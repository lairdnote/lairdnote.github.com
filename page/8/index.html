<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="codeva-HZoIBm8yNp" />
<meta name="bytedance-verification-code" content="xa6iZeY+/XCOJvarHaDY" />








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/8/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/8/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022/67-%E5%85%AB%E6%9C%88%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%97%A5%E7%A8%8B%E5%AE%89%E6%8E%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/67-%E5%85%AB%E6%9C%88%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%97%A5%E7%A8%8B%E5%AE%89%E6%8E%92/" itemprop="url">八月的两个日程安排</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-12T13:30:00+00:00">
                2022-07-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>今天预订了新开放的香港故宫文化博物馆的展览门票，本以为应该不会有很多人去参观，结果发现七月份的门票早就已经售罄，只能买到八月的门票了。顺便还预约了下个月去打新冠疫苗第四针，毕竟本轮疫情虽稍趋平缓，但是确诊人数依然较高。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2022/67-%E5%85%AB%E6%9C%88%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%97%A5%E7%A8%8B%E5%AE%89%E6%8E%92/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-7-9-videocompress/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-7-9-videocompress/" itemprop="url">如何将视频压缩到指定的大小？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-08T19:25:00+00:00">
                2022-07-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本文首发于微信公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/WUsSfnHuVvT2SWcso31qlQ">效率工具指南</a>」<br>文&#x2F;彭宏豪       </p>
<p>Hello 各位好，我是小豪。   </p>
<p>今天这篇文章，想来聊一下视频压缩这个话题。</p>
<p>如果只是单纯选择一款视频压缩工具，可以选择的压缩工具非常多：  </p>
<ul>
<li>Windows：小丸工具箱</li>
<li>Mac：Permute（付费软件，与 Mac 上非常出名的下载工具 Downie 来自一家公司）      </li>
<li>Window&#x2F;Mac：Handbrake、<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649919194&idx=1&sn=d51a53be3d5bdcb2f1c520800d55810e&chksm=83a88af7b4df03e137de5e218348c7f0cf34408d502605574b7ef859b28e4530b4c0dc8d37c4&token=658973878&lang=zh_CN#rd">Quick Cut</a></li>
</ul>
<p>关于 Quick Cut 的详细介绍，可以查看我之前发布在 B 站上的一期视频 </p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1G3411a7RN">做视频必备！多功能工具箱，解决90%视频剪辑难题【Quick Cut】</a>     </p>
<p><img src="https://img.penghh.fun/2022/07/09/qrcodea--a1-1.jpg" alt="QRcode_A — a1 -1-"></p>
<p>除了视频压缩工具的选择，有时还会遇到一些比较小众的需求，例如将视频压缩到不超过 20 MB。  </p>
<p>当然，对于不同的人或不同的场景，这里的 20 MB 可能要换成 10 MB，或者换成 50 MB，将不同的需求进行一般化，就得到了今天这篇文章的主题：  </p>
<p><strong>如何将视频压缩到指定的体积大小？</strong>    </p>
<p>对于这个问题，最简单的方法，就是找一个在开始压缩视频之前，可以<strong>提前得知</strong>压缩后视频体积大小的压缩工具。  </p>
<p>这里想推荐一个由国内厂商开发的多功能视频处理工具——<strong>万兴优转</strong>。    </p>
<p>这个工具用起来也非常简单：  </p>
<p>点击左侧栏的「视频压缩」，将想要压缩的视频拖拽到软件窗口中，点击右侧的「设置」按钮，在弹出的面板，拖动中间可自由滑动的图标，就能自定义视频的压缩强度，随之你就能在「文件大小」直接地看到压缩后的视频体积。  </p>
<p><img src="https://img.penghh.fun/2022/07/09/16573061654679.jpg"></p>
<p>压缩后的视频体积大小之所以有个范围，而不是某个确定的值，是因为软件默认选择了「<strong>可变比特率</strong>」，这里的比特率其实就是通常所说的「视频码率」。  </p>
<p>可变比特率的优点在于，它会根据视频帧画面的复杂程度，比较智能地匹配相应的码率，直白地理解就是：当视频画面比较复杂时，就会分配多一些的码率，而对于帧画面比较简单的情况，相应地码率就会降低。</p>
<p>因此，选择了可变比特率的情况下，在软件还没正式开始压缩前，只能根据比特率的上限和下限，得到一个大概的视频体积，就呈现为我们在下图看到的 48.4 MB 和 96.9 MB 这两个临界值。      </p>
<p><img src="https://img.penghh.fun/2022/07/09/16573064077783.jpg"></p>
<p><strong>可变比特率或者可变码率，我觉得叫做「动态码率」可能更直观，也更好理解。</strong>    </p>
<p>而如果我们把软件中的「可变比特率」更改为「恒定比特率」，压缩后的视频预估体积就是确定的，不存在前面有一个范围值的情况。    </p>
<p><img src="https://img.penghh.fun/2022/07/09/16573068367798.jpg"></p>
<p>当你选择了恒定比特率，就意味着压缩后每个帧画面的比特率都是一致的，这样有可能会出现一种情况：  </p>
<p>当视频中含有一些比较复杂的画面，例如烟雾、灰尘、粒子动效等，画面的画质表现就会非常差。   </p>
<p>好的，到这里就讲请了「如何将视频压缩到指定大小」的问题。   </p>
<p>更多关于视频码率、视频压缩、视频封装格式等知识，如果你感兴趣的话，可以前往去 B 站查看「影视飓风」发布的相关视频。   </p>
<p>需要说明的是，万兴优转虽然是一款可以免费下载的软件，但其中的不少功能也会存在限制，需要开通会员后用起来才比较舒服。  </p>
<p>由于我已经有了会员，就没有去对比免费版与付费版的差别，有需要的朋友自行比对吧。   </p>
<p>最后的最后，如果你不想花钱购买这款软件的会员，也还有一个方法，可以提前预估视频压缩后的体积大小，具体是如何做到的，我的一篇老文章里写过了：   </p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649914213&idx=1&sn=06869840e55c9d145f71773b35a20813&chksm=83a87f48b4dff65eb4e24ef5f00fa8e76f3406bc2ec583e343358ca24f2168d830f02531747d&token=658973878&lang=zh_CN#rd">高效批量压缩图片，Mark住这两个神器就够了。</a>       </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://img.penghh.fun/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">     </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022/06/risk-rule/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/06/risk-rule/" itemprop="url">基于准实时规则引擎的业务风控实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-28T12:00:00+00:00">
                2022-06-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>在当今复杂的互联网环境下，我们的系统时时刻刻都暴露在风险（刷单党、羊毛党）的攻击之中，如果我们不采取有效防御措施，那么这些风险就会对业务造成很大的损失。</p>
<p><img src="//www.fanhaobai.com/2022/06/risk-rule/24476377-1566-4cfd-bcd6-3d8af562e57c.png" alt="风控抽象过程">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2022/06/risk-rule/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-6-28-mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-6-28-mac/" itemprop="url">如何在Mac上快速切换窗口？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-27T16:36:00+00:00">
                2022-06-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本文首发于公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/U46M3GDfO3kVBDHGycbc8w">效率工具指南</a>」<br>文&#x2F;彭宏豪  </p>
<p>Hello 各位好，我是小豪。   </p>
<p>从 2020 年用 Mac 电脑以来，至今唯一还不习惯的是 Mac 上的窗口切换。  </p>
<p>当一个应用开了多个窗口之后，切换起来不是很习惯，你能想象其中一种切换方式是：右击 Dock 栏的软件图标，在弹出的菜单，才能看到应用打开的所有窗口。  </p>
<p>这种窗口切换，对比 Windows 上的「鼠标悬停在任务栏图标上方」，就能显示所有窗口，我还是更喜欢后者。   </p>
<p><img src="https://img.penghh.fun/2022/06/28/16563456961563.jpg"></p>
<p>因此为了把 Mac 上的这种切换方式，改回我更喜欢的方式，我在 Mac 上安装了一个第三方工具——<strong>DockMate</strong>。       </p>
<p><img src="https://img.penghh.fun/2022/06/28/16563461850799.jpg"></p>
<p>安装了 DockMate 之后，当我再次把鼠标放在 Dock 栏的图标上方，熟悉的感觉又回来了，这次不需要啥动作，鼠标悬停在图标上方，就会显示打开的所有窗口的缩略图。           </p>
<p><img src="https://img.penghh.fun/2022/06/28/16563465284421.jpg"></p>
<p>DockMate 是一款付费软件，价格还不是很便宜，有同样需求的朋友，可以前往下方的网站购买：   </p>
<p><a target="_blank" rel="noopener" href="https://www.macenhance.com/dockmate#">https://www.macenhance.com/dockmate#</a>!     </p>
<p><img src="https://img.penghh.fun/2022/06/28/16563469038078.jpg"></p>
<p>除了 DockMate，之前还介绍过 Mac 上另外一款增强窗口切换体验的应用——<strong>AltTab</strong>，使用快捷键 Option + Tab 可以呼出 AltTab 切换软件窗口的面板，相比 Mac 原生的窗口切换，这款软件提供了窗口预览，视觉效果也比较像 Windows 系统的设计。   </p>
<p><img src="https://img.penghh.fun/2022/06/28/16304971627851.jpg"></p>
<p>AltTab 是一款免费的软件，可从下方的官网链接下载：  </p>
<p><a target="_blank" rel="noopener" href="https://alt-tab-macos.netlify.app/">https://alt-tab-macos.netlify.app/</a>   </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://img.penghh.fun/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">     </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-6-26-miniprogram/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-6-26-miniprogram/" itemprop="url">微信小程序开发学习笔记 - 以网易云音乐小程序项目为例</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-26T04:06:00+00:00">
                2022-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p><em>注：笔记来自 coderwhy 老师的视频教程<a target="_blank" rel="noopener" href="https://ke.qq.com/course/4162214#term_id=104318954">小程序音乐项目开发实战-大神coderwhy新课</a></em>    </p>
<p><em>笔记编辑者：彭宏豪</em>    </p>
<h2 id="项目成果展示"><a href="#项目成果展示" class="headerlink" title="项目成果展示"></a>项目成果展示</h2><p>最后制作出来的音乐小程序，可以查看我发布在 B 站上的视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1CY411N7JJ">学着做了一个音乐小程序｜前端开发【效率工具指南】</a>    </p>
<h2 id="项目亮点"><a href="#项目亮点" class="headerlink" title="项目亮点"></a>项目亮点</h2><ul>
<li>轮播图实现在不同尺寸设备上的适配      </li>
<li>音乐播放页面在不同尺寸设备上的适配     </li>
<li>小程序插槽无法像 Vue 一样设置默认值，可以使用 CSS 的条件判断巧妙地实现    </li>
<li>数据多页面共享和状态管理（难点）      </li>
<li>防抖和节流（性能优化，难点，JS 高级，课程中没有详细展开讲解）      </li>
<li>第三方 UI 组件库 Vant 的使用    </li>
<li>毛玻璃效果的制作    </li>
<li>事件冒泡和阻止冒泡      </li>
<li>项目常量数据的管理    </li>
<li>代码分包       </li>
<li>📦「封装」和「抽取」思想</li>
</ul>
<h2 id="项目中用到的工具"><a href="#项目中用到的工具" class="headerlink" title="项目中用到的工具"></a>项目中用到的工具</h2><ul>
<li><p>代码编辑器：微信官方提供的「微信开发者工具」     </p>
</li>
<li><p>浏览器插件：FeHelper</p>
</li>
</ul>
<p>FeHelper 可以对服务器请求返回的 JSON 数据进行美化（格式化），美化后的效果，就和我们在「微信开发者工具」控制台 <code>console.log</code> 打印的内容外观一致了，看起来更舒服。     </p>
<p><img src="https://img.penghh.fun/2022/07/02/16566068661368.jpg"></p>
<p>顺便来看一下安装 FeHelper 插件之前，服务器返回的 JSON 数据的样式，作为对比：     </p>
<p><img src="https://img.penghh.fun/2022/07/02/16566070159756.jpg"></p>
<ul>
<li>正则表达式：正则表达式是字符串的匹配利器，在项目「解析歌词」的部分会用到。</li>
</ul>
<h2 id="各大厂商支持小程序的原因"><a href="#各大厂商支持小程序的原因" class="headerlink" title="各大厂商支持小程序的原因"></a>各大厂商支持小程序的原因</h2><p><img src="https://img.penghh.fun/2022/06/26/image-3.png" alt="image -3-"></p>
<h2 id="小程序是由谁来开发？"><a href="#小程序是由谁来开发？" class="headerlink" title="小程序是由谁来开发？"></a>小程序是由谁来开发？</h2><p>小程序的定位：介于原生 App 和手机 H5 页面之间的一个产品定位。<br>小程序的技术特点，决定了由前端工程师来开发</p>
<h2 id="开发小程序的技术选型"><a href="#开发小程序的技术选型" class="headerlink" title="开发小程序的技术选型"></a>开发小程序的技术选型</h2><ul>
<li>原生小程序开发</li>
<li>小程序框架<ul>
<li>mpvue</li>
<li>wepy</li>
<li>两个跨端方案开发小程序<ul>
<li>uni-app：基于 Vue 开发的框架</li>
<li>taro：由京东团队开发维护</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://img.penghh.fun/2022/06/26/image-4.png" alt="image -4-"></p>
<p>下图的 RN 是 React Native 的缩写，开发好之后可以发布为 iOS 和 Android 应用</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-5.png" alt="image -5-"></p>
<p>uni-app 和 taro 开发原生 App：</p>
<ul>
<li>无论是适配原生小程序还是原生 App，框架都有较多的适配问题，所以还是需要多了解原生的开发知识</li>
<li>产品使用体验整体相较于原生 App 差很多</li>
<li>也有其他的技术选型来开发原生 App：ReactNative、<strong>Flutter（体验也比较好）</strong></li>
</ul>
<p>作为前端工程师，不建议大家把过多精力放在原生开发上面，目前基本只有大厂才会开发原生 App，而很多小公司会开发小程序或 H5 页面。 </p>
<h2 id="小程序开发的预备知识"><a href="#小程序开发的预备知识" class="headerlink" title="小程序开发的预备知识"></a>小程序开发的预备知识</h2><p>小程序的核心技术主要是 3 个：</p>
<ul>
<li>页面布局：WXML</li>
<li>页面样式：WXSS，几乎就是 CSS（某些不支持，某些进行了增强，但基本是一致的）</li>
<li>页面脚本：JS + WXS(WeixinScript)</li>
</ul>
<p>如果之前已经掌握了 Vue 或者 React 等框架开发，那么学习小程序是更简单的，因为里面的核心思想都是一致的（比如<strong>组件化开发、数据响应式、mustache 语法、事件绑定</strong>等）</p>
<h2 id="微信小程序的双线程架构"><a href="#微信小程序的双线程架构" class="headerlink" title="微信小程序的双线程架构"></a>微信小程序的双线程架构</h2><ul>
<li>视图线程</li>
<li>逻辑线程</li>
</ul>
<p>这两个线程通过底层的 WeixinJSBridge 进行通讯</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-6.png" alt="image -6-"></p>
<h2 id="注册账号-申请-AppID"><a href="#注册账号-申请-AppID" class="headerlink" title="注册账号 - 申请 AppID"></a>注册账号 - 申请 AppID</h2><p>每个小程序都需要有一个唯一的 ID<br>前往 mp.weixin.qq.com 申请</p>
<h2 id="开发微信小程序的工具"><a href="#开发微信小程序的工具" class="headerlink" title="开发微信小程序的工具"></a>开发微信小程序的工具</h2><ul>
<li>微信开发者工具：官方提供的工具，必须下载、安装</li>
<li>VS Code</li>
</ul>
<h3 id="使用-VS-Code-开发"><a href="#使用-VS-Code-开发" class="headerlink" title="使用 VS Code 开发"></a>使用 VS Code 开发</h3><p>推荐一些 VS Code 插件：</p>
<ul>
<li>WXML - Language Service</li>
<li>小程序开发助手</li>
<li>wechat-snippet</li>
</ul>
<p>注：这些插件都是差不多的，不需要全部安装，老师推荐安装第一个插件就够了</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-7.png" alt="image -7-"></p>
<h2 id="小程序项目结构"><a href="#小程序项目结构" class="headerlink" title="小程序项目结构"></a>小程序项目结构</h2><p><img src="https://img.penghh.fun/2022/06/26/image-8.png" alt="image -8-"></p>
<h2 id="去除控制台的警告⚠️信息"><a href="#去除控制台的警告⚠️信息" class="headerlink" title="去除控制台的警告⚠️信息"></a>去除控制台的警告⚠️信息</h2><p>打开项目的 <code>project.config.json</code> 文件，在其中增加一个配置信息 <code>&quot;checkSiteMap&quot;: flase</code>，就可以去掉控制台的警告信息了。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-9.png" alt="image -9-"></p>
<h2 id="微信小程序基础库"><a href="#微信小程序基础库" class="headerlink" title="微信小程序基础库"></a>微信小程序基础库</h2><p>我们编写的代码，其实是运行在微信小程序 SDK 之上的，SDK 是 Soft Development Kit 的缩写，即<strong>软件开发工具包</strong>，SDK 是集成在微信 App 中的。</p>
<p>这里提到的 SDK 其实就是微信小程序的基础库。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-10.png" alt="image -10-"></p>
<p>基础库是会随着时间不断更新的，因此会衍生出多个版本：</p>
<ul>
<li>增加功能</li>
<li>修复 bug</li>
</ul>
<p>微信版本不同，其中包含的微信小程序基础库版本是不同的。</p>
<p>灰度发布：也叫金丝雀发布。<br>全量发布</p>
<h2 id="向服务器请求数据"><a href="#向服务器请求数据" class="headerlink" title="向服务器请求数据"></a>向服务器请求数据</h2><p>await 必须放到 async 异步函数里面。<br>这种方式不是在所有地方都可以使用的，在某些地方使用可能会影响性能。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-11.png" alt="image -11-"></p>
<h2 id="小程序的视频无法播放"><a href="#小程序的视频无法播放" class="headerlink" title="小程序的视频无法播放"></a>小程序的视频无法播放</h2><p>遇到小程序中的视频无法播放，可能是因为向服务器请求数据时验证不通过，我们需要在 video 组件中增加一个推荐策略的属性 <code>referrer-policy</code>，这个属性的默认值是 no-referrer，我们要把它设置为 origin。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-12.png" alt="image -12-"></p>
<h2 id="对-wxml-的数据进行格式化"><a href="#对-wxml-的数据进行格式化" class="headerlink" title="对 wxml 的数据进行格式化"></a>对 wxml 的数据进行格式化</h2><p>wxml 页面从服务器请求得到的视频播放量、时间（单位为毫秒 ms），转换为 XX 万播放量、几分几秒，不能直接在 wxml 的 mustache 语法使用过滤器 filter。</p>
<p>对 wxml 的数据进行格式化，需要用到 wxs，wxs 本质上也是 js，只不过不支持 ES6 语法，只能用 ES5。 </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-13.png" alt="image -13-"></p>
<p>在 utils 文件中创建一个 <code>format.wxs</code> 文件，里面定义了一个函数 formatCount，用来转换视频播放量。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-14.png" alt="image -14-"></p>
<p>接着在 wxml 文件中使用 wxs 标签引用 wxs 文件，wxs 标签需要添加一个 module 属性，属性值是可以自定义的，可以是 tools，也可以是 format。<br>在需要调用 formatCount 函数的位置，使用 module 属性值中的方法。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-15.png" alt="image -15-"></p>
<h2 id="将-wxml-中的组件抽取成一个单独的组件"><a href="#将-wxml-中的组件抽取成一个单独的组件" class="headerlink" title="将 wxml 中的组件抽取成一个单独的组件"></a>将 wxml 中的组件抽取成一个单独的组件</h2><p>小程序中创建的组件，同样需要包含 4 个文件——js、json、wxml、wxss</p>
<p>创建组件时，右击选择「新建 Component」，会一次性创建 4 个文件。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-37.png" alt="image -37-"></p>
<p>组件的 <code>index.js</code> 文件 Component 包含 properties 和 data，这两者的区别在于：</p>
<p>data 和页面一样，是用来存放组件内部的数据的；properties 用来<strong>存放外界传过来的数据</strong>，譬如服务器请求得到的数据，</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-38.png" alt="image -38-"></p>
<p>properties 会接收外部传入的 item 对象。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-39.png" alt="image -39-"></p>
<h2 id="在小程序中使用自定义的组件"><a href="#在小程序中使用自定义的组件" class="headerlink" title="在小程序中使用自定义的组件"></a>在小程序中使用自定义的组件</h2><p>在小程序页面使用自定义的组件时，需要先对组件进行注册，来到小程序页面的 json 文件。</p>
<p>注册组件的写法：<br><code>&quot;组件名&quot;: &quot;组件的路径&quot;</code><br>组件路径最末尾不要加后缀。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-40.png" alt="image -40-"></p>
<p>在 wxml 页面使用我们自定义的组件   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-41.png" alt="image -41-"></p>
<h2 id="小程序页面上拉加载更多数据"><a href="#小程序页面上拉加载更多数据" class="headerlink" title="小程序页面上拉加载更多数据"></a>小程序页面上拉加载更多数据</h2><p>在页面的 js 文件中，使用生命周期 <code>onReachBottom</code> 监听。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-42.png" alt="image -42-"></p>
<p>上拉加载数据时，可以在导航栏增加一点细节，譬如增加「加载数据」时的转圈动画<br>需要用到 <code>wx.showNavigationBarLoading()</code><br>数据完成加载后，要把加载动画隐藏，否则加载动画会一直显示在顶部的导航栏，调用 <code>wx.hideNavigationBarLoading()</code>   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-43.png" alt="image -43-"></p>
<h2 id="小程序页面下拉刷新"><a href="#小程序页面下拉刷新" class="headerlink" title="小程序页面下拉刷新"></a>小程序页面下拉刷新</h2><p>小程序页面默认情况下是不允许下拉刷新的，需要在页面的 json 文件中，将 enablePullDownRefresh 配置为 true，才可以实现下拉刷新。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-44.png" alt="image -44-"></p>
<p>同时，要在 json 中配置 <code>backgroundTextStyle</code> ，将默认的 light 更改为 dark，在下拉刷新时才能看见 3 个小点点。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-45.png" alt="image -45-"></p>
<p>当偏移量为 0 时，停止下拉刷新的动效，让动效尽快结束。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-46.png" alt="image -46-"></p>
<h2 id="点击组件跳转到新的页面"><a href="#点击组件跳转到新的页面" class="headerlink" title="点击组件跳转到新的页面"></a>点击组件跳转到新的页面</h2><p>新的需求：点击视频页面的小卡片（组件&#x2F;item），进入视频详情页。</p>
<p>这时我们就要监听 item 的点击，有两种方式：</p>
<ul>
<li>组件内部监听点击</li>
<li>直接监听组件的点击（组件可以直接绑定事件的）</li>
</ul>
<p><img src="https://img.penghh.fun/2022/06/26/image-47.png" alt="image -47-"></p>
<h3 id="组件内部监听点击事件"><a href="#组件内部监听点击事件" class="headerlink" title="组件内部监听点击事件"></a>组件内部监听点击事件</h3><p>来到自定义组件的 wxml 页面，给类名为 item 的 view 组件添加 bindtap，监听点击事件。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-48.png" alt="image -48-"></p>
<h3 id="直接监听组件的点击"><a href="#直接监听组件的点击" class="headerlink" title="直接监听组件的点击"></a>直接监听组件的点击</h3><p>在我们自定义的组件 <code>video-item-v1</code> 添加 bindtap 属性，可以直接监听组件的点击。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-49.png" alt="image -49-"></p>
<p>我们点击不同的组件，会跳转到不同的详情页，那我们如何知道具体是点击了哪个页面呢？<br>——这里需要在 wxml 中给组件添加一个额外的属性 data-item。<br>之后在事件处理时，我们就可以通过 data-item 绑定的 item，拿到所点击的组件的 id，就可以知道用户到底是点击了哪一个组件。<br>这种拿到 id 的方法，并不是小程序独有的，而是 html 提供的能力。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-50.png" alt="image -50-"></p>
<h2 id="在小程序引入第三方-UI-库-Vant"><a href="#在小程序引入第三方-UI-库-Vant" class="headerlink" title="在小程序引入第三方 UI 库 Vant"></a>在小程序引入第三方 UI 库 Vant</h2><p>进入项目所在的路径，在终端输入 <code>npm init -y</code> 生成 <code>package.json</code> 文件。<br>如果项目中包含了中文名称的文件夹，使用上面的命令会无法生成 json 文件，需要使用命令 <code>npm init</code> 。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-51.png" alt="image -51-"></p>
<p>通过 npm 安装 Vant：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @vant/weapp</span><br></pre></td></tr></table></figure>

<p>安装之后，项目文件夹会多出一个 <code>node_modules</code> 文件夹，里面就包含了我们刚安装的 Vant 库。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-52.png" alt="image -52-"></p>
<p><code>node_modules</code> 中的 Vant 库在小程序中无法直接使用，还需要经过构建 npm 的环节，构建之后，项目路径会生成一个新的文件夹 <code>miniprogram_npm</code> 。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-53.png" alt="image -53-"></p>
<p>完成构建之后，就可以开始使用 Vant 库了。<br>在想要使用 Vant 库的页面的 json 文件中，注册需要用到的组件，譬如其中的搜索框组件 <code>van-search</code>。    </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-54.png" alt="image -54-"></p>
<p>接着在 wxml 文件中使用 <code>van-search</code> 组件，编译之后就能看到搜索框了。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-55.png" alt="image -55-"></p>
<h2 id="小程序轮播图组件"><a href="#小程序轮播图组件" class="headerlink" title="小程序轮播图组件"></a>小程序轮播图组件</h2><p>小程序轮播图组件 swiper 默认的高度为 150px。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-56.png" alt="image -56-"></p>
<p>换到 iPhone5 小尺寸的手机上，轮播图组件高度依旧为 150px，原本位于图片上方的指示点就会显示在图片下方，看起来非常丑陋。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-57.png" alt="image -57-"></p>
<p>解决适配的问题，稍微有些麻烦。<br>解决的方法：轮播图组件的高度应该和图片的高度是一致的。<br>问题是：如何获取图片的高度（<strong>如何获取一张网络请求得到的图片的高度</strong>）。    </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-58.png" alt="image -58-"></p>
<p>这里需要注意的是，只有当图片完成加载，我们才能拿到网络图片的高度。</p>
<p>小程序的图片组件 image 有一个事件监听 <code>bindload</code>，可以在图片完成加载时，自动触发事件。</p>
<p>bindload 绑定了 handleSwiperImageLoaded 后，拿到的是图片原始的宽度和高度。</p>
<p>但我们这里想要的是 image 组件的高度，问题又转变成了：如何获取 image 组件的高度？<br>——需要用到小程序的 API <code>createSelectorQuery</code></p>
<p><img src="https://img.penghh.fun/2022/06/26/image-59.png" alt="image -59-"></p>
<h2 id="请求次数过多的处理方法"><a href="#请求次数过多的处理方法" class="headerlink" title="请求次数过多的处理方法"></a>请求次数过多的处理方法</h2><p>请求次数过多，会造成性能的负担，这里有两种可供选择的方法：</p>
<ul>
<li>防抖</li>
<li>节流</li>
</ul>
<h2 id="setData-是同步的还是异步的？"><a href="#setData-是同步的还是异步的？" class="headerlink" title="setData 是同步的还是异步的？"></a>setData 是同步的还是异步的？</h2><p>在小程序的 js 文件中，我们经常会用到 setData 来给 data 对象中的变量设置值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">banners</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">banners</span>: res.<span class="property">banners</span> &#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">banners</span>)</span><br></pre></td></tr></table></figure>
<p>如果 setData 是同步的，setData 设置了 banner 的值，下面的打印语句可以拿到最新设置的 banners 的值。<br>如果 setData 是异步的，setData 可能还没执行完设置值的语句，下面的打印语句就开始运行了，因为是<strong>异步的，setData 没执行完，并不会阻塞后面的打印语句</strong>，因此打印语句不一定能拿到最新设置的 banners 的值。</p>
<p>其实，setData 在设置 data 数据时，是同步的。<br>而通过最新的 data 数据对 wxml 进行渲染，渲染的过程 setData 是异步的。</p>
<p>setData 在设置 data 数据时，之所以是同步的，可能是为了方便我们在第 7 行打印语句中拿到最新设置的 banners 值。</p>
<h2 id="为轮播图组件设置圆角"><a href="#为轮播图组件设置圆角" class="headerlink" title="为轮播图组件设置圆角"></a>为轮播图组件设置圆角</h2><p>设置圆角，需要用到 wxss 中的 <code>border-radius</code>，但这个属性设置的圆角在某些手机系统上不起作用，是因为手机系统使用 web-view 来渲染类似 html 的页面时，会存在适配的问题（web-view 的 bug）。</p>
<p>解决这个 bug 的方法，添加额外的样式 transform</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.banner</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">0</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="区域标题自定义组件-area-header"><a href="#区域标题自定义组件-area-header" class="headerlink" title="区域标题自定义组件 area-header"></a>区域标题自定义组件 area-header</h2><p>自定义组件 <code>area-header</code> 配置好了左侧 title 的默认值，我们可以在使用的时候，为 title 设置新的值，就可以替换到默认的值。 </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-60.png" alt="image -60-"></p>
<h2 id="小程序插槽"><a href="#小程序插槽" class="headerlink" title="小程序插槽"></a>小程序插槽</h2><p>为什么要使用插槽？</p>
<p>我们封装的区域标题组件，右侧的内容，在不同的场景下，显示的内容是不一样的（内容会动态变化的），如果想要让封装的组件更加灵活，就需要用到插槽。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-61.png" alt="image -61-"></p>
<p>不像 Vue，<strong>微信小程序无法给插槽 slot 设置默认值</strong>，但还是有相应的解决方法的，主要有两种：  </p>
<ul>
<li>js</li>
<li>css：通过 CSS 伪类和连接器来解决</li>
</ul>
<p>我们在封装的组件 area-header 中预留了插槽的位置，如何实现 <strong>插槽默认值</strong> 和 <strong>在使用组件时往插槽插入内容</strong> 的<strong>互斥显示</strong>呢？</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-62.png" alt="image -62-"></p>
<p>下面介绍基于 css 样式来解决这个问题的方法：</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-63.png" alt="image -63-"></p>
<p>使用自定义组件 area-header，不往插槽中插入内容时，就会显示插槽的默认值 <code>更多 &gt;</code>。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-64.png" alt="image -64-"></p>
<h2 id="在小程序中使用多个插槽"><a href="#在小程序中使用多个插槽" class="headerlink" title="在小程序中使用多个插槽"></a>在小程序中使用多个插槽</h2><p>在一个小程序页面中使用多个插槽，可以像在 Vue 里一样，使用具名插槽，给每个插槽 slot 添加一个 name 属性，对插槽进行区分。</p>
<p>同时，<strong>当你在一个页面中使用多个插槽，需要在页面的 js 文件额外配置一个 options 字段</strong>，将 <code>multipleSlots</code>配置为 true。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-65.png" alt="image -65-"></p>
<h2 id="小程序多页面的状态管理"><a href="#小程序多页面的状态管理" class="headerlink" title="小程序多页面的状态管理"></a>小程序多页面的状态管理</h2><p>学习这个知识，是为了实现数据在多页面间共享（即多个页面会用到一份数据）的功能。</p>
<p>页面间的通讯包含两部分：</p>
<ul>
<li><strong>跨页面之间事件的传递</strong>：页面发出一个事件 event，其他的页面会进行监听。现在有很多的库来帮我们实现跨页面之间事件的传递，例如 mitt，mitt 库实际上就是<strong>事件总线</strong>。事件总线的库一般只负责帮助我们传递事件，并<strong>不会管理状态</strong>。</li>
<li>跨页面之间数据的共享和响应（<strong>状态共享</strong>）：页面会共享出一些数据（产生一些共享数据），其他页面可以使用这些数据，并且当共享的数据发生变化时，其他用到了共享数据的页面也会做出响应，自动更新数据。</li>
</ul>
<p><img src="https://img.penghh.fun/2022/06/26/image-66.png" alt="image -66-"></p>
<p>在不同的框架中，采用的不同方案来完成<strong>数据的共享</strong>：</p>
<ul>
<li>Vue 框架：Vuex（即 Vue 路由）</li>
<li>React：redux、react-redux</li>
<li>微信小程序<ul>
<li>方案一：把需要共享的数据放到全局的 <code>app.js</code> 中，在文件里面增加一个 globalData 的属性</li>
<li>其他方案：官方目前没有提供更好的方案；GitHub 有一些解决方案，但不够好。</li>
<li>更多方案：使用 coderwhy 老师写的库 <code>hy-event-store</code>，一个基于事件的全局状态管理工具，不仅可以在小程序中使用，也可以在 Vue、React 中使用。项目地址：<a target="_blank" rel="noopener" href="https://github.com/coderwhy/hy-event-store">https://github.com/coderwhy/hy-event-store</a></li>
</ul>
</li>
</ul>
<p><strong>方案一</strong></p>
<p>app.js -&gt; globalData: { name: phh }<br>其他页面想使用共享的数据 -&gt; getApp().globalData.name 就可以拿到共享的数据<br>这种方案有一个致命的缺点：<strong>数据不是响应式的</strong>（不能根据最新的数据，去渲染页面）</p>
<p>方案一实际上只能共享数据，无法做到响应式。</p>
<h2 id="小程序状态管理第三方库-hy-event-store"><a href="#小程序状态管理第三方库-hy-event-store" class="headerlink" title="小程序状态管理第三方库 hy-event-store"></a>小程序状态管理第三方库 hy-event-store</h2><p>安装 hy-event-store 库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hy-event-store </span><br></pre></td></tr></table></figure>

<p>当我们用 npm 安装了新的包之后，需要构建一下 npm。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-67.png" alt="image -67-"></p>
<p>在根目录下创建一个文件夹 store，用来存放共享的数据。其中的 <code>index.js</code> 作为统一导出的出口。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-68.png" alt="image -68-"></p>
<p>在需要用到共享数据的页面的 js 文件，在 onLoad 生命周期<strong>发起共享数据的请求</strong>和<strong>从 store 获取共享数据</strong>。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-69.png" alt="image -69-"></p>
<h2 id="推荐歌曲列表自定义组件-song-item-v1"><a href="#推荐歌曲列表自定义组件-song-item-v1" class="headerlink" title="推荐歌曲列表自定义组件 song-item-v1"></a>推荐歌曲列表自定义组件 song-item-v1</h2><p>自定义组件 song-item-v1 用到了 mustache 语法，需要将页面请求得到的数据，通过设置的 item 属性传递给自定义组件。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-70.png" alt="image -70-"></p>
<p>自定义组件的 js 文件中的 properties 属性，接收数据。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-71.png" alt="image -71-"></p>
<h2 id="全局共享数据"><a href="#全局共享数据" class="headerlink" title="全局共享数据"></a>全局共享数据</h2><p>我们在做项目的过程当中，可能会在不同页面中用到手机的屏幕宽度，出于这个考虑，我们可以把这个数据放在 <code>app.js</code> 中。 </p>
<p><code>wx.getSystemInfoSync</code>API 可以拿到当前手机设备的信息，例如手机屏幕的宽度和高度。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-72.png" alt="image -72-"></p>
<p>把获取到的手机屏幕宽度和高度数据，存入全局对象 <code>globalData</code> 中。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-73.png" alt="image -73-"></p>
<p>如何在组件中使用全局共享的数据？</p>
<p>两个步骤：</p>
<ul>
<li>使用 getApp() 方法获取全局对象 app；</li>
<li>在 data 中使用全局对象的方法，就能得到我们刚刚获取的 screenWidth</li>
</ul>
<p><img src="https://img.penghh.fun/2022/06/26/image-74.png" alt="image -74-"></p>
<p>拿到屏幕宽度后，我们可以给 scroll-view 组件设置行内样式 <code>style=&quot;width: &#123;&#123;screenWidth&#125;&#125;px&quot;</code>，这样 scroll-view 组件的宽度就和手机屏幕宽度是一致的。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-75.png" alt="image -75-"></p>
<p>同样是让 scroll-view 组件宽度等于屏幕宽度，还有另外一种<strong>更为简单的方法</strong>：</p>
<p>把 scroll-view 组件的宽度设置为 <strong>100 vw</strong>，等于视口的宽度，即整个屏幕的宽度。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-76.png" alt="image -76-"></p>
<p>另外一个全局共享数据的例子：</p>
<p>我们需要根据不同的设备，动态地获取页面顶部状态栏的高度，由于这个动态获取状态栏高度的需求，可能在多个页面中都是会用到的，我们可以把它放到 <code>app.js</code> 文件中。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-77.png" alt="image -77-"></p>
<h2 id="编程语言-数据处理"><a href="#编程语言-数据处理" class="headerlink" title="编程语言 - 数据处理"></a>编程语言 - 数据处理</h2><p>coderwhy 老师在上课时候讲到一句名言：所有的编程语言最终落实到的都是对数据的处理。<br>我们可以怎样地把数据组织得更合适一点<br>之后在另外一个地方就可以更加方便地使用这些数据</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-78.png" alt="image -78-"></p>
<p>数据结构：告诉你应该怎样更高效地组织数据<br>算法：在组织数据的过程当中，如何可以进行优化（优化获取或存储）</p>
<h2 id="单行文本溢出隐藏显示-CSS"><a href="#单行文本溢出隐藏显示-CSS" class="headerlink" title="单行文本溢出隐藏显示 - CSS"></a>单行文本溢出隐藏显示 - CSS</h2><p>溢出隐藏显示为省略号</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-79.png" alt="image -79-"></p>
<h2 id="页面跳转时携带参数"><a href="#页面跳转时携带参数" class="headerlink" title="页面跳转时携带参数"></a>页面跳转时携带参数</h2><p>默认情况下，页面跳转 url 链接的写法为<br><code>url: &#39;/pages/detail-songs/index&#39;,</code></p>
<p>如果跳转页面时需要携带参数，url 原本的单引号就要更改为 &#96;&#96;，且需要在 index 末尾增加参数  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-80.png" alt="image -80-"></p>
<p>在跳转的目标页面，我们可以在页面的 js 文件的 onLoad 生命周期，通过 <code>function(options) &#123;&#125;</code> 拿到携带过来的参数。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-81.png" alt="image -81-"></p>
<h2 id="CSS-制作毛玻璃效果"><a href="#CSS-制作毛玻璃效果" class="headerlink" title="CSS 制作毛玻璃效果"></a>CSS 制作毛玻璃效果</h2><p>毛玻璃效果由两个图层组成，一个是最下方的图片，一个是上层的半透明色块，给半透明色块加上模糊滤镜，就能得到想要的毛玻璃效果。<br>两个图层都采取<strong>相对定位</strong>，<code>z-index</code> 的值为 -1，半透明色块添加 <code>backdrop-filter: blur(5px)</code>，就能加上毛玻璃效果。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-82.png" alt="image -82-"></p>
<h2 id="搜索框的防抖操作"><a href="#搜索框的防抖操作" class="headerlink" title="搜索框的防抖操作"></a>搜索框的防抖操作</h2><p>在前端开发中涉及到搜索功能时，通常都要用到防抖操作。主要是对发送网络请求的函数进行防抖操作，减少对服务器的频繁请求。</p>
<p>防抖函数的文件一般命名为 <code>debounce.js</code></p>
<h2 id="搜索框监听用户按下了回车键-Enter"><a href="#搜索框监听用户按下了回车键-Enter" class="headerlink" title="搜索框监听用户按下了回车键 Enter"></a>搜索框监听用户按下了回车键 Enter</h2><p>在搜索框组件 <code>van-search</code> 绑定一个事件 <code>bind:search</code>，可以用来监听用户按下了回车键 Enter。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-83.png" alt="image -83-"></p>
<h2 id="搜索框固定定位"><a href="#搜索框固定定位" class="headerlink" title="搜索框固定定位"></a>搜索框固定定位</h2><p>当我们把顶部的搜索框设置为<strong>固定定位</strong>时，搜索框不占位置，下方的搜索结果会与浮在最上面的搜索框重叠在一起。</p>
<p>解决方法：给页面设置一个 padding-top，padding-top 的数值等于搜索框的高度。</p>
<p>还有一个细节，当我们为固定定位的搜索框设置了左右两侧的距离，它就会根据设置的距离，自动计算搜索框的宽度。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-84.png" alt="image -84-"></p>
<h2 id="自定义小程序页面顶部状态栏"><a href="#自定义小程序页面顶部状态栏" class="headerlink" title="自定义小程序页面顶部状态栏"></a>自定义小程序页面顶部状态栏</h2><p>小程序页面顶部的状态栏默认会显示系统的时间和电量，我们制作的音乐播放页面，想让播放页充满整个页面，就需要在页面的 json 中添加配置 <code>&quot;navigationStyle&quot;: &quot;custom&quot;</code>。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-85.png" alt="image -85-"></p>
<h2 id="获取不同机型（设备）状态栏的高度"><a href="#获取不同机型（设备）状态栏的高度" class="headerlink" title="获取不同机型（设备）状态栏的高度"></a>获取不同机型（设备）状态栏的高度</h2><p>这里的获取分成两种场景：</p>
<ul>
<li>页面获取</li>
<li>自定义组件获取</li>
</ul>
<p>页面获取，要把获取状态栏高度的函数写在页面 js 的 onLoad 生命周期中。<br>组件获取，通常情况下把获取状态栏高度的函数，写在组件的 lifetimes 生命周期中。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-86.png" alt="image -86-"></p>
<h2 id="小程序分页效果"><a href="#小程序分页效果" class="headerlink" title="小程序分页效果"></a>小程序分页效果</h2><p>点击页面顶部的 Tab，或是左右滑动可以切换到不同的页面，这种分页效果该怎么实现呢？</p>
<p>有 3 种方案：</p>
<ul>
<li>自己封装分页</li>
<li>使用第三方组件</li>
<li>使用小程序内置组件 swiper（类似轮播图）</li>
</ul>
<p><img src="https://img.penghh.fun/2022/06/26/image-87.png" alt="image -87-"></p>
<h2 id="项目中的「常量」管理"><a href="#项目中的「常量」管理" class="headerlink" title="项目中的「常量」管理"></a>项目中的「常量」管理</h2><p>不建议在 js 文件中直接使用「常量」进行运算，因为之后想要对常量进行更改，如果项目多个地方都用到了一个常量，就要在多处进行修改，维护起来比较麻烦。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-88.png" alt="image -88-"></p>
<p>对「常量」的处理方法有两种：</p>
<p>一种是在项目中建立一个专门用来存放常量的文件夹，例如下图的 constants 文件夹，里面有一个用于存放设备信息（常量）的 <code>device-const.js</code> 文件，导出我们需要用到的导航栏高度 44。</p>
<p>这种常量的管理方法常用于<strong>项目中有比较多常量</strong>的场景。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-89.png" alt="image -89-"></p>
<p>另外一种是将用到的常量放在全局的 <code>app.js</code> 文件，并对其初始化，在需要使用的时候，通过 getApp() 函数调用。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-90.png" alt="image -90-"></p>
<h2 id="页面在不同设备上的适配"><a href="#页面在不同设备上的适配" class="headerlink" title="页面在不同设备上的适配"></a>页面在不同设备上的适配</h2><p>音乐播放页面在不同型号的设备上，会因为<strong>屏幕高度的不同</strong>涉及到适配的问题。</p>
<p>这里我们采取的布局方式是，整个页面采用 flex 布局，flex-direction 设置为 column，即垂直方向为主轴，其他的部分都是由文字内容的大小、icon 图标的高度、内外边距撑起来的，而剩下两块——专辑的封面和歌词的高度，是由屏幕的高度来动态决定的，即它们的高度之和等于 屏幕高度 - 所有其他元素的高度之和，再由设置的 flex 数值来分配剩余的高度，譬如我们这里把专辑封面高度的比例设置为 4，歌词高度的比例设置为 1。 </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-91.png" alt="image -91-"></p>
<h2 id="小程序播放音乐"><a href="#小程序播放音乐" class="headerlink" title="小程序播放音乐"></a>小程序播放音乐</h2><p>小程序的 audio 组件已经停止维护了。<br>想要在小程序中添加音乐，需要使用能力更强的 <code>wx.createInnerAudioContext</code> API。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const audioContext = wx.createInnerAudioContext() </span><br><span class="line"></span><br><span class="line">// 设置音乐的 url 地址</span><br><span class="line">audioContext.src = <span class="string">&quot;url&quot;</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://img.penghh.fun/2022/06/26/image-92.png" alt="image -92-"></p>
<p><img src="https://img.penghh.fun/2022/06/26/image-93.png" alt="image -93-"></p>
<h2 id="歌词解析"><a href="#歌词解析" class="headerlink" title="歌词解析"></a>歌词解析</h2><p>课程视频：<a target="_blank" rel="noopener" href="https://ke.qq.com/webcourse/4162214/104318954#taid=12375291137589926&vid=387702294493689826">播放器暂停、上一首、下一首、进度控制（2）</a></p>
<p>我们从服务器请求得到的歌词，是放在一个大的字符串 lyric 里面，需要先对这个大的字符串进行分割，分割成一行行的歌词。   </p>
<p>通过每句歌词之间的换行符 <code>\n</code> 进行分割：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lyricString = res.<span class="property">lrc</span>.<span class="property">lyric</span>   </span><br><span class="line"><span class="keyword">const</span> lyricSingle = lyricString.<span class="title function_">split</span>(<span class="string">&quot;\n&quot;</span>)   </span><br></pre></td></tr></table></figure>

<p><img src="https://img.penghh.fun/2022/07/02/16566068661368.jpg"></p>
<p>split() 方法分割之后得到的一个数组，数组里面的每个元素是一个字符串，由时间和歌词组成。  </p>
<p>[“[00:00.000] 作词 : 唐恬”, “[00:00.576] 作曲 : 钱雷”, ……]    </p>
<p>用 for……of 遍历上面的数据，可以得到一行行的字符串 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> lineString <span class="keyword">of</span> lyricSingle) &#123;</span><br><span class="line">    <span class="comment">// [00:00.000] 作词 : 唐恬</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(lineString)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到一个个字符串之后，我们要对字符串进行拆分，取出里面的时间 <code>00:00.000</code> 和歌词文本「作词 : 唐恬」。   </p>
<p>取出时间比较麻烦，这里需要用到<strong>正则表达式</strong>。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 我们想要匹配的是 [00:00.000]</span></span><br><span class="line"><span class="keyword">const</span> timeRegExp = <span class="regexp">/\[(\d&#123;2&#125;):(\d&#123;2&#125;)\.(\d&#123;2,3&#125;)\]/</span>     </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>正则表达式要使用 <code>/ /</code> 进行包裹。  </p>
<p>方括号 [] 在正则表达式中是有特殊含义的，比如当我们想匹配 a 到 z 的字母，就会写 [a-z]，在中括号里会写上<strong>匹配的范围</strong>。</p>
<p>这里想匹配的时间左右两侧有中括号，因此在匹配的时候，需要在中括号前面加上转义的反斜杆 \。   </p>
<p>时间左右两侧的中括号匹配出来之后，我们就可以写里面想匹配的时间（分、秒、毫秒），每一块的匹配在正则表达式中使用小括号 <code>()</code> 进行分割。   </p>
<p>这里需要注意的是，英文句号 <code>.</code> 在正则表达式中也有特殊含义，因此要在英文句号前面加多一个反斜杆。  </p>
<p>接着我们就可以逐一写每一个小括号里面的匹配规则了：  </p>
<p>匹配分钟：(\d{2})</p>
<p>(\d)，<code>\d</code> 表示<strong>匹配数字</strong>，也可以写成 [0-9]，但这种形式有点长，我们更倾向于写更简短的 <code>\d</code>。  </p>
<p>在 <code>\d</code> 后面加上 <code>&#123;2&#125;</code> 表示我们想匹配两个数字。  </p>
<p>匹配秒钟：(\d{2})</p>
<p>匹配毫秒：(\d{2,3})</p>
<p>毫秒有些特殊，既有两个数字，也有 3 个数字的情况。  </p>
<p>[00:02.304]<br>[00:04.92]   </p>
<p><code>\d</code> 后面的规则需要改一改，写成 {2,3}，匹配两到三个，匹配 2 个或 3 个数字。  </p>
<p>⚠️ 注意：<strong>正则表达式中不能随意加空格</strong>，{2,3} 和 {2, 3} 在正则表达式中是不一样的。   </p>
<p>写好正则表达式之后，可以<strong>使用正则表达式对字符串进行执行</strong>，匹配出我们想要的东西。   </p>
<p>执行的意思是，我们要用正则表达式 timeRegExp 去匹配字符串 lineString 中的东西了。   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeRegExp = <span class="regexp">/\[(\d&#123;2&#125;):(\d&#123;2&#125;)\.(\d&#123;2,3&#125;)\]/</span>   </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> lineString <span class="keyword">of</span> lyricSingle) &#123;</span><br><span class="line">    <span class="comment">// [00:00.000] 作词 : 唐恬</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(lineString)  </span><br><span class="line">    <span class="keyword">const</span> timeResult = timeRegExp.<span class="title function_">exec</span>(lineString)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(timeResult)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打印正则表达式匹配出来的结果 timeResult，会发现匹配结果是一个个的数组。   </p>
<p>每个数组中第 2、第 3、第 4 个元素，就是我们想要的分钟、秒钟、毫秒。   </p>
<p><img src="https://img.penghh.fun/2022/07/02/16567361817322.jpg"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> minute = timeResult[<span class="number">1</span>] * <span class="number">60</span> * <span class="number">1000</span>  </span><br><span class="line"><span class="keyword">const</span> second = timeResult[<span class="number">2</span>] * <span class="number">1000</span></span><br><span class="line"><span class="keyword">const</span> millisecond = timeResult[<span class="number">3</span>]  </span><br></pre></td></tr></table></figure>

<p>这里还需要分别把分钟、秒转换为毫秒，等会方便与进度条的 currentTime（单位为毫秒） 相匹配。     </p>
<blockquote>
<p>一个 JS 的知识点：JS 中，数字字符串（例如我们这里拿到的 “02” 就是一个数字字符串）与一个数字相乘时，数字字符串会隐式转换为一个数字，就可以正常运算了。      </p>
</blockquote>
<p>最后匹配到的毫秒，比较特殊，有两位数字，也有三位数字的情况：  </p>
<p>三位数字 304 是正常的毫秒，不需要作任何处理。</p>
<p><strong>两位数字 92，需要先乘以 10，才能真正转换成毫秒</strong>，92 完整的写法应该是 920 ms，因此这里需要进行判断，可以使用三元运算符：   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> millisecond = timeResult[<span class="number">3</span>].<span class="property">length</span> === <span class="number">2</span> ? timeResult[<span class="number">3</span>] * <span class="number">10</span> : timeResult[<span class="number">3</span>] * <span class="number">1</span>   </span><br></pre></td></tr></table></figure>

<p>三元运算符的含义是，如果毫秒字符串的长度为 2，那么就乘以 10，转换为真正的毫秒，否则的话，就让<strong>毫秒字符串乘以 1，转换为数字类型的毫秒</strong>。   </p>
<p>拿到时间之后，我们再来拿字符串 lineString <code>[00:00.000] 作词 : 唐恬</code> 中剩下的歌词文本「作词 : 唐恬」。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lyricText = lineString.<span class="title function_">replace</span>(timeResult[<span class="number">0</span>], <span class="string">&quot;&quot;</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 另外一种写法</span></span><br><span class="line"><span class="comment">// const lyricText = lineString.replace(timeRegExp, &quot;&quot;)</span></span><br></pre></td></tr></table></figure>

<p>replace() 方法可以接收两种参数：  </p>
<ul>
<li>字符串  </li>
<li>正则表达式</li>
</ul>
<p>timeResult[0] 是正则表达式匹配结果的第一个元素，值为 <code>[00:00.000]</code>，将整个字符串前面的时间戳替换为空字符串，就能得到剩下的歌词文本了。 </p>
<h2 id="匹配歌词"><a href="#匹配歌词" class="headerlink" title="匹配歌词"></a>匹配歌词</h2><p>对歌词进行解析，我们就可以得到包含有时间和歌词文本的数组 lyricInfos，数组中的每一个元素是对象类型：  </p>
<p>[{time: 0, text: “作词：唐恬”}, {time: 576, text: “作曲：钱雷”}, ……]   </p>
<p>接下来，我们要根据当前播放的音乐进度 currentTime，与 lyricInfos 中的 time 进行匹配，得到对应的歌词。    </p>
<p><img src="https://img.penghh.fun/2022/07/02/gen-ju-shi-jian-cha-zhao-ge-ci-de-fen-xi.png" alt="根据时间查找歌词的分析"></p>
<h2 id="歌词自动滚动"><a href="#歌词自动滚动" class="headerlink" title="歌词自动滚动"></a>歌词自动滚动</h2><p>歌词滚动，是用小程序自带的 scroll-view 组件制作的。</p>
<p>想给开头和结尾的歌词设置一个空白，不能直接给 scroll-view 的第一行歌词（第一个 item）设置 margin-top 或 padding-top，因为这样设置的话，会导致上滑的歌词被设置的空白区域遮盖掉，无法看到歌词滚动到屏幕顶部自动消失的效果。<br>比较好的实现方法是：<strong>给遍历的 item 设置一个动态样式（动态的 css 样式）</strong>，根据歌词的索引值来设置样式，第一行歌词的索引值为 0，设置 padding-top，最后一行歌词的索引值为 <code>歌词所在的数组长度 - 1</code>，设置 padding-bottom。 </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">style=&quot;<span class="attribute">padding-top</span>: &#123;&#123;index==<span class="number">0</span>? (contentHeight/<span class="number">2</span>-<span class="number">80</span>): <span class="number">0</span>&#125;&#125;px; </span><br><span class="line"><span class="attribute">padding-bottom</span>: &#123;&#123;index==lyricInfos<span class="selector-class">.length-1</span>? (contentHeight/<span class="number">2</span>+<span class="number">80</span>): <span class="number">0</span>&#125;&#125;px&quot;</span><br></pre></td></tr></table></figure>

<p>注意：这里的 contentHeight 是整个 scroll-view 的高度。之所以添加了 <code>contentHeight/2-80</code> 这样的运算，是想让程序可以根据不同的手机屏幕高度，自适应设置不同大小的 padding-top 和 padding-bottom。</p>
<p>想要实现<strong>歌词自动滚动</strong>，可以给 scroll-view 组件设置 scroll-top 属性，属性需要绑定一个动态变化的值 lyricScrollTop。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image-94.png" alt="image -94-"></p>
<p>动态变化的值 lyricScrollTop，是由歌词的索引值和每行歌词的高度 35px 相乘得来的。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-95.png" alt="image -95-"></p>
<h2 id="点击左侧按钮返回上一页"><a href="#点击左侧按钮返回上一页" class="headerlink" title="点击左侧按钮返回上一页"></a>点击左侧按钮返回上一页</h2><p>左侧按钮位于我们自行封装的 nav-bar 组件中，我们给左侧的 left 区域绑定一个 handleLeftClick 事件。<br>在 nav-bar 组件的 js 文件中，只把点击的事件发射出去，而不直接写返回上一页的逻辑，因为我们要让使用 nav-bar 组件的页面自行决定点击后的逻辑，如此一来也能让 nav-bar 组件更具备扩展性。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-96.png" alt="image -96-"></p>
<p>来到使用 nav-bar 组件的音乐播放页面 music-player，我们在 nav-bar 组件监听内部发射出来的 click 事件，并绑定一个函数 handleBackBtnClick。<br>在函数里面调用小程序的 API <code>wx.navigateBack()</code>，就能返回上一页。    </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-97.png" alt="image -97-"></p>
<h2 id="阻止事件向上冒泡"><a href="#阻止事件向上冒泡" class="headerlink" title="阻止事件向上冒泡"></a>阻止事件向上冒泡</h2><p>在 HTML 中常用的做法：传入 event 对象，调用 event 对象的 stopPropagation() 方法。<br>但是小程序中是不支持这个做法的。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-98.png" alt="image -98-"></p>
<p>小程序中捕捉到一个事件后，不想让它向上冒泡，我们监听的方法要从 bindtap 更换为 catchtap。<br>这样当我们点击右侧的 播放&#x2F;暂停 按钮，就不会触发进入播放详情页的操作。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-99.png" alt="image -99-"></p>
<p>小程序有自己的捕获和冒泡机制的，跟在 JS 中的写法稍微有一点点不一样。</p>
<h2 id="小程序后台播放的-API（背景音频）"><a href="#小程序后台播放的-API（背景音频）" class="headerlink" title="小程序后台播放的 API（背景音频）"></a>小程序后台播放的 API（背景音频）</h2><p>什么时候属于后台播放？<br>——点击右上角的胶囊按钮，关闭小程序，或是从微信返回到手机桌面</p>
<p>使用 API <code>wx.getBackgroundAudioManager</code>  </p>
<p>将我们之前使用 <code>wx.createInnerAudioContext</code>创建的音频上下文对象，更改为 <code>wx.getBackgroundAudioManager</code>。  </p>
<p><img src="https://img.penghh.fun/2022/06/26/image-100.png" alt="image -100-"></p>
<p>使用 <code>wx.getBackgroundAudioManager</code> 有两个必须配置的参数：</p>
<ul>
<li>在 App 的全局 json 文件<code>app.json</code> 中增加字段 <code>requireBackgroundModes</code> 字段</li>
</ul>
<p><img src="https://img.penghh.fun/2022/06/26/image--20220626t102556119.png" alt="image - 2022-06-26T102556.119"></p>
<ul>
<li>在使用到 <code>wx.getBackgroundAudioManager</code> 的 js 文件中配置 title 属性，这个属性代表音乐的名称。</li>
</ul>
<p><img src="https://img.penghh.fun/2022/06/26/image--20220626t102612212.png" alt="image - 2022-06-26T102612.212"></p>
<h2 id="小程序登录功能"><a href="#小程序登录功能" class="headerlink" title="小程序登录功能"></a>小程序登录功能</h2><p>当用户登录小程序，我们可以拿到这个用户身份的唯一标识 openid，<strong>openid 是用户身份的唯一标识</strong>。<br>每个微信用户的 openid 是唯一的，不会重复</p>
<p><strong>微信小程序获取用户的 openid，是不需要经过用户授权的</strong><br>unionid：在多个平台共享 id</p>
<h3 id="小程序用户登录的流程"><a href="#小程序用户登录的流程" class="headerlink" title="小程序用户登录的流程"></a>小程序用户登录的流程</h3><p>涉及到 3 个角色——小程序（客户端）、开发者服务器（开发小程序的公司的服务器）、微信接口服务（微信的服务器）</p>
<p>步骤：</p>
<ol>
<li>在小程序中拿到一个临时的 code，调用 API <code>wx.login</code> 可以拿到临时的 code</li>
<li>把这个 code 传递给公司的服务器</li>
<li>公司服务器拿到 code 之后，准备齐 3 个东西（code、小程序后台的 appid 和 appsecret 参数）</li>
<li>公司服务器向微信服务器发送网络请求，携带前面的 3 个参数（服务器发送网络请求）</li>
<li>微信服务器向公司服务器返回 <strong>openid</strong> 和 session_key</li>
</ol>
<p>完成前面的步骤，用户是无感知的，不知道自己已经登录过了<br>那应该怎么让用户知道自己已经登录过了呢？<br>将 openid + session_key + 其他信息，生成一个新的东西——公司服务器的 token</p>
<ol start="6">
<li>接着将这个 token 返回给微信小程序</li>
</ol>
<p>小程序端获取到服务器返回的 token（这个 token 可以保存到本地的缓存 storage 中），用户进行各种操作——<strong>收藏、喜欢</strong>或者<strong>评论</strong>等，将这个 token 发送给公司的服务器</p>
<ol start="7">
<li>公司的服务器拿到小程序发送的 token</li>
</ol>
<p>解析 token 得到 openid、session_key<br>在数据库中保存用户的操作行为</p>
<ol start="8">
<li>假设用户换了另外一部手机</li>
</ol>
<p>判断小程序本地的缓存有没有 token<br>没有 token 的话，<strong>使用原始的登录流程</strong>，就是把前面的步骤重新走一遍<br>如果有 token<br>需要先判断一下 token 是否过期了<br>没有过期的话，直接使用<br>过期了的话，重新走一遍登录流程</p>
<p>下图中的「自定义登录态」，就是公司服务器生成的 token。</p>
<p><img src="https://img.penghh.fun/2022/06/26/image--20220626t102629475.png" alt="image - 2022-06-26T102629.475"></p>
<h3 id="用户什么时候需要重新登录呢？"><a href="#用户什么时候需要重新登录呢？" class="headerlink" title="用户什么时候需要重新登录呢？"></a>用户什么时候需要重新登录呢？</h3><ul>
<li>小程序本地缓存的 token 为空</li>
<li>token 已失效，或者 token 不是一个有效值  </li>
<li>session_key 失效</li>
</ul>
<p>这里之所以涉及到 session_key，是因为生成 access token 需要有至少 2 个参数：openid 和 session_key 。  </p>
<h3 id="判断-token-是否过期的两种方式"><a href="#判断-token-是否过期的两种方式" class="headerlink" title="判断 token 是否过期的两种方式"></a>判断 token 是否过期的两种方式</h3><p>第一种方式：在请求一些其他接口的时候，譬如请求收藏接口、评论接口等，在请求的 header 中携带 token，让服务器来判断 token 是否过期了。</p>
<p>第二种方式：当用户启动小程序，在 app.js 的 onLaunch 中判断 token 是否过期。</p>
<p>需要注意的是，微信给我们返回的 session_key 也是会过期的，在登录时也要判断一下 session_key 是否过期了，如果过期了，也要重新登录。   </p>
<p>session_key 的有效期是不确定的，微信官方并没有说明 session_key 的有效期，它的有效期与用户是否频繁使用小程序有关：如果用户频繁使用我们的小程序，它的有效期会比较长一点。  </p>
<h3 id="获取其他用户信息"><a href="#获取其他用户信息" class="headerlink" title="获取其他用户信息"></a>获取其他用户信息</h3><p>openid 是用户身份的唯一标识，它不携带其他信息，不包含用户的昵称、头像。  </p>
<p>openid 是识别这个用户的身份，而不是拿到这个用户的更多信息。  </p>
<p>获取其他用户信息，需要用到 API <code>wx.getUserProfile</code>。  </p>
<p>在使用这个 API 时需要注意，它直接放在 <code>app.js</code> 中是无效的，它需要<strong>在一个事件之后才能触发获取用户头像和昵称</strong>的，例如绑定在页面按钮的点击事件中，当我们点击了按钮，页面下方才会弹出是否授权的窗口。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/16561726429178.jpg"></p>
<p><img src="https://img.penghh.fun/2022/06/26/16561695117607.jpg"></p>
<h3 id="unionid"><a href="#unionid" class="headerlink" title="unionid"></a>unionid</h3><p>unionid：也是唯一标识，作为在微信的多个平台进行授权时，相同的 id。  </p>
<p>openid：仅仅是微信用户在同一个小程序里面多次登录的时候，它的一个身份标识。  </p>
<p>假设我们的产品不仅有小程序端，也有公众号端、H5 页面（第三方登录、微信登录），用户在不同端之间的操作行为，如何实现数据的共享呢？   </p>
<p>这时就需要用到 unionid。  </p>
<p>有了 unionid，用户使用同一个微信在不同的平台上登录，我们就可以通过 unionid 识别出这是同一个用户。  </p>
<p>获取 unionid，需要前往<strong>微信开放平台</strong>注册相应的账号，获取开放平台提供的 SDK。  </p>
<h3 id="国内-App-用户登录的常见设计（用户身份多平台共享）"><a href="#国内-App-用户登录的常见设计（用户身份多平台共享）" class="headerlink" title="国内 App 用户登录的常见设计（用户身份多平台共享）"></a>国内 App 用户登录的常见设计（用户身份多平台共享）</h3><p>用户身份多平台共享：  </p>
<ul>
<li>账号绑定</li>
<li>手机号绑定（现在最常用的）</li>
</ul>
<p>初次打开刚下载的 App，通常都会让你进行登录，登录方式一般会提供多种第三方登录，比如：  </p>
<ul>
<li>QQ 登录   </li>
<li>微信登录    </li>
<li>微博登录</li>
</ul>
<p>假设我们选择了微信登录，跳到微信授权后再返回 App，接下来可能还会遇到另外一步操作——<strong>绑定账号</strong>，绑定账号也有多种情况：  </p>
<ul>
<li>绑定用户名 userid</li>
<li>用户邮箱   </li>
<li>用户手机号（非常常见的）</li>
</ul>
<p>在前面的微信登录操作，我们可以拿到 openid 或者 unionid，与后面「绑定账号」的步骤获取的一项信息进行绑定，比如将 unionid 与手机号进行绑定，这样不管你之后是使用 unionid 登录，还是使用手机号登录，我们都可以知道这是同一个用户，可以更好地实现用户数据在多个平台间的共享。   </p>
<p>不过需要注意的是，个人开发者是无法通过微信小程序拿到用户的手机号的。   </p>
<p>截图地址：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html</a><br><img src="https://img.penghh.fun/2022/06/26/16561727312023.jpg"></p>
<p>如果是个人开发者账号，绑定获取手机号的事件，会打印一个错误信息，提示「没有获取的权限」。   </p>
<p><img src="https://img.penghh.fun/2022/06/26/16561732384096.jpg"></p>
<p>不过即便是公司主体的开发者账号，拿到的也不是手机号，而是一个动态的 code，要想真正拿到用户手机号码，我们还需要在公司服务器向微信服务器发起请求，发起请求的时候，需要携带两个参数，一个是 access_token，一个是动态的 code，请求之后微信会返回 phone_info 对象，里面就有用户的手机号。  </p>
<h2 id="小程序分包"><a href="#小程序分包" class="headerlink" title="小程序分包"></a>小程序分包</h2><p><img src="https://img.penghh.fun/2022/06/26/16561736591917.jpg"></p>
<p>第一次打开小程序必须下载的包，称为主包。<br>后面才需要用到的包，称为分包。  </p>
<p>主包尽可能地小一些，把暂时用不到的都放到分包里面，再在需要用到的时候进行下载。  </p>
<p>小程序的限制：  </p>
<ul>
<li>单个分包&#x2F;主包大小不能超过 2MB</li>
<li>整个小程序所有分包大小不超过 20MB</li>
</ul>
<p>分包操作：  </p>
<ul>
<li>将 3 个详情页分到一个包里面 packageDetail</li>
<li>将播放页面单独分到一个包里面 packagePlayer</li>
</ul>
<p>需要注意的是，TabBar 对应的页面是不能进行分包操作的。 </p>
<p><img src="https://img.penghh.fun/2022/06/26/16561746955305.jpg"></p>
<h3 id="分包预下载"><a href="#分包预下载" class="headerlink" title="分包预下载"></a>分包预下载</h3><p>加载完主包后，当小程序处于闲置状态，可以在后台预先下载分包，这个设计参考了 Webpack 中的「预加载和预获取」。   </p>
<p>在 <code>app.js</code> 中添加一个预下载的规则，指明当进入某个页面后，预下载哪些分包。  </p>
<p>譬如下面的代码，是在进入 home-music 页面后，预下载两个分包 packageDetail 和 packagePlayer。     </p>
<p><img src="https://img.penghh.fun/2022/06/26/16561756826579.jpg"></p>
<h2 id="项目为何要用到-Vant-组件库？"><a href="#项目为何要用到-Vant-组件库？" class="headerlink" title="项目为何要用到 Vant 组件库？"></a>项目为何要用到 Vant 组件库？</h2><ul>
<li>学习如何在小程序中引用一些 UI 组件库，来减少开发量</li>
<li>npm 包的使用</li>
<li>van-search 搜索组件</li>
</ul>
<h2 id="组件按需注入"><a href="#组件按需注入" class="headerlink" title="组件按需注入"></a>组件按需注入</h2><p>代码按需注入，俗称懒加载。   </p>
<p>启用组件按需注入，也就是在小程序中优先注入必须要用的组件，暂时未用到的组件之后注入，可以显著提高小程序的启动性能，配置起来也非常简单。  </p>
<p>只需要在项目的 <code>app.json</code> 中添加下面的一行配置，就能启用啦：   </p>
<pre><code>&quot;lazyCodeLoading&quot;: &quot;requiredComponents&quot;  
</code></pre>
<h2 id="骨架屏"><a href="#骨架屏" class="headerlink" title="骨架屏"></a>骨架屏</h2><p>骨架屏：展示一个页面骨架，而不含有实际的页面。  </p>
<p>骨架屏在页面白屏的时候，给了用户及时的反馈，减缓了用户焦急等待的一个情绪，这是它的意义所在。  </p>
<p>点击开发者工具「模拟器」右下角的 … ，选择「生成骨架屏」。     </p>
<p><img src="https://img.penghh.fun/2022/06/28/16562272511306.jpg"></p>
<p>骨架屏的详细使用，可以参考微信团队提供的视频教程： <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/business/doc/000086539b40682ccddd8b71551c0d">https://developers.weixin.qq.com/community/business/doc/000086539b40682ccddd8b71551c0d</a>    </p>
<p>骨架屏只是在页面加载时给用户更好的体验，并不能提高页面的加载速度，因此<strong>不能无节制地使用骨架屏</strong>，一般只给主页添加骨架屏效果。 </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-06-19-toyota-tps-system-book-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-06-19-toyota-tps-system-book-summary/" itemprop="url">构建精益生产的企业 - 读《漫画丰田生产方式》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-19T06:53:19+00:00">
                2022-06-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <img src="/images/tps-book-cover.jpg" class="">

<h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>最近周末在家，读完了《漫画丰田生产方式》，这是一本讲供应链优化的书。</p>
<p>丰田曾长期市值在汽车制造商中排名前三，这主要得益于它在生产方式上的有效改善。业界将丰田的改善方法称作：TPS，现在已经被各业界广为传播和学习。</p>
<p>美国 MIT 的研究人员将丰田这种生产方式称作 “精益生产”。</p>
<p>在今天，“精益” 一词进一步发展，成为持续改善和创新的代名词。</p>
<p>以下是一些笔记。</p>
<h2 id="二、TPS-产生的背景"><a href="#二、TPS-产生的背景" class="headerlink" title="二、TPS 产生的背景"></a>二、TPS 产生的背景</h2><p>TPS 的全称是：Toyota Production System，它的出现发生在丰田公司经营困难的 1950 年前后。</p>
<p>当时日本经济通胀严重，统治日本的美军政府经济顾问道奇提出了道奇计划（Dodge Line），其主要内容是让日本政府减少赤字，适应均衡财政。</p>
<p>于是日本政府将中央及地方税收从改革前的 25.9% 提升到了 28.5% ，强化征税有助于平衡政府的预算，但是也让企业经营更加困难。</p>
<p>当时汽车生产还是流行的流水线式的生产，为了追求规模化，流水线一经启动就会持续运行，商品非常容易产生库存积压。</p>
<p>而丰田公司的经营者去美国考察，从美国超市的 “及时销售及时补货” 的动作中得到灵感，从而发明了 TPS。</p>
<h2 id="三、TPS-的主要内容"><a href="#三、TPS-的主要内容" class="headerlink" title="三、TPS 的主要内容"></a>三、TPS 的主要内容</h2><p>TPS 的主要内容都是对浪费的优化。</p>
<p>在生产中，浪费无处不在。比如：</p>
<ul>
<li>你的原料买进来放在库存里面长时间不用，这就是对资金的浪费</li>
<li>你的产品生产多了卖不出去，这就是库存的浪费</li>
<li>你的人不是在做生产工作，而是在做生产资料的搬运，这就是搬运的浪费</li>
<li>你的生产过程效率不高，动作不是最经济的，这就是生产的浪费</li>
</ul>
<p>在我自己的理解下，为了减少浪费，TPS 主要做了两个方面的改造：</p>
<ul>
<li>对生产流程的改造</li>
<li>对团队成员的改造</li>
</ul>
<h3 id="3-1-对生产流程的改造"><a href="#3-1-对生产流程的改造" class="headerlink" title="3.1 对生产流程的改造"></a>3.1 对生产流程的改造</h3><p>TPS 对生产流程的改造主要就是引入了以下方法：</p>
<ul>
<li>U 型生产线：减少生产线长度，引入复合技能工作</li>
<li>后序拉动：以实际的订单来决定生产量</li>
<li>及时生产：优化上下游，将生产周期尽可能缩短</li>
<li>看板系统：通过可视化的数据传输将生产信息传递</li>
<li>均衡化：将多个 SKU 混合在一起生产，保证交付时间</li>
</ul>
<h3 id="3-2-对团队成员的改造"><a href="#3-2-对团队成员的改造" class="headerlink" title="3.2 对团队成员的改造"></a>3.2 对团队成员的改造</h3><p>TPS 对团队成员的改造主要是培养多面手技工。因为按需生产后，产线可能随时切换，而如果一个工人只能做一个产线上的动作的话，他的人力就会被浪费。</p>
<p>按需生产后，工厂的生产状态就不再是 100% 了，因为需求是会波动的。</p>
<p>这个时候，为了让团队将非生产时间利用起来做有价值的事情，丰田让他们做产线的复盘总结，不断优化和迭代生产环节。</p>
<p>员工一方面技能丰富了，另一方面参与了生产改善的过程中，于是工作主动积极性也大大增加。</p>
<h3 id="3-3-改造的本质是弥补劣势"><a href="#3-3-改造的本质是弥补劣势" class="headerlink" title="3.3 改造的本质是弥补劣势"></a>3.3 改造的本质是弥补劣势</h3><p>上面这些方法论，本质上都是为了追求 “按需生产” 这种从美国超市中借鉴到的理念，为了贯彻这种理念，丰田将整个供应链进行了上述的改造。</p>
<p>这个改造，其实就是在给 “按需生产” 的劣势 “打补丁 “，帮助 “按需生产” 的缺点不至于太致命，让 “按需生产” 整体上优势大于劣势。</p>
<p>按需生产有哪些劣势？</p>
<ul>
<li>产线启动成本太高。所以 TPS 引入了 U 型生产线来使得产线能快速启动。</li>
<li>原材料采购时间长。所以 TPS 引入了及时生产，优化上下游的采购和生产。</li>
<li>多个 SKU 生产的时候，只能先做一个，再做另一个。所以 TPS 引入了均衡化生产。</li>
<li>人员浪费。所以 TPS 引入了多技能员工。</li>
</ul>
<p>通过这些补丁，按需生产的经济性就体现出来了，从而让丰田公司拥有巨大市场竞争力。</p>
<h2 id="四、我从-TPS-中想到的"><a href="#四、我从-TPS-中想到的" class="headerlink" title="四、我从 TPS 中想到的"></a>四、我从 TPS 中想到的</h2><h3 id="4-1-多技能员工"><a href="#4-1-多技能员工" class="headerlink" title="4.1 多技能员工"></a>4.1 多技能员工</h3><p>培养多技能员工是每个企业都可以学习和借鉴的经营理念。</p>
<p>对员工来说：因为市场需求在不断变化，如果一个员工只会做一件事情，那么在业务需求变化的时候，他就只能离开。而如果他是一个多面手，那么他就可以和企业共同应对变化。</p>
<p>对企业来说：一个多技能的员工，因为具有更多视角，所以有助于改善生产的上下游衔接，更有可能成长为管理者。以满足企业不断成长的目标。</p>
<p>拿技术开发举例，我们在技术领域常常讲要做 T 型人才，即一专多能。做服务器端的要会写前端、做前端的要会写客户端。这样你理解了各种开发技术的异同之后，不但有助于自己学习新的技能，也能帮助自己理解对方在开发上的挑战，使你们之间协同更舒服。</p>
<h3 id="4-2-如何创新"><a href="#4-2-如何创新" class="headerlink" title="4.2 如何创新"></a>4.2 如何创新</h3><p>创新的机会总是发生在时代变化的时候，有可能是经济的变化，人们观念的变化，也可能是生产方式的变化。</p>
<p>而对创新的机会，如何做落地的方案？丰田的 TPS 引入过程给我了一个启示：抓核心问题，解次要矛盾。</p>
<p>拿丰田的改革来举例，核心问题是什么？核心问题是：</p>
<ul>
<li>在经济日益下行的情况下，粗放的流水线式生产会带来大量的浪费。</li>
</ul>
<p>解决方案是什么呢？解决方案是：</p>
<ul>
<li>把粗放的流水线模式，改成按需生产模式。</li>
</ul>
<p>按需生产模式引入，会带来哪些次要矛盾？次要矛盾是：</p>
<ul>
<li>流水线启停成本高</li>
<li>原材料采购慢</li>
<li>工人可能闲置</li>
<li>多 SKU 生产响应慢</li>
</ul>
<p>没关系，这些矛盾只要有一定程度上的优化，优化后问题小于收益，就可以。</p>
<p>于是创新产生了，帮助丰田度过了经济危机，并成为了市值前三的车企。</p>
<h3 id="4-3-没有好或不好，只有合适不合适的解决方案"><a href="#4-3-没有好或不好，只有合适不合适的解决方案" class="headerlink" title="4.3 没有好或不好，只有合适不合适的解决方案"></a>4.3 没有好或不好，只有合适不合适的解决方案</h3><p>我们家厨房有很多刀，有的适合削水果，有的适合切菜，有的适合切骨头，还有一种刀，专门用来切面包，特别好使。</p>
<p>每一种刀就像一个解决方案，它是为特定场景设计的，有优点也有缺点。</p>
<p>当时代变化的时候，解决方案可能就不再适用于它的场景了，那么你就需要重新构建你的解决方案。</p>
<p>这个时候，思考核心问题，解决次要矛盾就可以给你帮助。</p>
<h2 id="五、小结"><a href="#五、小结" class="headerlink" title="五、小结"></a>五、小结</h2><p>丰田在日本经济萧条时期，为了减少浪费而发明了 TPS 这种精益生产方式，通过按需生产的目标来改造供应链和团队，从而取得了巨大的成功。</p>
<p>以上。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-weekly" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/weekly-14.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/weekly-14.html" itemprop="url">周刊第14期：暂停更新说明、自动化测试的未来趋势</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-13T16:00:00+00:00">
                2022-06-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="暂停更新"><a href="#暂停更新" class="headerlink" title="暂停更新"></a>暂停更新</h2><p>因为最近在做一个 Side Project，所以本周刊已经有一段时间没更新了，毕竟一个人的时间精力是非常有限的，无法同时把两件事情做好，思前想后，决定先暂时停止周刊，等后面时间充裕起来，再恢复周刊，请见谅。</p>
<h2 id="本周见闻"><a href="#本周见闻" class="headerlink" title="本周见闻"></a>本周见闻</h2><h3 id="为什么会有「她」和「祂」"><a href="#为什么会有「她」和「祂」" class="headerlink" title="为什么会有「她」和「祂」"></a>为什么会有「她」和「祂」</h3><p>在 V2EX 看到一个帖子<a target="_blank" rel="noopener" href="https://v2ex.com/t/857418">《汉字不分性别的“他”》</a>，不禁疑惑为何要将「他」分为「它、他、她、牠、祂」呢？</p>
<p>首先为什么会出现「她」呢，其实「她」的开始是从清朝的刘半农才开始使用的，在以前「她」一直是「姐」的异体字，而在 1934 年的女性杂志《妇女共鸣》中，就曾在一篇<a target="_blank" rel="noopener" href="http://www.cuhk.edu.hk/ics/21c/media/articles/c136-201207034.pdf">启事</a>指出：「本刊同仁，以人字旁代男子、女字旁代女子，牛字旁代物件，含有侮辱女子非人之意」，所以拒绝用「她」字。但尽管当时饱受批评，如今「她」还是成为流行的女性专用代词。</p>
<p>而「祂」的出现则是西方宗教在华传教时，用作对上帝、耶稣等的第三人称代名词，不过在我们生活中已经很少能够见到了。</p>
<p>延伸阅读：<a target="_blank" rel="noopener" href="https://www.arianalife.com/tc/topics-tc/lgbt-tc/x%E4%B9%9Fand-ta-the-gradual-rise-of-gender-neutral-pronouns-in-chinese-tc/">《「他」、「X也」，还是「Ta」：非二元性別代词有哪些？》</a></p>
<h2 id="一些-tips"><a href="#一些-tips" class="headerlink" title="一些 tips"></a>一些 tips</h2><p>分享两篇非常不错的文章，分别提供 Bash 和 HTML 很多有用的技巧，这里就不全文摘抄了，有兴趣可以点击进原文查看。</p>
<h3 id="5-个现代-Bash-语法"><a href="#5-个现代-Bash-语法" class="headerlink" title="5 个现代 Bash 语法"></a><a target="_blank" rel="noopener" href="https://levelup.gitconnected.com/5-bash-syntax-for-going-beyond-traditional-shell-scripting-6904d3e71af6">5 个现代 Bash 语法</a></h3><h4 id="处理输入比-Python-和-Node-js-更加简单"><a href="#处理输入比-Python-和-Node-js-更加简单" class="headerlink" title="处理输入比 Python 和 Node.js 更加简单"></a>处理输入比 Python 和 Node.js 更加简单</h4><p>在 Bash 中，你可以通过以下代码来获取用户输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter your name: &quot;</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$name</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">&gt; ./test.sh</span><br><span class="line">Enter your name: 4Ark</span><br><span class="line">Hello, 4Ark</span><br></pre></td></tr></table></figure>

<h3 id="10-个罕为人知但非常有用的-HTML-提示。"><a href="#10-个罕为人知但非常有用的-HTML-提示。" class="headerlink" title="10 个罕为人知但非常有用的 HTML 提示。"></a><a target="_blank" rel="noopener" href="https://dev.to/babib/7-shocking-html-tips-you-probably-dont-know-about-ggd">10 个罕为人知但非常有用的 HTML 提示。</a></h3><h4 id="打开摄像机"><a href="#打开摄像机" class="headerlink" title="打开摄像机"></a>打开摄像机</h4><p>我们可以通过 input 的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/capture">capture</a> 属性来打开摄像机，它具有两个属性值：</p>
<ol>
<li>user：前摄像头</li>
<li>environment：后摄像头</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">capture</span>=<span class="string">&quot;user&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="分享文章"><a href="#分享文章" class="headerlink" title="分享文章"></a>分享文章</h2><h3 id="自动化测试的未来趋势"><a href="#自动化测试的未来趋势" class="headerlink" title="自动化测试的未来趋势"></a><a target="_blank" rel="noopener" href="https://insights.thoughtworks.cn/automated-testing-trends/">自动化测试的未来趋势</a></h3><p>这篇文章主要讲述自动化测试的发展以及未来趋势，从最早期的录制回放技术开始，逐步发展成DOM对象识别与分层自动化，而如今火热的 AI 技术会给自动化测试带来哪些突破呢？</p>
<p>其实在业界中已经有基于 AI 技术的自动化测试技术：</p>
<ol>
<li>自愈（Self-Healing）技术</li>
<li>机器学习（Machine Learning）技术</li>
</ol>
<p><strong>自愈技术</strong>一般指的是：一种自我修复的管理机制。<br>举个例子，假设我们通过 <a target="_blank" rel="noopener" href="https://www.cypress.io/">Cypress</a> 等框架进行 E2E 测试时，都是通过 CSS 选择器等方式获取元素，从而做进一步的测试，而当我们的内部实现发生变化时（这里指的就是元素发生变化），测试用例会失败，我们需要手动修改测试用例。<br>而自愈技术可以通过比较页面前后的差异，来自动修复测试用例中的 CSS 选择器，并在结束时更新测试用例到代码中。<br>自愈技术在业界较好的实践是 <a target="_blank" rel="noopener" href="https://healenium.io/">Healenium</a>。</p>
<p>然而传统的基于元素定位器等方式，面临着一些问题：</p>
<ul>
<li>仍然需要人工获取定位方式；</li>
<li>如果是通过 Canvas 绘制出来的对象，如何识别元素 (如Flutter Web)。</li>
</ul>
<p>于是就有了<strong>机器学习</strong>来解决这个问题，它可以通过图像识别和处理等技术来生成测试用例，比如直接根据某个按钮的截图来定位这个按钮，现在在业界较好的实践是 <a target="_blank" rel="noopener" href="https://airtest.netease.com/">Airtest</a>。</p>
<p>自动化测试未来趋势不仅仅是这两种，还有如智能化探索性测试，智能遍历测试以及智能验证等。关于智能遍历所用到的技术，大家可以参考DQN的介绍。</p>
<h2 id="有趣的链接"><a href="#有趣的链接" class="headerlink" title="有趣的链接"></a>有趣的链接</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.babelabc.com/">巴别英语 - 英语听力口语在线学习</a>：刷TED演讲和美剧佳作练听力, 带单句步进重复、灵活中英字幕设置等专为英语学习设计的功能, 让学英语变得容易、有趣、高效。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://monkeylearn.com/word-cloud">Free Word Cloud Generator</a>：构建你的词云，按相关性和频率对结果进行排序，探索更高级的文本分析工具。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.jsnice.org/">JS NICE</a>：一个 JavaScript 反混淆的在线工具。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://slashy.app/">Slashy</a>：一个可以创建 Notion 自定义命令的增强工具，非常不错。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://type-scale.com/">Type Scale</a>：一个可视化的字体大小调节工具，可以预览 CSS 字体在不同 rem 上表现。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://evanhahn.github.io/ffmpeg-buddy/">ffmpeg-buddy</a>：一个 ffmpeg 参数生成工具。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN">NGINX 配置</a>：一个 nginx 配置生成工具。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.compose.ai/">Compose AI</a>：一个帮助写作的 AI 工具，目前仅适用于英语，缺点就是太贵。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://getcssscan.com/">CSS Scan</a>：一个可直接在网页内获取任意元素 CSS 样式的工具。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-6-10-shimo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-6-10-shimo/" itemprop="url">如何批量导出石墨文档中的内容？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-10T15:32:00+00:00">
                2022-06-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本文首发于公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/sNHowZTLXMaLzLhWcZ9zKw">效率工具指南</a>」<br>文&#x2F;彭宏豪      </p>
<p>​Hello 各位晚上好，我是小豪。<br>​<br>​上次在一篇文章《<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649920061&idx=1&sn=8ea5550e1b0155f53361585d61f68ed2&chksm=83a89610b4df1f06bb6d30aaea13481470df27d40ab2e81f751a336c9216b10019eedc87149e&token=1993509468&lang=zh_CN#rd">靠软件赚钱，真的太难了</a>》中说到，我目前在用的在线文档工具是石墨文档，大体上它的功能都能满足我的需求，不过正如我在挑选文档或笔记类工具时，都会考虑软件是否提供了「<strong>数据导出</strong>」功能，以方便我在想切换到其他的工具时，可以随时导出数据。<br>​<br>​石墨文档虽然提供了数据导出功能，但导出时仅限于单个文档，无法一次批量导出多个文档。<br>​<br>​<img src="https://img.penghh.fun/2022/06/10/16548707584267.jpg"></p>
<p>就着这个问题，我在网上搜了一下，没想到从飞书的帮助文档中找到了解决方法。  </p>
<p>真是竞争对手把「撬墙角」的方法都给用户安排得明明白白的。             </p>
<p><img src="https://img.penghh.fun/2022/06/10/16548720986290.jpg"></p>
<p>说明文档中提到了一个可批量导出石墨文档的第三方工具「shimo-cloud-files-download」，支持 Windows 和 macOS 系统。        </p>
<p><img src="https://img.penghh.fun/2022/06/10/16548722867762.jpg"></p>
<p>批量导出石墨文档第三方工具下载地址：<br><a target="_blank" rel="noopener" href="https://github.com/Boeing724/mover/releases/tag/0.0.7">https://github.com/Boeing724/mover/releases/tag/0.0.7</a>    </p>
<p>因为这个工具放在了 GitHub 上，从 GitHub 下载的速度比较慢，有需要的可以点击下方的公众号卡片，在后台回复【<strong>石墨</strong>】，获取我下载好的安装包。   </p>
<p>使用 Mac 电脑的朋友，安装完首次打开软件会提示软件不安全、无法打开，可以去到系统设置的「安全性与隐私」&gt;&gt;「通用」，点击左下角的小锁🔒，输入电脑开机密码，接着点击右侧的「仍要打开」。  </p>
<p>重启 shimo-cloud-files-download 软件，就能顺利打开了。   </p>
<p><img src="https://img.penghh.fun/2022/06/10/16548719576841.jpg"></p>
<p>打开软件后，还是熟悉的石墨文档登录界面，输入石墨文档的账号密码。   </p>
<p><img src="https://img.penghh.fun/2022/06/10/16548731425196.jpg"></p>
<p>​登录之后，点击文件列表「文件名」左侧的复选框，就能全选所有文档，再点击下方的「导出」，就能将所有文档批量导出了。<br>​<br>​<img src="https://img.penghh.fun/2022/06/10/16548732706427.jpg"></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>其实石墨文档官方也是可以提供批量导出文档功能的，但从我自己的角度猜测：谁会愿意把好不容易得到的用户，拱手相让给其他人呢？   </p>
<p>就像之前在 MacTalk 的池建强老师一篇文章中看到的一句话：  </p>
<blockquote>
<p>微信在哪个手机（上登录），那个手机就是主力机。   </p>
</blockquote>
<p>对应到这里：  </p>
<p><strong>你的多数文档放在哪，那个就是你的主力文档工具</strong>，何况现在国内的 Saas 产品这么卷？     </p>
<p>最后的最后，这篇文章介绍这个工具，并不是鼓励用着石墨文档的朋友都要把文档导出，而是给你在需要导出数据的时候，提供一种选择。      </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://img.penghh.fun/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">     </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-06-08-the-lady-tasting-tea-book-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-06-08-the-lady-tasting-tea-book-summary/" itemprop="url">统计学的编年史-读《女士品茶》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-08T01:12:53+00:00">
                2022-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <img src="/images/lady-tasting-tea-book.jpg" alt="book cover" width="400"/>

<p>最近读完了《女士品茶-统计学如何变革了科学和生活》。这是一本科普性质的统计学发展编年史，在让大家了解统计学的发展之余，本书也八卦了费希尔，内曼，皮尔迩等统计学家的生活故事。</p>
<p>以下是一些笔记和思考。</p>
<h2 id="一、女士品茶的故事"><a href="#一、女士品茶的故事" class="headerlink" title="一、女士品茶的故事"></a>一、女士品茶的故事</h2><p>为了和书名呼应，全书中的开场就讲述了一个女士品茶的八卦故事。故事发生在 20 世纪的英国剑桥，一些大学教员和他们的妻子在喝下午茶，其中一个女士坚持认为：将茶倒进牛奶和将牛奶倒进茶里味道不同。</p>
<p>可想而知，在座的大学教授们觉得可笑至极，因为两种化合物在化学成分上没有任何区别。但是，现场的一位身材矮小的男子严肃地对待了这个事情。</p>
<p>他跑到厨房一顿操作之后，开始了他的实验：男子把第一杯茶递给女士，女士品尝了一分钟，判断这个是牛奶倒在茶里制作出来的。男子记录下来，没有发表任何观点，然后把第二杯茶递给她。最后大家惊讶的发现，女士真的辨别正确了所有的测试。</p>
<p>书中没有对女士如何做到这个做过多展开，迅速切到本书男主角的角度。</p>
<p>故事中的这个男子就是男主角费希尔。费希尔是整个现代统计学的开创者，出版了影响巨大的《研究工作者的统计方法》和《实验设计》。</p>
<h2 id="二、P-值与显著性检验"><a href="#二、P-值与显著性检验" class="headerlink" title="二、P 值与显著性检验"></a>二、P 值与显著性检验</h2><p>我们现在做产品的过程，常常伴随着用户研究测试。在用研过程中，我们会做一些假设，然后用显著性检验来看这个假设是否显著。</p>
<p>为了判断假设是否显著，我们引入了 P 值，用以表示推翻这个假设的概率。</p>
<p>那刚刚那个女士品茶的故事举例。如果我们只测试一次，那这个女士其实有 50% 的概率猜对，P 值为 0.5。显然，这个 P 值不够显著。</p>
<p>但是，如果我们连续测试 10 次，女士都猜对了。那么这个时候 P 值只有 0.001。这个时候 P 值已经非常显著了。</p>
<h2 id="三、真实数据很重要"><a href="#三、真实数据很重要" class="headerlink" title="三、真实数据很重要"></a>三、真实数据很重要</h2><p>统计数据很多时候会撒谎，所以不能盲信数据，最好的办法还是深入用户，查看原始数据。</p>
<p>这方面的案例很多，书中举了一个犯罪率与刑罚时间的统计案例。</p>
<p>在案例中，人们做了一项研究：对成年男子囚犯获刑时间与重新犯罪的关系进行比较。结果表明：获刑时间较短的囚犯重新犯罪的比例非常高。人们以此为据，认为应该给这类人长期的刑法。</p>
<p>书中的 “坎利夫” 负责审查这项调研。她不满足验算统计表格，而希望和背后的原始数据：即刑犯聊聊。结果她很快发现，几乎所有这些刑犯都是 “可怜又可悲的老人，因为他们没有去处，所以通过犯罪来获得回到监狱的机会”。而研究人员在制作表格时，把他们的多次入狱算作了不同的犯人。</p>
<p>在删除这些数据之后，服刑时间和再犯罪率之间就没有明显关系了。</p>
<h2 id="四、统计工作的复杂性"><a href="#四、统计工作的复杂性" class="headerlink" title="四、统计工作的复杂性"></a>四、统计工作的复杂性</h2><p>统计工作其实很复杂，稍微不注意就可能得出误导性的结论。书中介绍了很多这样的坑，也提出了一些解决办法。</p>
<h3 id="4-1-案例一：作物收成研究"><a href="#4-1-案例一：作物收成研究" class="headerlink" title="4.1 案例一：作物收成研究"></a>4.1 案例一：作物收成研究</h3><p>费希尔在研究作物收成的时候，发现很难保证每块地都是完全一模一样的样本，某些地可能因为历史用过一些肥料而影响现在的测试，这样实验数据就会被干扰。</p>
<p>费希尔为此引入了随机过程，让农田分割成若干块，每次实验的实验组与对照组均通过随机的办法来决定。</p>
<p>随机使得样本的个体差异被均匀性摊薄，在实验数量到达一定程度后，个体差异就很难只聚集在某一实验组内了。</p>
<h3 id="4-2-案例二：吸烟与肺癌的关系"><a href="#4-2-案例二：吸烟与肺癌的关系" class="headerlink" title="4.2 案例二：吸烟与肺癌的关系"></a>4.2 案例二：吸烟与肺癌的关系</h3><p>现代观点大多认为吸烟与肺癌是呈显著的相关性的。但是费希尔却认为研究不够严谨，他提出了这样一种假设：</p>
<p>假如有一种基因 A，携带这个基因的人普遍比不携带这个基因的人更容易喜欢上抽烟；同时，这个基因天然容易患上肺癌。</p>
<p>于是你就能观察到吸烟的人和患肺癌的人相关，但可能背后原因是他们携带这个基因，即使他们不吸烟，这个基因也一样让他们会容易得肺癌。</p>
<p>满足费希尔的挑战：你只能随机选择两组人，一组人强行要求他们吸烟，另外一组强行要求他们不吸烟。以此来排除 “喜爱抽烟基因” 的干扰。但是，从道德和伦理层面上，这种实验根本无法实施。</p>
<p>你看，要在统计上证明因果其实很难很难。</p>
<h3 id="4-3-案例三：癌症药物的有效性测试"><a href="#4-3-案例三：癌症药物的有效性测试" class="headerlink" title="4.3 案例三：癌症药物的有效性测试"></a>4.3 案例三：癌症药物的有效性测试</h3><p>书中举了一个癌症药物治疗组与对照组的实验困境。因为病人会对疗效的感受做反应，如果一个对照组病人感受到没效果，就可能放弃当前的治疗，转投别的治疗方案。这样，安慰剂组中留下来的可能都是自身免疫力好而感觉治疗 “起效果” 的人。</p>
<p>最终，测试结果可能是安慰剂的效果甚至比药物效果还好。</p>
<p>但是，从人道和法理上，你又不能强行要求一个癌症患者必须冒着生命危险结束安慰剂治疗。这里面又发展出了更多研究，最终现代医学会追求接受安慰剂这种 “非最佳治疗” 的病人数量最小作为分析测试标准。</p>
<h3 id="4-4-案例四：决策悖论"><a href="#4-4-案例四：决策悖论" class="headerlink" title="4.4 案例四：决策悖论"></a>4.4 案例四：决策悖论</h3><p>假如我们接受假设检验和显著性检验的思想。那如果一件事情发生的概率只有万分之一，那我们就应该拒绝这个假设。</p>
<p>但是我们考虑这样一个场景：我们组织一个抽奖活动，活动中有 1 万张彩票，每张彩票中奖概率相同。</p>
<p>所以，1 号彩票中奖概率是 0.0001，我们拒绝了这个假设。</p>
<p>2 号彩票中奖概率是 0.001，我们也拒绝了这个假设。</p>
<p>对于任何一张彩票，我们都会拒绝这个假设。</p>
<p>类似的决策悖论其实很多。</p>
<h2 id="五、小概率的决策"><a href="#五、小概率的决策" class="headerlink" title="五、小概率的决策"></a>五、小概率的决策</h2><p>很多时候我们面临小概率，但是我们还是应该满怀期待，为小概率努力。</p>
<p>比如：大家的孩子考上清华北大的概率不到 0.01，但是大家还是会努力培养孩子。</p>
<p>又比如，如果我们遇到一个疾病，存活率只有 0.01，我们还是应该期待奇迹，配合治疗。</p>
<p>面对小概率事件的时候，世界就是同步分裂成多个的平行宇宙，我们都有可能是幸运事件（小概率）发生的那个平行宇宙。</p>
<p>满怀希望，尽人事，听天命。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-5-31-heic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-5-31-heic/" itemprop="url">Windows电脑如何打开heic格式的图片？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-30T17:20:00+00:00">
                2022-05-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本文首发于公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649920114&idx=1&sn=a388c8be16a1bbc30e33185b0810269b&chksm=83a8965fb4df1f49f87a642b30e65f6817df3276e74827aae5f2e0dc0dfd3b01852e1b3ead48&token=792768228&lang=zh_CN#rd">效率工具指南</a>」<br>文&#x2F;彭宏豪    </p>
<p>​Hello 各位晚上好。</p>
<p>今天想来说一下，使用 Windows 系统的朋友经常会遇到的一个问题：从 iPhone 或者苹果设备上发送到 Windows 电脑的图片，在打开时会遇到下图的提示。  </p>
<p>这种情况，通常是在打开一种特殊的图片格式才会遇到，它就是来自苹果专有的图片格式 <strong>heic</strong>。   </p>
<p>使用 Win10 自带的「照片」虽然没办法打开 heic 格式的图片，但它还是给出了一种解决方法，让我们安装来自微软应用商店的一个插件「HEVC 视频扩展」。      </p>
<p><img src="https://img.penghh.fun/2022/05/31/image-37.png" alt="image-37-"></p>
<p>当你顺着上图的提示，点击蓝色的链接跳转到微软应用商店，会发现这个插件原来是要收钱的，这可能也是你在微软应用商店遇到的第一款付费应用？   </p>
<p>不过别急着付款（急着付款的人也没办法挽回了），因为这篇文章的目的，就是来教你白嫖这个插件。     </p>
<p><img src="https://img.penghh.fun/2022/05/31/7kuai-qian.png" alt="7块钱"></p>
<p>白嫖这个插件，需要先下载微软应用商店里的另外一个应用「哔哩哔哩动画」，这是 B 站的 UWP 应用。   </p>
<p>你可能会说，这两个软件八杆子打不着，干啥要扯到一起？（别急，往下看）      </p>
<p><img src="https://img.penghh.fun/2022/05/31/bi-li-bi-li-dong-hua.png" alt="哔哩哔哩动画"></p>
<p>安装 B 站应用之后，点击应用右下角的设置按钮，将打开的页面往下滑动，就能看到一个「安装 HEVC 视频解码扩展」的选项。  </p>
<p>点击这个选项，同样会打开微软应用商店，不过这回，你会发现一个惊天大秘密：这回这个插件居然变成免费的了！  </p>
<p>安装了这个免费插件之后，再次用 Win10 自带的「图片」打开 heic 格式的图片，就可以正常查看图片了。  </p>
<p><img src="https://img.penghh.fun/2022/05/31/image-38.png" alt="image -38-"></p>
<p>这次之所以能不花钱安装 HEVC 视频解码插件，原因如下（下图来自 IT 之家 2019 年的一篇文章《<a target="_blank" rel="noopener" href="https://www.ithome.com/0/447/326.htm">小技巧：微软Win10商店如何下载免费HEVC编解码器</a>》）：   </p>
<blockquote>
<p>微软在Windows 10商店中隐藏了另一个版本的HEVC编解码器，供设备制造商在将其交付给客户之前在台式机和笔记本电脑上安装编解码器。</p>
</blockquote>
<p><img src="https://img.penghh.fun/2022/05/31/16539286055157.jpg"></p>
<h2 id="安装-HEVC-视频解码插件的另外一个用处"><a href="#安装-HEVC-视频解码插件的另外一个用处" class="headerlink" title="安装 HEVC 视频解码插件的另外一个用处"></a>安装 HEVC 视频解码插件的另外一个用处</h2><p>安装了 HEVC 视频解码插件，不仅可以打开 heic 格式的图片，还能解决另外一个问题——Win10 自带的「电影和电视」应用无法打开 <strong>mkv</strong> 格式的视频。   </p>
<p>如果你的电脑上没有安装第三方的视频播放器（例如 Potplayer），每次打开 mkv 格式的视频，电脑自带的视频播放器也会提示你安装解码插件，同样是要钱滴。  </p>
<p>可以说，安装了这个插件，真的是一箭双雕呀。   </p>
<p><img src="https://img.penghh.fun/2022/05/31/dian-ying-he-dian-shi-da-kai-mkv-shi-pin.png" alt="电影和电视打开 mkv 视频"></p>
<p><img src="https://img.penghh.fun/2022/05/31/zhao-pian-he-dian-yingsnipaste20220531000702.png" alt="照片和电影Snipaste_2022-05-31_00-07-02"></p>
<h2 id="另外的解决方法"><a href="#另外的解决方法" class="headerlink" title="另外的解决方法"></a>另外的解决方法</h2><p>如果你不想安装免费的 HEVC 视频解码插件，但又想在本地直接查看 heic 格式的图片，还有另外的解决方法，这里提供一种：在电脑上安装开源、跨平台的看图软件 <strong>qView</strong>。    </p>
<p>关于 qView 的介绍，可以看我之前写过的一篇文章：   </p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649909010&idx=1&sn=1f33cbfe38a60bde5b24a19a488d7b30&chksm=83a8633fb4dfea292589ae12e74c3cafdfeeb1eb463f3d4ac09775b4b29e0f0688adcfd7844c&token=792768228&lang=zh_CN#rd">没找到好用的看图软件，我最终还是下回了这个流氓软件</a>    </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://img.penghh.fun/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">     </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-weekly" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/weekly-13.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/weekly-13.html" itemprop="url">周刊第13期：一些图像 AI 模型、冒名顶替综合症</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-30T16:00:00+00:00">
                2022-05-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="本周轮子"><a href="#本周轮子" class="headerlink" title="本周轮子"></a>本周轮子</h2><p>本周我们来实现一个被广泛使用的工具，那就是鼎鼎大名的 husky，几乎所有现代前端项目、以及 Node.js 项目都会接入这个工具，它的用途主要是统一管理项目中的 Git Hooks 脚本，不熟悉该工具的同学也不要紧，下面我们先来简单介绍一下 husky，它到底解决了什么问题，我们为什么需要使用 husky。</p>
<p>本周轮子：<a target="_blank" rel="noopener" href="https://4ark.me/post/weekly-npm-packages-02.html">《每周轮子之 husky：统一规范团队 Git Hooks》</a></p>
<h2 id="本周见闻"><a href="#本周见闻" class="headerlink" title="本周见闻"></a>本周见闻</h2><h3 id="AI-画画"><a href="#AI-画画" class="headerlink" title="AI 画画"></a>AI 画画</h3><p>上周和菜头在公众号分享了一篇文章<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/abcMo8pxi9Gnu40m8DIFhg">《新玩具，新瘾头》</a>，里面介绍了一个谷歌的 AI 图像生成程序 <a target="_blank" rel="noopener" href="https://colab.research.google.com/github/alembics/disco-diffusion/blob/main/Disco_Diffusion.ipynb">Disco Diffusion</a>，它可以根据描述场景的关键词渲染出对应的图像，真的非常惊艳，有兴趣可以玩一下。</p>
<p>从文中借一张图来展示下效果：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images202205312334384.png" alt="图片"></p>
<h3 id="文本生成图片"><a href="#文本生成图片" class="headerlink" title="文本生成图片"></a>文本生成图片</h3><p>这是谷歌的一个 AI 模型 <a target="_blank" rel="noopener" href="https://imagen.research.google/">Imagen</a>，可以根据输入文字生成写实的图片，下面这个弹吉他的猫就是它生成的：</p>
<img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images202205312247639.jpeg" alt="img"/>

<h3 id="Edge-的-AI-图像增强功能"><a href="#Edge-的-AI-图像增强功能" class="headerlink" title="Edge 的 AI 图像增强功能"></a><a target="_blank" rel="noopener" href="https://blogs.bing.com/search-quality-insights/may-2022/Turing-Image-Super-Resolution">Edge 的 AI 图像增强功能</a></h3><p>微软图灵团队发布了一个 AI 模型  Super-Resolution (T-ISR)，它可以提高图片的质量，它将应用在 Bing 地图以及 Edge 浏览器中，目前已经在 <a target="_blank" rel="noopener" href="https://www.microsoftedgeinsider.com/en-us/download/canary">Edge Canary</a> 中发布，将会在未来几个月推广给用户使用。</p>
<p>附上对比效果：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images202205312333952.png" alt="image-20220531233321460"></p>
<h3 id="冒名顶替综合症"><a href="#冒名顶替综合症" class="headerlink" title="冒名顶替综合症"></a>冒名顶替综合症</h3><blockquote>
<p>冒名顶替综合症是一种心理现象，即一个人怀疑自己的技能、才能或成就，并有一种持续的内在恐惧，害怕被揭穿自己是个骗子。</p>
</blockquote>
<p>老实讲，从我开始写博客一直到今天，期间也写过一些较有深度的技术文章，往往这个时候都能感觉到自己知识的匮乏，而当我将这些文章发布到技术论坛时，一方面我自然希望可以帮助到更多人，另一方面也希望可以通过这些文章结识到更多志同道合的朋友，可是每当有人称赞我的文章写得不错的时候，我在开心之余，也隐约担心自己是否承受得起，其实这些文章是我花费了数天晚上才勉强肝出来的，并不轻松，我深知自己并没有他们口中说的那么厉害，甚至很多时候我会忘记自己在文章中写过的知识，但是好处是我可以非常快地重新拾起来，所以为了让自己可以持续地输出对别人有帮助的文章，我需要花费更多的时间在写作这件事情上，其实收益最大的是自己。</p>
<h2 id="一些-tips"><a href="#一些-tips" class="headerlink" title="一些 tips"></a>一些 tips</h2><h3 id="没有-Docker-Desktop-的情况下运行-Docker"><a href="#没有-Docker-Desktop-的情况下运行-Docker" class="headerlink" title="没有 Docker Desktop 的情况下运行 Docker"></a><a target="_blank" rel="noopener" href="https://www.swyx.io/running-docker-without-docker-desktop/">没有 Docker Desktop 的情况下运行 Docker</a></h3><p>Docker 几乎是每一位开发者都必备的工具，然而 Docker Desktop for Mac 也被无数人吐槽过，现在我们终于可以摆脱 Docker Desktop，使用 <a target="_blank" rel="noopener" href="https://github.com/abiosoft/colima/">Colima</a> 即可在你的电脑上运行 Docker。</p>
<p>不过笔者按照文档上的步骤，遇到了这个报错：</p>
<blockquote>
<p>FATA[0000] error starting vm: error at ‘starting’: exit status 1</p>
</blockquote>
<p>如果你也遇到同样的问题，可以试试这个操作步骤：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; brew <span class="built_in">unlink</span> colima <span class="comment"># 已经安装的话，先卸载</span></span><br><span class="line"></span><br><span class="line">&gt; brew install --HEAD colima</span><br><span class="line"></span><br><span class="line">&gt; colima start --runtime docker</span><br><span class="line"></span><br><span class="line">&gt; docker ps <span class="comment"># 成功</span></span><br></pre></td></tr></table></figure>

<h2 id="分享文章"><a href="#分享文章" class="headerlink" title="分享文章"></a>分享文章</h2><h3 id="主要版本号不是神圣的"><a href="#主要版本号不是神圣的" class="headerlink" title="主要版本号不是神圣的"></a><a target="_blank" rel="noopener" href="https://tom.preston-werner.com/2022/05/23/major-version-numbers-are-not-sacred.html">主要版本号不是神圣的</a></h3><p>本文的作者是 <a target="_blank" rel="noopener" href="https://semver.org/lang/zh-CN/">语义化版本控制规范</a> 的提出者，相信大家对这个规范都不陌生，它规定了版本格式应该为：主版本号.次版本号.修订号。</p>
<p>版本号递增规则如下：</p>
<ol>
<li>主版本号：当你做了不兼容的 API 修改，</li>
<li>次版本号：当你做了向下兼容的功能性新增，</li>
<li>修订号：当你做了向下兼容的问题修正。</li>
</ol>
<p>但作者在提出这个规范十年后的今天，发现了一个问题：大家把主版本号的升级看得太重要。</p>
<p>文章主要传递一个观点：<strong>主版本号的升级不应该作为一种营销的噱头，只要有 breaking change（重大改变） 时就应该升级，没有例外。</strong></p>
<p>下面聊些不太成熟的观点，在项目的实践中，特别是开源前端组件库，经常会面临一个选择困境：我们不得不对某个 API 做出 breaking change，然而这个  API 仅在少数场景下被使用到，如果严格遵循语义化版本，那我们将要升级主版本号，但是对于用户而言，会认为是整个组件库得到了升级，所以我认为这一点上还是需要根据实际情况做考虑。</p>
<h2 id="有趣的链接"><a href="#有趣的链接" class="headerlink" title="有趣的链接"></a>有趣的链接</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://acapela.com/">Acapela</a>：一个收件箱搞定所有工作通知。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://uiverse.io/switches">uiverse.io</a>：一些开源的 UI 元素，可以直接复制代码。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://henryheffernan.com/">Henry Heffernan - Portfolio 2022</a>：一个惊艳的个人网站。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://sideproject.guide/">Side Project 指南</a>：一本关于程序员开发 Side Project 指南的小册。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://bionic-reading.com/">Bionic Reading</a>：这是一种英文阅读方式，它认为将每个单词的首字母变成大写后会使阅读效率提高，Reeder 也使用了这个服务。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://ooooooooooooooooooooooo.ooo/">ooooooooooooooooooooooo.ooo | URL Lengthner</a>：输入任意 URL，将它转换为全是 oooo。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://psychology-tools.com/">心理学工具</a>：一个经过学术验证的心理评估工具，如果这段时间感到焦虑、压力大的话可以简单做下测试。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://browser.engineering/index.html">Web Browser Engineering</a>：一本教你使用 1000 行的 Python 代码构建一个基本但完整的Web浏览器的书。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/weekly-npm-packages-02.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/weekly-npm-packages-02.html" itemprop="url">每周轮子之 husky：统一规范团队 Git Hooks</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-29T16:00:00+00:00">
                2022-05-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>本文是每周轮子计划的第二篇，本周我们来实现一个被广泛使用的工具，那就是鼎鼎大名的 husky，几乎所有现代前端项目、以及 Node.js 项目都会接入这个工具，它的用途主要是统一管理项目中的 Git Hooks 脚本，不熟悉该工具的同学也不要紧，下面我们先来简单介绍一下 husky，它到底解决了什么问题，我们为什么需要使用 husky。</p>
<p>大部分公司都会采用 Git 来对项目进行代码的版本控制，其好处相信大家都知道，这里就不再赘述，通常为了保证项目的代码质量、以及更好地进行团队之间的协作，我们都会在提交代码时做一些额外的工作，包括：检查 commit message 的规范性、统一代码风格、进行单元测试等等。</p>
<p>而这些工作自然不能完全依靠项目成员的自觉性，毕竟人都会犯错，所以这些工作都得交给自动化工具来处理。</p>
<p>因此，大部分版本控制系统都会提供一个叫做钩子（Hooks）的东西，Git 自然也不例外，Hooks 可以让我们在特定的重要动作发生时触发自定义脚本，通常分为客户端和服务端，而我们接触的大部分 Hooks 都是客户端的，也就是在我们本机上执行的。</p>
<p>下面我们简单介绍一下如何在 Git 中使用 Hooks，我们只需要在项目的 <code>.git/hooks</code> 目录中创建一个<strong>与某个 hook 同名的可执行脚本</strong>即可，比如我们想要阻止一切提交，并将 commit message 打印到终端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .git/hooks/commit-msg</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">INPUT_FILE=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">START_LINE=$(<span class="built_in">head</span> -n1 <span class="variable">$INPUT_FILE</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前提交信息为：<span class="variable">$START_LINE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;阻止此次提交！！！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure>

<p>这里先别纠结这段脚本代码是如何做到的，只需清楚我们可以利用 Git Hooks 做到这一点，实际上我们可以在这里做任何操作，比如检查 commit message 的规范性。</p>
<p>讲完如何使用 Git Hooks，那我们就得讲讲这种方式存在哪些不足。</p>
<p>在 <a target="_blank" rel="noopener" href="https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90">Git 文档</a>中对客户端钩子有这么一段话：</p>
<blockquote>
<p>需要注意的是，克隆某个版本库时，它的客户端钩子并不随同复制。 如果需要靠这些脚本来强制维持某种策略，建议你在服务器端实现这一功能。 </p>
</blockquote>
<p>简单来说就是，我们上面添加的这个 <code>commit-msg</code> Hook，只能在我们自己的机器上，不能被加入到版本控制中推送到远端，也就意味着我们无法同步这些 Hooks 脚本。</p>
<p>而 husky 主要就是为了解决这个问题，除此之外还提供了更加简便的方式来使用 Git Hooks，而无须采用上面那种方式。</p>
<p>先来介绍一下大家所熟知的 husky 用法，首先要安装这个工具，可以使用全局安装，但一般更推荐在项目本地安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install husky -D</span><br></pre></td></tr></table></figure>

<p>然后我们在 <code>package.json</code> 中添加以下代码：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;husky&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lint-staged&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pre-push&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yarn test&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>以上这种方式是 husky v4 版本之前的配置方式，相信大部分同学都对这种方式很熟悉了，而在最新版本 husky（v7 之后） 已经不支持这样使用，而是采用命令行配置的方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/pre-commit <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line">npx husky add .husky/pre-push <span class="string">&quot;yarn test&quot;</span></span><br></pre></td></tr></table></figure>

<p>它的配置方式之所以会有如此翻天覆地的变化是有原因的，不过说来话长，我们下面会讲到，这里先按下不表。</p>
<p>本文就带领大家从 0 到 1 造一个 husky，我们先从第一种使用方式开始，然后一步步来看为什么 husky 在新版本会选择改变它的配置方式。</p>
<p>让我们开始吧！</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="v4-以前的版本"><a href="#v4-以前的版本" class="headerlink" title="v4 以前的版本"></a>v4 以前的版本</h3><p>我们先来以最 low 的方式实现它，第一步是对 <code>package.json</code> 进行配置，以便测试：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;husky&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo hello husky!&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后读取 <code>package.json</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// husky.js</span></span><br><span class="line"><span class="keyword">const</span> pkg = <span class="built_in">require</span>(<span class="string">&#x27;./package.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">husky</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!pkg?.<span class="property">husky</span>?.<span class="property">hooks</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> pkg.<span class="property">husky</span>.<span class="property">hooks</span> !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> hooks = pkg.<span class="property">husky</span>.<span class="property">hooks</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(hooks)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">husky</span>()</span><br></pre></td></tr></table></figure>

<p>现在我们现在已经能拿到 hooks 相关的配置，然后我们把相关的脚本内容写入到对应的 hooks 可执行文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [name, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(hooks)) &#123;</span><br><span class="line">  <span class="keyword">const</span> script = <span class="string">`#!/bin/sh\n<span class="subst">$&#123;value&#125;</span>\n`</span></span><br><span class="line"></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(<span class="string">`./.git/hooks/<span class="subst">$&#123;name&#125;</span>`</span>, script, &#123; <span class="attr">mode</span>: <span class="string">&#x27;751&#x27;</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node husky.js</span><br></pre></td></tr></table></figure>

<p>然后我们就可以看到 <code>.git/hooks</code> 下面多了一个 <code>pre-commit</code> 可执行文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cat</span> pre-commit</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="built_in">echo</span> hello husky!</span><br></pre></td></tr></table></figure>

<p> 这时候进行 commit 也可以看到输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; git commit -m <span class="string">&quot;test&quot;</span></span><br><span class="line"></span><br><span class="line">hello husky!</span><br></pre></td></tr></table></figure>

<p>这时候我们已经完成了 husky 大部分的功能，但是这里还存在这么一个问题：<strong>如果现在我去修改 <code>package.json</code>  中的 husky 配置，hooks 文件如何同步更新？</strong></p>
<p>举个例子，如果现在把 <code>package.json</code> 改成这样：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;husky&quot;: &#123;</span><br><span class="line">    &quot;hooks&quot;: &#123;</span><br><span class="line"><span class="deletion">-     &quot;pre-commit&quot;: &quot;echo hello husky!&quot;</span></span><br><span class="line"><span class="addition">+     &quot;pre-commit&quot;: &quot;echo hello husky2!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后进行 commit，它输出的仍然是 hello husky!，实际上如果我们不是手动执行写入 hooks 文件这个操作，甚至连第一步都做不到，可是回想上面 husky 的使用方式，我们只需要安装 husky 后进行配置即可，并不需要手动执行什么命令。</p>
<p>那 Huksy 是如何做到这一点的呢？动动你聪明的小脑瓜，有没有解决方案呢？</p>
<p>我们先来分析一下为什么无法做到自动同步更新 hooks，归根到底就是因为无法检测修改 <code>package.json</code> 后自动执行写入 hooks 操作，那我们不妨换一种思路：<strong>不用在修改 <code>package.json</code> 时执行写入操作，而是在执行 hooks 时去执行 <code>package.json</code> 中对应的 <code>hooks</code>。</strong></p>
<p>可能有点拗口，换句话说就是我们在一开始就把所有的 hooks 预注册了，然后在每一个 hooks 脚本中做同一件事：寻找 <code>package.json</code> 中对应的 hooks 并执行。</p>
<p>可能会觉得有点奇技淫巧 ，但也不失为一种曲线救国的方式，而事实上在 husky v4 之前还真的是这么做的。</p>
<p>那我们如何在一开始就注册所有 hooks 呢？</p>
<p>翻了一下 npm 的文档，发现有一个 <code>install</code> 钩子，它会在 <code>npm install</code> 后执行。</p>
<p>首先我们的项目结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── husky-test</span><br><span class="line">│   ├── husky</span><br><span class="line">│   │   ├── husky.js</span><br><span class="line">│   │   └── package.json</span><br><span class="line">│   └── package.json</span><br></pre></td></tr></table></figure>

<p>在 <code>husky/package.json</code> 添加以下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;husky&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;install&quot;</span>: <span class="string">&quot;node husky&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>husky-test</code> 安装这个 npm 包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;husky-test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;husky&quot;</span>: <span class="string">&quot;./husky&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候执行 <code>npm install</code> 会运行 <code>husky/husky.js</code> ，我们就可以在这个文件中预注册所有的 hooks，不过在此之前我们先梳理一下整体实现逻辑：</p>
<ol>
<li>我们要在 <code>husky.js</code> 中预注册所有的 hooks，可以在这个<a target="_blank" rel="noopener" href="https://git-scm.com/docs/githooks">文档</a>中参考所有的 hooks。</li>
<li>我们要在所有的 hooks 中写入脚本内容，使其可以在被执行时寻找 <code>package.json</code> 中对应的 hook，并将其执行结果返回。<ol>
<li>因为 hooks 的 exit code 非 0 时要中断本次操作。</li>
</ol>
</li>
</ol>
<p>因此，经过梳理后，我们的目录结构调整如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── husky                   // husky 包</span><br><span class="line">│   ├── package.json     </span><br><span class="line">│   ├── husky.js            // install 入口</span><br><span class="line">│   ├── installer           // 初始化，预注册 hooks</span><br><span class="line">│   │   └── index.js     </span><br><span class="line">│   ├── runner              // 寻找对应的 hook 并执行</span><br><span class="line">│   │   └── index.js     </span><br><span class="line">│   └── sh                  // 所有 hooks 统一调用脚本</span><br><span class="line">│       └── husky.sh     </span><br><span class="line">└── package.json            // 测试</span><br></pre></td></tr></table></figure>

<p>我们在 <code>husky.js</code> 中调用 install 进行初始化操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> install = <span class="built_in">require</span>(<span class="string">&#x27;./installer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">install</span>()</span><br></pre></td></tr></table></figure>

<p>然后在 <code>installer/index.js</code> 中预注册 hooks：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// installer/index.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> cp = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hookList = [</span><br><span class="line">  <span class="string">&#x27;applypatch-msg&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pre-applypatch&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;post-applypatch&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pre-commit&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pre-merge-commit&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;prepare-commit-msg&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;commit-msg&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;post-commit&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pre-rebase&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;post-checkout&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;post-merge&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pre-push&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;post-update&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;push-to-checkout&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pre-auto-gc&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;post-rewrite&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;sendemail-validate&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">git</span>(<span class="params">args, cwd = process.cwd()</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> cp.<span class="title function_">spawnSync</span>(<span class="string">&#x27;git&#x27;</span>, args, &#123; <span class="attr">stdio</span>: <span class="string">&#x27;pipe&#x27;</span>, <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span>, cwd &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getGitRoot</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">git</span>([<span class="string">&#x27;rev-parse&#x27;</span>, <span class="string">&#x27;--show-toplevel&#x27;</span>]).<span class="property">stdout</span>.<span class="title function_">trim</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getGitHooksDir</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> root = <span class="title function_">getGitRoot</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">join</span>(root, <span class="string">&#x27;.git/hooks&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getHookScript</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`#!/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">. &quot;$(dirname &quot;$0&quot;)/husky.sh&quot;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">writeHook</span>(<span class="params">filename, script</span>) &#123;</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(filename, script, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  fs.<span class="title function_">chmodSync</span>(filename, <span class="number">0o0755</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createHook</span>(<span class="params">filename</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hookScript = <span class="title function_">getHookScript</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">writeHook</span>(filename, hookScript)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createHooks</span>(<span class="params">gitHooksDir</span>) &#123;</span><br><span class="line">  <span class="title function_">getHooks</span>(gitHooksDir).<span class="title function_">forEach</span>(createHook)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getHooks</span>(<span class="params">gitHooksDir</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hookList.<span class="title function_">map</span>(<span class="function">(<span class="params">hookName</span>) =&gt;</span> path.<span class="title function_">join</span>(gitHooksDir, hookName))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getMainScript</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> mainScript = fs.<span class="title function_">readFileSync</span>(</span><br><span class="line">    path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../../sh/husky.sh&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mainScript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMainScript</span>(<span class="params">gitHooksDir</span>) &#123;</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(path.<span class="title function_">join</span>(gitHooksDir, <span class="string">&#x27;husky.sh&#x27;</span>), <span class="title function_">getMainScript</span>(), <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">install</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> gitHooksDir = <span class="title function_">getGitHooksDir</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createHooks</span>(gitHooksDir)</span><br><span class="line">  <span class="title function_">createMainScript</span>(gitHooksDir)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>做完这一步的结果是在安装 husky 时，会自动创建 hooks、并将 <code>husky.sh</code> 复制到 <code>.git/hooks</code> 中，所有 hooks 都会调用 <code>husky,sh</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">. <span class="string">&quot;<span class="subst">$(dirname <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>/husky.sh&quot;</span></span><br></pre></td></tr></table></figure>

<p>在 <code>husky.sh</code> 中主要是做一件事，调用 <code>runner/index</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sh/husky.sh</span></span><br><span class="line">gitParams=<span class="string">&quot;$*&quot;</span></span><br><span class="line">hookName=<span class="string">&quot;<span class="subst">$(basename <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">npm husky-run <span class="variable">$hookName</span> <span class="string">&quot;<span class="variable">$gitParams</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>husky-run</code> 是我们自定义的一个命令，需要在 <code>package.json</code> 中先注册：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// husky/package.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;husky&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;MIT&quot;,</span><br><span class="line">  &quot;bin&quot;: &#123;</span><br><span class="line"><span class="addition">+   &quot;husky-run&quot;: &quot;./runner/index.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;install&quot;: &quot;node husky&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以实际上就是调用 <code>runner/index</code>，我们要在这个文件中寻找对应的 hook 并执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line">const &#123; spawnSync &#125; = require(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line">const &#123; cosmiconfigSync &#125; = require(<span class="string">&#x27;cosmiconfig&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> getConf(<span class="built_in">dir</span>) &#123;</span><br><span class="line">  const explorer = cosmiconfigSync(<span class="string">&#x27;husky&#x27;</span>)</span><br><span class="line">  const &#123; config = &#123;&#125; &#125; = explorer.search(<span class="built_in">dir</span>) || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  const defaults = &#123;</span><br><span class="line">    skipCI: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> &#123; ...defaults, ...config &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> getCommand(cwd, hookName) &#123;</span><br><span class="line">  const config = getConf(cwd)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> config &amp;&amp; config.hooks &amp;&amp; config.hooks[hookName]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> runner(</span><br><span class="line">  [, , hookName = <span class="string">&#x27;&#x27;</span>, husky_GIT_PARAMS],</span><br><span class="line">  &#123; cwd = process.cwd() &#125; = &#123;&#125;</span><br><span class="line">) &#123;</span><br><span class="line">  const <span class="built_in">command</span> = getCommand(cwd, hookName)</span><br><span class="line"></span><br><span class="line">  const <span class="built_in">env</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (husky_GIT_PARAMS) &#123;</span><br><span class="line">    env.husky_GIT_PARAMS = husky_GIT_PARAMS</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">command</span>) &#123;</span><br><span class="line">    <span class="built_in">return</span> runCommand(cwd, hookName, <span class="built_in">command</span>, <span class="built_in">env</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> runCommand(cwd, hookName, cmd, <span class="built_in">env</span>) &#123;</span><br><span class="line">  const &#123; status &#125; = spawnSync(<span class="string">&#x27;sh&#x27;</span>, [<span class="string">&#x27;-c&#x27;</span>, cmd], &#123;</span><br><span class="line">    cwd,</span><br><span class="line">    <span class="built_in">env</span>: &#123; ...process.env, ...<span class="built_in">env</span> &#125;,</span><br><span class="line">    stdio: <span class="string">&#x27;inherit&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (status !== 0) &#123;</span><br><span class="line">    const noVerifyMessage = [</span><br><span class="line">      <span class="string">&#x27;commit-msg&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;pre-commit&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;pre-rebase&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;pre-push&#x27;</span></span><br><span class="line">    ].includes(hookName)</span><br><span class="line">      ? <span class="string">&#x27;(add --no-verify to bypass)&#x27;</span></span><br><span class="line">      : <span class="string">&#x27;(cannot be bypassed with --no-verify due to Git specs)&#x27;</span></span><br><span class="line"></span><br><span class="line">    console.log(`husky &gt; <span class="variable">$&#123;hookName&#125;</span> hook failed <span class="variable">$&#123;noVerifyMessage&#125;</span>`)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (status === 127) &#123;</span><br><span class="line">    <span class="built_in">return</span> 1</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> status || 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async <span class="keyword">function</span> <span class="function"><span class="title">run</span></span>() &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const status = await runner(process.argv)</span><br><span class="line">    process.exit(status)</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    console.log(<span class="string">&#x27;husky &gt; unexpected error&#x27;</span>, err)</span><br><span class="line">    process.exit(1)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run()</span><br></pre></td></tr></table></figure>

<p>我们来测试一下，在 <code>package.json</code> 添加如下配置：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;husky-test&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;MIT&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;husky&quot;: &quot;./husky&quot;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="addition">+  &quot;husky&quot;: &#123;</span></span><br><span class="line"><span class="addition">+    &quot;hooks&quot;: &#123;</span></span><br><span class="line"><span class="addition">+      &quot;pre-commit&quot;: &quot;echo 123 &amp;&amp; exit 1&quot;</span></span><br><span class="line"><span class="addition">+    &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后进行一次 commit，得到结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; git commit -m <span class="string">&quot;test&quot;</span></span><br><span class="line"></span><br><span class="line">123</span><br><span class="line">husky &gt; pre-commit hook failed (add --no-verify to bypass)</span><br></pre></td></tr></table></figure>

<p>OK，到这里我们除了一些代码上的健壮性问题以外，已经把大部分 husky v4 版本的核心功能都给实现了。</p>
<p>不过我们已经能够对 husky 的实现方式给摸透，各位同学认为这样的实现方式好不好呢？</p>
<p>其实 husky 的这种通过预注册所有 hooks 的方式一直被人诟病，详见 <a target="_blank" rel="noopener" href="https://github.com/typicode/husky/issues/260">#260</a> 。</p>
<p>其实 husky 的维护者也知道这种方式属实不妥，不过由于当时 Git 的 hooks 机制，只能一直顶着骂名维护下去。</p>
<p>终于，在 Git v2.9 的版本升级中，正式支持通过配置 core.hooksPath 自定义项目的 hooks 的存放路径，也即意味着可将 hooks 加入版本控制，于是 husky 二话不说地进行了重构，用了一种全新的实现方式来做这件事，也就是我们今天看到的 husky v5 以后的版本（截止目前最新的 v8 版本）。</p>
<p>同时 husky 因为配置方式的缘故，使其仅局限于 node.js 项目，为了提高 husky 的使用范围，最新版本决定采用 CLI 配置的方式，参见：<a target="_blank" rel="noopener" href="https://blog.typicode.com/husky-git-hooks-javascript-config/">Why husky has dropped conventional JS config</a>。</p>
<p>因此，最新版本的 husky 实现代码与前面版本截然不同，下面我们继续从 0 到 1 开始实现 husky。</p>
<h3 id="v4-以后的版本"><a href="#v4-以后的版本" class="headerlink" title="v4 以后的版本"></a>v4 以后的版本</h3><p>我们再把最新版本的 husky 使用方式介绍一遍：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化</span></span><br><span class="line">npm set-script prepare <span class="string">&quot;husky install&quot;</span></span><br><span class="line">npm run prepare</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 hook</span></span><br><span class="line">npx husky add .husky/pre-commit <span class="string">&quot;npm test&quot;</span></span><br><span class="line">git add .husky/pre-commit</span><br></pre></td></tr></table></figure>

<p>可以发现最新版本的 husky 无需利用 npm 的 install 钩子，毕竟已经不再局限于 node.js 项目，所以初始化操作需要另寻僻径，在 husky 文档中给出的解决方案是利用 npm 的 prepare 钩子，其可以执行 npm publish 和 不带参数的 npm install 时执行。</p>
<p>同时 husky 一共支持以下命令：</p>
<ol>
<li>husky install：安装，主要是配置 Git 的 core.hooksPath</li>
<li>husky uninstall：卸载，主要是恢复对 Git 的 core.hooksPath 的修改</li>
<li>husky set：新增 hook</li>
<li>husky add：给已有的 hook 追加命令</li>
</ol>
<p>因此，它的实现方式并不难，这里我直接张贴核心源码过来，首先是 CLI 的入口：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get CLI arguments</span></span><br><span class="line"><span class="keyword">const</span> [, , cmd, ...args] = process.<span class="property">argv</span></span><br><span class="line"><span class="keyword">const</span> ln = args.<span class="property">length</span></span><br><span class="line"><span class="keyword">const</span> [x, y] = args</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set or add command in hook</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hook</span> = (<span class="params">fn: (a1: <span class="built_in">string</span>, a2: <span class="built_in">string</span>) =&gt; <span class="built_in">void</span></span>) =&gt; (): <span class="function"><span class="params">void</span> =&gt;</span></span><br><span class="line">  <span class="comment">// Show usage if no arguments are provided or more than 2</span></span><br><span class="line">  !ln || ln &gt; <span class="number">2</span> ? <span class="title function_">help</span>(<span class="number">2</span>) : <span class="title function_">fn</span>(x, y)</span><br><span class="line"></span><br><span class="line"><span class="comment">// CLI commands</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">cmds</span>: &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125; = &#123;</span><br><span class="line">  <span class="attr">install</span>: (): <span class="function"><span class="params">void</span> =&gt;</span> (ln &gt; <span class="number">1</span> ? <span class="title function_">help</span>(<span class="number">2</span>) : h.<span class="title function_">install</span>(x)),</span><br><span class="line">  <span class="attr">uninstall</span>: h.<span class="property">uninstall</span>,</span><br><span class="line">  <span class="attr">set</span>: <span class="title function_">hook</span>(h.<span class="property">set</span>),</span><br><span class="line">  <span class="attr">add</span>: <span class="title function_">hook</span>(h.<span class="property">add</span>),</span><br><span class="line">  [<span class="string">&#x27;-v&#x27;</span>]: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="comment">// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-var-requires</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">require</span>(p.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../package.json&#x27;</span>)).<span class="property">version</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run CLI</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// Run command or show usage for unknown command</span></span><br><span class="line">  cmds[cmd] ? cmds[cmd]() : <span class="title function_">help</span>(<span class="number">0</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(e <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? <span class="string">`husky - <span class="subst">$&#123;e.message&#125;</span>`</span> : e)</span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="install-安装初始化"><a href="#install-安装初始化" class="headerlink" title="install 安装初始化"></a>install 安装初始化</h4><p>安装初始化主要做以下事情：</p>
<ol>
<li>拷贝 <code>husky.sh</code> 到项目中，其主要工作是添加 debug 开关以及支持 <code>.huskyrc</code> 配置文件，最后将其添加到 <code>.gitignore</code>。</li>
<li>将 Git 的 core.hooksPath 修改为项目目录的 <code>.husky</code>，后续添加的 hooks 都将存放在此目录。</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">dir = <span class="string">&#x27;.husky&#x27;</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">HUSKY</span> === <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">l</span>(<span class="string">&#x27;HUSKY env variable is set to 0, skipping install&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ensure that we&#x27;re inside a git repository</span></span><br><span class="line">  <span class="comment">// If git command is not found, status is null and we should return.</span></span><br><span class="line">  <span class="comment">// That&#x27;s why status value needs to be checked explicitly.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">git</span>([<span class="string">&#x27;rev-parse&#x27;</span>]).<span class="property">status</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Custom dir help</span></span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">&#x27;https://typicode.github.io/husky/#/?id=custom-directory&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ensure that we&#x27;re not trying to install outside of cwd</span></span><br><span class="line">  <span class="keyword">if</span> (!p.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), dir).<span class="title function_">startsWith</span>(process.<span class="title function_">cwd</span>())) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`.. not allowed (see <span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ensure that cwd is git top level</span></span><br><span class="line">  <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(<span class="string">&#x27;.git&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`.git can&#x27;t be found (see <span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Create .husky/_</span></span><br><span class="line">    fs.<span class="title function_">mkdirSync</span>(p.<span class="title function_">join</span>(dir, <span class="string">&#x27;_&#x27;</span>), &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create .husky/_/.gitignore</span></span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(p.<span class="title function_">join</span>(dir, <span class="string">&#x27;_/.gitignore&#x27;</span>), <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy husky.sh to .husky/_/husky.sh</span></span><br><span class="line">    fs.<span class="title function_">copyFileSync</span>(p.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../husky.sh&#x27;</span>), p.<span class="title function_">join</span>(dir, <span class="string">&#x27;_/husky.sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Configure repo</span></span><br><span class="line">    <span class="keyword">const</span> &#123; error &#125; = <span class="title function_">git</span>([<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;core.hooksPath&#x27;</span>, dir])</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">throw</span> error</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">l</span>(<span class="string">&#x27;Git hooks failed to install&#x27;</span>)</span><br><span class="line">    <span class="keyword">throw</span> e</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">l</span>(<span class="string">&#x27;Git hooks installed&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="uninstall-卸载"><a href="#uninstall-卸载" class="headerlink" title="uninstall 卸载"></a>uninstall 卸载</h4><p>卸载的工作就更简单了，只需要恢复对 Git 的 core.hooksPath 的配置即可：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">uninstall</span>(<span class="params"></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="title function_">git</span>([<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;--unset&#x27;</span>, <span class="string">&#x27;core.hooksPath&#x27;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="set-添加-hook"><a href="#set-添加-hook" class="headerlink" title="set 添加 hook"></a>set 添加 hook</h4><p>添加 hook 只需要创建对应的 hook 脚本文件，并写入内容：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">file: <span class="built_in">string</span>, cmd: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> dir = p.<span class="title function_">dirname</span>(file)</span><br><span class="line">  <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(dir)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">      <span class="string">`can&#x27;t create hook, <span class="subst">$&#123;dir&#125;</span> directory doesn&#x27;t exist (try running husky install)`</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(</span><br><span class="line">    file,</span><br><span class="line">    <span class="string">`#!/usr/bin/env sh</span></span><br><span class="line"><span class="string">. &quot;$(dirname -- &quot;$0&quot;)/_/husky.sh&quot;</span></span><br><span class="line"><span class="string"><span class="subst">$&#123;cmd&#125;</span></span></span><br><span class="line"><span class="string">`</span>,</span><br><span class="line">    &#123; <span class="attr">mode</span>: <span class="number">0o0755</span> &#125;,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="title function_">l</span>(<span class="string">`created <span class="subst">$&#123;file&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="add-追加-hook-命令"><a href="#add-追加-hook-命令" class="headerlink" title="add 追加 hook 命令"></a>add 追加 hook 命令</h4><p>add 命令是对已有的 hook 文件追加脚本文件，</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">file: <span class="built_in">string</span>, cmd: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(file)) &#123;</span><br><span class="line">    fs.<span class="title function_">appendFileSync</span>(file, <span class="string">`<span class="subst">$&#123;cmd&#125;</span>\n`</span>)</span><br><span class="line">    <span class="title function_">l</span>(<span class="string">`updated <span class="subst">$&#123;file&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">set</span>(file, cmd)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>本文带领大家从 0 到 1 实现了 v4 以及最新版本的 husky，相信大家看完后对 husky 的实现方式也有了一定的了解，在以后的工作中使用它将会更加地得心应手，但如果你所在的项目中不是使用 Git，而是其它版本控制工具，也可以尝试基于 husky 改造，比如本人就曾尝试将 husky 改造使其<a target="_blank" rel="noopener" href="https://github.com/gd4Ark/husky/pull/1">支持 Mercurial</a>。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-5-25-shimo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-5-25-shimo/" itemprop="url">靠软件赚钱，真的太难了｜石墨文档</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-24T17:31:00+00:00">
                2022-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本文首发于公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ULmHo2lu_15WLFxcTPWQRQ">效率工具指南</a>」<br>文&#x2F;彭宏豪   </p>
<p>Hello 各位好，我是小豪。   </p>
<p>昨天在公司用着<strong>石墨文档</strong>的时候，发生了一个小插曲：  </p>
<p>原本可以免费使用的「搜索文档正文」功能，在刷新页面后，变成了「个人高级版」中的一项权益，真像一句话说的「翻脸比翻书还快」。  </p>
<p><img src="https://img.penghh.fun/2022/05/25/16534077864620.jpg"></p>
<p>说这个小插曲，并不是想吐槽「石墨文档你咋能这样，别的在线文档都是免费的功能，你却拿来收费，吃相这么难看」，反而是想说：<strong>在国内想靠软件赚钱，真的太难了</strong>。    </p>
<p>因为不少人会觉得：      </p>
<ul>
<li>我都习惯用盗版了，你跟我扯正版？   </li>
<li>软件免费就是天经地义，你跟我扯付费？   </li>
<li>大厂出的同类型的产品，好好的你放着不用，偏偏要来用这个名不见经传的小产品？</li>
</ul>
<p>首先，我想声明我的观点：     </p>
<ul>
<li>我讨厌「产品唯大厂论」或是跪舔大厂产品的说法，一刀切地认为大厂的产品就是比小众的产品好，即便大厂的产品实际上做得并不咋地        </li>
<li>我讨厌那些因为「某款软件有广告」而否定某款产品的行为，你既想免费使用，但又不想花钱，看到广告后还骂娘，这种行为就有点像是：既想白嫖但又不愿意好好说话，敢情你来白嫖还是看得起对方一样，毕竟你还能反驳对方，我帮你贡献了一个阅读量或者播放量呢</li>
</ul>
<p>说回到石墨文档，如果你有看过石墨文档免费版和个人高级版的功能对比，会发现，<strong>个人高级版并没有非常吸引人的卖点，让人非得去开通会员</strong>。      </p>
<p>而这次刚好让我撞见的「搜索正文」功能，正好是我经常要用到的功能，突然变成了会员专属的权益，犹豫了一小下，还是开通了一年的会员。   </p>
<p><img src="https://img.penghh.fun/2022/05/25/16534102075707.jpg"></p>
<p>我想看到这里，有些人肯定会在心里默念：这人该不会是个傻子吧？别的软件不花钱照样能用的搜索，你搁着花钱不是傻子是啥？      </p>
<p>是的，我确实很傻，但我希望石墨文档这么好看、有气质的产品，别那么快就消失在中国互联网里。        </p>
<p>如果你天天在用一个产品，尤其是小公司出的产品，却不舍得为它花一分钱，那它最终走向没落甚至消亡，也是大概率的事情。   </p>
<p>写到这里，突然想起之前一位同事在朋友圈里发过的一句歌词：   </p>
<blockquote>
<p>经过的人没有名字，唯有城市接近不朽。——《陌生城市的早晨》    </p>
</blockquote>
<p>我想把它改成：  </p>
<blockquote>
<p>用过的人最是无情，唯有消亡才是永恒。    </p>
</blockquote>
<h2 id="腾讯文档"><a href="#腾讯文档" class="headerlink" title="腾讯文档"></a>腾讯文档</h2><p>说完石墨文档，还想来说一下同类型的腾讯文档。  </p>
<p>先上我的观点：即便腾讯文档完全免费，它还是比不上石墨文档，因为它不是一款好产品——不美、不好用、不用心。    </p>
<p>这里还有一个小插曲：有一回在一个知名公众号作者的视频号直播间里，听到他这么评论腾讯文档，「腾讯文档是一群没有文化的人做出的产品」。    </p>
<p>腾讯文档的「不好」体现在哪里呢？   </p>
<p>我来列举两点：   </p>
<ul>
<li>文档标题和正文标题没有逻辑关系，让人很迷</li>
</ul>
<p>当我编辑了左上角的文档标题，正文开头的提示语「请输入标题」并不会随之发生变化，两者之间不存在关联，不知道这个提示语的作用是什么？    </p>
<p><img src="https://img.penghh.fun/2022/05/25/16534116298196.jpg"></p>
<ul>
<li>内置的搜索功能一团糟</li>
</ul>
<p>先说一下：腾讯文档也是支持搜索文档正文内容的，只是默认没有开启，需要手动开启。   </p>
<p>同样搜索「UI设计」，下图是石墨文档和腾讯文档正文搜索功能的对比，石墨文档会返回带有「UI设计」、「UI 设计」、「设计」、「UI」的结果，而腾讯文档只会返回「UI」的结果，而且不能直接看到 UI 在文档中的上下文。。。    </p>
<p>还有一个小细节，在腾讯文档中搜索「UI 设计」和「UI设计」得到的结果也是不同的，它把带有空格和不带空格的词当成两个截然不同的词了。。。真够蠢的。       </p>
<p><img src="https://img.penghh.fun/2022/05/25/16534123699819.jpg"></p>
<p>就这两点，还有加上腾讯文档难看的设计，你要说这是一个好产品，我还真的无法认同。   </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://img.penghh.fun/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">     </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-05-22-startup-10th-year-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-05-22-startup-10th-year-summary/" itemprop="url">我的移动开发程序人生 - 写在创业十周年</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-22T10:50:37+00:00">
                2022-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <blockquote>
<p>正值我在猿辅导工作十年，《新程序员》杂志的编辑小引老师邀请我撰文，作为第一代移动互联网开发者分享自己的成长过程和心得。文章经过多次修改，最终发表在 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/hUhfaWWi55s5c-uq_H4kgQ"> CSDN 微信公众号</a> 和 2022 年第五期《新程序员》杂志上。</p>
<p>以下是文章全文。</p>
</blockquote>
<h2 id="一、序"><a href="#一、序" class="headerlink" title="一、序"></a>一、序</h2><p>我是移动互联网时代兴起时的第一批开发者，见证了移动互联网将传统的 PC 互联网颠覆的过程。也有幸参与其中，推动移动互联网行业的发展。</p>
<p>本文介绍了我从接触计算机到选择职业开发道路，最后再承担起更多非技术工作的过程。希望我的程序人生能够帮助到大家，在面对新的时代机遇时抓住机会，与时代共舞。</p>
<h2 id="二、接触计算机"><a href="#二、接触计算机" class="headerlink" title="二、接触计算机"></a>二、接触计算机</h2><p>我的计算机之旅开始于 1999 年，那时我 15 岁，正在读初中。在我舅舅家里，第一次看到 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Windows_98">Windows 98</a> 电脑就被深深地吸引了。但那个时候，我对计算机完全没有概念，也不知道能做什么。我去学校对面的书刊亭，试图购买计算机入门的科普读物，但能够找到的只有《电脑报》。</p>
<p>2000 年，我升入高中，因为成都石室中学开设了 NOI（全国青少年信息学奥林匹克竞赛）课程，有幸得以学习计算机编程相关的知识。我还记得当时学的第一门语言是 Pascal，教材很难买到，于是老师自行复印了几本让我们学习。</p>
<p>那是一个让人热血沸腾的年纪！每天晚上做完作业后，我就会翻开编程教材，一句一句地读着那些晦涩的代码，希望参透其背后的算法逻辑。这可能是我这辈子学习知识最艰难的时候了，因为全年级参加这个课程的只有不到 5 个人，几乎没有交流，老师刚开始指导，也不太会讲，所以只能靠自己看书琢磨。</p>
<p>但现在回想起来，这真是一段 “打鸡血” 的日子。第一天看不懂就第二天接着看，差不多花了一个月的时间，终于把搜索算法看明白了。由于算法的原理大同小异，学完后再学其它的算法突然就容易多了。</p>
<p>也是在那个时候，我发现计算机相关的杂志变得更多了。《程序员》杂志在 2000 年创刊，我是它的第一波读者。那个时候，每个月我都会去报刊亭买《程序员》。其实好多内容我也看不太懂，但是它就有一种魔力，让我想读懂它。读着读着，好多也都懂得八九不离十了。</p>
<img src="/images/startup-10th-2.jpg" class="">
<blockquote>
<p>图 1：2003年的《程序员》杂志，摄于成都家中。</p>
</blockquote>
<p>2002 年，我参加全国青少年信息学奥林匹克竞赛，由于太过紧张，平时能做对的一道题目写错了一个条件，本来是应该 “小于等于”，我写成了 “小于”。于是程序虽然通过了样例，但在更复杂的测试用例上都错了，最后得了一个省二等奖。如果当初这道题做对，我就可以拿到省一等奖，进而拥有保送资格。</p>
<p>虽然没有了保送资格，但因为备赛的原因，我早早就买了电脑，也接入了互联网。我在网络上查到北京师范大学对于省二等奖的学生，提供了报考自主招生的机会。于是，在 2003 年的非典时期，我自行从四川到北京，参加了北京师范大学的自主招生考试，并且通过了！我只需要上重点线即可被北师大录取。因为这件事情对我来说过于简单，所以高考整个过程心态都比较放松，最终超了重点线 100 分。</p>
<p>就这样，计算机改变了我的整个中学生涯，帮助我进入了北京师范大学。</p>
<h2 id="三、玩转计算机"><a href="#三、玩转计算机" class="headerlink" title="三、玩转计算机"></a>三、玩转计算机</h2><p>大学开始后，我就继续参与计算机相关的竞赛和社团。竞赛上，我最终获得了 ACM-ICPC 国际大学生程序设计竞赛的亚洲区金奖（如下图）。而社团上，我则参与创建了北师大最大的民间 BBS 蛋蛋网。</p>
<img src="/images/startup-10th-1.jpg" class="">
<blockquote>
<p>图 2： 2004 年唐巧代表北京师范大学参加 ACM-ICPC</p>
</blockquote>
<p>另外，我和室友也不断地接网站制作的外包工作，他负责设计，我负责开发，两个人在大学时期挣了不少钱。我自己还给中学生做竞赛培训的家教，这块其实收费很高，在 2000 年，一般的学科家教才收费 50 左右 1 小时，计算机竞赛的家教能收费 200 一小时。</p>
<p>所以，到了大学的第二年我就可以不用家里给钱，自己负担学费和生活费了。</p>
<p>到了研究生阶段，我进入了 IBM、网易这样的企业实习，每月的收入更加丰厚。那个时候 IBM 的实习工资一个月有 4000 元，加上研究生本身还有补贴，所以我还存了不少钱。</p>
<p>就这样，在大学里，计算机就让我深刻地感受到了它的力量，既满足了经济需求，也收获了足够的社会实践经验。</p>
<h2 id="四、走上职业开发道路"><a href="#四、走上职业开发道路" class="headerlink" title="四、走上职业开发道路"></a>四、走上职业开发道路</h2><p>2010 年，我研究生毕业，拿到了百度、IBM、网易有道的研发工程师 Offer，最终选择了变化较多的网易有道，开始了职业开发的道路。</p>
<p>在网易有道，我先做了一年多的服务器端开发。当时正值国外 <a target="_blank" rel="noopener" href="https://twitter.com/">Twitter</a> 火热，我有幸参与了网易微博的服务器开发。当时，我负责的是网易微博的搜索服务，为了支持海量的用户发贴能被实时检索到，我们基于 <a target="_blank" rel="noopener" href="https://lucene.apache.org/">Lucene</a>  开发了多级索引。整个研发过程对我帮助很大，让我知道了企业级的服务是如何被模块化拆解，并最终完成组合的。</p>
<p>2011 年，iPhone 4S 进入中国，我预感到移动端才是未来的行业发展机会，在咨询了很多朋友之后，果断申请转做 iOS 端开发。</p>
<p>当时的情景很像十多年前我刚学编程的时候。iOS 技术太新，基本上没有任何可以阅读的资料，公司内的同行也没几个，大家也都不精通，所以只能靠自己。但和初中不一样的是：工作和排期已经安排下来了，我只有 1-2 周的时间，需要完成自学并交付相关的工作。</p>
<p>又是一段打鸡血的时间，那个时候没有中文资料，我找到了斯坦福大学以及 WWDC 的视频，结合苹果官方的文档，每天用上下班坐地铁和周末的时间来学习。我从来没有这么高强度地学习英文资料，一段时间下来，不仅掌握了 iOS 知识，还把我的英文听读能力也练过关了。</p>
<p>为了让后来者们不像我学习起来这么难受，我从那个时候开始写 iOS 的博客和公众号，也由此结交了许多同行。一年下来，我认识的 iOS 开发者就遍布了几乎所有的互联网公司。</p>
<p>写博客的积累也让我有机会将自己的知识慢慢梳理出来，最终我出版了<a target="_blank" rel="noopener" href="https://item.jd.com/11598468.html">《iOS 开发进阶》</a>，该书重印了 5 次，风靡一时。</p>
<h2 id="五、从开发者到更多角色"><a href="#五、从开发者到更多角色" class="headerlink" title="五、从开发者到更多角色"></a>五、从开发者到更多角色</h2><p>2012 年，我在网易的上司郭常圳邀请我加入猿辅导，作为核心员工参与在线教育行业的创业。在线教育行业在 2014 年开始火爆，而猿辅导的估值也以每年翻番的速度在增长。</p>
<p>在猿辅导，我的身份角色不停地在变化。</p>
<ul>
<li>刚开始我是 iOS 开发的负责人，指导并招聘了很多 iOS 工程师。</li>
<li>2014 年，小猿搜题立项时，我成为它的产品技术负责人，开始接触产品工作。</li>
<li>2019 年，开始接触投放和运营的工作。</li>
<li>2020 年，组建了智能硬件团队。</li>
<li>2021 年，开始接触供应链的工作。</li>
</ul>
<p>每一次角色的变化，对我来说都是一段似曾相识的 “打鸡血” 的日子。我会夜以继日地努力学习新领域的知识，希望自己的成长能够快速跟上业务的需求。有些时候，我做得还不够好，但好在公司一直给我机会，让我持续累进。</p>
<p>在从工程师成长为技术管理者的时候，我一边思考一边实践，慢慢形成了自己的方法论，即：将管理工作拆解成为管理业务、管理团队和管理技术。</p>
<ul>
<li>管理业务时，我通过 Scrum 敏捷开发将整个业务开发流程管理起来。</li>
<li>管理团队时，我主要关注人的招聘、一对一指导，以及打造积极向上的团队工作气氛。</li>
<li>管理技术时，我主要思考业务发展与技术方案是否匹配，是否需要做及时的技术储备以应对业务增长。</li>
</ul>
<p>从技术管理者到产品管理者，我主要学会了一些产品的核心方法论，主要为用户思维和数据思维。</p>
<ul>
<li>用户思维是指能够将自己代入到用户场景中，思考解决方案的优劣性。在这个方向上，我学习了大量 MVP（最小可行性产品）的构建和测试方法。</li>
<li>数据思维是指一切以数据导向来评估产品方案。NPS、A&#x2F;B 测试、用户研究是数据思维的具体实践方法。</li>
</ul>
<p>从产品负责人到业务负责人转变时，我更加关注商业模型的重要性，进而对市场端的获客工作有了大量的思考和实践。</p>
<p>在负责硬件和供应链团队时，我感受到了实体产品交付的挑战，对硬件产品在产品创新、供应链管控、渠道、品牌建设上的竞争局势有了更深刻的认识。</p>
<p>创业的这十年也是移动互联网高速发展的十年，我见证了抖音、滴滴、拼多多、美团的高速崛起，也见证了技术对于行业的变革。这也是技术开发者黄金的十年，很多开源的技术或社区能够在商业层面上带来巨大的回报。比如：</p>
<ul>
<li>2017 年，<a target="_blank" rel="noopener" href="http://www.mongodb.com/">MongoDB</a> 上市，现在市值超 200 亿美元；</li>
<li>2018 年，<a target="_blank" rel="noopener" href="https://github.com/">GitHub</a> 被微软以 75 亿美元收购；</li>
<li>2019 年，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Elasticsearch">Elasticsearch</a> 上市，现在市值超 80 亿美元；</li>
<li>2021 年，国内的开源分布式存储公司 <a target="_blank" rel="noopener" href="https://en.pingcap.com/">PingCAP</a> 完成新一轮融资，估值超过 30 亿美元。</li>
</ul>
<img src="/images/startup-10th-3.jpg" class="">

<blockquote>
<p>图 3：MongoDB 的股价走势</p>
</blockquote>
<p>这也是人工智能颠覆行业的一年，我们见证了围棋、德州扑克被 AI 统治，L2 级自动辅助驾驶已经广泛应用，信息流推荐和广告投放领域也早已被深度学习统治……各种商业化领域，都开始用深度学习进行功能改造。在教育领域，我们用 AI 来做：</p>
<ul>
<li>语音识别，帮助学习者纠正不正确的发音；</li>
<li>语义理解，帮助学习者批改中文和英文作文；</li>
<li>图像识别，帮学习者检查口算作业；</li>
<li>自适应学习，给学习者推荐难度适中的题目，提高练习效率。</li>
</ul>
<p>这黄金的十年给了我们太多的商业机会，锻炼了很多程序员成为行业专家，我个人也是这行业十年红利的受益者。</p>
<h2 id="六、未来的机遇与挑战"><a href="#六、未来的机遇与挑战" class="headerlink" title="六、未来的机遇与挑战"></a>六、未来的机遇与挑战</h2><p>我是幸运的，赶上了移动互联网的红利，成为第一批的移动开发者。那个时候移动开发刚刚兴起，资料匮乏，而我抓住了这样的机会，在为行业分享移动开发心得的同时，也收获了技术的成长与行业的红利。</p>
<p>中国发展太快了，随着全球格局的变化，未来面临的发展机会和挑战都会越来越多。对于我们这一代技术人来说，只要顺应时代的变化，未来的机会只会更多。</p>
<p>对于新一代的开发者来说，我认为未来的领域会更加集中在用技术和算法进一步改造各种传统的行业，例如：汽车、物联网，以及用技术将人类社会朝着数字化的虚拟世界发展。所以，我推荐大家关注自动驾驶、人工智能、产业互联网、推荐系统、虚拟现实等领域，可能会有新的行业红利出现。</p>
<p>期待大家与时代共舞。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-5-22-notiontoblog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-5-22-notiontoblog/" itemprop="url">如何使用Notion制作个人网站？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-22T04:19:00+00:00">
                2022-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本文首发于公众号「效率工具指南」<br>文&#x2F;彭宏豪    </p>
<p>Hello 各位好，我是小豪。   </p>
<p>之前写过一篇<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649911025&idx=1&sn=9b849dbaf03a6407b6ebd533d0fb6f87&chksm=83a86adcb4dfe3ca54a324d6c784c2f9fa8e5ba6061a33f4da804ddfc3a86f8019922c7449ec&scene=21#wechat_redirect">基于 Notion + Next.js + Vercel 搭建个人网站</a>的文章，老实说折腾起来有些麻烦，而且现在照着那篇文章去操作，可能还会因为代码（依赖的包）版本的不同而遇到新的问题。  </p>
<p>如果你之前看过上面的文章，但弄到一半就放弃了，没关系，今天来介绍一种超级简单的个人网站搭建方法，只需要用到一个工具——<strong>Popsy</strong>。   </p>
<p>Popsy，一个免费将 Notion 页面转换为网站的在线工具。使用 Popsy 之前，请确保你已经有一个 Google 账号。</p>
<p>没有 Google 账号的朋友，可以查看往期文章：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649912873&idx=1&sn=7a11acaec4173d7a9501359b4aa5d524&chksm=83a87204b4dffb12a3b1e058dbddbba43e293dcef288db6391927660bac6aca610c62f21e9f8&token=201204900&lang=zh_CN#rd">2021年，如何注册一个Google账号？</a>      </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531882183970.jpg"></p>
<p>下图是我使用 Notion + Popsy 搭建出来的网站首页，访问地址 ▶▶ <a target="_blank" rel="noopener" href="https://penghh.popsy.site/">https://penghh.popsy.site/</a>    </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531874725550.jpg"></p>
<p>打开 Popsy 的官网 <code>https://popsy.co/</code>，将 Notion 页面链接粘贴到中间的输入框，登录 Google 账号，按照提示一直往下点点点，就能将 Notion 页面转换为网站。   </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531896808461.jpg"></p>
<h2 id="网站域名"><a href="#网站域名" class="headerlink" title="网站域名"></a>网站域名</h2><p>Notion 页面转换为网站后，Popsy 会给你的网站提供一个域名，你可以自定义域名的前半部分，后半部分的 <code>popsy.site</code> 则是统一的。    </p>
<p>域名自定义的部分可以多次修改，因此不用担心第一次没取一个好记的域名而不得不重新创建一个网站。      </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531899027089.jpg"></p>
<h2 id="设置标签页图标和网站图标"><a href="#设置标签页图标和网站图标" class="headerlink" title="设置标签页图标和网站图标"></a>设置标签页图标和网站图标</h2><p>在网站域名下方，Popsy 还提供了设置页面图标和网站图标的选项。  </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531913208537.jpg"></p>
<p>页面图标 Site favicon，即每次打开页面，位于浏览器标签页的小图标，这个图标尺寸不宜过大，建议选择 16x16 或 32x32 的尺寸即可。   </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531916541821.jpg"></p>
<h2 id="手动同步-Notion-数据"><a href="#手动同步-Notion-数据" class="headerlink" title="手动同步 Notion 数据"></a>手动同步 Notion 数据</h2><p>当你在 Notion 中更新了页面的内容，使用 Popsy 搭建的网站也会自动更新。    </p>
<p>如果网站更新不及时，你可以打开 Popsy 的管理后台，点击左侧的「Sync from Notion」，手动同步 Notion 页面的数据。        </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531902326402.jpg"></p>
<h2 id="更换网站主题"><a href="#更换网站主题" class="headerlink" title="更换网站主题"></a>更换网站主题</h2><p>Popsy 提供了 8 种网站主题，点击左侧的主题名称，可以实时预览每种主题的效果。    </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531893830451.jpg"></p>
<h2 id="自定义主题"><a href="#自定义主题" class="headerlink" title="自定义主题"></a>自定义主题</h2><p>前面介绍的更换网站主题，可以一键更换网站的主题样式，但不能细致地调节网站的布局、字体、文本大小等。  </p>
<p>如果你想更精细化地调节网站的样式，Popsy 也提供了相应的支持，点击管理后台左侧栏的「Customize theme」，进入自定义主题的界面，左侧提供了多个调整布局的选项，调整后可以实时预览效果。</p>
<p><img src="https://img.penghh.fun/2022/05/22/16531918152716.jpg"></p>
<p>但比较尴尬的是，当你完成调整后，点击顶部的保存按钮，Popsy 会弹出让你付费成为会员的窗口，每月为 8 美元，付费后才能保存你刚刚调整好的样式。 </p>
<p>Popsy 的会员权益包含：自定义主题、移除网站左下角的 Popsy 图标、谷歌网站流量分析、添加自定义的代码。    </p>
<p><img src="https://img.penghh.fun/2022/05/22/16531923224767.jpg"></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>最后，简单总结一下：   </p>
<p>如果你图简单，不想改代码、不购买域名、不配置 DNS，使用 Popsy 就能快速得到一个属于自己的个人网站，而且网站的数据最终还是存放在 Notion 中，不用担心 Popsy 之后可能会出现的关停，给个人数据带来损失。  </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://img.penghh.fun/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">     </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-05-16-the-time-of-dengxiaoping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-05-16-the-time-of-dengxiaoping/" itemprop="url">改革开放的总设计师 - 读《邓小平时代》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-16T04:48:16+00:00">
                2022-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <img src="/images/dxp-book.jpg" class="">

<h2 id="一、序"><a href="#一、序" class="headerlink" title="一、序"></a>一、序</h2><p>最近读完了<a target="_blank" rel="noopener" href="http://dangshi.people.com.cn/GB/146570/355070/index.html">《邓小平时代》</a>，作者是美国哈佛大学的教授傅高义（EZRA F. VOGEL）。</p>
<p>这是一本很厚的书，详细介绍了邓小平从出生到参与革命，三起三落，然后在粉碎四人帮之后掌权。他掌权后坚持党的领导，努力通过改革开放发展经济，最终使得中国走上经济发展的快车道。</p>
<p>这里面的艰辛与不易，只有看完了书中的细节才能真切感受到。</p>
<p>我们现在看起来无比正确的一些事情，在不同的时代背景下，却变得无比艰难。比如：坚持改革开放、实事求是、以实践来检验想法，坚持发展科技。</p>
<p>我们现在看起来相对容易的事情，其实实施起来异常艰难。比如：收回香港主权、应对苏联和越南的威胁、联合美国制衡苏联、重组领导班子、裁军。</p>
<p>我们小时候天天听新闻联播讲，但是不能理解的一些口号，看完书我也终于理解了。比如：“坚持四项基本原则”，“两手抓两手都要硬”，“有中国特色社会主义”，“社会主义初级阶段”。</p>
<p>以下是一些感悟。</p>
<h2 id="二、维护国家的统一与稳定"><a href="#二、维护国家的统一与稳定" class="headerlink" title="二、维护国家的统一与稳定"></a>二、维护国家的统一与稳定</h2><p>在我看来，邓小平做的最最成功的事情，就是在 89~91 年国家有可能剧烈动荡的危机阶段，坚持了稳定大于一切的重大决定。</p>
<p>这个决定非常艰难，但是我们看东欧和苏联这些共产主义国家，就是在这个年代没能稳定住国家，最终分裂解体，对长期的国家发展带来风险。分裂解体后，大部分国家的经济都陷入了衰退。</p>
<p>而最近的俄乌战争，也是当时的分裂种下的祸根。俄罗斯与乌克兰在分裂前本都属于苏联。</p>
<p>为了对比看到邓小平的伟大，我们先看看苏联解体的过程。</p>
<blockquote>
<p>注：苏联相关内容主要参考自百度百科中的 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%8B%8F%E8%81%94%E8%A7%A3%E4%BD%93/634053">”苏联解体“词条</a></p>
</blockquote>
<p>苏联在斯大林时代与新中国成立后的毛泽东时代非常相近，个人崇拜成为社会统治的主流风气。因为个人崇拜，就造就了比较强的个人集权。斯大林甚至对反对派进行大清洗。</p>
<p>1985年3月戈尔巴乔夫出任苏共中央总书记。当时因为国际上发展市场经济的国家都在迅速腾飞，所以他希望学习外国经验，发展市场经济，带动苏联快速把经济搞上去。于是他在 1990 年实施了 500 天计划。包括实行完全市场经济，大规模进行私有化，把权力下放到低一级政府手中等。</p>
<p>戈尔巴乔夫心愿是好的，但是他没有考虑到苏联当时的国情。整体的社会制度根本没有切换成市场经济的基础。快速的改革由于过于激进，苏联经济状况更加恶化，最终被迫中止了。</p>
<p>同时，戈尔巴乔夫在政治上开放言论，希望用更加自由民主的方式来统治国家。并且他主动和西方国家和解，希望结束冷战，营造出一个更加安全的外部环境。这些都是西方社会比较推崇的。他因为这一点还得到了 1990 年的诺贝尔和平奖。</p>
<p>但是他的这些政治政策并没能在国内团结好各个主要的政治盟友，最终使得苏联在 1991 年走上分裂。</p>
<p>分裂后的各国，虽然像乌克兰一类国家，进一步亲向西方。但是经济改革缺乏有效的制度监管，发展还不如继续推行社会主义国家的俄罗斯。</p>
<img src="/images/dxp-1.png" class="">

<blockquote>
<p>图片来自：<a target="_blank" rel="noopener" href="https://www.kylc.com/stats/global/yearly_per_country/g_gdp_per_capita/rus-ukr.html">https://www.kylc.com/stats/global/yearly_per_country/g_gdp_per_capita/rus-ukr.html</a></p>
</blockquote>
<p>我们再看看中国与俄罗斯的对比。</p>
<img src="/images/dxp-2.png" class="">

<blockquote>
<p>图片来自：<a target="_blank" rel="noopener" href="https://www.kylc.com/stats/global/yearly_per_country/g_gdp_per_capita/chn-rus.html">https://www.kylc.com/stats/global/yearly_per_country/g_gdp_per_capita/chn-rus.html</a></p>
</blockquote>
<p>邓小平具体做了什么事情，使得中国没有像苏联那样解体呢？其实说起来就是第一个口号：坚持四项基本原则。</p>
<p>四项基本原则是：</p>
<ul>
<li>坚持社会主义道路</li>
<li>坚持无产阶级专政</li>
<li>坚持中国共产党的领导</li>
<li>坚持马列主义、毛泽东思想</li>
</ul>
<p>四项基本原则把所有试图以发展经济，人权，自由，民主等任何幌子来达到分裂国家的行为给中止了。使得国家得以在统治上稳定，一切统治上可能的错误，也可以更大胆地总结反思，不用担心政权不稳定。</p>
<h2 id="三、坚持发展经济"><a href="#三、坚持发展经济" class="headerlink" title="三、坚持发展经济"></a>三、坚持发展经济</h2><p>邓小平明白，国家落后就要挨打。这一点是他青年时去法国留学时深深烙印在他的记忆中的。邓小平家境很好，但是去了法国才发现国内的落后，作为中国人在外国也被各种歧视，他只能做最最苦力的工作。这使得他坚持以发展经济，改善人民生活，带动国家增强国际竞争力作为主要的执政目标。</p>
<p>在这一点上，邓小平和戈尔巴乔夫目标是一样的。但是邓小平的步子更加温和，也更有耐心。</p>
<p>邓小平首先在 1977 年恢复了高考，他一直坚信科学技术才是第一生产力。而要发展科技，首先要有足够多的科技人力。</p>
<p>当时，发展经济很容易与意识形态挂勾。大家都不敢做，怕被扣上资本主义的帽子。于是，当他发现他的意见不容易被大家接受的时候，他就开始反复讲一句话：实践是检验真理的唯一标准。让大家搁置争议，选一个小的地方试验试点。试验成功了，再向别的地区推行。这种方式很快就让大家都感受到人民生活的改善，从而放弃了之前以意识形态为基础讨论的行为。</p>
<h2 id="四、坚持反腐败"><a href="#四、坚持反腐败" class="headerlink" title="四、坚持反腐败"></a>四、坚持反腐败</h2><p>经济发展起来了，很容易让某些人由于权力集中而带来寻租空间。邓小平都明白，但是他知道如果因此停止改革发展的步伐，对国家影响更大，于是他提出新的口号：“两手抓两手都要硬”。</p>
<p><a target="_blank" rel="noopener" href="http://cpc.people.com.cn/GB/33839/34943/34978/35419/2665796.html">两手抓两手都要硬</a> 是指：一手就是坚持对外开放和对内搞活经济的政策，一手就是坚决打击经济犯罪活动。</p>
<p>国家坚持廉洁的政策一直持续到现在，我们看到在近几年，也不断有高官因为在这方面的问题而落马。这使得政府在人民心中是权威的，正义的；也有助于商业环境更加纯粹追求提供产品本身的竞争力。</p>
<h2 id="五、为中国发展找到合理的道理"><a href="#五、为中国发展找到合理的道理" class="headerlink" title="五、为中国发展找到合理的道理"></a>五、为中国发展找到合理的道理</h2><p>有了苏联的例子，中国作为另一个社会主义大国应该如何发展，备受世界关注。邓小平引入的“中国特色社会主义”，以及后面发展出的”社会主义初级阶段“，配合“一国两制”的思想，成为了中国在过去几十年团队大多数人，求同存异，努力发展的基础认知。</p>
<p>这些思想最大的价值是：它团结了大多数人，保证了国家的稳定，为大家齐心协力发展提供了保障。</p>
<p>近年来，我们进一步提出的共同富裕政策，更是延续了这样的思想。</p>
<h2 id="六、小结"><a href="#六、小结" class="headerlink" title="六、小结"></a>六、小结</h2><p>有一些英雄是时代造就的，比如微信的张小龙。如果没有微信，在那个时间点也会有别的移动社交App 替代微信，成为国民 App。</p>
<p>但是邓小平不一样的地方在于，中国的繁荣发展不是必然的。看看苏联，乌克兰，越南，古巴，朝鲜。这些或大或小的国家，要么走向分裂，要么经济发展得并不顺利。</p>
<p>邓小平在没有任何外部国家参考借鉴的情况下，对内面对内部的各种争议声音，对外面临美国和苏联的威胁。他靠着自己的智慧和坚持完成了中国向更市场化的方向转型，为人民的幸福生活和国家的稳定做出了不可替代的、巨大的贡献。</p>
<p>邓小平说：“我是中国人民的儿子，我深情地爱着我的祖国和人民。” 当我读到这句话，我内心澎湃。</p>
<p>感谢你小平，给我们带来了现在的美好生活。我和你一样，也深爱着我们的祖国和人民。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/weekly-npm-packages-01.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/weekly-npm-packages-01.html" itemprop="url">每周轮子之 only-allow：统一规范团队包管理器</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-15T16:00:00+00:00">
                2022-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>首先我们来提一个团队开发中很常见的需求：一般来说每个团队都会统一规定项目内只使用同一个包管理器，譬如 npm、yarn、pnpm 等，如果成员使用了不同的包管理器，则可能会因为 <em>lock file</em> 失效而导致项目无法正常运行，虽然这种情况一般都可以通过项目的上手文档来形容共识，但有没有更好的解决方案，比如在项目安装依赖时检测如果使用了不同的包管理器就抛出错误信息？</p>
<p>当然是可以的，pnpm 就有一个包叫做 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/only-allow">only-allow</a> ，连 <a target="_blank" rel="noopener" href="https://github.com/vitejs/vite/blob/c7fc1d4a532eae7b519bd70c6eba701e23b0635a/package.json#L16">vite</a> 都在使用它，所以本周我们就从 0 到 1 实现这个工具，以此对它的工作原理一探究竟。</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>说干就干，我们先在 <a target="_blank" rel="noopener" href="https://docs.npmjs.com/cli/v8/using-npm/scripts#life-cycle-operation-order">npm 文档</a> 搜寻一番，发现有一个钩子叫做 <code>preinstall</code>：</p>
<blockquote>
<p>可以在运行 npm instal 之前执行某个命令，当 exit code 非 0 时终止运行</p>
</blockquote>
<p>所以第一步是在 <code>package.json</code> 中添加以下代码：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;preinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node check-npm.js&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>接下来的问题就是：我们如何知道用户使用了哪一个包管理器？</p>
<p>我们知道 <code>process.env</code> 会包含当前脚本的运行环境，首先我们将它打印看看</p>
<p>分别使用 <code>yarn</code> 和 <code>npm install</code> 后，发现了以下几个相关字段的区别：</p>
<p>使用 <code>yarn</code> 安装：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  npm_config_registry<span class="punctuation">:</span> &#x27;https<span class="punctuation">:</span><span class="comment">//registry.yarnpkg.com&#x27;,</span></span><br><span class="line">  npm_execpath<span class="punctuation">:</span> &#x27;/usr/local/lib/node_modules/yarn/bin/yarn.js&#x27;<span class="punctuation">,</span></span><br><span class="line">  npm_config_user_agent<span class="punctuation">:</span> &#x27;yarn/<span class="number">1.22</span><span class="number">.11</span> npm/? node/v16<span class="number">.13</span><span class="number">.2</span> darwin arm64&#x27;<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>npm</code> 安装：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  npm_config_metrics_registry<span class="punctuation">:</span> &#x27;https<span class="punctuation">:</span><span class="comment">//registry.npmjs.org/&#x27;,</span></span><br><span class="line">  npm_execpath<span class="punctuation">:</span> &#x27;/opt/homebrew/lib/node_modules/npm/bin/npm-cli.js&#x27;<span class="punctuation">,</span></span><br><span class="line">  npm_config_user_agent<span class="punctuation">:</span> &#x27;npm/<span class="number">8.5</span><span class="number">.5</span> node/v16<span class="number">.13</span><span class="number">.2</span> darwin arm64 workspaces/<span class="literal"><span class="keyword">false</span></span>&#x27;<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>以下是三者的解释：</p>
<ol>
<li>npm_config_metrics_registry：npm 源，就是当我们安装 npm 包会从这个服务器上获取，可以通过 <code>npm config set registry</code> 或者     等工具进行配置。</li>
<li>npm_execpath：当前 npm 包管理器的执行目录，这个路径会根据你安装的方式而不同。</li>
<li>npm_config_user_agent：由包管理器设置的 UA，每个包管理器都不一样，比如 npm  <a target="_blank" rel="noopener" href="https://github.com/npm/cli/blob/8a49e3ab6499c6196c5d7a0f6dad3b345944b992/lib/utils/config/definitions.js#L2190">lib&#x2F;utils&#x2F;config&#x2F;definitions.js#L2190</a>，因此我们可以使用这个信息来判断客户端。</li>
</ol>
<p>因此我们可以通过 <code>process.env.npm_config_user_agent</code> 获取当前用户使用的包管理器，那么接下来的工作很简单了。</p>
<p>我们先写一个最 Low 的解决方案：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wantedPM = <span class="string">&#x27;yarn&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> usedPM = process.<span class="property">env</span>.<span class="property">npm_config_user_agent</span>.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (usedPM !== wantedPM) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`You are using <span class="subst">$&#123;usedPM&#125;</span> but wanted <span class="subst">$&#123;wantedPM&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>至此，我们的核心功能就已经实现了，还不赶紧发到 GitHub 开源一波坐等 stars？</p>
<p>别急，我们来思考下这段代码存在哪些不足：</p>
<ol>
<li>应该由用户指定可以使用哪一个包管理器。</li>
<li>这段代码的健壮性如何？</li>
</ol>
<p>那我们再修改一波，首先是接收用户传递参数，指定使用的包管理器：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;preinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node check-npm.js yarn&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后改为通过接收参数：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ const argv = process.argv.slice(2)</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ const wantedPM = argv[0]</span></span><br><span class="line"><span class="deletion">- const wantedPM = &#x27;yarn&#x27;</span></span><br><span class="line"></span><br><span class="line">const usedPM = process.env.npm_config_user_agent.split(&#x27;/&#x27;)[0]</span><br><span class="line"></span><br><span class="line">if (usedPM !== wantedPM) &#123;</span><br><span class="line">  console.error(`You are using $&#123;usedPM&#125; but wanted $&#123;wantedPM&#125;`)</span><br><span class="line"></span><br><span class="line">  process.exit(1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>还有第二个问题，这段代码的健壮性如何？譬如以下情况：</p>
<ol>
<li>用户不传或乱传参数怎么办？</li>
<li>如果以后有新需求：除了要限制包管理器，还要限制到具体某个版本怎么办？</li>
</ol>
<p>所以，我们再调整一波代码，检测传入的参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PACKAGE_MANAGER_LIST</span> = [<span class="string">&#x27;npm&#x27;</span>, <span class="string">&#x27;yarn&#x27;</span>, <span class="string">&#x27;pnpm&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> argv = process.<span class="property">argv</span>.<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (argv.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="variable constant_">PACKAGE_MANAGER_LIST</span>.<span class="title function_">join</span>(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Please specify the wanted package manager: only-allow &lt;<span class="subst">$&#123;name&#125;</span>&gt;`</span>)</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wantedPM = argv[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable constant_">PACKAGE_MANAGER_LIST</span>.<span class="title function_">includes</span>(wantedPM)) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="variable constant_">PACKAGE_MANAGER_LIST</span>.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="string">`&quot;<span class="subst">$&#123;wantedPM&#125;</span>&quot; is not a valid package manager. Available package managers are: <span class="subst">$&#123;name&#125;</span>.`</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们将获取 UA 的代码抽离出来，并使其可以获取版本，以便后续扩展：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPackageManagerByUserAgent</span>(<span class="params">userAgent</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!userAgent) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`&#x27;userAgent&#x27; arguments required`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> spec = userAgent.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">const</span> [name, version] = spec.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name,</span><br><span class="line">    version</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PACKAGE_MANAGER_LIST</span> = [<span class="string">&#x27;npm&#x27;</span>, <span class="string">&#x27;yarn&#x27;</span>, <span class="string">&#x27;pnpm&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> argv = process.<span class="property">argv</span>.<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (argv.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="variable constant_">PACKAGE_MANAGER_LIST</span>.<span class="title function_">join</span>(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Please specify the wanted package manager: only-allow &lt;<span class="subst">$&#123;name&#125;</span>&gt;`</span>)</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wantedPM = argv[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable constant_">PACKAGE_MANAGER_LIST</span>.<span class="title function_">includes</span>(wantedPM)) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="variable constant_">PACKAGE_MANAGER_LIST</span>.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="string">`&quot;<span class="subst">$&#123;wantedPM&#125;</span>&quot; is not a valid package manager. Available package managers are: <span class="subst">$&#123;name&#125;</span>.`</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> usedPM = <span class="title function_">getPackageManagerByUserAgent</span>(</span><br><span class="line">  process.<span class="property">env</span>.<span class="property">npm_config_user_agent</span></span><br><span class="line">).<span class="property">name</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (usedPM !== wantedPM) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`You are using <span class="subst">$&#123;usedPM&#125;</span> but wanted <span class="subst">$&#123;wantedPM&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPackageManagerByUserAgent</span>(<span class="params">userAgent</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!userAgent) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`&#x27;userAgent&#x27; arguments required`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> spec = userAgent.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [name, version] = spec.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name,</span><br><span class="line">    version</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>很好，现在我们已经将这个 npm 包的功能给实现了：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/only-allow">only-allow</a>，可以看下它的源码：<a target="_blank" rel="noopener" href="https://github.com/pnpm/only-allow/blob/master/bin.js">bin.js</a>。</p>
<p><strong>不过发现了一个问题：</strong>上面提到过 <code>preinstall</code>  钩子会在安装依赖时触发，但是经验证，npm 和 yarn 调用 <code>preinstall</code> 的时机不一样，npm 仅会在 <code>npm install</code> 时运行，而 <code>npm install &lt;pkg-name&gt;</code> 则不会，但 yarn 则会在 <code>yarn</code> 和 <code>yarn add &lt;pkg-name&gt;</code> 时都运行，所以如果想用这种方式限制 npm 使用者，可能无法达到预期，该问题在 2021 年<a target="_blank" rel="noopener" href="https://github.com/npm/rfcs/issues/325">就有人提出</a>，但目前仍未有解决方案出现。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-weekly" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/weekly-12.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/weekly-12.html" itemprop="url">周刊第12期：每周轮子计划、程序员应该如何写博客</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-15T16:00:00+00:00">
                2022-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="本周轮子"><a href="#本周轮子" class="headerlink" title="本周轮子"></a>本周轮子</h2><p>以前看过一个小册子 <a target="_blank" rel="noopener" href="https://github.yanhaixiang.com/make-wheels/">《一天学习一个 npm 轮子，十天后变成轮子哥 》</a>，觉得这种「首先实现一个最 Low 的解决方案，然后慢慢优化，进而推导出最终的源码」的学习思路非常不错，所以我也决定从现在开始，每周都学习造一个 npm 轮子。</p>
<p>当然前期只要专注于那些日常使用、相对简单的 npm 包，毕竟能力有限，太复杂的包就很难可以讲透。</p>
<p>这是本周的轮子：<a href="/post/weekly-npm-packages-01.html">《每周轮子之 only-allow：统一规范团队包管理器》</a>。</p>
<h2 id="本周见闻"><a href="#本周见闻" class="headerlink" title="本周见闻"></a>本周见闻</h2><h3 id="程序员应该怎么写博客？"><a href="#程序员应该怎么写博客？" class="headerlink" title="程序员应该怎么写博客？"></a><a target="_blank" rel="noopener" href="https://www.v2ex.com/t/851549">程序员应该怎么写博客？</a></h3><p>这是在 V2EX 上看到的一个帖子，OP 是之前周刊有提到过的 <a target="_blank" rel="noopener" href="https://hutusi.com/">胡涂说</a> 的博主，在这个帖子中，我收获不少有用的建议，也意外地发现到几个不错的博客。我也想借此机会聊一聊关于这个话题的一些想法，也算是当作我个人写作的总结与反思。</p>
<p>回顾本站的第一篇文章<a href="/post/d69467be.html">《锐捷无线AP学习笔记 - 入门篇》</a>，写于 2018 年，到现在也就第 4 个年头，相比有些人动不动建站十几年，自然算得上年轻，但我认为我在写博客这件事上有过不少的挣扎与坚持，总结起来一共经历了以下几个阶段，但其实以下阶段并不是层层递进式的，它们有可能会同时进行：</p>
<ol>
<li><strong>记录学习笔记</strong>，这个阶段的产出主要是一些较为基础的学习笔记，原创度也较低，属于网上一搜一大把那种，对他人的帮助接近于无，还记得当时把一篇文章分享到技术社区上，被某些暴躁的老哥说我误人子弟，更有甚者直接开怼让我干脆把整本书都抄过来，当时有点气馁，但也承认自己的确是很菜，也曾自我怀疑过是否应该继续往中文社区「倒垃圾」，但最后还是坚持下来了。据我了解很多程序员刚开始写博客都是写这类学习笔记，也有很多人仅仅停留在这个阶段，甚至放弃，实在是太可惜了。</li>
<li><strong>资源分享类</strong>，写技术文章很难写，有深度的技术文更是难上加上，所以曾有一段时间我特别喜欢写「资源分享」类的文章，譬如<a href="/posts/share-site.html">《分享一些好用的网站》</a>、<a href="/post/549a6198.html">《分享一些好用的 Chrome 扩展》</a>，这类文章写起来压根不费多少时间和经历，你只需要把平时经常使用的网站、工具分享一一罗列出来，，就能在社区上收获不少的点赞收藏，这也是为什么 GitHub 上简体中文项目的 Markdown 项目如此之多的原因，但是我后来意识到，写这类文章对我个人能力的提升并没有多大帮助，如果你知道一些非常有用的工具，你确实应该将它分享出去给更多人，这是非常有价值的，但我的建议是千万不要满足于只写这类文章。</li>
<li><strong>较有深度的技术文章</strong>，随着工作时间的增长，在技术上有了一些的积累，我开始尝试写一些较有深度的技术文章，包括一些经典面试题讲解、源码阅读、某个知识点深入剖析、一些工具类库的踩坑记录等，写这类文章是最痛苦的，因为你会发现在写的过程突然在某个地方你自己也无法讲清楚，说明你并没有理解透彻，于是只能逼迫自己一边查阅文档、一边根据自己的理解用自己的话把它讲透，这过程中的收获自然也是非常大，对其他人的帮助也不小。</li>
<li><strong>与技术无关的</strong>，人都是有感情的动物，除了技术以来，总需要聊点其他的东西，有可能是生活上的一些感悟，也有可能是你针对某个事情的看法，这类文章，它既有可能会引起读者的共鸣，也有可能会因为与读者的看法不同而遭到反感，且很多时候，自己也不确定这些看法到底是不是正确的，所以会害怕被别人看到自己不成熟的一面，我也曾有过这方面的顾虑，不敢在博客上公开谈论太多与技术无关的事情，但后来发现是我多虑了，因为这类文章，往往最终的读者只有你自己，因为读者看你的文章，他也只会关心对他有帮助的地方，而且即便你当时所记录下来的自己可能是不成熟的，这也是你成长的印记，比如我常常会在迷茫的时候翻看起之前刚踏入职场时写下的<a href="/posts/why-i-became-a-programmer.html">《我为什么会成为一名程序员》</a>，告诉自己不要忘了为什么会走上技术这条路，所以不要害怕写技术以外的东西，这些稚嫩的文字很有可能会在多年以后一直激励着你。</li>
</ol>
<p>可能还有些同学会认为自己文笔不好、词穷，写不了这么多文字，其实也是多虑了，我坦白我的文笔其实很差，不能像别人那样出口成章、行云流水，但其实你只要把意思表达清楚、并且注入你的感情即可，总之多写、坚持写。</p>
<h2 id="一些-tips"><a href="#一些-tips" class="headerlink" title="一些 tips"></a>一些 tips</h2><h3 id="QOTD-协议"><a href="#QOTD-协议" class="headerlink" title="QOTD 协议"></a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/QOTD">QOTD 协议</a></h3><p>QOTD 的全程是 <strong>Quote of the Day</strong>，翻译过来就是「每日报价」，在 <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc865">RFC 865</a> 中定义，监听的端口是 17，这是一个非常少用到的协议，目前仅剩的公共 QOTD 服务器只有几个：</p>
<table>
<thead>
<tr>
<th>服务器地址</th>
<th>TCP 端口</th>
<th>UDP 端口</th>
</tr>
</thead>
<tbody><tr>
<td>djxmmx.net</td>
<td>17</td>
<td>17</td>
</tr>
<tr>
<td>alpha.mike-r.com</td>
<td>17</td>
<td>17</td>
</tr>
<tr>
<td>cygnus-x.net</td>
<td>17</td>
<td>17</td>
</tr>
</tbody></table>
<p>可以用它做什么呢？</p>
<p>比如<a target="_blank" rel="noopener" href="https://github.com/daya0576/daya0576">这里</a>就有一个在 GitHub Action 上利用该协议定时获取 djxmmx.net 服务器上的名人名言，将它更新到 Github Profile 中。</p>
<h2 id="分享文章"><a href="#分享文章" class="headerlink" title="分享文章"></a>分享文章</h2><h3 id="Bash-Pitfalls-编程易犯的错误"><a href="#Bash-Pitfalls-编程易犯的错误" class="headerlink" title="Bash Pitfalls: 编程易犯的错误"></a><a target="_blank" rel="noopener" href="https://kodango.com/bash-pitfalls-part-1">Bash Pitfalls: 编程易犯的错误</a></h3><p>本文是<a target="_blank" rel="noopener" href="http://mywiki.wooledge.org/BashPitfalls">《Bash Pitfalls》</a>的中文翻译版，介绍了40多条日常 Bash 编程中，老手和新手都容易忽略的错误编程习惯。作者会在每条给出错误的范例上，详细分析与解释错误的原因，同时给出正确的改写建议。</p>
<h3 id="Docker-镜像构建的一些技巧"><a href="#Docker-镜像构建的一些技巧" class="headerlink" title="Docker 镜像构建的一些技巧"></a><a target="_blank" rel="noopener" href="https://www.kawabangga.com/posts/4676">Docker 镜像构建的一些技巧</a></h3><p>本文分享几个 Docker 镜像构建的一些技巧，可以帮助你提高 Docker 镜像构建的效率，对于老手来说已经是非常基本的事情了，但是对于新手还是很有帮助的。</p>
<p>原文一共举例了 4 个技巧，在此我只详细讲解第一个技巧，其余的麻烦移步<a target="_blank" rel="noopener" href="https://www.kawabangga.com/posts/4676">原文</a>查看。</p>
<ol>
<li>删除缓存</li>
</ol>
<p>使用 apt、pip 等包管理器下载包时一般都会产生缓存，以便后续下载时使用，但是在 Docker Image 中，我们不需要这些缓存，所以一般都会在下载后，手动清除缓存：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RUN dnf install -y --setopt=tsflags=nodocs \</span><br><span class="line">    httpd vim &amp;&amp; \</span><br><span class="line">    systemctl enable httpd &amp;&amp; \</span><br><span class="line">    dnf clean all</span><br></pre></td></tr></table></figure>

<p>要切记千万不要像这样分开写，因为 Dockerfile 里面的每一个 <code>RUN</code> 都会创建一层新的 layer，这样其实是创建了 3 层 layer，前 2 层带来了缓存，第三层删除了缓存：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM fedora</span><br><span class="line">RUN dnf install -y mariadb</span><br><span class="line">RUN dnf install -y wordpress</span><br><span class="line">RUN dnf clean all</span><br></pre></td></tr></table></figure>

<p>但其实 Docker 在 <a target="_blank" rel="noopener" href="https://www.docker.com/blog/whats-new-in-docker-1-13/">v1.13</a> 中引入了 <em>–squash</em> 参数，可以在完成构建后将所有的 layers <strong>压缩成一个 layer</strong>，也就是说，最终构建出来的 Docker image 只有一层，所以，如上在多个 <code>RUN</code> 中写 clean 命令，其实也可以。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build --squash</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>改动不频繁的内容往前放</li>
<li>构建和运行 Image 分离</li>
<li>检查构建产物</li>
</ol>
<h3 id="JavaScript-函数式组合：有什么大不了的？"><a href="#JavaScript-函数式组合：有什么大不了的？" class="headerlink" title="JavaScript 函数式组合：有什么大不了的？"></a><a target="_blank" rel="noopener" href="https://jrsinclair.com/articles/2022/javascript-function-composition-whats-the-big-deal/">JavaScript 函数式组合：有什么大不了的？</a></h3><p>这是我看到过所有写 JavaScript 函数式组合里面最通俗易懂的一篇文章，作者从头开始一步步地实现 compose、pipe、flow 等方法，并且让对函数式组合了解不多的同学知道，函数式组合的好处在哪？</p>
<p>举个例子，假如我们使用 Array 的方法是这样写的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> comments = commentStrs</span><br><span class="line">    .<span class="title function_">filter</span>(noNazi)</span><br><span class="line">    .<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">map</span>(emphasize)</span><br><span class="line">    .<span class="title function_">map</span>(itemize)</span><br><span class="line">    .<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>而改用函数式组合的方式，则是这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> comments = <span class="title function_">pipe</span>(commentStrs,</span><br><span class="line">    <span class="title function_">filter</span>(noNazi),</span><br><span class="line">    <span class="title function_">take</span>(<span class="number">10</span>),</span><br><span class="line">    <span class="title function_">map</span>(emphasize),</span><br><span class="line">    <span class="title function_">map</span>(itemize),</span><br><span class="line">    <span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这样写的好处在哪呢？</p>
<p>首先，我们可以增加任何 Array 原型上没有的自定义方法：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const comments = pipe(commentStrs,</span><br><span class="line">    filter(noNazi),</span><br><span class="line">    take(10),</span><br><span class="line">    map(emphasize),</span><br><span class="line">    map(itemize),</span><br><span class="line">    join(&#x27;\n&#x27;),</span><br><span class="line"><span class="addition">+   chaoticListify,</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>另外，我们可以自由地实现像 map 这些方法，比如用生成器的方式改成它，而无需改变调用它们的方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">map</span> = f =&gt; <span class="keyword">function</span>*(iterable) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> iterable) <span class="keyword">yield</span> <span class="title function_">f</span>(x);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">join</span> = s =&gt; <span class="function"><span class="params">iterable</span> =&gt;</span> [...iterable].<span class="title function_">join</span>(s);</span><br></pre></td></tr></table></figure>

<p>综上所述，使用函数式组合的方式编写代码可以让我们写出更加简洁、优雅的代码，更重要的是它给我们提供了另一种思考的方式。</p>
<h3 id="中国黑客关系图"><a href="#中国黑客关系图" class="headerlink" title="中国黑客关系图"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/gowGNyJ_MaP6meQDQlSSZw">中国黑客关系图</a></h3><p>本文是新书《沸腾信安志》的一篇预热文章，主要讲述了中国上个世纪末到本世纪初的传奇黑客们的故事，想要了解有哪些著名的黑客，以及他们今何在的同学可以看看。</p>
<blockquote>
<p>网络安全行业和武侠江湖是很像的，有门派组织，有江湖名号，有武林大会，有绝计和宝物，而且都是大侠少而恶盗多，甚至连朝廷的管制方式都很相似。</p>
<p>这种氛围里，竟然出了这样一群奇人。</p>
<p>他们在最艰苦的岁月里，只要把道德底线稍微降低一点，就可以衣食无忧，然而他们没有；</p>
<p>他们掌握着最高超的技术，却拿着流量行业一半甚至更低的薪水，只要稍微做点灰产，就能摆脱困境，然而他们没有；</p>
<p>他们忍受着社会的质疑，承担着行业流氓带来的负面，却仍然坚持着自己热爱的技术创新。</p>
<p>直到现在，他们终于等到了自己的时代。</p>
</blockquote>
<h2 id="有趣的链接"><a href="#有趣的链接" class="headerlink" title="有趣的链接"></a>有趣的链接</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/zonemeen/musicn">zonemeen&#x2F;musicn</a>：🎵 一个下载高质量音乐的命令行工具</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.similarweb.com/zh/">Similarweb</a>：查看并分析任何网站流量，站长必备工具</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://codeit.codes/">Codeit</a>：手机连接 Git 查看代码的神器 APP</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.queue.so/">Queue</a>：使用 Notion 发布 Twitter 的工具</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://coverview.vercel.app/">Coverview</a>：生成文章题图的工具</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022-5-14-iPhone/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022-5-14-iPhone/" itemprop="url">4个相见恨晚的iPhone使用技巧，关键时刻还能救你一命。</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-14T13:37:00+00:00">
                2022-05-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本文首发于公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/rN8qotED3XyWAGHvGjrAwQ">效率工具指南</a>」<br>作者&#x2F;彭宏豪       </p>
<p>Hello 各位好，我是小豪。  </p>
<p>好久没有写过手机📱使用技巧方面的东西，今天就来开整！   </p>
<p>这篇文章想给大家介绍一些手机上的「救命🆘&#x2F;急救」小技巧，希望你永远不会用到。   </p>
<h2 id="SOS-紧急联络"><a href="#SOS-紧急联络" class="headerlink" title="SOS 紧急联络"></a>SOS 紧急联络</h2><p>这个相信不少用过 iPhone 的朋友都知道，长按电源键和音量键（上下音量键都可以），会打开 iPhone 的关机页面。</p>
<p>在关机页面会出现「SOS 紧急联络」的按钮，向右滑动可以进入拨打 110&#x2F;119&#x2F;120 的页面。   </p>
<p><img src="https://img.penghh.fun/2022/05/14/img2417.JPEG" alt="IMG_2417"></p>
<p>上面调出关机页的「SOS 紧急联络」按钮，需要用到两只手，但如果不幸你的其中一只手被压住了，这种呼出紧急联络按钮的方法就失效了。  </p>
<p>别担心，苹果提供了另外一种方法，让我们单只手也能呼出同样的界面。  </p>
<p>这需要我们打开系统设置，找到「SOS 紧急联络」，开启「按 5 次进行呼叫」。  </p>
<p>开启之后，连续按下 5 次手机电源键，就会自动进入 SOS 紧急联络的界面，但同时还会发出警报声😂，<strong>从来没用过的朋友可以体验一下</strong>。     </p>
<p>但我在想，如果你被别人绑架了，想偷偷拨打电话报警，发出这个警报声，反而不是暴露了嘛🤦‍♂️ </p>
<p><img src="https://img.penghh.fun/2022/05/14/img2422.jpg" alt="IMG_2422"></p>
<h2 id="紧急联系人"><a href="#紧急联系人" class="headerlink" title="紧急联系人"></a>紧急联系人</h2><p>除了从外部寻求帮助，生活中可能还会发生其他的意外，譬如你走在路上不幸晕倒了，别人送你到医院后，和你素不相识，该怎么通知你的家里人呢？  </p>
<p>——这时就可以用到 iPhone 的紧急联系人功能了。</p>
<p>打开 iPhone 自带的健康 App，点击右上角的头像，选择「医疗急救卡」，点击右上角的「编辑」，在编辑界面，可以从手机通讯录选择亲人作为自己的紧急联系人。  </p>
<p><img src="https://img.penghh.fun/2022/05/14/img37e44c3dc6ab1.jpeg" alt="IMG_37E44C3DC6AB-1"></p>
<p>添加紧急联系人之后，还要记得拉到下面，开启「<strong>锁定时显示</strong>」，最后点击右上角的「完成」保存设置。  </p>
<p>完成设置之后，可以测试一下：同时按下电源键和音量键，在关机页面会增加一个「<strong>医疗急救卡</strong>」的按钮，滑动按钮进入健康 App 的页面，就能看到你设置的紧急联系人的电话。     </p>
<p><img src="https://img.penghh.fun/2022/05/14/img745350c341cd1.jpeg" alt="IMG_745350C341CD-1"></p>
<p>当然，如果只有晕倒的人知道这个功能，而施救者却不知道这个操作，好像也是白搭。     </p>
<p>可能是考虑到这个呼出紧急联系人的操作比较隐蔽，苹果还提供了另外一个入口：   </p>
<p>在手机的锁屏页，点击左下角的「紧急情况」进入拨号页面，点击拨号页左下角的「医疗急救卡」，同样可以查看我们设置的紧急联系人电话。   </p>
<p><img src="https://img.penghh.fun/2022/05/14/img84b1c992f77d1.jpeg" alt="IMG_84B1C992F77D-1"></p>
<h2 id="摔倒检测"><a href="#摔倒检测" class="headerlink" title="摔倒检测"></a>摔倒检测</h2><p>摔倒检测，是苹果手表 Apple Watch 中的一项实用功能，对于任何人（尤其是老年人）来说，意外摔倒是非常危险的，这项功能有助于帮助他们在摔倒后及时获得救助。     </p>
<p>在使用这项功能之前，你需要先有一个 Apple Watch，要求的 Apple Watch 型号：Apple Watch SE、Apple Watch Series 4 或更新机型。  </p>
<p>在 iPhone 上打开 Watch App，在「我的手表」找到「SOS 紧急联络」，开启「<strong>摔倒检测</strong>」，并设置为「始终开启」。   </p>
<p><img src="https://img.penghh.fun/2022/05/14/imge117a8b0ebdc1.jpeg" alt="IMG_E117A8B0EBDC-1"></p>
<p>当 Apple Watch 检测到你<strong>可能</strong>摔倒后，它会弹出下面的提示，根据苹果官方提供的说明：   </p>
<blockquote>
<p>如果 Apple Watch 检测到您在移动，它会等待您对提醒做出响应，而不会自动拨打紧急服务电话。如果手表检测到您在大约一分钟内没有做出任何动作，它会自动拨打紧急服务电话。    </p>
<p>在通话结束后，手表会向您的紧急联系人发送一条包含您所在位置的信息，让他们知道手表检测到您摔得很严重并呼叫了紧急服务。手表会从您的医疗急救卡中获取紧急联系人信息。</p>
</blockquote>
<p><img src="https://img.penghh.fun/2022/05/14/16525333154392.jpg"></p>
<p>前面在描述摔倒时，我加上了「可能」两个字，是因为苹果手表有时会产生误判，误以为你摔倒了，但其实并没有。   </p>
<p>值得一提的是，如果你在健康 App 中设置的年龄已满 55 周岁，iPhone 会自动开启摔倒检测的功能。  </p>
<blockquote>
<p>如果您在设置 Apple Watch 时输入了您的年龄或在“健康”App 中输入了年龄，并且您已年满 55 周岁，这项功能会自动打开。确保您的“医疗急救卡”和“健康资料”中显示了您的正确年龄。“摔倒检测”仅供年满 18 周岁的用户使用。</p>
</blockquote>
<p>如果有多余的闲钱，或是不知道给爸妈买什么礼物，就送 TA 一个苹果手表吧～最好加一部 iPhone，用起来才给力。      </p>
<h2 id="遗产联系人"><a href="#遗产联系人" class="headerlink" title="遗产联系人"></a>遗产联系人</h2><p>这是一个比较令人伤心的功能。  </p>
<p>遗产联系人，是 iOS15.2 中新增的「数字遗产继承」功能，它可以让你从通讯录选择一位或多位用户成为你的数字遗产继承人，在你过世后可以访问你储存在 Apple 帐户中的数据。</p>
<p>譬如小明将自己的爸妈设置为遗产联系人，它们会获得一串密钥，当小明过世后，小明爸妈向苹果官方提供密钥和小明的死亡证明文件，通过苹果审核后，小明爸妈就可以访问小明存放在 Apple 帐户中的数据，包含但不限于照片、钥匙串、备忘录等。  </p>
<p><img src="https://img.penghh.fun/2022/05/14/img2416.JPEG" alt="IMG_2416"></p>
<p>遗产联系人：打开系统设置，点击顶部的 Apple ID，选择「密码与安全性」，其中就可以找到「遗产联系人」。    </p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>由于我没有安卓手机，本文仅写了 iPhone 上的小技巧，使用安卓设备的朋友，如果知道安卓上的一些急救小技巧，欢迎在下方👇的评论区留言。   </p>
<h2 id="扫码加入我在知识星球上创建的社群「效率工具指南」"><a href="#扫码加入我在知识星球上创建的社群「效率工具指南」" class="headerlink" title="扫码加入我在知识星球上创建的社群「效率工具指南」"></a>扫码加入我在知识星球上创建的社群「效率工具指南」</h2><p>如果你觉得本文帮到了你，想支持我做得更好，欢迎戳下方图片，加入我的知识星球。     </p>
<p>关于社群「效率工具指南」的介绍，可以查看我在语雀文档上发布的文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/penghonghao/af0aai/glwrg2dl0dqlegi6?singleDoc#">知识星球「效率工具指南」简介</a>    </p>
<p><img src="https://img.penghh.fun/2023/03/25/48844555552858t2.JPG" alt="48844555552858T2">   </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://img.penghh.fun/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">     </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2022/66-%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E7%B1%B3%E5%AE%B6%E5%85%A8%E5%AE%B6%E6%A1%B6Yes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/66-%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E7%B1%B3%E5%AE%B6%E5%85%A8%E5%AE%B6%E6%A1%B6Yes/" itemprop="url">智能家居？米家全家桶，Yes！</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-10T05:00:00+00:00">
                2022-05-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p><img src="https://cos.pinlyu.com/posts/2022/66-aqara.webp"></p>
<p>现在家庭装修基本都会考虑要不要装智能家居，但是考虑到成本和安装使用难度，许多人又只能放弃。所以，这里分享一下我家两年前装修时，选择米家智能家居方案的考量和实际安装情况。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2022/66-%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E7%B1%B3%E5%AE%B6%E5%85%A8%E5%AE%B6%E6%A1%B6Yes/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/73/">73</a><a class="extend next" rel="next" href="/page/9/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1451</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">889</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5358884258"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
