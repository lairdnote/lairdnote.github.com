<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/38/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/38/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/11/19/%E5%86%AC%E5%A4%A9%E6%9D%A5%E4%BA%86%EF%BC%8C%E6%98%A5%E5%A4%A9%E8%BF%98%E4%BC%9A%E8%BF%9C%E5%90%97%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/19/%E5%86%AC%E5%A4%A9%E6%9D%A5%E4%BA%86%EF%BC%8C%E6%98%A5%E5%A4%A9%E8%BF%98%E4%BC%9A%E8%BF%9C%E5%90%97%EF%BC%9F/" itemprop="url">冬天来了，春天还会远吗？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-19T10:16:17+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          其实回头想想今年面试的表现，前端、数据库等相关经验的匮乏，一度让我在面试中非常被动，而外冷内热的性格常常给人一种不自信的表现，特别是去葡萄城面试的这次体验，让我意识到在面试中我无法展示出和职位匹配的能力，我们说面试是双向选择的一个过程，这看起来有点像是找男女朋友一样，有时候我们太在乎对方而导致表现不佳;有时候人的命运像极了历史的兴衰，记得三年前和同学第一次来西安，那个时候我们说，总有一天我们会再来这里的，那时的我或许完全不知道现在会面临这种处境，看着那些年龄比自己大依然碌碌无为的人，看着那些面临中年危机而不得不向生活妥协的人.....我告诉自己，我永远都害怕自己变成这样的人，所以让我内心无法平静下来的，永远是我近乎自责的自我反省式人格;我花了时间去听知乎上有关面试技巧的Live，甚至找朋友帮我分析如何给出面试官满意的答案，有时候别人会觉得我对严厉到苛刻的程度，是因为我对某些东西太在乎的缘故，可是不在乎这些问题就能解决了吗
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/11/19/%E5%86%AC%E5%A4%A9%E6%9D%A5%E4%BA%86%EF%BC%8C%E6%98%A5%E5%A4%A9%E8%BF%98%E4%BC%9A%E8%BF%9C%E5%90%97%EF%BC%9F/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/11/13/2017/11/synchronised-asynchronized-coroutine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/13/2017/11/synchronised-asynchronized-coroutine/" itemprop="url">异步、并发、协程原理</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-13T10:45:30+08:00">
                2017-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/" itemprop="url" rel="index">
                    <span itemprop="name">系统原理</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>原文：<a target="_blank" rel="noopener" href="http://wiki.phpboy.net/doku.php?id=2017-07:55-%E5%BC%82%E6%AD%A5_%E5%B9%B6%E5%8F%91_%E5%8D%8F%E7%A8%8B%E5%8E%9F%E7%90%86.md">http://wiki.phpboy.net/doku.php?id=2017-07:55-异步_并发_协程原理.md</a></p>
</blockquote>
<p>Linux 操作系统在设计上将虚拟空间划分为用户空间和内核空间，两者做了隔离是相互独立的，用户空间给应用程序使用，内核空间给内核使用。<br><img src="//www.fanhaobai.com/2017/11/synchronised-asynchronized-coroutine/a89c6e5b-facd-47a1-a26b-c8fb747e9650.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/11/13/2017/11/synchronised-asynchronized-coroutine/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/11/03/2017/11/qconf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/03/2017/11/qconf/" itemprop="url">分布式配置管理Qconf</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-03T17:32:27+08:00">
                2017-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">分布式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>原文：<a target="_blank" rel="noopener" href="http://catkang.github.io/2015/06/23/qconf.html">从配置文件到分布式配置管理QConf</a></p>
</blockquote>
<p>QConf 是奇虎 360 广泛使用的配置管理服务，现已开源 <a target="_blank" rel="noopener" href="https://github.com/Qihoo360/QConf">QConf Source Code</a>，欢迎大家关注使用。本文从设计初衷，架构实现，使用情况及相关产品比较四个方面进行介绍。</p>
<p><img src="//www.fanhaobai.com/2017/11/qconf/d7fec4ae-e55a-11e7-80c1-9a214cf093ae.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/11/03/2017/11/qconf/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/10/30/2017/10/internal-php-fpm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/30/2017/10/internal-php-fpm/" itemprop="url">深入源码剖析PHP-FPM</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-30T15:03:36+08:00">
                2017-10-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>原文：<a target="_blank" rel="noopener" href="https://github.com/pangudashu/php7-internal/blob/master/1/fpm.md">https://github.com/pangudashu/php7-internal/blob/master/1/fpm.md</a></p>
</blockquote>
<p>FPM（FastCGI Process Manager）是 PHP FastCGI 运行模式的一个进程管理器，从它的定义可以看出，FPM 的核心功能是进程管理，那么它用来管理什么进程呢？这个问题就需要从 FastCGI 说起了。<img src="//www.fanhaobai.com/2017/10/internal-php-fpm/2ed1b400-61ae-cdbe-405a-8353ab28aa74.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/10/30/2017/10/internal-php-fpm/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/10/29/2017-10-29-game-and-gamification-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/29/2017-10-29-game-and-gamification-2/" itemprop="url">游戏和游戏化（下）</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-29T13:34:43+08:00">
                2017-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="广义的游戏"><a href="#广义的游戏" class="headerlink" title="广义的游戏"></a>广义的游戏</h2><p>说完游戏，我们再说说游戏化。上面我们讲的游戏，其实是狭义的游戏，在我看来，还有一种广义的游戏。广义的游戏是指：为了达成某个目标，我们在设计中引入游戏的某些元素，使得大家从人性上更容易达成目标。</p>
<p>举一个例子：背单词。背单词是一件非常反人性的事情。单词的记忆量大，所需的记忆时间长，为了记住需要一遍一遍地复习。市面上的背单词软件为了让大家从人性上更加容易完成背单词这件枯燥的事情，想了各种游戏化的方案。例如：在背诵时把单词的意思画成小插画、打卡机制、各种阶段性任务、任务完成之后勋章、朋友圈各种分享炫耀等。背单词和游戏其实并不相关，但是不影响它引入游戏化的元素。</p>
<p>如果说《游戏改变世界》一书是写给游戏从业者的，那么《游戏化思维》就是写给非游戏从业者的。《游戏化思维》一书中介绍了大量方法，可以将游戏中符合人性的元素引入到非游戏中。</p>
<h2 id="游戏化实践"><a href="#游戏化实践" class="headerlink" title="游戏化实践"></a>游戏化实践</h2><p>《游戏化思维》一书的结构非常清晰。我最喜欢的是书中的实践部分。</p>
<p>书中提到，最最基本的游戏元素就是积分（Point），徽章（Badge）和排行榜（Leaderboard），简称 PBL。这些元素确实随处可见，例如猿辅导上课时，就会在开课，答题，下课等环节引入积分奖励，这样你就会不由自主地全程参与整个课程。流利说每次口语跟读得优的时候，就会有一个金币 +1 的效果出来，虽然金币实际上用处不大，但是这种立即的反馈让人觉得有刚刚的努力有了成效。</p>
<h3 id="积分"><a href="#积分" class="headerlink" title="积分"></a>积分</h3><p>先说说积分。积分算是最常见的游戏化手段。我们说过游戏中的基本要素是目标、规则、反馈和自愿参与。积分可以很好地服务于 “规则” 和 “反馈”。举个例子，当玩家在虚拟世界中完成一个任务，立即显示出对应的积分变化。那么玩家很快就可以建立起任务完成与积分的因果关系，从而有效地评估这部分的激励。很多时候，积分还会被设计成阶段性的等级形式，或者设计成可以兑换某种奖励的可消费形式，这都给游戏的玩法增加了很多趣味性。</p>
<p>在书中，积分被总结成有以下作用：</p>
<ul>
<li>为游戏要素 “规则” 服务，可以有效地计分。</li>
<li>为游戏要素 “反馈” 服务，可以明确而频繁的反馈，它是最详细的反馈机制。</li>
<li>成为对外显示用户成就的方式。</li>
<li>在游戏进程和外在奖励之间构建联系。</li>
</ul>
<p>积分其实也有一些问题，最常见的问题就是它太详细和单一了。在最初帮助玩家建立起有效的规则和反馈之后，玩家对于反馈的注意力就会大大的减弱，因为每次的积分变化不会特别巨大，玩家不会因为这个产生巨大的情绪波动。所以积分通常还会附加一些别的设计，比如将积分成段，形成等级，或者为积分生成阶段性的排行榜之类，以便强化积分的效果。</p>
<p>积分还有一个问题，就是它其实是一种外显化的奖励。而一款游戏或者游戏化功能，其实有它内在的趣味和目标，过于外显化的奖励可能会弱化内在的趣味。</p>
<p>对于这一点，我有一个印象深刻的故事：</p>
<blockquote>
<p>一个老人住在一所房子里，每天都有一群小孩在院子里吵闹。老人想了一个办法，他把孩子们叫过来说：我一直觉得院子里太安静了，谢谢你们过来玩耍给院子带来了生气！作为感谢，以后你们每次来我都给你们 1 块钱。于是每个孩子都高兴地领到了钱。这样过了几天，老头说，我现在经济不太行了，只能每次给你们 5 毛钱，孩子们有点不高兴，但还是接受了。又过了几天，老头说，我以后不给钱了。孩子们炸了：我们每天给你们院子带来生气，你居然不分钱不给，我们再也不来了！</p>
</blockquote>
<p>在上面这个故事中，孩子玩游戏本身的乐趣，就是被外显化的金钱给转移和弱化了。</p>
<h3 id="徽章"><a href="#徽章" class="headerlink" title="徽章"></a>徽章</h3><p>刚刚说到积分的形式过于单一和微小，而徽章则是积分的反面，徽章可以提供多样化的评价，并且每次都可以是对玩家的一个巨大刺激。</p>
<p>很多 App 也有徽章的设计，比如得到，Keep，我们的猿题库在答题时有可能会掉落明信片，其实也是一种徽章。徽章在设计时可以有很多变化，比如：</p>
<ul>
<li>我们可以将徽章设计成达成某种成就时将奖励，这样徽章就可以是一种成就证明。</li>
<li>我们可以将徽章设计成随机掉落，这样配合全部徽章的介绍，徽章可以变成一种收集任务。</li>
<li>我们可以将徽章变成有奖励的形式，并且加强徽章的完成介绍，这样就徽章更像是一种任务。</li>
<li>我们也可以完全不介绍徽章如何获得，这样的徽章就变成了一种带有随机性和未知性的惊喜。下图是得到 App 的随机徽章。</li>
</ul>
<img src="/images/2017-10-29-game-and-gamification-2-dd4d3.png" class="">

<ul>
<li>我们也可以将同一个徽章增加金银铜或积分等级，这样徽章就变成了一种变相的等级系统。多个不同的徽章可以融合形式多种维度的等级展示。下图是得到 App 的积分等级徽章：</li>
</ul>
<img src="/images/2017-10-29-game-and-gamification-2-f537b.png" class="">

<p>徽章的优点其实也暗示着它的缺点。徽章过于灵活的设计规则使得产品经理常常会过度设计规则，而过于复杂的规则使得人们理解这个规则变得不容易。而这本来就是一个游戏，如果规则还需要人们特别花精力理解的话，很可能人们就不玩了。所以，过多的徽章让人无所适从。我们在设计的时候一定要适可而止。</p>
<h3 id="排行榜"><a href="#排行榜" class="headerlink" title="排行榜"></a>排行榜</h3><p>排行榜是一个相比积分更加明确的成就排名，玩家可以知道自己到底相对于其他玩家水平怎么样。排行榜由于是玩家之间的对比，所以相对于刚刚提到的积分和徽章，排行榜更能增加竞技性，而这种竞争带来的刺激会激励玩家更加努力。</p>
<p>我们小时候各个班级都会评小红花，发流动红旗，而且会在学校最醒目的黑板上公开各个班级的情况。这种竞争极大地激发出了大家的班级荣誉感，使得班级上很多团体活动能够团结一致，共同合作。</p>
<p>在游戏中，排行榜过于稳定也是一个问题，所以有些游戏会想一些办法，比如：设计按日排名的排行榜，设计让你看到你自己的名次的升降数以及相邻排行的人。</p>
<p>排行榜或许也是 PBL 中最难以设计的一个元素。因为有人排在前面，就有人排在后面。一个设计不好的排行榜，可能让普通玩家感受到目标的遥不可及。还是拿学校举例，虽然成绩排行榜对学生的学习有一进促进效果，但如果一个同学总是排在班级的最后几名，那么对他的信心打击将是巨大的。如果每个人都在认真地学习，那么排行榜对于前面几名的激励有限，但是对后面几名的打击却巨大，所以还不如没有得好。</p>
<p>在本书中，作者提到一些研究表明，商业环境中单纯引入排行榜通常会降低绩效。这也是为什么互联网公司的绩效排名虽然几乎每个公司都做，却通常不会面向所有员工公开的原因。</p>
<h3 id="动力、机制与组件"><a href="#动力、机制与组件" class="headerlink" title="动力、机制与组件"></a>动力、机制与组件</h3><p>刚刚聊到了 PBL，其实是一些游戏化的组件，而这些组件其实有很多很多。比如书中就列出了：成就、头像、徽章、打怪、收集、战斗、内容解锁、赠予、排行榜、等级、点数、任务、社交图谱、团队、虚拟商品等。</p>
<p>而机制方面，书中提到了挑战、随机机会、竞争、合作、反馈、资源获取、奖励、交易、回合、获胜状态。最上层的动力是：约束、情感、叙事、进展、关系。</p>
<p>整体动力、机制和组件的关系是一个金字塔一样的关系，如下图：</p>
<img src="/images/2017-10-29-game-and-gamification-2-436e7.png" class="">

<p>可惜的是，这虽然有助于我们理解游戏化元素的理论层次，但并不足以帮助我们设计出更好的游戏化方案。</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>为了设计出更好的游戏化方案，作者提出了他的一套流程方法论，即：</p>
<ul>
<li>明确商业目标</li>
<li>划定目标行为</li>
<li>描述你的用户</li>
<li>制定活动周期</li>
<li>不要忘记乐趣</li>
<li>部署适当工具</li>
</ul>
<p>前三步属于搞清楚游戏化的目标和对象，后三步属于执行设计方案时注意的要点。</p>
<p>就我自己来看，互联网的游戏化设计更像是一个参考、设计、讨论调整的过程。我们首先参考游戏或者别的游戏化 App 去分析现有产品的设计方案，然后我们着手自己产品的特点和用户，设计自己的方案，最后是讨论和调整这个方案。最终方案上线后，我们还可以进一步收集分析数据来评估方案，然后做进一步的讨论调整，再设计的工作。</p>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>因为上一节讲到，我们的实践偏案例形式，所以我这里给大家分享一些我看到的游戏化不错的案例。</p>
<p>我录制了几个案例视频：</p>
<ul>
<li><p>流利说的积分示例。它结合声音，很好地实现了积分的立即反馈效果。这种小奖励需要口语得分 85 分以上才行，所以用户不自觉就会把每一句跟读尽量读好。<a target="_blank" rel="noopener" href="http://weibo.com/1708947107/FsB1ayqkP?from=page_1005051708947107_profile&wvr=6&mod=weibotime&type=comment">视频示例</a></p>
</li>
<li><p>流利说对话中模仿游戏中的 “连击” 效果。让人不由自主希望继续优异表现。<a target="_blank" rel="noopener" href="http://weibo.com/1708947107/FsB330Taj?from=page_1005051708947107_profile&wvr=6&mod=weibotime&type=comment">视频示例</a></p>
</li>
<li><p>猿题库的排行榜。利用每周更新的个人榜和学校榜来激励大家竞争。<a target="_blank" rel="noopener" href="http://weibo.com/1708947107/FsB5XzCN0?from=page_1005051708947107_profile&wvr=6&mod=weibotime">视频示例</a></p>
</li>
<li><p>小猿搜题 24 点游戏的积分，等级和排行榜。排行榜以日榜为主，加强变化的可能性。<a target="_blank" rel="noopener" href="http://weibo.com/1708947107/FsB8djVJ7?from=page_1005051708947107_profile&wvr=6&mod=weibotime">示例</a></p>
</li>
<li><p>得到 App 的徽章系统。融合了积分，等级的星级勋章，以及融合了任务，奖励，收集和一点点神秘的成就勋章。<a target="_blank" rel="noopener" href="http://weibo.com/1708947107/FsBpQ5iEz?from=page_1005051708947107_profile&wvr=6&mod=weibotime&type=comment">视频示例</a></p>
</li>
<li><p>keep 的用户等级，融合了积分、等级、特权。<a target="_blank" rel="noopener" href="http://weibo.com/1708947107/FsBsttmhr?from=page_1005051708947107_profile&wvr=6&mod=weibotime&type=comment">视频示例</a></p>
</li>
</ul>
<p>也有一些我觉得做得不好的案例，比如我就对 “签到得积分” 这个产品形式非常不看好。因为签到本身并没有与 App 的功能紧密结合，得到的 “积分” 大多也就变成积分商城的一些实物奖品，这也没有与 App 的功能紧密结合。这种强行植入的游戏，很难让人坚持下来，即使有人坚持下来了，他也并不是你的 App 功能的忠实用户，而是你的奖品的忠实用户，而你的奖品是要你自己花钱提供的，一旦你的奖品没有吸引力或者不容易获得，用户就会流失。</p>
<p>小猿搜题在 2016 年曾经设计了这种失败的签到得积分功能，最后证明是非常失败的，几乎没有人能够坚持下来，对整体应用数据的影响微乎其微。</p>
<p>好的签到功能应该是与 App 本身功能紧密结合的，例如：英语流利说里面完成规定时长的口语练习才能在当天 “打卡”。打卡成功的奖励也应该与 App 本身紧密结合，比如可以解锁一些高级功能，或者获得一些虚拟的勋章或排行榜荣誉。</p>
<p>但是我们看市面上，还是有大量 App 采用了这种脱离 App 本身功能的游戏化设计。比如高德地图，某竞品 1 和某竞品 2。稍微好一些的，会把签到积分与任务系统结合，至少使积分的获得与 App 相关，比如优酷和爱奇艺。相关截图见：<a target="_blank" rel="noopener" href="http://weibo.com/1708947107/FsBDz6Rt9?from=page_1005051708947107_profile&wvr=6&mod=weibotime&type=comment#_rnd1509254730173">示例</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>游戏化的产品设计符合人性，应该是每个产品经理都应该学习的设计思路。在实践上有积分、徽章、排行榜等常见的形式。整个游戏化的方案应该具备游戏具备的目标明确、规则易懂、反馈及时以及自愿参与的特点。游戏化的方案应该符合产品的最终目标，不应该为了游戏化而游戏化。参考案例以及反复迭代打磨是我认为最简单实际的游戏化实践的方式。</p>
<p>愿大家玩得开心。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/10/24/%E8%BF%81%E7%A7%BBHexo%E5%8D%9A%E5%AE%A2%E5%88%B0Google%E6%B8%90%E8%BF%9B%E5%BC%8FWeb%E5%BA%94%E7%94%A8(PWA)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/%E8%BF%81%E7%A7%BBHexo%E5%8D%9A%E5%AE%A2%E5%88%B0Google%E6%B8%90%E8%BF%9B%E5%BC%8FWeb%E5%BA%94%E7%94%A8(PWA)/" itemprop="url">迁移Hexo博客到Google渐进式Web应用(PWA)</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T23:13:41+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%8B%AC%E7%AB%8B%E5%8D%9A%E5%AE%A2/" itemprop="url" rel="index">
                    <span itemprop="name">独立博客</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          现在，我们基本了解了PWA的概念以及实现PWA的关键技术，我们现在考虑将Hexo博客改造成一个PWA应用，我们这里不打算考虑消息推送的相关问题，所以对Hexo这样一个静态博客生成器而言，我们可以做的实际上只有两件事情，即通过Web App Manifest让它更像一个Native应用，通过ServiceWorker为它提供离线缓存的特性;我们知道传统Web应用有两个关键问题无法解决，即**需要从网络实时加载内容而带来的网络延迟**和**依赖浏览器入口而带来的用户体验**，从某种意义上而言，渐进式应用的出现有望让这些问题得到解决，首先，渐进式应用可以显著加快应用加载速度，其提供的离线缓存机制可以让应用在离线环境下继续使用，关键技术为Service Worker和Cache Storage;按照[官方文档](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API)中的定义，ServiceWorker同WebWorker一样，是一段JavaScript脚本，作为一个后台独立线程运行，其运行环境与普通的JavaScript不同，因此不直接参与Web交互行为，从某种意义上来说，ServiceWorker的出现，正是为了弥补Web应用天生所不具备的离线使用、消息推送、后台自动更新等特性，我们这里来看一个使用ServiceWorker缓存文件已达到离线使用的目的的例子：
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/10/24/%E8%BF%81%E7%A7%BBHexo%E5%8D%9A%E5%AE%A2%E5%88%B0Google%E6%B8%90%E8%BF%9B%E5%BC%8FWeb%E5%BA%94%E7%94%A8(PWA)/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/10/21/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%9C%A8Hexo%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%9A%84%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%9C%A8Hexo%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%9A%84%E5%AE%9E%E8%B7%B5/" itemprop="url">持续集成在 Hexo 自动化部署上的实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-21T22:57:55+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index">
                    <span itemprop="name">开发工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          TravisCI 提供了主流编程语言如 C#、Java、JavaScript、Ruby、PHP、Node.js 等的支持，相比 Jenkins 而言，它是一个轻量级的持续集成平台，它会在每次提交代码后，根据配置文件来创建一个虚拟机，并执行用户定义的 Build 任务，这个虚拟机提供版本控制(**Git**)、项目构建(**Node.js**)等，在此前提下，我们下面着手 Hexo 的自动化部署;现在我们在本地提交代码到 blog 分支，就会触发 TravisCI 执行 Build 任务，在这里 Build 任务是从 blog 分支拉取博客内容及主题，通过 npm 安装依赖的 nodejs 模块，最终 Hexo 生成的静态页面会被推送到 master 分支，这样就完成了整个自动化构建的流程;其次，持续集成可以将开发和部署分离，所以我在任何一台计算机上撰写博客，都可以通过 TravisCI 实现编译和部署，对 Hexo 这种静态博客而言，部署其实就是推送页面到 Github 而已，整体难度并没有太高
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/10/21/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%9C%A8Hexo%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%9A%84%E5%AE%9E%E8%B7%B5/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/10/21/%E4%B8%8D%E5%A6%82%E5%BD%92%E5%8E%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/%E4%B8%8D%E5%A6%82%E5%BD%92%E5%8E%BB/" itemprop="url">不如归去</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-21T22:31:48+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          我忽然发现我一年中我陪他们的日子屈指可数，从前向往远方觉得在那里能找到我的梦，现在越发地觉得他们一天天老去，想努力长大成熟，让他们能够放心，可更怕因为距离而疏远了他们，古人说『树欲静而风不止，子欲养而亲不待』，这个世界固然不再是古人所认识的世界，这种感情却超越了时间和空间轮回至今;早上看到这样一句话，『你懂得越多，就越觉得自己像这个世界里的孤儿』，人生而孤独，父母总有一天会离开我们，但他们教会我们如何去爱这个世界，我希望我可以用他们教会我的，在他们有生之年做些在他们眼里不再『孩子气』的事情，虽然在他们眼里我们永远都是孩子，我觉得真正的成熟并不是变得冷酷麻木，而是你知道这个世界有黑暗的一面，依然愿意相信那些温暖的事情;如果没有人愿意陪伴我做一件事情，我不会勉强更不会因此而沮丧，因为当你习惯了一个人去面对所有事情，你会发现你从来不缺乏做一件事情的动力
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/10/21/%E4%B8%8D%E5%A6%82%E5%BD%92%E5%8E%BB/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/10/11/2017-10-11-game-and-gamification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/11/2017-10-11-game-and-gamification/" itemprop="url">游戏和游戏化（上）</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-11T21:55:42+08:00">
                2017-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>最近看完了两本书：《游戏改变世界》和《游戏化思维》。前者是讲游戏的，后者是讲游戏化的。</p>
<img src="/images/2017-10-11-game-and-gamification-3d29e.png" class="">

<p>《游戏改变世界》的作者简•麦戈尼格尔 (Jane McGonigal) 认为游戏不但好，而且建立了相对于真实社会的一种“平行宇宙”，进入游戏其实就像进入了另一个社会一样。所以本书的英文名更为贴切，叫：《Reality is Broken》。作者从头到尾都在夸游戏中的社会是如何如何好，现实是如何如何让人沮丧。</p>
<img src="/images/2017-10-11-game-and-gamification-bcec8.png" class="">

<p>《游戏化思维》从另外一个角度来讲游戏：主要是将游戏中的一些元素融入到非游戏中，使得人们更加轻松地完成一些现实中的任务。</p>
<p>我们先说游戏吧。</p>
<h2 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h2><p>《游戏改变世界》认为所有游戏都有一个决定性的特征：目标、规则、反馈系统和自愿参与。前三者比较好理解，最后一项自愿参与：要求所有玩游戏的人都了解并愿意接受目标，规则和反馈。这一条其实建立了玩家的安全感，保证玩家把游戏中的高压挑战当作愉快的活动。</p>
<p>《游戏改变世界》将游戏世界对现实世界的改造比喻成“补丁”。在书中，作者一共介绍了 14 个补丁，用于描述游戏世界相对于现实世界的优越性。</p>
<img src="/images/2017-10-11-game-and-gamification-511d0.png" class="">

<p>但是，我觉得作者的解释过于拖沓，并且没有重点。其实游戏世界相对于现实世界的最最核心的理由是：游戏世界构造了一些机制，使得玩家一直处于一种心流（flow）的状态。所谓的心流，是指游戏构造了一种合适的难度，这种难度使得玩家一直处于自己可以在能力上“够得着”的状态。在书中，这种状态被称作：”个人最优化的障碍”，这种状态可以让人始终产生成就感。</p>
<p>这种持续的成就感很快就会让人上瘾。上瘾之后，游戏会加大难度，使得大家为了再次体会到类似的快感欲罢不能。我们来看几个例子。</p>
<p>俄罗斯方块恐怕是最简单又让人上瘾的游戏了。在游戏的刚开始，一切操作速度都很慢，玩家很容易适应游戏的节奏。然后俄罗斯方块通过各种即时反馈，让人们感觉到”正反馈“。比如随时在增加的分数，消除掉多行的快感，于是人们觉得”有点意思“。但是这种心流状态很快随着熟练就丧失了，于是游戏的难度加大，你不得不集中精力来处理快速下落的方块，最终你输了，虽然有所遗憾，但是你得到了历史最高的分数。于是你顾不得休息，又开始了新一轮的尝试。</p>
<p>最近流行的游戏王者荣耀也是这样。如果你也玩王者荣耀，并且是iOS平台的玩家，建议你尝试拿个Android手机重新玩一次，由于苹果的限制，在王者荣耀中iOS和Android 手机并不能互通角色。然后你就可以重新体验一次游戏的整个生命期。</p>
<p>我玩了大概半年的王者荣耀，一次偶然的机会，我拿起身边的一台 Android 测试机重新登录了一个新号。于是我立马发现了王者荣耀为新手构建了一个异常强大的”个人最优化的障碍”。在我用 Android 重新玩的那几天，王者荣耀为我模拟了一个非常舒服的比赛环境，我在游戏中把把拿 MVP，几乎没有输过。我突然想到，我在 iOS 平台刚开始玩黄忠的时候，基本上每次都赢，但是之后才发现黄忠其实被很多英雄相克，我很好奇，在相当长的几个月中，我都没有遇到过一次黄忠的克星。</p>
<p>所以，我几乎可以肯定的是：王者荣耀为玩家构建了一个相当长时期的保护期。在这个保护期内，你就如同进入了 iOS 的沙盒环境，所有的对手都是为你特别准备的，刚好够让你杀个痛快还有一点挑战。我有一次细心观察了一下，对手有一个走位明显就是机器人。我才一下子明白了，原来这个环境竟然是虚拟的。</p>
<p>所以大家就可以明白了，为什么有那么多妹子喜欢玩王者荣耀，其实游戏玩得好的女生非常少，但是王者荣耀的”个人最优化的障碍”机制，使得很多陪练参与其中，真实的玩家得到了极大地鼓励。当然，你如果一直这么玩，难道水平就不会有涨进吗？答案是肯定的，这就像《异类》中提到的那些成功人士一样让人羡慕。</p>
<p>在《异类》中，作者分析发现那些各种所谓的天才，其实只是比别人更加早完成 10000 小时练习而已，而他们的坚持动力，很大程度上都来自于刚开始比别人稍微强一点点，这稍微一点点的优势，成为了他的激励和成就感来源。这其实就是真实社会的”个人最优化的障碍”。在书中印象最深的是加拿大冰球队队员大多集中在 1 月份的例子：</p>
<blockquote>
<p>加拿大冰球队按年龄分组所依据的分界线是 1 月 1 日，即从 1 月 1 日到当年 12 月 31 日之间出生的球员将会被分在同一组。也就是说，一个 1 月 1 日出生的选手，是在跟许多年纪比他小的队友争夺晋级权。</p>
</blockquote>
<blockquote>
<p>而年龄大几个月而显现的微弱优势，会在孩子的成长过程中不断积累，最终引导孩子走向成功或不成功，自信或不自信的轨道中，其影响会延伸许多年。</p>
</blockquote>
<blockquote>
<p>社会学家罗伯特·默顿援引《新约·马太福音》，把这种现象叫作 “马太效应”。“凡是有的，还要加给他，叫他有余；没有的，连他所有的，也要夺过来。” 成功者，换句话说，就是获得这些特殊机遇的人，他们因此最终取得了更大的进步。</p>
</blockquote>
<p>我们脑洞一下，如果整个人类社会都是虚拟的，然后整个社会为了某个真实玩家而构建”个人最优化的障碍”，例如让你每次努力和别人比赛的时候都能赢。每次成绩都获得家长、同学、老师的肯定。当然，给玩家刻意构造几次挫折和失败也是必要的。然后社会再给这个玩家各种千载难逢的机会。最终这个人从虚拟社会中”毕业“的时候，他会不会在各个需要后天培养的地方都达到我们理想中的标准？我觉得答案是肯定的。</p>
<p>这个设定在各种科幻题材的作品中常常看到。比如经典的电影《黑客帝国》，人类就生存在一个机器构造的虚拟世界（电影中叫Matrix）中。在美剧《Rick and Morty》的第一季第四集，也脑洞了一个完全虚拟的世界（下图）。</p>
<img src="/images/2017-10-11-game-and-gamification-69ee0.png" class="">

<p>需要注意的是，”个人最优化的障碍”并不意味着一定要让玩家通关。在玩家对于游戏熟悉之后，通关并不是最爽的，相反，不能通关反倒是让人欲罢不能的事情。</p>
<p>国内的火爆游戏“天天爱消除”，其实就是让你一遍一遍不能通关，让你产生反复尝试的动力。最终有些人买了道具通关了，其实他的乐趣也结束了。“王者荣耀”也是这样，最终人们会陷在游戏给他的一个几乎不能完成的目标里面不能自拔，但是自己还乐在其中。</p>
<h2 id="其它因素"><a href="#其它因素" class="headerlink" title="其它因素"></a>其它因素</h2><p>当然，一款游戏光有”个人最优化的障碍”也是不够的，书中介绍的清晰的目标和规则、即时的反馈、低成本的失败压力、多人协作等元素，也是游戏成功必不可少的环节。</p>
<p>“个人最优化的障碍”的实现相对来说是有很多套路的。但是游戏的目标和规则却是真正比拼创意的事情。很多成功的游戏都开创了一些新的玩法从而成功。“王者荣耀”将 PC 时代的 DOTA 成功简化到手机上，优化掉各种装备购买，补刀等逻辑，这里面肯定花费了大量精力来做可玩性的设计。</p>
<p>单单是一款游戏里面的各种参数值，都会对游戏产生致命性影响。高中时我玩过一个 PC 网游叫“决战”，那款游戏的失败之处就在于法师的数值远高于别的职业，造成游戏完全没有平衡性可言。所以游戏开发里面专门有“数值设定”这个职位，他们的工作就是一遍一遍地调整游戏参数，使得整个世界的平衡性得以保证。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>总结一下，一款成功的游戏都有着”个人最优化的障碍”作为基础，在这之上，通过清晰的目标和规则、即时的反馈、低成本的失败压力、社交元素来构建出一个让人上瘾的环境。</p>
<h2 id="更新-2017-12-04"><a href="#更新-2017-12-04" class="headerlink" title="更新(2017.12.04)"></a>更新(2017.12.04)</h2><p>非常有意思的是，当本文在博客上发表之后，我的一个同事转给我<a target="_blank" rel="noopener" href="http://www.ifanr.com/948155">一篇文章</a>，上面介绍了 EA 公司申请的「动态难度调节」（Dynamic Difficulty Adjustment）<a target="_blank" rel="noopener" href="http://www.freepatentsonline.com/y2017/0259177.html">专利</a>。文章是这么介绍这个功能的：</p>
<p>当玩家的表现不尽如人意的时候，游戏会自动降低难度，让游戏变简单；当玩家表现神勇的时候，游戏又会调高难度，让游戏充满挑战——早在 1986 年，「红白机」FC 上的飞行射击游戏 Zanac 就曾引入过「动态难度调节」系统，当玩家 Game Over 的次数越多，游戏难度就越低。后来，《求生之路》（Left 4 Dead）、《生化危机 4》上也都采用过类似的系统。</p>
<p>这，不就是我们说了半天的“个人最优化障碍”么？</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/10/04/2017/deploy-hexo-blog-automatically-with-travis-ci/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/04/2017/deploy-hexo-blog-automatically-with-travis-ci/" itemprop="url">使用 Travis CI 自动部署 Hexo 博客</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-04T10:50:41+08:00">
                2017-10-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>之前（六月份高考完后）我把博客引擎由 Ghost <a target="_blank" rel="noopener" href="https://prinsss.github.io/migrated-to-hexo/">换成了静态博客生成器 Hexo</a>，并且只使用了自带的 Git Deployment 来手动部署生成好的静态博客文件到服务器上。虽然不像动态博客程序那样可以随时随地更新博客，但是想到马上就要上大学了，之后手头都会有电脑，所以更新博客也不算那么麻烦。</p>
<p>但是实在是人算不如天算，浙江这一届新高考改革是结结实实地把我坑了一把。二段线以上一段线未满这样中途半端的分数让人在填志愿时着实是犯难 —— 这次浙江几乎普遍出现「一段考生抢以往的二本中好学校，二段考生抢三本学校」这样神秘的情况。思来想去最后把心一横，决定去再读一年高四。后来全省高考录取情况出来后，也证实了我当时复读的决定也不是不合理的（譬如当时上了新浪微博热门话题的「浙江滑档大学」等）。</p>
<p>关于复读的话题就先放一放吧，毕竟现在的时间确实是有些紧，可能得等到寒假时才能好好地写一篇近况报告以及关于高四生活的事情了，非常遗憾。</p>
<p>回到正题，因为我输得透彻滚去读高四了，所以自然不可能每次都有配置完好的操作环境让我手动发博文 + 部署（虽然我也不见得有时间写什么博文）。在这样的前提条件下，一个 Hexo 博客的自动部署（持续集成）系统就显得非常有必要了。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/10/04/2017/deploy-hexo-blog-automatically-with-travis-ci/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/wecodesign-pwa">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wecodesign-pwa" itemprop="url">Hablando sobre PWA en el podcast WeCodeSign</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-03T18:00:00+08:00">
                2017-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          He grabado un podcast sobre Progressive Web App para WeCodeSign. Escúchalo o lee la transcripción.
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/wecodesign-pwa">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/25/%E7%A7%8B%E9%A3%8E%E5%8A%B2%E4%BC%BC%E5%8E%BB%E5%B9%B4%E6%97%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/%E7%A7%8B%E9%A3%8E%E5%8A%B2%E4%BC%BC%E5%8E%BB%E5%B9%B4%E6%97%B6/" itemprop="url">秋风劲似去年时</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-25T00:56:50+08:00">
                2017-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          二十五岁的我，喜欢一个人还是和从前一样无所顾忌，我还是学不会那些复杂的套路，不喜欢单方面付出，不喜欢卑微地爱一个人，每一次都会因为喜欢某个女孩子而尝试改变，想和她站在一起的时候不会被她的光芒完全覆盖，想和她待在一块的时候不让她觉得我这个人枯燥，想和她抱在一起的时候给她讲我从书里看到的某个故事......我一直在想，如果我们的感情不是以异地恋这种方式会不会有不一样的结局，我喜欢《星月神话》这首歌，是因为我们的确呼吸着同一片天空的气息而注定无法再相遇，就像两条相交的直线一样从陌生到熟悉再到陌生;我喜欢穿裙子的女孩子，这一点完全是因为受到她的影响，虽然她一再告诉我，是我喜欢这样的女孩子，而她恰好喜欢穿裙子而已，可这些淹没在风声里的话语，谁会去盘问孰是孰非呢，如果她此刻愿意同我争论这个问题，我直接认输就好啦，我对输赢看得并不重要，这就像在工作中，没有人在意做的产品是不是好用，大家关注的是始终是它能节省多少个FTE，所以为了达到这些光鲜亮丽的指标，没有人会在意工程师的代码被改成什么样子，我们所追求的东西是否显得舍本逐末，我们所在意的东西到底是否真正发自你我的本心;你一定觉得我幼稚或者是不成熟啦，我问过人家要怎么样变得成熟，人家说你去找一个女朋友就好啦，然后就会在喜欢的人面前紧张甚至自卑，我曾一度很讨厌下雨天，因为我怕两个人遇到一起，我既没有伞亦没有外套
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/25/%E7%A7%8B%E9%A3%8E%E5%8A%B2%E4%BC%BC%E5%8E%BB%E5%B9%B4%E6%97%B6/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/23/%E5%89%8D%E7%AB%AF%E7%9C%9F%E7%9A%84%E8%83%BD%E5%81%9A%E5%88%B0%E5%BD%BB%E5%BA%95%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%90%97%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/23/%E5%89%8D%E7%AB%AF%E7%9C%9F%E7%9A%84%E8%83%BD%E5%81%9A%E5%88%B0%E5%BD%BB%E5%BA%95%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%90%97%EF%BC%9F/" itemprop="url">前端真的能做到彻底权限控制吗？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-23T22:41:20+08:00">
                2017-09-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>有一天突然想到一个问题，web端的权限控制：<br>1.真的能控制权限吗？<br>2.仅仅靠前端，能不能做到真正的权限控制？<br>3.如果需要后台配合，应该如何配合？<br>可能这是一个老生常谈的问题，但还是想整理下，有误的地方望大家指出。</p>
</blockquote>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/23/%E5%89%8D%E7%AB%AF%E7%9C%9F%E7%9A%84%E8%83%BD%E5%81%9A%E5%88%B0%E5%BD%BB%E5%BA%95%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%90%97%EF%BC%9F/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/23/2017/09/supervisor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/23/2017/09/supervisor/" itemprop="url">使用Supervisor管理进程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-23T17:56:57+08:00">
                2017-09-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p><a target="_blank" rel="noopener" href="http://supervisord.org/">Supervisor</a> 是一款使用 Python 开发的非常优秀的进程管理工具。它可以在类 UNIX 系统上让用户精确地监视与控制多组指定数量的服务进程。当监控的服务进程意外退出时，会尝试自动重启这些服务，以保持服务可用状态。</p>
<p><img src="//www.fanhaobai.com/2017/09/supervisor/d42decd3-2342-4e8f-a34f-48b47fc6e557.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/23/2017/09/supervisor/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/21/2017/09/record-question-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/21/2017/09/record-question-1/" itemprop="url">记录 — Redis与接口签名问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-21T13:09:59+08:00">
                2017-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/" itemprop="url" rel="index">
                    <span itemprop="name">DB</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>最近比较忙，要上新的项目，也没时间打理博客了。今天中午抽午睡时间记录下这几天工作上遇到的 <a href="#">接口签名错误</a> 和 <a href="#">Redis 集群 VIP 漂移故障</a> 。</p>
<p><img src="//www.fanhaobai.com/2017/09/record-question-1/0188ae67-31cc-464e-a986-d999f3507427.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/21/2017/09/record-question-1/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/20/%E4%BB%8EReact%E4%B8%93%E5%88%A9%E4%BA%8B%E4%BB%B6%E7%9C%8B%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/20/%E4%BB%8EReact%E4%B8%93%E5%88%A9%E4%BA%8B%E4%BB%B6%E7%9C%8B%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF/" itemprop="url">从 React 专利事件看开源软件许可</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-20T23:06:45+08:00">
                2017-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          实际上在 React 为前端带来虚拟 DOM、单向数据流和不可变对象等一系列函数式编程的概念的同时，Facebook 在开源社区中的话语权同样越来越大，Facebook 在开源协议中夹藏私货的确让人有种"挟天子以令诸侯"的感觉，曾几何时，社区指责微软没有开放全部的 OpenXML 标准，因为大家都觉得按照这个标准实现的 Office 文档和微软家的存在差异，可是面对这种和自家产品紧密联系的项目要开源，我觉得这不单是 Facebook 会有所提防，恐怕所有的商业公司都会有类似的想法吧，所以在这个事件中，隐含的一个点就是，一旦当使用 React 的公司和 Facebook 发生业务上的竞争，React 将成为 Facebook 获得诉讼胜利的一个重要筹码，因为根据 React 的专利协议，Facebook 有权在开展诉讼时从被授权方手中收回 React 的使用权，所以我们不难理解为什么百度和 Wordpress 都宣称要停止使用 React，除了不想受制于人以外，像百度这种未来可能会和 Facebook 在 AI 等领域发生竞争的公司，宁可自己造一套轮子而不愿让自家专利被对方使用的做法，我觉得是可以理解的;或许在数日前，你还在为 React 专利事件而苦恼，或者考虑在 Preact 的基础上实现一个新的 React，或者考虑转向 Angular 和 Vue 这两个框架，此时此刻 Facebook 宣布将 React 的开源协议修改为 MIT，或许这算是开源社区的一次胜利，或许这算是整个专利事件的尘埃落定，或许有人继续担心 Facebook 搞其他事情，可是这个世界原本就是在每天都发生变化着的，对于未来我们常常是无从得知它的足迹会在哪里;所以这篇文章我想和大家通过 React 专利事件来聊聊开源软件许可，以及我们如何在商业化和开源社区间找到一个平衡点
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/20/%E4%BB%8EReact%E4%B8%93%E5%88%A9%E4%BA%8B%E4%BB%B6%E7%9C%8B%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/17/Redis%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97%E4%B9%8BLua%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/17/Redis%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97%E4%B9%8BLua%E8%84%9A%E6%9C%AC/" itemprop="url">Redis 缓存技术学习系列之 Lua 脚本</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-17T10:49:07+08:00">
                2017-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">数据存储</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          好了，现在大家应该理解 EVAL 这个命令的使用方法啦，那么对 EVALSHA 命令来说，顾名思义，它就是使用了 SHA1 验证的 EVAL 方法，我们注意到现在脚本都是定义在 EVAL 命令的第一个参数上，假如我们需要复用一个脚本，而该脚本可以为我们提供 Sum 这样的功能，即它可以返回一组参数的和给我们，显然参数的个数是不同的，那么这个时候我们总不能每次都重复写这个脚本吧，所以 Redis 会为脚本创建一个指纹，我们使用 EVALSHA 命令来传入一个指纹，Redis 将从缓存的脚本中找到这个脚本，并结合我们的参数来调用它，这样我们就可以获得脚本执行以后的结果，关于指纹的这种说法，大家可以结合 Git 提交代码时的感受进行理解，除此以外，它和 EVAL 在使用方法上是完全一致的，所以不再举例子说明啦;尤其当我面试的时候，我发现好多我写在简历上的内容，都会成为某种意义上的呈堂证供，这让我更加确信好多东西需要不断地去巩固，所以尝试在实际项目上使用 Moq、考虑怎么写出更好的测试方法以及时刻保持自我的不可替代性，这些都是我最近在考虑的事情，有时候发脾气是因为觉得自己在浪费生命，可越是被这种无力感笼罩的时候，就越是要对自己狠一点儿，所以在这篇博客中，让我们重新拾起对 Redis 的学习兴趣，今天我们来说说 Redis 中的 Lua 脚本;好了，我们下面来解释下这段脚本，我们向 Redis 中键名为**data**的集合中添加了 5 个元素，注意这句脚本是在执行**src/redis-cli**后执行的，这部分内容我们在前面讲解 Redis 中的数据结构的时候提到过，博主表示在写这篇文章的时候依然要去看文档，总之现在我们有一个集合，并且这个集合中有 5 个元素，与此同时呢，我们编写了一个 Lua 脚本文件**script01.lua**，这个脚本的作用是对集合中的元素进行求和
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/17/Redis%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97%E4%B9%8BLua%E8%84%9A%E6%9C%AC/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/12/2017/2017-09-12-gpg-and-e2ee/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/12/2017/2017-09-12-gpg-and-e2ee/" itemprop="url">GPG 与端到端加密：论什么才是可以信任的</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-12T00:00:00+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <blockquote>
<p>本文由我去年 6 月在 LeanCloud 的一次技术分享整理而来，需要读者对公钥加密算法有基本的了解。</p>
</blockquote>
<p>如果提到 GPG 那么不得不提的就是公钥加密算法，首先我们先来快速地了解一下最知名的公钥加密算法 —— RSA：在 RSA 中有「公钥」和「私钥」两种密钥，其中私钥可以导出公钥，但公钥无法反推私钥。如果用公钥加密数据的话，那么只有私钥可以解密；如果使用私钥签名数据的话，那么可以验签名。</p>
<p><img src="https://r2-lc-cn.jysperm.me/thirdparty/gpg-public-key-encryption.gif"></p>
<h2 id="密码学账户"><a href="#密码学账户" class="headerlink" title="密码学账户"></a>密码学账户</h2><p>顾名思义，通常我们会将公钥公开地发布，作为自己身份的代表，就好像用户名一样（虽然是一个难以记忆的随机字符串）；而将私钥秘密地保存，作为身份的证明，就像密码一样。如果一个账户是由一个公钥加密算法的密钥对所保护的，那我们称之为「密码学账户」，我们身边常见的密码学账户包括：</p>
<ul>
<li>SSL 证书（用于 HTTPS 等加密通讯）</li>
<li>S&#x2F;MIME 证书（用于邮件加密和认证）</li>
<li>SSH 密钥（用于登录服务器的凭证）</li>
<li>Bitcoin 钱包</li>
<li>GPG ID</li>
</ul>
<p>这些账户和我们通常注册的互联网服务很不一样，在我们通常注册的互联网服务中，你的账户实际上是由网站的维护者管理的，你为账户设置的密码并没有真的用来加密数据，而只是一种证明账户所有权的凭证，在每次登录时你向网站发送密码，来证明自己是账户的所有者。一旦你忘记了密码，网站的维护者在通过其他渠道（邮箱地址、手机号码）确认了你的身份之后，也可以帮助你重置密码。</p>
<p>而在密码学账户中，你拥有账户的唯一凭证就是你的密钥对 —— 通常是计算机上的一个文件，你通过使用这个密钥对进行签名来管理你的账户、进行解密来访问机密数据。密码学账户既是更加安全的（不存在具有特权的管理者），同时也是更加危险的（一旦丢失无法找回；一旦泄漏也无法重置）。</p>
<h2 id="公钥交换"><a href="#公钥交换" class="headerlink" title="公钥交换"></a>公钥交换</h2><p>公钥加密算法看上去很美好，一旦我们有了对方的公钥，只需在通讯时用对方的公钥加密数据，就万无一失了，但这其中 <strong>最薄弱的一个环节就是「得到对方的公钥」，即「公钥交换」</strong>。</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/exchange.png"></p>
<p>上图是理想的情况，A 和 B 互相之间交换公钥，后续的通讯就可以以加密的方式进行了。但如果这时出现了一个能够监听和篡改 A 和 B 之间的通讯的 C，然后将自己的公钥发给 A 和 B，就变成了这样：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/mitm.png"></p>
<p>A 和 B 都以为自己得到了对方的公钥，但实际上他们得到的都是中间人 C 的公钥，这意味着他们之后的通讯都会以 C 的公钥来加密，C 便可以在中间继续进行窃听和篡改。</p>
<p>所以在理论上 <strong>不可能存在一种在线的、可靠的、不事先协商的公钥交换机制</strong>，因为交换公钥意味着双方还没有开始加密通讯，交换的过程自然没有保障。那么在实际应用中我们是如何解决公钥交换的问题的呢，我们来看一下 SSL 所使用的 X.509 证书体系：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/x509.png"></p>
<p>在 X.509 中有一个被称为「证书颁发机构（CA）」的权威的第三方，CA 的数量较为有限，资格变化也并不频繁，所有浏览器（browser）都内置了 CA 的公钥。而网站方（website）在生成了自己的公钥后，需要先找 CA 对自己的公钥进行签名然后才能使用。当浏览器访问一个新的网站时，网站方需要提供经过 CA 签名的公钥，浏览器使用内置的 CA 公钥来验证签名，确保收到的网站的公钥没有被篡改过。</p>
<p>X.509 实际上就是要求大家信任一个权威的第三方并将它们的公钥内置在客户端中，这并不是一个完美的方案，因为在这个体系中 CA 有着非常大的权力，一旦 CA 不按照规则签发证书，那么客户端是无法察觉这种攻击行为的。</p>
<h2 id="GPG"><a href="#GPG" class="headerlink" title="GPG"></a>GPG</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://gnupg.org/">GPG</a> 是 PGP（Pretty Good Privacy）的一个 GPL 实现，也是目前使用最广泛的实现。</p>
</blockquote>
<p>「信任一个权威的第三方」对于一些去中心化爱好者是无法接受的：首先我们凭什么去信任这个第三方，其次在 CA 申领证书通常也是需要付费的。那么有没有可能去除这个权威的第三方，而允许大家互相进行认证呢？如何确认一个公钥就是属于这个人的呢？这就是我们接下来要介绍的 GPG 的信任模型：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/gpg-trust-model.png"></p>
<p>在 GPG 的信任模型中，用户互相之间对公钥进行认证（通过用自己的私钥进行签名的方式），例如 Alice 和 Bob 是很好的朋友，要么 Alice 就会用自己私钥给 Bob 的公钥签名，然后将这个签名通过 Key Server 广播给其他人。Key Server 仅仅用来交换公钥和签名，因为签名本身是可校验的，所以 Key Server 并没有任何特权。</p>
<p>当另外一个 Alice 的朋友看到 Bob 的公钥，并且发现 Alice 给 Bob 的公钥签过名，那么就可以认为他的朋友 Alice 已经检查过 Bob 的公钥了，如果看到更多朋友给 Bob 签过名，那么就几乎可以认定 Bob 的身份是真实的。</p>
<p>所以 GPG 实际上是一个由「熟人关系」建立起的信任网络，当你认可一个人的身份，即认可这个公钥是属于这个人的，你便可以给他的公钥进行签名，形成一种信任关系，同时这种信任关系又是可以传递的。当你的 GPG 通讯录中有了一些互相信任的朋友之后，便可基于这个关系网来拓展你的朋友圈。</p>
<p>那么既然我们前面提到不可能有一个在线的、可靠的、不事先协商的公钥交换机制，那么这个信任网络在一开始是如何建立起来的呢？答案是使用分散的、多渠道的、可能是线下的方式来交换和确认公钥。如果使用一个固定的协议去交换公钥，而且这个协议本身没有加密保护，那么当然容易被中间人攻击，但如果两个人同时使用多种渠道来交换公钥，例如先用邮件发一次、再用微信发一次、最后再用电话说一次，那么这些渠道同时被攻击的可能性会非常小。</p>
<p>或者更进一步，我们可以采用线下的方式来进行确认，实际上很多技术类会议结束后可能会有一个 Key Signing Party 的活动，大家面对面地确认身份（你可能有必要出示印有照片的证件，例如身份证或护照），用纸和笔记下公钥，然后回家进行签名和上传。</p>
<p><img src="https://r2-lc-cn.jysperm.me/thirdparty/gpg-key-signing-party.jpg"></p>
<p>最后你便得到了一些来自其他人签名，代表他们认可了你的身份，即认可了某一个 GPG 公钥代表了你。</p>
<h2 id="GPG-通讯簿"><a href="#GPG-通讯簿" class="headerlink" title="GPG 通讯簿"></a>GPG 通讯簿</h2><p>因为 GPG 需要用户自己维护信任关系，因此每个 GPG 的用户都会有一个通讯簿，里面是大量的公钥（代表着一个其他用户）和签名（代表着信任关系）。</p>
<p>下面是我的通讯录中与我自己相关的部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~&gt; gpg --list-keys jysperm</span><br><span class="line">pub   4096R/E466CF1E 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">uid       [ultimate] Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">uid       [ultimate] Wang Ziting &lt;jysperm@icloud.com&gt;</span><br><span class="line">uid       [ultimate] [jpeg image of size 1476]</span><br><span class="line">sub   2048R/1D795875 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">sub   2048R/289286B3 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">sub   2048R/35B5DE4D 2016-05-17 [expires: 2017-05-17]</span><br></pre></td></tr></table></figure>

<p>其中 <code>E466CF1E</code> 是我的「根公钥」的简写形式，<code>4096R</code> 表示这是一个 4096 bit 的 RSA 密钥对，创建时间是 <code>2014-11-23</code>，有效期至 <code>2017-05-17</code>。一个 GPG 帐号下可以有多个 uid，我可以使用根公钥签署类似于「<a href="mailto:&#x6a;&#121;&#x73;&#112;&#x65;&#114;&#109;&#x40;&#x67;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#109;">&#x6a;&#121;&#x73;&#112;&#x65;&#114;&#109;&#x40;&#x67;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#109;</a> 是我的邮箱地址」的签名，来将自己的多个身份关联到一起，上面的 3 个 uid 即我的 2 个邮箱地址和一个头像图片。</p>
<p>我还可以使用根公钥签署一个类似于「我授权 1D795875 为我的子密钥，可以代替我进行签名等操作」的消息来添加额外的子密钥，例如上面的三个 <code>sub</code> 就是三个不同功能的子密钥。就像这样，其实对于 GPG 帐号的管理操作都是通过用私钥签名消息来实现的。</p>
<p>还可以列出与我有关的签名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~&gt; gpg --list-sigs jysperm</span><br><span class="line">pub   4096R/E466CF1E 2014-11-23 [expires: 2017-05-17]</span><br><span class="line">uid                  Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">sig          C07CFB96 2016-05-04  paomian &lt;qtang@leancloud.rocks&gt;</span><br><span class="line">sig 3        7CDC82A7 2015-05-11  Yeechan Lu &lt;wz.bluesnow@gmail.com&gt;</span><br><span class="line">sig 3        E466CF1E 2016-05-17  Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">sig          E411E711 2016-06-02  keybase.io/librazy &lt;librazy@keybase.io&gt;</span><br><span class="line">sig          B0B002B8 2016-07-13  dennis (Dennis Zhuang) &lt;killme2008@gmail.com&gt;</span><br></pre></td></tr></table></figure>

<p>这里看到除了我自己之外，还有其他四个人为我 <code>jysperm@gmail.com</code> 这个 uid 进行了签名，认可了 <code>E466CF1E</code> 这个公钥属于 <code>Wang Ziting &lt;jysperm@gmail.com&gt;</code> 这个人。对他人的签名也是可以区分不同的级别的，例如对于「在论坛上混了个脸属」和「每天都见面的同事」你可以给予不同级别的签名来更准确地表达信任关系</p>
<h2 id="使用-GPG"><a href="#使用-GPG" class="headerlink" title="使用 GPG"></a>使用 GPG</h2><p>前面我们介绍了 GPG 的信任模型和通讯簿，那么可以在哪些场景下使用 GPG 呢？</p>
<p>首先是你可以用它签名一段消息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~&gt; echo &#x27;hello&#x27; | gpg --clearsign -a</span><br><span class="line">-----BEGIN PGP SIGNED MESSAGE-----</span><br><span class="line">Hash: SHA1</span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">-----BEGIN PGP SIGNATURE-----</span><br><span class="line"></span><br><span class="line">iQIcBAEBAgAGBQJXfifAAAoJELQPOvDkZs8epZAP/3/jP6k1Dev2a8i8KfY7VDfv</span><br><span class="line">TVGl61kLEbgpgR3mWXFL7PaJ8SyW8N0Dv3cJhYbY8NGp8wbkZa7cUS7DkTb2ArhS</span><br><span class="line">M+IKUJtwUwbfp5fOyT+esaDLWatqjSJ+5IjWX8BOnh5SnLNMURDxsYrJMShfecTD</span><br><span class="line">tbBfnEkIeCFBwIfE0Xs5m23+6i7t77ZgLdn1qpWLTRNpd6Fzi0B653Kr8dREPflI</span><br><span class="line">MAsn6CP90pX55V0LnsZGiAgZV+34iFolhFDd7N5mtPT/zF7OToN2SNJF3YOVikBp</span><br><span class="line">M+1WJL9W8x9DwzhOq8AmPgHIEwBZVNS8Nv+UNadIZJuexR0ERl64e8MdTLft0Qui</span><br><span class="line">ChjUiD7ibkLR433jcms+2EJ04xd6Ie0mp/nH5nMLY1mEgHtLMXql6VHQCbJt80Vf</span><br><span class="line">ZrL2J+BF9Sk1zPh9Hn5NGe+RLX1d/CZ62rYMICRcEwiS9vpWq6m9ouSMNZUYr8S5</span><br><span class="line">a/ooD6gc71t457pVgkMqjo3Auazf4PRilUsAraQZilr+8yPhciE/PX3gBL5CtKHJ</span><br><span class="line">4vKH9P9RngigL6D+YyBB5vMcpXlhx9ShbH2qLr106adJ1XrCpGtSmfxygjRn3xX9</span><br><span class="line">Q1dWUaELUahhcdtK6IwZ6qzyp9AESpSd+Z/bnV7jc8iC0VtMOXipVnMo7J5qyHKD</span><br><span class="line">/+yt8/tzoC4+0MEzlaHJ</span><br><span class="line">=aOto</span><br><span class="line">-----END PGP SIGNATURE-----</span><br></pre></td></tr></table></figure>

<p>上面我们先用 SHA1 对要签名的文本进行进行了一下摘要，然后用 GPG 对这个摘要进行了签名。</p>
<p>因为 Git 中的用户名和邮件地址其实是可以随意更改的，之前有过几次伪造 Commit 冒充大 V 的事件发生。最近 GitHub 支持了为帐号配置 GPG 公钥，然后你便可以在发布新版本的时候用 <code>git tag -s v1.0.0</code> 进行签名：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/github-gpg-signature.png"></p>
<p>你可以在本地这样来验证签名，一旦签名认证通过，和正确的 GPG 帐号管理，那么这个 Commit 就不可能是伪造的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~&gt; git tag -v v1.1.0</span><br><span class="line">object b0e42636df7394ac34f2b61c589233d0c3296d10</span><br><span class="line">type commit</span><br><span class="line">tag v1.1.0</span><br><span class="line">tagger jysperm &lt;jysperm@gmail.com&gt; 1467084786 +0800</span><br><span class="line"></span><br><span class="line">gpg: Signature made 6/28 11:33:17 2016 CST</span><br><span class="line">gpg:                using RSA key B40F3AF0E466CF1E</span><br><span class="line">gpg: Good signature from &quot;Wang Ziting &lt;jysperm@gmail.com&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>很多开源软件在发布新版本的二进制包时也会使用 GPG 进行签名，包括 Debian 的软件仓库 apt 也是通过 GPG 进行签名的。</p>
<p>然后你当然也可以用 GPG 加密消息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~&gt; echo &#x27;hello&#x27; | gpg --encrypt -a -r jysperm</span><br><span class="line">-----BEGIN PGP MESSAGE-----</span><br><span class="line"></span><br><span class="line">hQEMAyp325QokoazAQf8DDqELYisLFSGo/9Gblr1MEabb9t3V3AcbWkA4uimpYeD</span><br><span class="line">/DTWDlmxrIsvpmDDeV/1bAZ/gMc2DzhODfM4PQf8DfD+lvHwgMBhe1zSBCZlQwkj</span><br><span class="line">xkP+CtF+S8xWTciaexIMQiTHLNu1tvhvCjIeR1qYJY0/E7tdKhS5iG4Jc3/oyCNN</span><br><span class="line">a1m34O9GG5WJsHozGqpfKZFma50onDmQ6TnSuz4iDWrslvq3XuLRXvgOQ6DKArix</span><br><span class="line">Sxnmxg1kMvlIF6AMmQRHaHpyXBoOlaX/NEsl8ESCe9w4KZFTCoFtsEB9tAwQGeGn</span><br><span class="line">6Tnd7BLaxXOabqaSpoNcOlpWDlZcX89lbewAryKbY9I7AbURsuemI37bTizQUjWA</span><br><span class="line">57xm4t7wTUJ/FLx22Amv1ljUa/Rq84rO8d38EQViNGyo31UmRVXy12AmBDU=</span><br><span class="line">=T42S</span><br><span class="line">-----END PGP MESSAGE-----</span><br></pre></td></tr></table></figure>

<p>这里我们指定了我自己的公钥为收信人，可以看到不同于前面，加密消息没有明文部分，除非使用收信人的私钥，否则无法解密：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ gpg -d &lt; gpg-message</span><br><span class="line">gpg 2048-bit RSA key, ID 289286B3, created 2016-06-28 (main key ID E466CF1E)</span><br><span class="line">    Wang Ziting &lt;jysperm@gmail.com&gt;</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><p>因为 SSH 和 GPG 都支持一样的公钥加密算法（例如 RSA），因此你也可以直接在 SSH 上使用 GPG 的密钥。</p>
<p>例如将你的 GPG 公钥添加到 GitHub，然后使用它来登录 GitHub:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~&gt; export SSH_AUTH_SOCK=~/.gnupg/S.gpg-agent.ssh</span><br><span class="line"></span><br><span class="line">~&gt; ssh-add -l</span><br><span class="line">2048 SHA256:wO93TcTQHZtltKfvS0jewFh0CMj4No6xnTegtB8FN+k</span><br><span class="line"></span><br><span class="line">~&gt; ssh git@github.com</span><br><span class="line">Hi jysperm! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line">Connection to github.com closed.</span><br></pre></td></tr></table></figure>

<h2 id="管理密码"><a href="#管理密码" class="headerlink" title="管理密码"></a>管理密码</h2><p>有一个比较有趣的实践是你可以用 gpg 来加密你的密码，<a target="_blank" rel="noopener" href="https://www.passwordstore.org/">pass-store</a> 是一个基于 GPG 和 Git 的非常简单的密码管理器，它可以用 GPG 来加密密码，然后用 Git 来进行版本控制：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~&gt; pass find Coding</span><br><span class="line">Search Terms: Coding</span><br><span class="line">└── Code</span><br><span class="line">    └── Coding</span><br><span class="line">        └── jysperm.gpg</span><br><span class="line"></span><br><span class="line">~&gt; pass insert Code/Coding/jysperm</span><br><span class="line"></span><br><span class="line">~&gt; pass show Code/Coding/jysperm</span><br><span class="line">DzizKKVIy22aHQwm</span><br><span class="line"></span><br><span class="line">~&gt; pass git pull --rebase</span><br><span class="line">remote: Counting objects: 11, done.</span><br><span class="line">remote: Total 11 (delta 1), reused 1 (delta 1), pack-reused 10</span><br><span class="line">Unpacking objects: 100% (11/11), done.</span><br><span class="line">From github.com:jysperm/passwords</span><br><span class="line">   5026f34..e94a70f  master     -&gt; origin/master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Fast-forwarded master to e94a70f8b42af5e1c13dd69246b156bbcb24a94c.</span><br></pre></td></tr></table></figure>

<p>这样一来你甚至可以把密码托管在 GitHub 上：<a target="_blank" rel="noopener" href="https://github.com/jysperm/passwords">https://github.com/jysperm/passwords</a></p>
<h2 id="KeyBase-和身份证明"><a href="#KeyBase-和身份证明" class="headerlink" title="KeyBase 和身份证明"></a>KeyBase 和身份证明</h2><p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/keybase-profile.png"></p>
<p>再向大家介绍一个有趣的社区 —— <a target="_blank" rel="noopener" href="https://keybase.io/jysperm">Keybase</a>，它就好像是 GitHub 之于 GPG 社区一样。提供了一个你的 GPG 身份的主页，上面有你的公钥、关联的 GitHub 帐号、Twitter 帐号以及所拥有的网站，他人还可以在这个网页上直接用你的公钥发送经过 GPG 加密的信息。你可以将你的私钥以加密的方式存储在 Keybase（当然不推荐这样做），Keybase 提供了在浏览器中使用密钥对进行加密、解密、签名、验签的功能。</p>
<p>前面我们提到在 Keybase 上你可以关联你的社交帐号，不同于一般的网站的「第三方帐号关联」，Keybase 的用户们显然都对去中心化非常在乎，那么如何去证明一个社交帐号是属于这个 GPG 公钥的呢？在这个场景中我们需要进行两方面的证明，一方面是要用 GPG 公钥去进行一个签名，声明他拥有这个社交帐号：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/twitter-proof-signature.png"></p>
<p>另一方面是用这个社交帐号将这个签名发布出来，来声明他拥有这个 GPG 公钥：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/twitter-proof.png"></p>
<p>这种交叉的证明将不同的数字身份联系到了一起，我觉得这是一个挺有趣的事情，于是我在 KeyBase 之外也自己创建了一个 GPG 主页，并在上面列出了一些和其他数字身份的交叉证明，例如邮件、V2EX 帐号等。我还注册了一个我的 GPG 公钥后八位的域名来指向这个页面：<a target="_blank" rel="noopener" href="http://e466cf1e.pub/">http://E466CF1E.pub</a></p>
<h2 id="端到端加密"><a href="#端到端加密" class="headerlink" title="端到端加密"></a>端到端加密</h2><p>我们再来转向这篇文章的第二个话题「端到端加密」，下图中分别展示了在无加密、SSL 加密和端到端加密的场景下，从 A 到 B、中间经过服务器的一次通讯的过程：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/end-to-end.png"></p>
<p>在没有加密的情况下，消息从 A 到服务器、再到 B 的全程都没有加密。这也意味着数据经过的链路上的任何一个节点（例如运营商的路由器）都可以查看和修改消息的内容，这种情况下的通讯安全是完全没有保证的。</p>
<p>在经过 SSL 加密的情况下，A 和 B 会分别在收发消息前通过 CA 签署的证书去认证服务器的身份，并协商一个用于加密数据的密钥。在从 A 到服务器，或从服务器到 B 的过程中，SSL 会保证数据不被窃听和篡改，但消息在服务器上则是以未加密的形态存在的，服务器可以查看和修改消息的内容，进行一些内容上的审查。</p>
<p>在端到端加密的情况下，消息在从 A 发出之前，就会利用我们前面介绍过的公钥加密技术，使用 B 的公钥进行加密，中间以加密的形式经过服务器和其他路由节点，直到 B 收到消息后，才使用自己的私钥进行解密。这种情况下的服务器并不能查看和修改消息，仅仅作为一个渠道来转发消息。</p>
<p>我们当然可以简单地使用 GPG 加密我们在第三方即时通讯软件上的聊天内容，就像下面这样：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/e2ee-bearychat.png"></p>
<p>但实际上例如 Tox、Line、WhatsApp、iMessage 等 IM 软件，都是默认提供了端到端加密的特性的，我们下面以 iMessage 为例去介绍一个 IM 软件是如何完成端到端加密通讯的。</p>
<p>iMessage 会在每台设备上生成一个 RSA 密钥对用于对数据进行加密，以及一个 ECDSA 密钥对用作签名（它出于安全性和性能的考虑使用了不同的密钥对，但其实是可以用同一个密钥对的）。这些密钥对中的公钥会被上传到 Apple IDS（Identity Services），然后其他用户会从 IDS 中取得你的所有公钥（每个设备一个公钥）。在 iMessage 中发出的所有文字消息都会使用自己的 ECDSA 私钥进行签名，使用对方的每个设备的 RSA 公钥加密一份，通过 APNs 发送给对方。对于多媒体消息，为了减少加密带来的开销，以及加密多份的流量开销，会使用一个临时密钥加密一次，通过 iCloud 进行传输，然后通过前面提到的方式发送临时密钥。苹果的很多应用都使用类似的方式进行端到端加密，包括 iCloud、Facetime、Keychain 等。</p>
<p>但在这个架构中，Apple IDS 依然是一个中心化的单点，它控制了全部的公钥交换过程，而且不允许用户干预。这就意味着 Apple 依然可以在 IDS 上进行中间人攻击，这也印证了我们在一开始提到的，公钥的交换是一个无法绕开的问题。在 GPG 中，用户需要繁琐地完全手动地去建立信任关系，换取了最高的去中心化程度；而在 iMessage 中 IDS 代劳了公钥交换的工作，方便了用户，但也引入了安全风险。</p>
<p>同时群聊也是一个比较难以解决的问题，在 Telegram 中群聊是无法开启端到端加密模式的，在 iMessage 中群聊也不总是可以使用端到端加密。这是因为就像前面提到的多设备的情况一样，在群聊的情况下我们必须用每个人的公钥来加密数据，这样数据在发送端就会膨胀许多倍（而不能发送端只发送一份，由服务器转发），具体的带宽开销会取决于群聊中的人数：</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2017/e2ee-group-chat.png"></p>
<h2 id="保管密钥"><a href="#保管密钥" class="headerlink" title="保管密钥"></a>保管密钥</h2><p>前面我们提到，在密码学账户中，你拥有一个账户的唯一凭证就是你的密钥对，一旦遗失，那么你便没有办法再去控制这个账户；或者一旦泄漏，其他人便拥有和你一样的控制这个账户的能力，无法重置，因此对密钥的保管显得尤为重要。</p>
<p>「备份」是具有两面性的 —— 一方面会让密钥更不容易丢失，但也让密钥变得更加容易泄漏。于是我就有个有趣的想法：能否做到将一个密钥分为若干「片段」保存，仅当拥有其中大部分片段的的时候才能够还原出密钥，但丢失了小部分片段又不影响还原呢？比如将密钥分为 5 份，仅当拥有其中任意三份的情况下可以还原出密钥。于是我找到了一个叫「Shamir’s Secret Sharing」的算法来做到这一点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~&gt; ssss-split -t 3 -n 5</span><br><span class="line">Generating shares using a (3,5) scheme with dynamic security level.</span><br><span class="line">Enter the secret, at most 128 ASCII characters: my secret root password</span><br><span class="line">Using a 184 bit security level.</span><br><span class="line">1-1c41ef496eccfbeba439714085df8437236298da8dd824</span><br><span class="line">2-fbc74a03a50e14ab406c225afb5f45c40ae11976d2b665</span><br><span class="line">3-fa1c3a9c6df8af0779c36de6c33f6e36e989d0e0b91309</span><br><span class="line">4-468de7d6eb36674c9cf008c8e8fc8c566537ad6301eb9e</span><br><span class="line">5-4756974923c0dce0a55f4774d09ca7a4865f64f56a4ee0</span><br><span class="line"></span><br><span class="line">~&gt; ssss-combine -t 3</span><br><span class="line">Enter 3 shares separated by newlines:</span><br><span class="line">Share [1/3]: 3-fa1c3a9c6df8af0779c36de6c33f6e36e989d0e0b91309</span><br><span class="line">Share [2/3]: 5-4756974923c0dce0a55f4774d09ca7a4865f64f56a4ee0</span><br><span class="line">Share [3/3]: 2-fbc74a03a50e14ab406c225afb5f45c40ae11976d2b665</span><br><span class="line">Resulting secret: my secret root password</span><br></pre></td></tr></table></figure>

<p>但将密钥作为一个文件，尤其是未加密的文件存储在电脑上仍然还是相当不安全的，因为你的电脑上安装了太多乱七八糟的软件了，目前大多数桌面操作系统其实都没有很好的权限控制 —— 几乎所有软件都可以随意地读取你所有的文件。因此 <strong>存储在硬盘上的文件是早晚要泄漏的</strong>，我们应该把密钥存储到一个无法被读取的地方，这就是我们下面要介绍的 TPM 芯片。</p>
<p><img src="https://r2-lc-cn.jysperm.me/thirdparty/gpg-yubikey.jpg"></p>
<p>作为一个芯片来讲，外界必须通过已经被硬件定义好的协议去操作它，而对于 TPM 来讲，它在硬件的设计上就不允许你从芯片中取出私钥，你只能将私钥存进去，或者在 TPM 上生成密钥对。之后和私钥有关的所有运算，包括解密和签名都是在 TPM 芯片上进行的，整个过程中密钥都不会离开 TPM 芯片，即使作为硬件的 TPM 芯片被盗，他人也无法复制芯片中的私钥。</p>
<p>TPM 其实存在与很多笔记本和手机中，iPhone 的存储芯片和指纹识别都是依赖于 TPM 工作的。我目前在使用是的一款叫 Yubikey 的 USB TPM 芯片，它支持 GPG SmartCard 的标准，可以将 GPG 的密钥存储在其中。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>GPG 可以在互联网上，以数学为基础创造一个无法被伪造的身份，并以此身份签名信息、接收加密信息。</li>
<li>GPG 使用去中心化的信任模型，需要自行通过多种渠道来交换公钥，因此不会受制于单一的权威机构。</li>
<li>GPG 提供了身份管理和相互进行「信任签名」的机制来简化密钥的交换过程。</li>
<li>GPG 是一个开放的标准（兼容很多软件和硬件），有着活跃的社区，提供了相对易用的工具来进行公钥加密、解密、签名、验签。</li>
<li>基于公钥加密并签名的端到端加密是从理论上保证通讯安全的唯一方法，但在此之前你需要通过某种方式来交换公钥。</li>
<li>如果私钥丢失就只能改头换面、重新做人了。</li>
</ul>
<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dusted.codes/the-beauty-of-asymmetric-encryption-rsa-crash-course-for-developers">The beauty of asymmetric encryption - RSA crash course for developers</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Comparison_of_instant_messaging_clients#Secure_messengers">Wikipedia: Comparison of instant messaging clients#Secure messengers</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cryptnet.net/fdp/crypto/keysigning_party/en/keysigning_party.html">The Keysigning Party HOWTO</a>（<a target="_blank" rel="noopener" href="https://web.archive.org/web/20070210014944/http://www.cryptnet.net/fdp/crypto/gpg-party/gpg-party.zh-TW.html.euc-tw">繁体中文</a>）</li>
<li><a target="_blank" rel="noopener" href="https://www.apple.com/cn/business/docs/iOS_Security_Guide.pdf">iOS Security Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">Wikipedia: Shamir’s Secret Sharing</a> <a target="_blank" rel="noopener" href="http://point-at-infinity.org/ssss/">一个开源实现：ssss</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/09/09/2017/09/lua-in-nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/2017/09/lua-in-nginx/" itemprop="url">Lua在Nginx的应用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-09T21:25:59+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/Lua/" itemprop="url" rel="index">
                    <span itemprop="name">Lua</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>当 Nginx 标准模块和配置不能灵活地适应系统要求时，就可以考虑使用 Lua 扩展和定制 Nginx 服务。<a target="_blank" rel="noopener" href="http://openresty.org/en/">OpenResty</a> 集成了大量精良的 Lua 库、第三方模块，可以方便地搭建能够处理超高并发、扩展性极高的 Web 服务，所以这里选择 OpenResty 提供的 <a target="_blank" rel="noopener" href="https://github.com/openresty/lua-nginx-module">lua-nginx-module</a> 方案。</p>
<p><img src="//www.fanhaobai.com/2017/09/lua-in-nginx/63113174-45d7-4a27-8472-d037675c2cbd.jpg">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/09/2017/09/lua-in-nginx/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/speaking-alicante-frontend">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/speaking-alicante-frontend" itemprop="url">Speaking at Alicante Frontend</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-09T08:00:00+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          I have presented a talk at Alicante Frontend, a meetup about web development in Spain.
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/speaking-alicante-frontend">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/37/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><span class="page-number current">38</span><a class="page-number" href="/page/39/">39</a><span class="space">&hellip;</span><a class="page-number" href="/page/73/">73</a><a class="extend next" rel="next" href="/page/39/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1451</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">914</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5358884258"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
