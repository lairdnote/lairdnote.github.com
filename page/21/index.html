<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/21/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/21/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/09/08/2020/airpods-2-are-great/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/08/2020/airpods-2-are-great/" itemprop="url">AirPods 2 到手半个月，我的实际体验如何？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-08T19:51:00+08:00">
                2020-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>先说好，这不是安利文：我没有推荐任何人购买 AirPods 2 的意思。</p>
<p>这篇文章仅旨在向各位分享我入手 AirPods 2 后的<strong>真实使用体验</strong>，有吐槽也有真香。</p>
<p>数码圈有个很奇怪的现象，总有那么些人抢着当「厂商孝子」「精神股东」，批评一句产品好像要了他们的命似的（更好笑的是还会互相扣帽子），对此我实在是难以理解。反正我对数码产品的态度一直都是：喜欢就买，开心就好。</p>
<p>如果你恰巧在考虑是否要入手 AirPods 2，希望这篇文章能对你有所帮助。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/09/08/2020/airpods-2-are-great/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/09/08/2020/dont-buy-a-gaming-laptop-for-college/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/08/2020/dont-buy-a-gaming-laptop-for-college/" itemprop="url">上大学买游戏本，你可能会后悔</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-08T03:50:00+08:00">
                2020-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>如果让我回到两年前，我肯定会告诉当时的自己：不要买游戏本。</p>
<p>好吧我知道，现在都九月份了，准大学生们电脑估计早就到手了，我这里啰嗦几句也没用。虽然估计也没人看，不过就当给以后的同学做个参考吧。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/09/08/2020/dont-buy-a-gaming-laptop-for-college/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/09/05/Dapper.Contrib%E5%9C%A8Oracle%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%95%E5%8F%91ORA-00928%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/05/Dapper.Contrib%E5%9C%A8Oracle%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%95%E5%8F%91ORA-00928%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/" itemprop="url">Dapper.Contrib 在 Oracle 环境下引发 ORA-00928 异常问题的解决</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-05T14:28:20+08:00">
                2020-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">数据存储</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>话说最近这两周里，被迫官宣<strong>996</strong>的生活实在是无趣，在两周时间里安排三周的工作量，倘若用丞相的口吻来说，那便是: <strong>我从未见过有如此厚颜无耻之人</strong>。无法为工作的紧急程度排出优先级，这便是身为肉食者们的<strong>鄙</strong>。古人云：<strong>肉食者鄙，未能远谋</strong>，诚不欺我也。一味地追求快速迭代，“屎”山越滚越高没有人在乎；一味地追求功能叠加，技术债务越来越多没有人在乎。所以，本着“多一事不如少一事”的原则，直接通过 Dapper 写 SQL 语句一样没有问题，因为被压榨完以后的时间只能写这个。在今天的这篇博客里，我想和大家分享的是，<code>Dapper.Contrib</code>在操作 Oracle 数据库时引发 <strong>ORA-00928: 缺失 SELECT 关键字</strong> 这一错误背后的根本原因，以及 Dapper 作为一个轻量级 ORM 在设计上做出的取舍。</p>
<h1 id="问题回顾"><a href="#问题回顾" class="headerlink" title="问题回顾"></a>问题回顾</h1><p>在使用 <code>Dapper.Contrib</code> 操作 Oracle 数据库的时候，通过 Insert() 方法来插入一个实体对象，此时，会引发 <strong>ORA-00928: 缺失 SELECT 关键字</strong> 这种典型的 Oracle 数据库错误，对于经常使用 Dapper 的博主而言，对于 <code>@</code> 还是 <code>:</code> 这种无聊的语法还是有一点经验的，在尝试手写 SQL 语句后，发现使用 Dapper 提供的 <code>Execute()</code> 扩展方法一点问题都没有，初步判定应该是 <code>Dapper.Contrib</code> 这个扩展库的问题，在翻阅 <code>Dapper</code> 的源代码以后，终于找到了问题的根源所在，所以，下面请跟随博主的目光，来一起解读解读 <code>Dapper.Contrib</code> 这个扩展库，相信你看完以后就会明白，为什么这里会被 Oracle 数据库摆上一道，以及为什么它至今都不考虑合并 Oracle 数据库相关的 PR。</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>众所周知，<code>Dapper</code> 的核心其实就是一个 SqlMapper ，它提供的 Query() 和 Execute() 接口本身都是附加在 <code>IDbConnection</code> 接口上的扩展方法，所以，最基础的 <code>Dapper</code> 用法其实是伴随着 SQL 语句和以匿名对象为主的参数化查询，这可以说是 Dapper 的核心，而 <code>Dapper.Contrib</code> 在这个基础上提供了 Get()、Insert()、Delete() 和 Update() 等等常见的 CRUD 方法，这些方法都针对的是单主键的表，让 <code>Dapper</code>有了一点 ORM 的感觉，可惜的是 <code>Dapper.Contrib</code> 的实现是不完整的，主要是指下面两个方面，即：第一，官方未能提供 Oracle 版本的 <code>ISqlAdapter</code>。第二，兼容不同数据库自增 ID 的实现，让官方在处理 Id 的参数化查询时束手束脚，对 <code>ISqlAdapter</code> 的设计并不全面。</p>
<h2 id="Oracle-版本的-ISqlAdapter"><a href="#Oracle-版本的-ISqlAdapter" class="headerlink" title="Oracle 版本的 ISqlAdapter"></a>Oracle 版本的 ISqlAdapter</h2><p>首先，第一个结论，<code>Dapper.Contrib</code> 没有实现 Oracle 版本的 <code>ISqlAdapter</code> 。关于这个接口，我们可以在 <code>SqlMapperExtensions</code> 这个类中找到定义，而 <code>Dapper.Contrib</code> 内部实际上是维护了一个字典 <code>AdapterDictionary</code> ，在 <code>SqlMapperExtensions.cs</code> 文件的第 62 行 ~ 第 73 行，我们可以注意到，其内部提供了 6 种 <code>ISqlAdapter</code> 的实现，且默认为 <code>SqlServerAdapter</code> ：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> ISqlAdapter DefaultAdapter = <span class="keyword">new</span> SqlServerAdapter();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Dictionary&lt;<span class="built_in">string</span>, ISqlAdapter&gt; AdapterDictionary</span><br><span class="line">    = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, ISqlAdapter&gt;(<span class="number">6</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          [<span class="string">&quot;sqlconnection&quot;</span>] = <span class="keyword">new</span> SqlServerAdapter(),</span><br><span class="line">          [<span class="string">&quot;sqlceconnection&quot;</span>] = <span class="keyword">new</span> SqlCeServerAdapter(),</span><br><span class="line">          [<span class="string">&quot;npgsqlconnection&quot;</span>] = <span class="keyword">new</span> PostgresAdapter(),</span><br><span class="line">          [<span class="string">&quot;sqliteconnection&quot;</span>] = <span class="keyword">new</span> SQLiteAdapter(),</span><br><span class="line">          [<span class="string">&quot;mysqlconnection&quot;</span>] = <span class="keyword">new</span> MySqlAdapter(),</span><br><span class="line">          [<span class="string">&quot;fbconnection&quot;</span>] = <span class="keyword">new</span> FbAdapter()</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>一个自然而然的问题是，这个 <code>ISqlAdapter</code> 接口是做什么的呢？为什么说 <code>Dapper.Contrib</code> 没有实现 Oracle 版本的 ISqlAdapter 呢？如果我们看一下 <code>ISqlAdapter</code> 的定义，就可以了解到其作用是告诉 Dapper ，应该怎么样处理数据库里的自增 ID、怎么样表示 <code>Column = Value</code> 这样的结构，以及怎么样处理列名：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">interface</span> <span class="title">ISqlAdapter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">Insert</span>(<span class="params">IDbConnection connection, IDbTransaction transaction, </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">int</span>? commandTimeout, <span class="built_in">string</span> tableName, <span class="built_in">string</span> columnList, </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">string</span> parameterList, IEnumerable&lt;PropertyInfo&gt; keyProperties, </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">object</span> entityToInsert</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AppendColumnName</span>(<span class="params">StringBuilder sb, <span class="built_in">string</span> columnName</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AppendColumnNameEqualsValue</span>(<span class="params">StringBuilder sb, <span class="built_in">string</span> columnName</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里以 <code>MySqlAdapter</code> 的实现为例：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MySqlAdapter</span> : <span class="title">ISqlAdapter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Insert</span>(<span class="params">IDbConnection connection, IDbTransaction transaction, </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">int</span>? commandTimeout, <span class="built_in">string</span> tableName, <span class="built_in">string</span> columnList, </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">string</span> parameterList, IEnumerable&lt;PropertyInfo&gt; keyProperties, </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">object</span> entityToInsert</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> cmd = <span class="string">$&quot;insert into <span class="subst">&#123;tableName&#125;</span> (<span class="subst">&#123;columnList&#125;</span>) values (<span class="subst">&#123;parameterList&#125;</span>)&quot;</span>;</span><br><span class="line">        connection.Execute(cmd, entityToInsert, transaction, commandTimeout);</span><br><span class="line">        <span class="keyword">var</span> r = connection.Query(<span class="string">&quot;Select LAST_INSERT_ID() id&quot;</span>, transaction: transaction, commandTimeout: commandTimeout);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> id = r.First().id;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> propertyInfos = keyProperties <span class="keyword">as</span> PropertyInfo[] ?? keyProperties.ToArray();</span><br><span class="line">        <span class="keyword">if</span> (propertyInfos.Length == <span class="number">0</span>) <span class="keyword">return</span> Convert.ToInt32(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> idp = propertyInfos[<span class="number">0</span>];</span><br><span class="line">        idp.SetValue(entityToInsert, Convert.ChangeType(id, idp.PropertyType), <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Convert.ToInt32(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AppendColumnName</span>(<span class="params">StringBuilder sb, <span class="built_in">string</span> columnName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        sb.AppendFormat(<span class="string">&quot;`&#123;0&#125;`&quot;</span>, columnName);</span><br><span class="line">    ｝</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AppendColumnNameEqualsValue</span>(<span class="params">StringBuilder sb, <span class="built_in">string</span> columnName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        sb.AppendFormat(<span class="string">&quot;`&#123;0&#125;` = @&#123;1&#125;&quot;</span>, columnName, columnName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相信看到这里的时候，大家会和我一样感到失望，因为 Dapper 的底层依然是在拼 SQL ，尤其是看到 <code>AppendColumnNameEqualsValue()</code> 这个方法的时候，会有一种恍然大明白的感觉，因为 @ 这个符号对于 Dapper 的参数化查询而言，实在是熟悉得不能再熟悉了。我们都知道为 Dapper 写 SQL 语句的时候，要对 Oracle 区别对待，因为这个奇葩非要用 <code>:</code> 这个奇怪的符号。回到我们一开始的问题，为啥 <code>Dapper.Contrib</code> 在 Oracle 环境下会提示 <code>ORA-XXXXX</code> 这种鬼都看不明白的错误，因为它在处理 SQL 的语句的时候依然使用的是 <code>@</code> 这个符号。这又是为什么呢？因为当指定的 <code>IDbConnection</code> 在 <code>AdapterDictionary</code> 中不存在的时候，它会使用默认的 <code>SqlServerAdapter</code> ，显然，全世界只有 Oracle 这个奇葩会用 <code>:</code> 这个奇怪的符号。我们不是在调用 Insert() 方法的时候提示这个错误吗？那么 <code>Dapper.Contrib</code> 是怎么实现 <code>Insert()</code> 方法的呢？这个部分实现主要在第 352 行 ~ 第 360 行：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> adapter = GetFormatter(connection);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; allPropertiesExceptKeyAndComputed.Count; i++)</span><br><span class="line"> &#123;</span><br><span class="line">    <span class="keyword">var</span> property = allPropertiesExceptKeyAndComputed[i];</span><br><span class="line">    adapter.AppendColumnName(sbColumnList, property.Name);  <span class="comment">//fix for issue #336</span></span><br><span class="line">    <span class="keyword">if</span> (i &lt; allPropertiesExceptKeyAndComputed.Count - <span class="number">1</span>)</span><br><span class="line">       sbColumnList.Append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>显然，这部分是按照属性名去组织 <code>columnList</code> 和 <code>parameterList</code> 的过程，对于 Oracle ，永远是充满吐槽的，比如不加双引号则强制大写的设定，这意味着如果你的表名或者字段名是区分大小写的话，在 Oracle 这里都要加上双引号，这对 <code>Dapper.Contrib</code> 有什么影响呢？原本我们只需要给实体添加<code>[Table]</code>标签即可，而现在你不得不考虑带上反斜杠转义，甚至当你需要为 <code>DBeaver</code> 下载一个 JDBC 的驱动的时候，甲骨文这家公司居然要强制你去注册，对于一个习惯像<code>·.NET Core</code>、<code>GCC</code>、<code>Python</code>、<code>Lua</code> 和 <code>Node</code> 这样开箱即用的人来说，这就像强迫你注册一大堆真实信息，然后发现 API 接口完全无法匹配你的需求一样痛苦。关于 <code>GetFormatter()</code> 方法，它和我们猜想的完全一致：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ISqlAdapter <span class="title">GetFormatter</span>(<span class="params">IDbConnection connection</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">var</span> name = GetDatabaseType?.Invoke(connection).ToLower() ?? connection.GetType().Name.ToLower();</span><br><span class="line">   <span class="keyword">return</span> AdapterDictionary.TryGetValue(name, <span class="keyword">out</span> <span class="keyword">var</span> adapter) ? adapter : DefaultAdapter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好了，在明白了以上种种因果关系以后，我们现在来考虑如何解决 Oracle 的问题。按照人类最直观的思维，既然它没有实现 Oracle 版本的 <code>ISqlAdapter</code> ，我自己实现一个不就好啦：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OracleSqlAdapter</span> : <span class="title">ISqlAdapter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AppendColumnName</span>(<span class="params">StringBuilder sb, <span class="built_in">string</span> columnName</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">        sb.AppendFormat(<span class="string">&quot;&#123;0&#125;&quot;</span>, columnName);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AppendColumnNameEqualsValue</span>(<span class="params">StringBuilder sb, <span class="built_in">string</span> columnName</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">        sb.AppendFormat(<span class="string">&quot;&#123;0&#125; = :&#123;1&#125;&quot;</span>, columnName, columnName);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Insert</span>(<span class="params">IDbConnection connection, IDbTransaction transaction, <span class="built_in">int</span>? commandTimeout, <span class="built_in">string</span> tableName, </span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="built_in">string</span> columnList, <span class="built_in">string</span> parameterList, IEnumerable&lt;PropertyInfo&gt; keyProperties, <span class="built_in">object</span> entityToInsert</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">        <span class="keyword">var</span> sql = <span class="string">$&quot;insert into <span class="subst">&#123;tableName&#125;</span> (<span class="subst">&#123;columnList&#125;</span>) values (<span class="subst">&#123;parameterList&#125;</span>)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> connection.Execute(sql, entityToInsert, transaction, commandTimeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">InsertAsync</span>(<span class="params">IDbConnection connection, IDbTransaction transaction, <span class="built_in">int</span>? commandTimeout, <span class="built_in">string</span> tableName, </span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="built_in">string</span> columnList, <span class="built_in">string</span> parameterList, IEnumerable&lt;PropertyInfo&gt; keyProperties, <span class="built_in">object</span> entityToInsert</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">         <span class="keyword">var</span> sql = <span class="string">$&quot;insert into <span class="subst">&#123;tableName&#125;</span> (<span class="subst">&#123;columnList&#125;</span>) values (<span class="subst">&#123;parameterList&#125;</span>)&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> connection.ExecuteAsync(sql, entityToInsert, transaction, commandTimeout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>坦白说， <code>Dapper.Contrib</code> 这种纯静态类的设计，完全就不给别人留扩展的口子，为此，扩展方法 + 反射搞一个突破口：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">SqlAdapterrExtensions</span></span><br><span class="line"> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UseSqlAdapter</span>&lt;<span class="title">TSqlAdapter</span>&gt;(<span class="params"><span class="keyword">this</span> IDbConnection connection, TSqlAdapter sqlAdapter</span>)</span></span><br><span class="line"><span class="function">        <span class="keyword">where</span> TSqlAdapter : ISqlAdapter, <span class="keyword">new</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> adapters = (Dictionary&lt;<span class="built_in">string</span>, ISqlAdapter&gt;)</span><br><span class="line">            <span class="keyword">typeof</span>(SqlMapperExtensions)</span><br><span class="line">            .GetField(<span class="string">&quot;AdapterDictionary&quot;</span>, BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.Static)</span><br><span class="line">            ?.GetValue(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> connectionType = connection.GetType().Name.ToLower();</span><br><span class="line">        <span class="keyword">if</span> (adapters != <span class="literal">null</span> &amp;&amp; !adapters.ContainsKey(connectionType))</span><br><span class="line">            adapters?.Add(connectionType, sqlAdapter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们不但可以满足眼下，还可以着眼未来，虽然未来有时候挺遥远，但梦想还是要有的，开闭原则，我做到了！改进后，我们这样处理即可：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">connection = <span class="keyword">new</span> OracleConnection(ConnectionStrings.Default);</span><br><span class="line">connection.UseSqlAdapter(<span class="keyword">new</span> OracleSqlAdapter());</span><br></pre></td></tr></table></figure>

<p>此时，我们发现，我们解决了 Insert() 的问题，但随之而来的，Get()、Delete()、Update() 这一系列和主键相关的方法，都因为 <code>Dapper.Contrib</code> 中的主键设计而出现了问题，而这就是我们接下来要讲的主键 Id 参数化问题。</p>
<h2 id="主键-Id-参数化问题"><a href="#主键-Id-参数化问题" class="headerlink" title="主键 Id 参数化问题"></a>主键 Id 参数化问题</h2><p>当我谈起这个问题的时候，我对于 <code>Dapper.Contrib</code> 中支持自增 ID 的坚持是怀疑的，因为在分布式盛行的今天，有大量的分布式 ID 生成方案供我们选择，比如基于 <code>Redis</code> 的号段策略，基于雪花算法的 ID 生成等等。大家会注意到我实现的 OracleSqlAdapter 在实现 Insert() 方法的时候简化了大量代码，这是因为我真的不知道，怎么从 Oracle 中获取一个新生成的 ID，尤其是这个 ID 居然还要依赖一个我听都没有听说过的“序列”，而之所以要在 ISqlAdapter 中实现 Insert() 方法，最根本的原因就是，各个数据库对于自增 ID 的实现是不一样的，比如 MySQL 中使用的是 <code>SCOPE_IDENTITY()</code>，而 MSSQL 中使用的则是 <code>SCOPE_IDENTITY()</code> ，就因为这一点点差异，我们就必须要去折腾一遍，可以说， Dapper.Contrib 不支持 Oracle 的一个重要原因，就是在 Oracle 下实现自增 ID 太麻烦了。</p>
<p>既然大家都不用自增 ID 了，为什么还要在一个通用的 ORM 里折腾这个呢？说实话，我真担心有一天自增 ID 会溢出，谁让每个数据库里的上限都不一样呢？另一方面，既然 Id 在每个数据库的实现都不一样，那么，作为 Id 本身应该考虑放到 <code>ISqlAdapter</code> 接口中由使用者来实现啊，可偏偏 ISqlAdapter 里只定义了一个 Insert() 方法，所以，就算我们实现了 OracleSqlAdapter ，一样无法解决 Insert() 方法以外的其它方法在 Oracle 下面的问题，正因为如此，默认的 @ 符号在 Oracle 环境下下没有被完全替换掉，这就需要修改 Dapper.Contrib 的底层代码，这真的是一个不好的设计，因为使用者完全没有办法通过重写来覆盖某些默认行为，我们一起来看看，需要修改哪些地方：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T <span class="title">Get</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> IDbConnection connection, <span class="built_in">dynamic</span> id, </span></span></span><br><span class="line"><span class="params"><span class="function">IDbTransaction transaction = <span class="literal">null</span>, <span class="built_in">int</span>? commandTimeout = <span class="literal">null</span></span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> type = <span class="keyword">typeof</span>(T);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!GetQueries.TryGetValue(type.TypeHandle, <span class="keyword">out</span> <span class="built_in">string</span> sql))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> key = GetSingleKey&lt;T&gt;(<span class="keyword">nameof</span>(Get));</span><br><span class="line">        <span class="keyword">var</span> name = GetTableName(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第一个坏事儿的地方，为什么不用AppendColumnName()方法?</span></span><br><span class="line">        sql = <span class="string">$&quot;select * from <span class="subst">&#123;name&#125;</span> where <span class="subst">&#123;key.Name&#125;</span> = @id&quot;</span>;</span><br><span class="line">        GetQueries[type.TypeHandle] = sql;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dynParams = <span class="keyword">new</span> DynamicParameters();</span><br><span class="line">    <span class="comment">//第二个坏事的地方，什么不用AppendColumnName()方法??</span></span><br><span class="line">    dynParams.Add(<span class="string">&quot;@id&quot;</span>, id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//以下代码已省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">long</span> <span class="title">Insert</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> IDbConnection connection, T entityToInsert,</span></span></span><br><span class="line"><span class="params"><span class="function">IDbTransaction transaction = <span class="literal">null</span>, <span class="built_in">int</span>? commandTimeout = <span class="literal">null</span></span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//以上代码已省略</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sbParameterList = <span class="keyword">new</span> StringBuilder(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; allPropertiesExceptKeyAndComputed.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//第三个坏事的地方，什么不用AppendColumnName()方法???</span></span><br><span class="line">        <span class="keyword">var</span> property = allPropertiesExceptKeyAndComputed[i];</span><br><span class="line">        sbParameterList.AppendFormat(<span class="string">&quot;@&#123;0&#125;&quot;</span>, property.Name);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; allPropertiesExceptKeyAndComputed.Count - <span class="number">1</span>)</span><br><span class="line">            sbParameterList.Append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//以下代码已省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实，仔细阅读 Update() 和 Delete() 两个方法的实现，就会发现它们都非常完美地避开了这一点，就是不知道为什么只有两个方法采用了不同地方式去拼接 SQL ，当然，这里我们会意识到有个列名的问题，尤其是在需要区分大小写的情况下，为此，我们可能需要去定义一个 ColumnAttribute，还能说什么呢？请和我大声地吐槽：<strong>垃圾 Oracle ！</strong>你看，就为了这一点点差异，我们不得不去额外写一点代码，所以，喊了很多年的去 IOE，我表示举双手赞成。</p>
<p>事实上，社区里已经有类似的PR，可因为改动的范围比较大，官方至今都没有考虑过将其合并到主干分支上，所以，这个问题一直没有解决，这是一个悲伤的故事。</p>
<h1 id="相关思考"><a href="#相关思考" class="headerlink" title="相关思考"></a>相关思考</h1><p>在阅读 Dapper 源码的同时，我查阅了一个和 Dapper.Contrib 类似的项目：DapperExtension，我发现这个项目目前处在“荒废”的状态，因为它遇到了相同的问题，即 SQL 这门看起来统一实则相当不统一的语言，因为每一个数据库厂商几乎都在给标准“添砖加瓦“，就以自增 ID 为例，MySQL、MSSQL、Oracle 居然是三种不同的实现方式，尤其是 Oracle 这个奇葩，居然还需要定义一个序列来解决这个问题，这个奇葩给数据库加注释都那么另类，这带来的问题是什么？Dapper.Contrib 无力去实现 Oracle 的自增 ID 而放弃了 Oracle ，所以，即使社区里提交了 PR，因为实现方式有点脏，官方一直没有合并到主干上去。</p>
<p>再回过头来看 Dapper.Contrib 支持自增 ID 的举动，总会觉得有点不合时宜，因为不同数据库自增 ID 的上限不一样不说，现在都普遍在分布式的环境中，数据库的自增 ID 其实是非常鸡肋的功能，而实际应用中常常会用 <code>Redis</code> 、雪花算法等来实现分布式 ID，所以，当你回顾历史发展的趋势的时候，就会感慨有标准化的东西该多好，并不是说这个世界不需要多样性，显然这是一个标准约束性不强的领域，看起来大家都实现了 SQL，无一例外地都夹藏了私货，对于商业行为而言，这无可厚非；可对于这个世界而言，这无疑增加了工作量。</p>
<p>有时候，当一个行业没有什么标准的时候，到底是突破勇气去率先制定标准，还是放弃自我去迎合各种不成文的规则，对于企业而言，是战略上的一种选择；而对于个人而言，其实是人生的一种选择。当彼时青春年少的人们，竞相以标新立异为荣的时候，如果想到有一天，终究要活成千篇一律的人生，为了生活而选择跪着的时候，内心又会有什么不一样的举动呢？</p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>本文分析了 Dapper.Contrib 这个扩展库，在搭配 Oracle 数据库使用时遇到 ORA-XXXXX 系列错误的原因及相应地处理方法，这个问题的表象是 Dapper.Contrib 没有实现 OracleSqlAdapter ，而更深层的原因，实际上是 Dapper.Contrib 选择支持自增 ID 而带来的 SQL 标准差异化问题。因为不同的数据库在实现自增 ID 时的机制不同，Oracle 甚至需要引入序列这个概念，这种差异化，增加了 Dapper 各个扩展库维护的工作量，这是官方一直不愿意实现 OracleSqlAdapter 的原因，其次， Dapper.Contrib 底层设计不合理，除了 Insert() 方法以外，其它依赖主键的方法都没有提供扩展接口，导致使用者只能通过修改底层代码的方式解决问题，这严重违反开闭原则。好了，这是一篇利用 996 闲暇(可能是指做梦)写的一篇博客，如果文章中有什么不周到的地方，欢迎大家在博客下面给我留言，谢谢，晚安！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/f05d518.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/f05d518.html" itemprop="url">八月总结</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-28T00:05:48+08:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="背单词"><a href="#背单词" class="headerlink" title="背单词"></a>背单词</h2><p><img src="https://i.loli.net/2020/08/28/OCf79JkXbP4vQUw.png" alt="image.png"></p>
<p>月初发现这个软件，发现比我之前使用过的所有背单词软件都好用，基于艾宾浩斯记忆曲线，我的方法是同时打开三个软件：</p>
<ul>
<li>List 背单词（上图软件</li>
<li>欧路词典（用来练发音</li>
<li>词根词缀字典（用来记词根，同时还有一个“不拘一格背单词”模块，有趣还方便记忆</li>
</ul>
<p>每天晚上抽一个小时，效果还是挺不错的，希望能继续坚持下去。</p>
<h2 id="手机换屏幕"><a href="#手机换屏幕" class="headerlink" title="手机换屏幕"></a>手机换屏幕</h2><h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>之前的小米 8 的屏幕摔坏了，然后换手机后就一直被闲置，最近老母亲提到她的手机电池不太稳定，就心想着自己动手把这台小米的屏幕换了给她用，之前还没有亲自换过屏幕，还是得自己动手折腾一波。</p>
<h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><p>之前就看过在官方换需要 740 元，觉得这台手机用了这么久了，不值得花这个钱来“续命”，而且对屏幕要求也不高，能用就行。所以在某宝上找了一个华强北的带框屏幕总成，跟着网上的视频教程一步一步换，结果在第一步（拆后壳）卡了近两个小时，差点把我整疯了。</p>
<p>期间还把开机排线扯断了，然后又在某宝上买了两条排线（备用），就这样等了一天才能继续更换。</p>
<p>最后更换完开机也是各种问题，比如因为音量键卡住导致开机进入 fastboot 界面，还有因为指纹模块没插好导致无法使用指纹。</p>
<p>解决上述问题后，还有一个问题无法解决，就是后壳无法完全贴合，据网上说是因为里面没放平，但觉得这个没什么大碍，反正平时也是戴手机壳，只要不重摔就没事。</p>
<h3 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h3><p>经过三天的折腾，总算是换好了，虽然最后各种问题，但不管怎么说也是尝试过，当然最重要一个原因也是因为这个手机本身并不贵重，就当练练手，否则我还是会选择送去维修店的，毕竟专业的事就应该交给专业的人做。</p>
<h2 id="RSS-阅读"><a href="#RSS-阅读" class="headerlink" title="RSS 阅读"></a>RSS 阅读</h2><p>今年最大一个改变，就是开始习惯 RSS 阅读，这大大减少我需要在不同平台切换的繁琐，改用 RSS 订阅后，能自由订阅自己感兴趣的内容，不受算法推荐的影响，且对各大平台的文章拥有一致的阅读体验。</p>
<h3 id="阅读器"><a href="#阅读器" class="headerlink" title="阅读器"></a>阅读器</h3><p>首先是要找一个用得舒服的 RSS 阅读器，我在前几个月都一直在使用 RSS Reader Prime，这个阅读器的优点是：配色好看，阅读体验很好、支持搜索以前阅读过的文章。</p>
<p>但是后来随着我对 RSS 的需求越来越大，经常需要在不同设备间同步订阅源和阅读历史，虽然该软件自带有 iCloud 同步，但是挺捉急的，经常出现无法同步的问题，于是前段时间趁 Reeder 4 限免，赶紧在三个设备中安装，然后开始我的 RSS 折腾之旅。</p>
<h3 id="云服务"><a href="#云服务" class="headerlink" title="云服务"></a>云服务</h3><p>首先 Reeder 支持使用第三方账号登录，如 Feedly、Inoreader 等，但是我尝试过这两者的服务，总觉得有订阅源限制，赶紧不太舒服，且我现在已经订阅超过 100 个 RSS 源，于是在 <a target="_blank" rel="noopener" href="https://diygod.me/ohmyrss/">我有特别的 RSS 使用技巧</a> 这篇文章的安利中，我也自己搭了一个 <a target="_blank" rel="noopener" href="https://github.com/HenryQW/docker-ttrss-plugins">Tiny Tiny RSS</a>，从此不再担心有限制。</p>
<h3 id="定制订阅源"><a href="#定制订阅源" class="headerlink" title="定制订阅源"></a>定制订阅源</h3><p>自建 ttrss 后，就开始折腾如何订阅一些不支持 rss 的网站，那就不得不提 <a target="_blank" rel="noopener" href="https://docs.rsshub.app/">RSSHub</a> 这个开源项目了（与前面那篇文章是同一个作者），我自己 fork 了一份部署在自己的 vps 上，根据自己兴趣添加 RSS 订阅源，其实大部分个人博客都是支持 RSS 订阅的，主要是一些比较奇怪的需求，比如：全文输出内容、筛选分类等。</p>
<p>我还有一个想法，就是把一些英文订阅源的标题翻译成中文，毕竟英文还是比较烂，这样我就能快速寻找感兴趣的文章阅读，而不用一个一个细看，于是我找到一个可用的 google translate 库 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/google-translate-open-api">google-translate-open-api</a>，但在我的套路云上会超时，而在谷歌云则没问题，后来想想这样对我英文提升是无帮助的，所以也就放弃了。</p>
<p>即便 RSSHub 已经足够强大，但由于部署在国内的 vps 上，即便我设置了代理，也会出现无法访问部分需要科学上网的网站，这时候我会使用 <a target="_blank" rel="noopener" href="https://feed43.com/">Feed43</a> 定制这些源，虽然比较土，但也能凑合用。</p>
<h2 id="闯越自动签到"><a href="#闯越自动签到" class="headerlink" title="闯越自动签到"></a>闯越自动签到</h2><p>我们学校实习期需要每天在一个叫做 「闯越顶岗实习管理系统」 的软件上面写日志签到，个人对于这种繁琐且纯属应付的操作实在不能忍受，不过之前有个朋友做了个自动签到的脚本，我也就直接用他的，懒得重复造轮子。</p>
<p>最近突然想搞点业余项目，就估摸着在他的基础上做个更完善的自动签到系统，不仅限于学生自动签到，还打算做一个可以让教师快捷点评的操作，据我了解，教师在上面要逐一对学生的日志点评，操作要更加繁琐，。</p>
<p>而且根据该软件官网上描述，在广东省就有十几家合作技校，如果我做的这个系统能让大家节省这些时间，还是挺有成就感的。</p>
<p>初步想法是做一个 web 的管理后台 + 小程序用户端 ，后面根据实际用户量再考虑要不要做成 SASS 版。</p>
<p>目前基本核心签到功能已经实现，剩下的就是做成一个完整的系统，至于技术栈，尝试一下使用 nest.js + react 。</p>
<h2 id="八佰"><a href="#八佰" class="headerlink" title="八佰"></a>八佰</h2><p><a target="_blank" rel="noopener" href="https://4ark.me/posts/ba-bai-review.html">《八佰》读后感</a></p>
<h2 id="下月计划"><a href="#下月计划" class="headerlink" title="下月计划"></a>下月计划</h2><ol>
<li>微信公众号 RSS 订阅源</li>
<li>在语雀构建自己的知识库</li>
<li>读完《清醒思考的艺术》</li>
</ol>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/posts/ba-bai-review.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/ba-bai-review.html" itemprop="url">《八佰》观后感</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-28T00:03:45+08:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>这几天在很多社区网站都看到关于《八佰》的评论，趁着周末和女朋友去观看，也算了却她一直说今年因为疫情期间没有去看过电影的遗憾。</p>
<p>其实在之前有了解过这部电影，主要讲述的是 1937 年淞沪会战的最后一役，“八百壮士”奉命坚守上海四行仓库，以少敌多顽强抵抗四天四夜的这段真实历史事件。</p>
<p>因为总所周知的原因，这部电影从去年一直拖到今年才终于上映，最后不可避免地要做一些妥协，但是就上映后的剧情来说还是可以接受的，而且据网上资料所说，电影原本的龙标是 2019 第 88 号（八十八师），但是后来改为 2019 第 800 号（八百壮士），从这两个定制的龙标，能看出国家电影局确实是给了特别优待的。</p>
<p>暂时抛开历史，就电影本身的质量而言，我觉得可以给个 4 星，其中有很多场战斗戏，不乏一些血腥的画面，且整体剧情相对紧凑，战斗总是来得很突然，前一秒还是活生生的人，下一秒就倒下，能如此近距离观看战争的残酷，让我对今天能处在和平的年代感到幸运，也让某些整天想着开战的人看看，还是挺有教育意义的。</p>
<p>因为太关注剧情本身，我从头到尾并没有很关注哪个角色是谁扮演的，以至于后来我甚至没有发现那个特派员居然是黄晓明扮演的，其中也有一些我之前不太感兴趣的演员，但这部戏我认为是超出了他们之前的水平的。</p>
<p>近几年我国的抗日片，有一个通病，那就是故意丑化日本军人，而一味夸大自己，以此鼓吹民族主义。但这部电影并没有，影片中，一名记者去到日军营地时，看见日军戒备森严、言行律己，且对牺牲军人给予厚葬，说明日军的实力不容小觑，没有故意贬低敌人的拍摄方式很值得大家学习。这也凸显中国军方的英勇抗战和为胜利所付出的代价。</p>
<p>这部电影不是要激起民族主义，更不是让我们敌视日本这个国家，而是让我们不要忘记那段历史，从而更加珍惜现在和平的时代，那时候我们之所以被打得这么惨，除了跟日本实力悬殊之外，更多的是国人自己不团结，影片中有一幕给我很大冲击，当时日军正在攻楼，而国军自行组成敢死队高喊自己的家乡和名字，身绑手榴弹前仆后继跳楼与敌人同归于尽，当时对岸围观的人说的一句话：“国人皆如此，倭寇何敢？”。</p>
<p>影片结束时，谢晋元团长按照军队高层命令，率领剩余的“八百壮士”，冲过日军火力封锁的连向英租界的桥。影片到这里就结束了。实际上，后面冲过英租界的“八百壮士”结局更加悲凉，有兴趣可以自行搜寻。这里我想说的希望以后我们能正视我们的历史，更不要扭曲事实，敢于正视自身历史污点的民族，勇于承认错误，才是伟大的民族。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/08/15/NET-Core%E4%B8%AD%E5%AF%B9%E8%B1%A1%E6%B1%A0-Object-Pool-%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/15/NET-Core%E4%B8%AD%E5%AF%B9%E8%B1%A1%E6%B1%A0-Object-Pool-%E7%9A%84%E4%BD%BF%E7%94%A8/" itemprop="url">.NET Core 中对象池(Object Pool)的使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-15T16:37:23+08:00">
                2020-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>在此前的博客中，博主参考 <a target="_blank" rel="noopener" href="https://github.com/dotnet-architecture/eShopOnContainers">eShopOnContainers</a> 实现了一个基于 RabbitMQ 的事件总线(EventBus)。在这个项目中，它提供了一个持久化连接的类<code>DefaultRabbitMQPersistentConnection</code>，主要解决了 RabbitMQ 在连接断开后自动重连的问题，可实际上我们都知道，RabbitMQ 提供的连接数是有一个上限的，如果频繁地使用短连接的方式，即通过<code>ConnectionFactory</code>的<code>CreateConnection()</code>方法来创建一个连接，从本质上讲，一个<code>Connection</code>对象就是一个 TCP 连接，而<code>Channel</code>则是每个<code>Connection</code>对象下有限的虚拟连接，注意“有限”这个限定词，这意味着<code>Channel</code>和<code>Connection</code>一样，都不能毫无节制的创建下去。此时，官方推荐的做法有两种：(1)：一个<code>Connection</code>对应多个<code>Channel</code>同时保证每个<code>Channel</code>线程独占；(2)：创建一个<code>Connection</code>池同时定期清除无效连接。这里的第二种做法，显然就是我们今天要说的对象池(Object Pool)啦，我们将从这里拉开这篇博客的帷幕。</p>
<h1 id="什么是对象池"><a href="#什么是对象池" class="headerlink" title="什么是对象池"></a>什么是对象池</h1><p>首先，我们来回答第一个问题，什么是对象池？简单来说，它就是一种为对象提供可复用性能力的软件设计思路。俗话说<strong>“有借有还，再借不难”</strong>，而对象池就是通过“借”和“还”这样两个动作来保证对象可以被重复使用，进而节省频繁创建对象的性能开销。对象池在游戏设计中使用的更普遍一点，因为游戏中大量存在着像子弹、怪物等等这类可复用的对象，你在玩第一人称射击游戏(FPS)时，总是有源源不断的子弹或者丧尸出现，可事实上这不过是数字世界的循环再生，因为玩家的电脑内存始终都有一个上限。而在数据库的世界里，则存在着一个被称为“连接池”的东西，每当出现数据库无法连接的情况时，经验丰富的开发人员往往会先检查“连接池”是否满了，这其实就是对象池模式在特定领域的具体实现啦，所以，对象池本质上就是负责一组对象创建和销毁的容器，下面是一个基本的对象池示意图：</p>
<p><img src="https://i.loli.net/2020/08/22/lReo7LQa1SODZpc.png" alt="对象池示意图"></p>
<p>可以注意到， 对象池最大的优势就是可以自主地管理“池子”内的每个对象，决定它们是需要被回收还是可以重复使用。我们都知道，创建一个新的对象，需要消耗一定的系统资源，而一旦这些对象可以重复地使用，就能有效地节省系统资源的开销，这对于我们提高系统性能会非常有帮助。也许，现在计算机的硬件水平越来越好，可我们还是要重新拾起这个领域的基础知识，即数据结构、算法、数学和英语。如果你完全理解了对象池模式，你应该可以非常轻松地给出你的实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPool</span>&lt;<span class="title">T</span>&gt; : <span class="title">IObjectPool</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span> Func&lt;T&gt; _instanceFactory;</span><br><span class="line">  <span class="keyword">private</span> ConcurrentBag&lt;T&gt; _instanceItems;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ObjectPool</span>(<span class="params">Func&lt;T&gt; instanceFactory</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    _instanceFactory = instanceFactory ?? </span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(instanceFactory));</span><br><span class="line">    _instanceItems = <span class="keyword">new</span> ConcurrentBag&lt;T&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> T <span class="title">Get</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    T item;</span><br><span class="line">    <span class="keyword">if</span> (_instanceItems.TryTake(<span class="keyword">out</span> item)) <span class="keyword">return</span> item;</span><br><span class="line">    <span class="keyword">return</span> _instanceFactory();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Return</span>(<span class="params">T item</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    _instanceItems.Add(item);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：以上代码片段来自微软的一篇文档：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/standard/collections/thread-safe/how-to-create-an-object-pool">How to: Create an Object Pool by Using a ConcurrentBag</a>。实际上，除了<code>ConcurrentBag&lt;T&gt;</code>，我们可以选择的数据结构还可以是<code>Stack&lt;T&gt;</code>、<code>Queue&lt;T&gt;</code>以及<code>BlockingCollection&lt;T&gt;</code>，此中差别，大家可以自己去体会。</p>
<h1 id="NET-Core-中的对象池"><a href="#NET-Core-中的对象池" class="headerlink" title=".NET Core 中的对象池"></a>.NET Core 中的对象池</h1><p>在.NET Core 中，微软已经为我们提供了对象池的实现，即<code>Microsoft.Extensions.ObjectPool</code>。它主要提供了三个核心的组件，分别是<code>ObjectPool</code>、<code>ObjectPoolProvider</code>和<code>IPooledObjectPolicy</code>，关于这三者间的关系，我绘制了下面的 UML 图来作为说明：</p>
<p><img src="https://i.loli.net/2020/08/22/M6ojLtqgKc5pfCA.png" alt="ObjectPool核心组件及其关系"></p>
<p>可以注意到，<code>ObjectPool&lt;T&gt;</code>是一个抽象类，它对外提供了 Get()和 Return()两个方法，所谓的“有借有还”，这一点没什么可说的。接下来，<code>ObjectPoolProvider</code>同样是一个抽象类，它的职责就是创建<code>ObjectPool&lt;T&gt;</code>，所以，它提供了两个<code>Create&lt;T&gt;()</code>方法，两者的区别是，无参数版本本质上使用的是<code>DefaultPooledObjectPolicy&lt;T&gt;</code>。顾名思义，它同<code>DefaultObjectPool&lt;T&gt;</code>、<code>DefaultObjectPoolProvider</code>一样，都是微软提供的默认实现，其中<code>IPooledObjectPolicy&lt;T&gt;</code>可以为不同的对象池定义不同的策略，来决定对象如何“借”、是否可以“还”。默认的对象池<code>DefaultObjectPool&lt;T&gt;</code>内部使用<code>ObjectWrapper[]</code>这个数组来管理对象，数组的大小等于 maximumRetained - 1，因为它单独指定了首项，默认情况下，这个 maximumRetained 等于<code>Environment.ProcessorCount * 2</code>，这里主要用到了<code>Interlocked.CompareExchange()</code>方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> T <span class="title">Get</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> item = _firstItem;</span><br><span class="line">  <span class="keyword">if</span> (item == <span class="literal">null</span> || Interlocked.CompareExchange(<span class="keyword">ref</span> _firstItem, <span class="literal">null</span>, item) != item)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> items = _items;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; items.Length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      item = items[i].Element;</span><br><span class="line">      <span class="keyword">if</span> (item != <span class="literal">null</span> &amp;&amp; Interlocked.CompareExchange(<span class="keyword">ref</span> items[i].Element, <span class="literal">null</span>, item) == item)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    item = Create();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Non-inline to improve its code quality as uncommon path</span></span><br><span class="line">[<span class="meta">MethodImpl(MethodImplOptions.NoInlining)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> T <span class="title">Create</span>()</span> =&gt; _fastPolicy?.Create() ?? _policy.Create();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Return</span>(<span class="params">T obj</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (_isDefaultPolicy || (_fastPolicy?.Return(obj) ?? _policy.Return(obj)))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (_firstItem != <span class="literal">null</span> || Interlocked.CompareExchange(<span class="keyword">ref</span> _firstItem, obj, <span class="literal">null</span>) != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> items = _items;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; items.Length &amp;&amp; Interlocked.CompareExchange(<span class="keyword">ref</span> items[i].Element, obj, <span class="literal">null</span>) != <span class="literal">null</span>; ++i)</span><br><span class="line">      &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里主要用到<code>Interlocked.CompareExchange()</code>这个方法，对于<code>Get()</code>方法而言，它将<code>items[i].Element</code>和<code>null</code>进行交换，相当于将指定元素设为 null 并返回原始值；而对于<code>Return()</code>方法而言，如果将<code>items[i].Element</code>和<code>obj</code>交换后的值不为 null，则表示指定元素已经“归还”，因为这个方法只有在第一个参数和第三个参数相等时才会发生交换。好了，了解了.NET Core 中对象池的实现以后，我们来一起看看具体的使用：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> service = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用DefaultObjectPoolProvider</span></span><br><span class="line">service.AddSingleton&lt;ObjectPoolProvider, DefaultObjectPoolProvider&gt;();</span><br><span class="line"><span class="comment">//使用默认策略</span></span><br><span class="line">service.AddSingleton&lt;ObjectPool&lt;Foo&gt;&gt;(serviceProvider =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> objectPoolProvider = serviceProvider.GetRequiredService&lt;ObjectPoolProvider&gt;();</span><br><span class="line">  <span class="keyword">return</span> objectPoolProvider.Create&lt;Foo&gt;();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//使用自定义策略</span></span><br><span class="line">service.AddSingleton&lt;ObjectPool&lt;Foo&gt;&gt;(serviceProvider =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> objectPoolProvider = serviceProvider.GetRequiredService&lt;ObjectPoolProvider&gt;();</span><br><span class="line">  <span class="keyword">return</span> objectPoolProvider.Create(<span class="keyword">new</span> FooObjectPoolPolicy());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> serviceProvider = _service.BuildServiceProvider();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> objectPool = _serviceProvider.GetService&lt;ObjectPool&lt;Foo&gt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//有借有还，两次是同一个对象</span></span><br><span class="line"><span class="keyword">var</span> item1 = objectPool.Get();</span><br><span class="line">objectPool.Return(item1);</span><br><span class="line"><span class="keyword">var</span> item2 = objectPool.Get();</span><br><span class="line">Assert.AreEqual(item1, item2);<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//有借无还，两次是不同的对象</span></span><br><span class="line"><span class="keyword">var</span> item3 = objectPool.Get();</span><br><span class="line"><span class="keyword">var</span> item4 = objectPool.Get();</span><br><span class="line">Assert.AreEqual(item3, item4);<span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<p>其中，<code>Foo</code>和<code>FooObjectPoolPolicy</code>是两个非常典型的“工具类”，类似我们所说的“工具人”：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">string</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">  <span class="keyword">public</span> DateTime? CreatedAt &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">string</span> CreatedBy &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FooObjectPoolPolicy</span> : <span class="title">IPooledObjectPolicy</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Foo <span class="title">Create</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Foo()</span><br><span class="line">    &#123;</span><br><span class="line">      Id = Guid.NewGuid().ToString(<span class="string">&quot;N&quot;</span>),</span><br><span class="line">      CreatedAt = DateTime.Now,</span><br><span class="line">      CreatedBy = <span class="string">&quot;Ezio&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Return</span>(<span class="params">Foo obj</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当你需要控制对象池内的对象如何被创建的时候，你可以考虑实现自定义的<code>IPooledObjectPolicy&lt;T&gt;</code>，否则，<code>DefaultPooledObjectPolicy&lt;T&gt;</code>这个默认实现完全可以满足你的使用，而这就是.NET Core 中对象池的所有用法，一个实现起来并不复杂但是在某些场景下非常有用的软件设计模式。</p>
<h1 id="回到起点"><a href="#回到起点" class="headerlink" title="回到起点"></a>回到起点</h1><p>好了，回到我们一开始的问题，即：如何解决 RabbitMQ 在多次重连后提示连接数不足的问题。由于 Channel 对象本质上是 Connection 对象上的 TCP 连接的软连接，所以，每当创建一个新的 Channel 的时候，实际上会独占一个 TCP 连接。考虑到在使用 RabbitMQ 的时候，发布消息&#x2F;消费消息每次都是创建一个 Channel，在高并发场景下可能会导致 TCP 连接数被用完，进而出现无法连接或者响应过慢等一系列问题。既然 TCP 连接数是有限的，为什么不考虑复用这些 TCP 连接呢？从这个角度上来看，数据库连接池承担了相同的角色，增加连接数说到底是一种“治标不治本”的做法。在具体实现上，可以考虑 Connection“池”和 Channel“池”，我们我们像官方推荐的做法一样，一个 Connection 对应多个 Channel，实际上只需要实现 Channel“池”。除非在多个 Connection 对应多个 Channel 的情况下，我们需要考虑同时实现 Connection“池”和 Channel“池”。坦白说，我这里一直没能找到实现 Connection“池”的相关资料，高冷的 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/catcher1994/">Catcher</a> 大神只是让我去认真读官方文档，搞清楚 Connection 和 Channel 的关系。而这个 Channel“池”的实现，结合这篇博客里的内容，实现起来是非常简单的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ChannelObjectPoolPolicy</span> : <span class="title">IPooledObjectPolicy</span>&lt;<span class="title">IModel</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> IConnectionFactory _connectionFactory;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ChannelObjectPoolPolicy</span>(<span class="params">IConnectionFactory connectionFactory</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    _connectionFactory = connectionFactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> IModel <span class="title">Create</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> connection = _connectionFactory.CreateConnection();</span><br><span class="line">    <span class="keyword">return</span> connection.CreateModel();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Return</span>(<span class="params">IModel obj</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!obj.IsOpen)</span><br><span class="line">    &#123;</span><br><span class="line">      obj?.Dispose();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一步是实现<code>IPooledObjectPolicy&lt;IModel&gt;</code>，注意到，这里通过构造函数注入了<code>ConnectionFactory</code>，所以，除了常规的注入项以外，这里还需要注入<code>ConnectionFactory</code>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">services.AddSingleton&lt;IConnectionFactory, ConnectionFactory&gt;(sp =&gt; <span class="keyword">new</span> ConnectionFactory() &#123; </span><br><span class="line">    HostName = <span class="string">&quot;localhost&quot;</span>, </span><br><span class="line">    UserName = <span class="string">&quot;guest&quot;</span>, </span><br><span class="line">    Password = <span class="string">&quot;guest&quot;</span> </span><br><span class="line">&#125;);</span><br><span class="line">services.AddSingleton&lt;ObjectPoolProvider, DefaultObjectPoolProvider&gt;();</span><br><span class="line">services.AddSingleton&lt;ObjectPool&lt;IModel&gt;&gt;(serviceProvider =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> objectPoolProvider = serviceProvider.GetRequiredService&lt;ObjectPoolProvider&gt;();</span><br><span class="line">  <span class="keyword">var</span> connectionFactory = serviceProvider.GetRequiredService&lt;ConnectionFactory&gt;();</span><br><span class="line">  <span class="keyword">return</span> objectPoolProvider.Create(<span class="keyword">new</span> ChannelObjectPoolPolicy(connectionFactory));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后，我们只需要在 EventBus 里注入<code>ObjectPool&lt;IModel&gt;</code>即可，此时，我们调用 Channel 的画风是下面这样子的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channel = _channelPool.Get();</span><br><span class="line"><span class="keyword">try</span> &#123;  <span class="comment">//在这里做点什么吧  &#125;</span></span><br><span class="line"><span class="keyword">finally</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//好借好还，再借不难</span></span><br><span class="line">  _channelPool.Return(channel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于 Connection“池”的实现，我认为我的想法还不太成熟，暂时列入未来的思考计划中，所以，这篇博客就先写到这里。</p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>对象池(ObjectPool)是一种通过复用对象来减少资源开销进而实现提高系统性能的软件设计模式，其核心是控制容器内对象的生命周期来规避系统的主动回收，从对象池中(ObjectPool)“借”出的对象必须要及时“归还”，否则会造成对象池(ObjectPool)中没有可用资源。实现对象池可以考虑<code>ConcurrentBag&lt;T&gt;</code>、<code>Stack&lt;T&gt;</code>、<code>Queue&lt;T&gt;</code>以及<code>BlockingCollection&lt;T&gt;</code>等多种数据结构，而微软在.NET Core 中已经为我们实现了一个简单的对象池，大多数情况下，我们只需要定义自己的<code>IPooledObjectPolicy&lt;T&gt;</code>去决定对象应该怎么样“借”、怎么样“还”。因为此前实现基于 RabbitMQ 的 EventBus 的时候，我们是每次创建一个 Channel，即官方所谓的“短连接”的方式，因为 Channel 本质上是 Connection 在 TCP 连接上的一个虚拟连接，所以，每次创建 Channel 都会占用一个 TCP 连接，当我们系统中的 TCP 连接被用完的时候，就会出现无法连接、连接过慢的问题，为了解决这个问题，我们最终引入了对象池，实际上这里是实现了一个 Channel“池”，关于是否应该实现 Connection“池”，这一点我还没有想好，总而言之，游戏世界里可以复用的 GameObject、各种数据库里的连接池，都是对象池模式在各自领域中的具体实现，这就是这篇博客的内容啦，欢迎大家在评论中留言，谢谢大家！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/08/14/threadlocal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/14/threadlocal/" itemprop="url">聊一聊 Java 中的 ThreadLocal</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-14T20:21:26+08:00">
                2020-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>提到 ThreadLocal， Java 开发者并不陌生。在面试中，也经常被面试官提及，对 Java 开发者而言也是一个必须掌握的知识点，所以将它理解透彻是很有必要的。</p>
<p>文章稍微有点长，不过介绍的还是比较细致。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/08/14/threadlocal/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/834cbf1e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/834cbf1e.html" itemprop="url">我以为我不会成为那样的煞笔</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-12T00:37:51+08:00">
                2020-08-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>多年前在帝吧看过一篇文章，题目大概的意思就是本文的标题，作者貌似叫操笔帝，但不知道是不是我记忆错乱还是怎么的，我居然没有在互联网上找到这篇文章，今晚突然想起了这篇文章， 觉得很适合此刻的心情，就来写一篇差不多的吧。</p>
<p>当我小时候看到别人家里吵架，我心想我以后一定不会像他们这么煞笔，直到我现在为夹在她们中间而感到心累。</p>
<p>当我小时候看到别人脾气暴躁，我心想我以后一定不会像他们这么煞笔，直到我现在还经常无法控制自己的脾气。</p>
<p>当我小时候看到别人自私自利，我心想我以后一定不会像他们这么煞笔，直到我现在做什么都先考虑自己。</p>
<p>当我小时候看到别人精打细算，我心想我以后一定不会像他们这么煞笔，直到我现在也经常盘算如何才不吃亏。</p>
<p>当我小时候看到别人有难不帮，我心想我以后一定不会像他们这么煞笔，直到我现在害怕老同学找我借钱。</p>
<p>当我小时候看到别人冷漠无情，我心想我以后一定不会像他们这么煞笔，直到我现在看到有人晕倒也不敢上去扶。</p>
<p>当我小时候看到别人没有道德，我心想我以后一定不会像他们这么煞笔，直到我现在坐公交都会先找后面的位置。</p>
<p>当我小时候看到别人不合群，我心想我以后一定不会像他们这么煞笔，直到我现在喜欢一个人安静的做自己的事。</p>
<p>我们生活中有形形色色的煞笔，但我们总是在不同的时间里扮演着他们。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/posts/tai-jiu-mei-geng-xin-blog-de-yi-xie-fan-si.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/tai-jiu-mei-geng-xin-blog-de-yi-xie-fan-si.html" itemprop="url">太久没更新博客的原因和反思</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-03T00:00:00+08:00">
                2020-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>距离上一篇文章 <a target="_blank" rel="noopener" href="https://4ark.me/post/72566ae3.html">我的 2019 年度总结</a> 发布时间，已经过去大半年了，也就是说 2020 年我把写博客的习惯弄丢了，其实原因很简单，那就是我变懒了。</p>
<p>我曾给自己找过借口，写技术方面的我总觉得自己写的太粗浅，其实这类文章在目前国内平台已经够多了，没必要重复产出这类文章，但是一篇质量好、有深度的文章，又要花费大量的时间，这让我总是望而却步。</p>
<p>还有一种生活类文章，我也考虑过要不要把生活上一些感想记录下来，但是后来总是因为各种原因没有这样做，所以对比去年，今天我在写博客方面变懒惰了，但是我知道写博客是好习惯，所以从现在开始我要重新坚持这个习惯。</p>
<p>我觉得我把写博客这件事还是看得太功利，还没写之前就开始想着会不会有人看，其实博客更多是给以后的自己看。</p>
<p>自勉。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/08/02/2020/the-idolmaster/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/02/2020/the-idolmaster/" itemprop="url">THE IDOLM@STER 偶像大师系列个人入坑心得</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-02T19:23:00+08:00">
                2020-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p><img src="/the-idolmaster/imas-15th-banner.jpg" alt="imas-15th-banner"></p>
<p>说起来我有多久没写过二次元相关的博客了？恰逢爱马仕 15 周年，前几天追着官方生放重温了 2011 版《偶像大师》动画和剧场版，还有 5 场 LIVE BD 看了个爽（拜此所赐睡眠周末时间只有六小时），正好借此机会写点东西。</p>
<p><del>因为以往的经验告诉我，如果现在拖着不写以后就更写不出来了（</del></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/08/02/2020/the-idolmaster/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/31/%E5%88%A9%E7%94%A8MySQL%E7%9A%84Binlog%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E4%B8%8E%E8%AE%A2%E9%98%85-%E4%B8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/31/%E5%88%A9%E7%94%A8MySQL%E7%9A%84Binlog%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E4%B8%8E%E8%AE%A2%E9%98%85-%E4%B8%8B/" itemprop="url">利用 MySQL 的 Binlog 实现数据同步与订阅(下)：EventBus 篇</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-31T12:01:14+08:00">
                2020-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">数据存储</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>终于到这个系列的最后一篇，在前两篇博客中，我们分别了介绍了<strong>Binlog</strong>的概念和事件总线(<strong>EventBus</strong>)的实现，在完成前面这将近好几千字的铺垫以后，我们终于可以进入正题，即通过 EventBus 发布 Binlog，再通过编写对应的 EventHandler 来订阅这些 Binlog，这样就实现了我们“最初的梦想”。坦白说，这个过程实在有一点漫长，庆幸的是，它终于还是来了。</p>
<h1 id="Binlog-读取与解析"><a href="#Binlog-读取与解析" class="headerlink" title="Binlog 读取与解析"></a>Binlog 读取与解析</h1><p>首先，我们通过 <a target="_blank" rel="noopener" href="https://github.com/noplay/python-mysql-replication">Python-Mysql-Replication</a> 这个项目来读取 Binlog，直接通过<code>pip install mysql-replication</code>安装即可。接下来，我们编写一个简单的脚本文件，这再次印证那句名言——人生苦短，我用 Python：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">readBinLog</span>():</span><br><span class="line">    stream = BinLogStreamReader(</span><br><span class="line">        <span class="comment"># 填写IP、账号、密码即可</span></span><br><span class="line">        connection_settings = &#123;</span><br><span class="line">            <span class="string">&#x27;host&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;port&#x27;</span>: <span class="number">3306</span>, </span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;&#x27;</span>, </span><br><span class="line">            <span class="string">&#x27;passwd&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment"># 每台服务器唯一</span></span><br><span class="line">        server_id = <span class="number">3</span>, </span><br><span class="line">        <span class="comment"># 主库Binlog读写完毕时是否阻塞连接</span></span><br><span class="line">        blocking = <span class="literal">True</span>, </span><br><span class="line">        <span class="comment"># 筛选指定的表</span></span><br><span class="line">        only_tables = [<span class="string">&#x27;order_info&#x27;</span>, <span class="string">&#x27;log_info&#x27;</span>], </span><br><span class="line">        <span class="comment"># 筛选指定的事件</span></span><br><span class="line">        only_events = [DeleteRowsEvent, WriteRowsEvent, UpdateRowsEvent]) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> binlogevent <span class="keyword">in</span> stream:</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> binlogevent.rows:</span><br><span class="line">            event = &#123;</span><br><span class="line">                <span class="string">&quot;schema&quot;</span>: binlogevent.schema,</span><br><span class="line">                <span class="string">&quot;table&quot;</span>: binlogevent.table,</span><br><span class="line">                <span class="string">&quot;log_pos&quot;</span>: binlogevent.packet.log_pos</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(binlogevent, DeleteRowsEvent):</span><br><span class="line">                event[<span class="string">&quot;action&quot;</span>] = <span class="string">&quot;delete&quot;</span></span><br><span class="line">                event[<span class="string">&quot;origin&quot;</span>] = <span class="built_in">dict</span>(row[<span class="string">&quot;values&quot;</span>].items())</span><br><span class="line">                event[<span class="string">&quot;current&quot;</span>] = <span class="literal">None</span></span><br><span class="line">                event = <span class="built_in">dict</span>(event.items())</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(binlogevent, UpdateRowsEvent):</span><br><span class="line">                event[<span class="string">&quot;action&quot;</span>] = <span class="string">&quot;update&quot;</span></span><br><span class="line">                event[<span class="string">&quot;origin&quot;</span>] = <span class="built_in">dict</span>(row[<span class="string">&quot;before_values&quot;</span>].items())</span><br><span class="line">                event[<span class="string">&quot;current&quot;</span>] = <span class="built_in">dict</span>(row[<span class="string">&quot;after_values&quot;</span>].items())</span><br><span class="line">                event = <span class="built_in">dict</span>(event.items())</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(binlogevent, WriteRowsEvent):</span><br><span class="line">                event[<span class="string">&quot;action&quot;</span>] = <span class="string">&quot;insert&quot;</span></span><br><span class="line">                event[<span class="string">&quot;origin&quot;</span>] = <span class="literal">None</span></span><br><span class="line">                event[<span class="string">&quot;current&quot;</span>] = <span class="built_in">dict</span>(row[<span class="string">&quot;values&quot;</span>].items())</span><br><span class="line">                event = <span class="built_in">dict</span>(event.items())</span><br><span class="line">    stream.close()</span><br></pre></td></tr></table></figure>

<h1 id="发布-Binlog"><a href="#发布-Binlog" class="headerlink" title="发布 Binlog"></a>发布 Binlog</h1><p>在读取到 Binlog 以后，我们需要将其发布到 EventBus 里，为此，在.NET Core 这边提供一个 Web API 接口，只需要注入<code>IEventBus</code>然后调用<code>Publish()</code>即可：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Post: /&lt;controller&gt;/Publish</span></span><br><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line">[<span class="meta">Route (<span class="string">&quot;PublishBinLog&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">PublishBinLog</span> (<span class="params">BinLogEventModel&lt;<span class="built_in">dynamic</span>&gt; eventModel</span>)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (eventModel.action == <span class="string">&quot;insert&quot;</span> &amp;&amp; eventModel.table.StartsWith (<span class="string">&quot;log_&quot;</span>))</span><br><span class="line">        _eventBus.Publish (eventModel.MapTo&lt;WriteLogEvent&gt; ());</span><br><span class="line">    <span class="keyword">if</span> (eventModel.action == <span class="string">&quot;insert&quot;</span> &amp;&amp; eventModel.table == <span class="string">&quot;order_info&quot;</span>)</span><br><span class="line">        _eventBus.Publish (eventModel.MapTo&lt;OrderInfoCreateEvent&gt; ());</span><br><span class="line">    <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相应地，我们需要在脚本中添加调用 Web API 的逻辑代码，使用我们最熟悉的<code>requests</code>库即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sendBinLog</span>(<span class="params">event</span>):</span><br><span class="line">    url = <span class="string">&quot;https://localhost:44348/EventBus/PublishBinLog&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = json.dumps(event,cls=ComplexEncoder)</span><br><span class="line">        response = session.request(<span class="string">&quot;POST&quot;</span>, url, data=payload, headers=headers, verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>在这里，在处理 Binlog 的序列化的问题时，我们可能会遇到默认的 JSON 序列化器无法对 event 进行序列化的问题，此时，我们可以编写一个自定义的序列化器，下面是博主目前在使用的序列化器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexEncoder</span>(json.JSONEncoder):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">default</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, datetime):</span><br><span class="line">            <span class="keyword">return</span> obj.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(obj, date):</span><br><span class="line">            <span class="keyword">return</span> obj.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(obj, decimal.Decimal):</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(obj)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">bytes</span>):</span><br><span class="line">            <span class="keyword">return</span> obj.decode(<span class="string">&#x27;utf-8&#x27;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> json.JSONEncoder.default(self, obj)</span><br></pre></td></tr></table></figure>

<h1 id="订阅-Binlog"><a href="#订阅-Binlog" class="headerlink" title="订阅 Binlog"></a>订阅 Binlog</h1><p>现在，为了订阅这些 Binlog，我们来编写对应的 EventHandler，这里我们定义两个 EventHandler，一个用于打印日志编号、日志内容、日志级别等信息，一个用于统计不同级别的日志的数目。代码实现如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打印日志的EventHandler</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WriteLogEventHandler</span> : <span class="title">IEventHandler</span>&lt;<span class="title">WriteLogEvent</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> ILogger&lt;WriteLogEventHandler&gt; _logger;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WriteLogEventHandler</span> (<span class="params">ILogger&lt;WriteLogEventHandler&gt; logger</span>)</span> &#123;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task <span class="title">Handle</span> (<span class="params">WriteLogEvent @<span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        _logger.LogInformation (<span class="string">$&quot;日志编号：<span class="subst">&#123;@<span class="keyword">event</span>.TRANSACTION_ID&#125;</span>，日志级别：<span class="subst">&#123;@<span class="keyword">event</span>.LOG_LEVEL&#125;</span>，主机：<span class="subst">&#123;@<span class="keyword">event</span>.HOST_NAME&#125;</span>，IP：<span class="subst">&#123;@<span class="keyword">event</span>.HOST_IP&#125;</span>，内容：<span class="subst">&#123;@<span class="keyword">event</span>.CONTENT&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//分析日志的EventHandler</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AnalyseLogEventHandler</span> : <span class="title">IEventHandler</span>&lt;<span class="title">WriteLogEvent</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;AnalyseLogEventHandler&gt; _logger;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IDistributedCache _cache;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AnalyseLogEventHandler</span> (<span class="params">ILogger&lt;AnalyseLogEventHandler&gt; logger, IDistributedCache cache</span>)</span> &#123;</span><br><span class="line">        _logger = logger;</span><br><span class="line">        _cache = cache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task <span class="title">Handle</span> (<span class="params">WriteLogEvent @<span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> cacheCount = _cache.GetString (@event.LOG_LEVEL);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty (cacheCount))</span><br><span class="line">            cacheCount = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cacheCount = (<span class="built_in">int</span>.Parse (cacheCount) + <span class="number">1</span>).ToString ();</span><br><span class="line">        _cache.SetString (@event.LOG_LEVEL, cacheCount);;</span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，这里需要在<code>Startup</code>中注入<code>EventHandler</code>、<code>EventBus</code>以及各种必要的依赖项，你可以手动注册，或者参考下面的代码，实现扫描注册：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">services.AddSingleton&lt;IRabbitMQPersistentConnection, DefaultRabbitMQPersistentConnection&gt; ();</span><br><span class="line">services.AddSingleton&lt;IEventBusSubscriptionManager, EventBusSubscriptionManager&gt; (sp =&gt; <span class="keyword">new</span> EventBusSubscriptionManager ());</span><br><span class="line">services.AddSingleton&lt;IConnectionFactory, ConnectionFactory&gt; (sp =&gt; <span class="keyword">new</span> ConnectionFactory () &#123; HostName = <span class="string">&quot;localhost&quot;</span>, UserName = <span class="string">&quot;guest&quot;</span>, Password = <span class="string">&quot;guest&quot;</span> &#125;);</span><br><span class="line">services.AddSingleton&lt;ObjectPoolProvider, DefaultObjectPoolProvider&gt; ();</span><br><span class="line">services.AddControllers ().AddNewtonsoftJson ();</span><br><span class="line">services.AddDistributedMemoryCache (options =&gt; &#123;</span><br><span class="line">    options.ExpirationScanFrequency = TimeSpan.FromMinutes (<span class="number">5</span>);</span><br><span class="line">    options.SizeLimit = <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//自动注册</span></span><br><span class="line">services.AddEventBus();</span><br><span class="line"></span><br><span class="line"><span class="comment">//手动注册</span></span><br><span class="line">services.AddSingleton&lt;IEventBus, RabbitMQEventBus&gt; (sp =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> eventBus = <span class="keyword">new</span> RabbitMQEventBus (sp.GetRequiredService&lt;IRabbitMQPersistentConnection&gt; (), sp.GetRequiredService&lt;IEventBusSubscriptionManager&gt; (), sp.GetRequiredService&lt;ILogger&lt;RabbitMQEventBus&gt;&gt; (), sp, <span class="string">&quot;eventbus-exchange&quot;</span>, <span class="string">&quot;eventbus-queue&quot;</span>);</span><br><span class="line">    eventBus.Subscribe&lt;WriteLogEvent, WriteLogEventHandler&gt;():</span><br><span class="line">    eventBus.Subscribe&lt;WriteLogEvent, AnalyseLogEventHandler&gt;();</span><br><span class="line">    <span class="keyword">return</span> eventBus;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">services.AddTransient&lt;WriteLogEventHandler&gt;();</span><br><span class="line">services.AddTransient&lt;AnalyseLogEventHandler&gt;();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>一起来看看效果，简直太完美了，我就是不想写中间表啊，这样多好！！！<br><img src="https://i.loli.net/2020/07/31/PRjfiYpWNqHxI7Z.gif" alt="Python 读取 Binlog 演示"><br><img src="https://i.loli.net/2020/07/31/yVZgIn9NifpxTXa.gif" alt=".NET Core 消费 Binlog演示"><br><img src="https://i.loli.net/2020/07/31/iMX5PFCoak7VDv9.png" alt="RabbitMQ Dashboard 演示"></p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>通过三篇博客的篇幅，我们实现了“利用 MySQL 的 Binlog 实现数据同步与订阅”的想法。在这个过程中，我们了解了 Binlog 的相关概念，参考微软的 <a target="_blank" rel="noopener" href="https://github.com/dotnet-architecture/eShopOnContainers">eShopOnContainers</a> 项目实现了一个基于 RabbitMQ 的 EventBus，而这一切都在这篇博客中完成了最终的“拼合”，通过 <a target="_blank" rel="noopener" href="https://github.com/noplay/python-mysql-replication">Python-Mysql-Replication</a> 实现了 Binlog 解析，而 EventBus 则作为整个事件系统的“上帝”对所有事件处理器(<strong>EventHandler</strong>)进行统一调度，最终我们不需要关心这些事件是如何被发布到 EventBus 中的，只需要知道它对应哪一个 Event 并为它编写对应的 EventHandler 即可，除了这篇博客中提到的 Binlog 以外，实际上它还可以作为系统内的“领域事件”来实现业务上的事件驱动，譬如<code>OrderInfoCreateEvent</code>这个事件可以表示一个订单被创建，而关心订单状态的人则可以通过 EventHandler 来实现订阅，实现类似发短信、发邮件、发微信等等的功能，或者可以让第三方的 Web API 来消费事件中携带的信息。同理，第三方的数据在流入系统时，可以先发布到消息队列中，再通过对应的 EventHandler 来进行异步处理，极大地改善系统接口的吞吐性能，而如果在这中间抽象出来一个数据交换层出来，那么就能收获更多不一样的东西，就在写这篇博客的时候，我在 Github 上的代码被收入了微软的”北极冰川火种计划”，虽然数字世界远比现实世界宽广得多，可能为这个世界减少一点“无用”的数据或者代码，应该一样可以算作是环保行为吧！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/28/2020-07-28-about-user-research/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/28/2020-07-28-about-user-research/" itemprop="url">关于用研岗位的思考</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-28T09:13:21+08:00">
                2020-07-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="什么是用研岗位"><a href="#什么是用研岗位" class="headerlink" title="什么是用研岗位"></a>什么是用研岗位</h2><p>用户研究简称“用研”，是一种主要通过面向用户的各种研究方法，达成对关键问题的信息收集和理解的目标。</p>
<p>这些关键问题可大可小。大的方面可能是确定某个市场需求，小的方面可能是验证某个产品的市场受欢迎程度，也可能是确认产品的某个问题。</p>
<h2 id="用研常用的手段"><a href="#用研常用的手段" class="headerlink" title="用研常用的手段"></a>用研常用的手段</h2><p>用研常用的手段包括以下几种：用户访谈（包括一对一和一对多）、用户使用场景的现场观察、以及用户问卷调查、用户反馈收集等。</p>
<p>我把这些手段分成 2 类：</p>
<ul>
<li>客观数据分析类。包括用户使用场景。</li>
<li>主观数据分析类。包括用户访谈和用户问卷。</li>
</ul>
<p>我们也可以按定性和定量分析，把用研手段分类：</p>
<ul>
<li>定性分析。包括用户访谈和用户使用场景的分析。</li>
<li>定量分析。包括用户问卷，以及用户操作日志分析。</li>
</ul>
<p>下面我稍微展开介绍一下。</p>
<h3 id="用户访谈"><a href="#用户访谈" class="headerlink" title="用户访谈"></a>用户访谈</h3><p>我认为用户访谈是最好的定性分析手段，没有之一。主要是每个用户都有着独特的个体差异。如果我们在访谈前不设置太多访谈目标的话，就可以获得比较多的新的信息点。</p>
<p>这些信息点可能暴露出一些未被发掘的用户需求。也可能发现产品设计当中的不合适的流程。</p>
<p>当然，大部分时候，用户提到的问题要么是太特殊，要么是并不合理，但这没有关系，如果用户访谈中只有一个用户提到，我们就简单记录下来即可。大部分时候用户提的东西都不能直接拿来用，需要消化。</p>
<p>但如果每个用户都提到同样的问题，那我们就要小心了，很可能是我们产品的问题。</p>
<h3 id="用户使用场景的现场观察"><a href="#用户使用场景的现场观察" class="headerlink" title="用户使用场景的现场观察"></a>用户使用场景的现场观察</h3><p>做产品一直讲要“还原用户场景”，而用研就是最直接的呈现出用户场景。这个信息非常非常关键。因为用户可以随便说，但是怎么做才是最重要的，“身体不会撒谎”。</p>
<p>有一个故事，有一个公司做用研，让用户挑他们最喜欢的杯子颜色，结果大家都投的红色。用户做完用研，这个公司说，你们可以走的时候带走一个杯子。结果，大家走的时候都带走的是白色的杯子。</p>
<p>这就是一个用户说的和做的不一样的故事。类似的故事有很多，像可口可乐换口味事件就是历史上成本最大的被用户说的欺骗的故事，详见：<a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/e847c601cc175527072208b9.html">https://wenku.baidu.com/view/e847c601cc175527072208b9.html</a>。</p>
<h3 id="用户问卷"><a href="#用户问卷" class="headerlink" title="用户问卷"></a>用户问卷</h3><p>用户问卷用于定位一个问题后，定量分析用户的一些看法。问卷的设计大多时候都带有调研者的倾向性，所以很容易设置得不合理，这也是乔布斯说他从来不看用户问卷的原因。</p>
<p>但是 NPS（用户净推荐值）是一个很值得做的问卷，主要是这个指标非常标准化，我从在工作的第一天就接触 NPS，这个值的长期变化还是能有效反应出产品的改善。</p>
<h2 id="用研的核心挑战"><a href="#用研的核心挑战" class="headerlink" title="用研的核心挑战"></a>用研的核心挑战</h2><p>用户研究在很多公司都有岗位，但是这个岗位如果只做用户研究，那么很容易做得很差。所以大多数公司都将这个工作综合放到产品经理的工作中。</p>
<p>我也见过很多第三方的用研公司，请一些用户做访谈，然后搞一些问卷，出一个满是图表和数据的报告。看起来很牛逼，但是能够给决策带来支持的信息极少，信息本身的质量也值得商榷。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>我认为客观数据分析类：用户使用场景的现场观察、用户操作日志分析是最有价值的用研工作。</p>
<p>用研要做得好，还是应该是最核心的人「亲自参与」或者「重度参与」。</p>
<p>所谓的亲自参与，即核心的人自己做用研。如果是决定产品需求或功能，就让产品经理自己做用研。我们猿辅导的教学端产品经理，就需要自己深入教学环节中去了解老师的需求，以便改进教学端的体验。</p>
<p>如果想节省一些时间，那么也可以选择「重度参与」的方式。「重度参与」的核心是：必须亲眼看到原始数据。比如，我听说在头条，当用研在给用户试用产品的时候，屋子里有一面单面玻璃，后面是相关的产品经理在现场观察。这个时候，用研只是帮忙进行了组织协调工作，核心工作和决策产品经理并没有缺席。</p>
<p>我们在做一些新产品用研的时候，我也要求用研的同学需要把现场录像下来。这些录像也非常有助于大家研究用户为什么那么操作，反复观看和思考。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>用研是一种面向用户获得决策信息的研究方法。</li>
<li>用研最有价值的是用户现场操作的原始数据。</li>
<li>用研的开放性访谈可以获得一些意外的发现。</li>
<li>用研问卷比较难以做决策支持，但 NPS 有一定价值。</li>
<li>用研最好是决策相关人「亲自参与」或者「重度参与」，否则用研结果很难被合理消化并得到推进。</li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/21/git-commit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/21/git-commit/" itemprop="url">如何规范地提交 Git Commit Message</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-21T20:38:05+08:00">
                2020-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>Commit message 是开发的日常操作，它可以提供更多的历史信息，方便，还可以有效的生成 Change log，对项目的管理实际至关重要，但是实际工作中却常常被大家忽略。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/21/git-commit/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/20/java-fail-safe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/20/java-fail-safe/" itemprop="url">一文读懂 Java 集合中的快速失败(fail-fast)和安全失败(fail-safe)机制</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-20T22:15:11+08:00">
                2020-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <h3 id="快速失败"><a href="#快速失败" class="headerlink" title="快速失败"></a>快速失败</h3><p>采用快速失败机制的集合容器，使用迭代器进行遍历集合时，除了通过迭代器自身的 <code>remove()</code> 方法之外，对集合进行任何其他方式的结构性修改，则会抛出 ConcurrentModificationException 异常。</p>
<p>在 <code>java.util</code> 包下的集合类都采用的是快速失败机制，不能在多线程下发生并发修改（迭代过程中被修改）。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/20/java-fail-safe/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/19/hexo-blog-creat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/19/hexo-blog-creat/" itemprop="url">Hexo + GitHub Pages 搭建个人博客及 NexT 主题配置</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-19T23:34:13+08:00">
                2020-07-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">技术教程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>最近，自己根据网上的一些教程，基于 Hexo 搭建了自己的博客，并把搭建过程整理了出来，以供参考。</p>
<p>博客地址：<a target="_blank" rel="noopener" href="http://yifanstar.top/">http://yifanstar.top/</a></p>
<p>源码仓库：<a target="_blank" rel="noopener" href="https://github.com/yifanzheng/yifanzheng.github.io/tree/hexo-blog-backup">https://github.com/yifanzheng/yifanzheng.github.io/tree/hexo-blog-backup</a></p>
<p>框架驱动：<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a>  </p>
<p>博客主题：<a target="_blank" rel="noopener" href="https://github.com/theme-next/hexo-theme-next">NexT ^6.x</a></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/19/hexo-blog-creat/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/19/hexo-github-actions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/19/hexo-github-actions/" itemprop="url">使用 GitHub Actions 自动部署 Hexo 博客到 GitHub Pages</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-19T22:20:39+08:00">
                2020-07-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">技术教程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近，看到网上有很多人开始使用 GitHub Actions 进行项目的持续集成（CI）以及持续部署（CD）。于是，我也心血来潮，开始使用 GitHub Actions 来进行个人博客的自动部署。不得不说，GitHub Actions 真香！</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/19/hexo-github-actions/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/17/proxy-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/17/proxy-pattern/" itemprop="url">代理模式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-17T21:19:32+08:00">
                2020-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">Java 设计模式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>代理模式（Proxy）意图是为另一个对象提供代理，以控制对其的访问。即通过代理类访问目标类，这样做可以通过代理对象扩展目标类的功能以及控制对目标类的访问。</p>
<p>代理模式主要有三种形式，分别是<strong>静态代理</strong>、<strong>动态代理</strong>、<strong>CGlib 代理</strong>。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/17/proxy-pattern/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/17/flyweight-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/17/flyweight-pattern/" itemprop="url">享元模式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-17T21:18:07+08:00">
                2020-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">Java 设计模式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>享元模式(Flyweight)，使用共享技术有效地支持大量细粒度的对象。常用于系统底层开发，解决系统的性能问题。比如，数据库连接池技术。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/17/flyweight-pattern/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/17/facade-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/17/facade-pattern/" itemprop="url">外观模式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-17T21:16:19+08:00">
                2020-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">Java 设计模式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>外观模式(Facade)，为子系统中的一组接口提供统一的接口。此模式定义了一个高层接口，这个接口使子系统更易于使用。简而言之，外观模式提供了到复杂子系统的简化接口。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/17/facade-pattern/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/07/17/composite-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/17/composite-pattern/" itemprop="url">组合模式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-17T21:13:55+08:00">
                2020-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">Java 设计模式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>组合模式(Composite)，将对象组合成树形结构以表示“部分-整体”的层次结构。组合模式使得用户对单个对象和组合对象的使用具有一致性。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/07/17/composite-pattern/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/73/">73</a><a class="extend next" rel="next" href="/page/22/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1451</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">914</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
