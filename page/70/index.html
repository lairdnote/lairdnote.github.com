<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/70/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/70/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/07/28/2013-07-28-a-look-inside-blocks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/07/28/2013-07-28-a-look-inside-blocks/" itemprop="url">谈Objective-C block的实现</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-28T10:42:00+08:00">
                2013-07-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a target="_blank" rel="noopener" href="http://blog.parse.com/2013/02/05/objective-c-blocks-quiz/">这里</a> 有关于 block 的 5 道测试题，建议你阅读本文之前先做一下测试。</p>
<p>先介绍一下什么是闭包。在 wikipedia 上，<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Closure_(computer_science)">闭包的定义</a> 是:</p>
<blockquote><p>In programming languages, a closure is a function or reference to a function together with a referencing environment—a table storing a reference to each of the non-local variables (also called free variables or upvalues) of that function.</p>
</blockquote>
<p>翻译过来，闭包是一个函数（或指向函数的指针），再加上该函数执行的外部的上下文变量（有时候也称作自由变量）。</p>
<p>block 实际上就是 Objective-C 语言对于闭包的实现。<br>block 配合上 dispatch_queue，可以方便地实现简单的多线程编程和异步编程，关于这个，我之前写过一篇文章介绍：<a href="/2012/02/22/use-gcd/">《使用 GCD》</a>。</p>
<p>本文主要介绍 Objective-C 语言的 block 在编译器中的实现方式。主要包括：</p>
<ol>
<li>block 的内部实现数据结构介绍</li>
<li>block 的三种类型及其相关的内存管理方式</li>
<li>block 如何通过 capture 变量来达到访问函数外的变量</li>
</ol>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2013/07/28/2013-07-28-a-look-inside-blocks/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/07/20/2013/2013-07-20#%E5%9B%9E%E5%88%B0%E8%BF%87%E5%8E%BB%EF%BC%8C%E9%A2%84%E6%B5%8B%E6%9C%AA%E6%9D%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/07/20/2013/2013-07-20#%E5%9B%9E%E5%88%B0%E8%BF%87%E5%8E%BB%EF%BC%8C%E9%A2%84%E6%B5%8B%E6%9C%AA%E6%9D%A5/" itemprop="url">回到过去，预测未来</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-20T00:00:00+08:00">
                2013-07-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>“… 预备阶段完成，一分钟后进入时空融合。”，密闭的舱室内，一个科学狂人，花费了毕生精力，造出了一台时间机器，今天他将亲自进行第一次测试。他也不确定会被送到多久以前，但是现在程序已经启动，无法取消了。“四、三、二 …”，眼前一道白光，他屏住了呼吸——然后——“ … 预备阶段完成，一分钟后进入时空融合。”。</p>
<p>时间旅行是个多么诱人的话题，无数的影视和文学作品以此为题。</p>
<p>人们对时间旅行最大的误读恐怕就是“超过光速就能回到未来”。这个推论显然来自相对论中的时间膨胀公式(运动速度越接近光速，该物体时间流逝越慢), 但是这个公式是基于相对论中另一个基本假设“光速是不可超越的”，所以说在写方程的时候标上自变量取值范围是多么地重要。</p>
<p>所谓相对论，提出的基本假设之一就是“时间是相对的”。</p>
<p>当年牛顿的经典力学告诉我们“空间是相对的”，不同的参考系中，观测到的速度是不同的。而现在相对论告诉我们，在不同的参考系中，测量到的时间流逝同样是不同的，时间和速度互相影响着——但所有人都能测量到同样的光速，光速是不可超越的。</p>
<p>根据时间膨胀公式，可以预测的是，当速度足够接近光速的时候，运动物体相对于静止物体时间流逝地更慢，这就是所谓“双生子谬论”。一对双胞胎，如果弟弟以一半的光速运动1年，那么在静止的哥哥看来，实际上已经过去了1.3年，弟弟要比哥哥年轻了0.3岁。</p>
<p>这相当于弟弟只花了1年便到达了1.3年后，实现了当前向未来的时间旅行，如果运动速度更加接近光速，那么这个效应会更加明显，比如如果速度达到99.9%光速，那么运动的1年将相当于静止的50年。</p>
<p>在相对论中，从现在到未来的时间旅行是被允许的，只要你有足够的能量，将你加速到足够接近光速，就可以让你的时间流逝地更慢，从而更快地到达未来。</p>
<p>但根据相对论的质能方程，越接近光速，加速所需要的能量越大，以至于将有质量的物体加速到光速需要无限大的能量，这也是在计算上光速不能被超越的原因。</p>
<p>所以更激动人心的是回到过去。但凡提到这个话题，就必须提到因果关系，不同于向未来旅行，向过去旅行涉及到对已有历史的改变，这种改变超越了大多数人对因果关系的认识，科幻作品也大多是在这个环节(如何克服因果关系)做文章。</p>
<p>对我们而言，时间似乎是天然的一种属性，那么究竟何谓时间？根据热力学第二定律“闭合系统中的无序度(熵)总是在增加”，宇宙的状态总是在由整齐向混乱运动着，这个过程是不可逆的，局部的有序度增加了一点，整体的无序度则增加更多。</p>
<p>这种现象为我们(智慧生命)定义了一个非常有意义的时间箭头，这也和我们的认知相适应：很多过程，比如打碎一个杯子，比如吃一顿饭，都是无法逆转的，你只有把碎玻璃片扔进垃圾桶。这种时间箭头也为我们的生命(自我意识)赋予了意义：如果一切都是由混乱，自动地变为整齐，那么我们的生命还有什么挑战？有什么意义？</p>
<p>这种时间箭头的方向可能是由于宇宙大爆炸的方向，以及各种宇宙常数共同决定，也只有这样的宇宙，才可能存在智慧生命。</p>
<p>为了解决回到过去带来的因果关系问题，有两种较为常见的理论：决定论和平行宇宙。</p>
<p>决定论即宇宙中发生的一切事件，都由宇宙的初始状态和物理定律决定，不为智慧生命的自我意识而改变。一切历史和未来都是事先确定的，如果有人可能回到过去并改变历史，这也是历史早就确定了的。</p>
<p>平行宇宙即，除了我们的宇宙还存在着无数的宇宙，每个宇宙代表着不同的选择，每个选择都对应一个宇宙。回到过去事实上就是到达了另一个平行宇宙，历史将在这里分支。</p>
<p>我个人倾向于决定论，我觉得这才是最简洁，最完美的解释，证明了是物理定律而非自我意识在统治宇宙，我相信这也是大多数物理学家的想法。</p>
<p>而平行宇宙则更多地出现在科幻作品中，可以为情节带来更多戏剧性。</p>
<p>在目前的物理学领域中，回到过去的新的希望是虫洞理论，但直到目前，即使是仅供微观粒子通过的虫洞，也没有被观测到，仅仅存在于理论中，但目前物理学也同样无法否认时间旅行(回到过去)的存在，也许有朝一日会有新的发现。</p>
<p>但是直到目前我们还没有发现来自未来的时间旅行者不是么？开个玩笑。</p>
<p>平行宇宙的假设是各个宇宙之间相互独立，无法互相影响，如果真的是这样，那么根据剃刀原理我们就没有必要去假设平行宇宙模型。而但如果能通过时间旅行到达另外一个宇宙，即说明这些宇宙并非是无关联的。</p>
<p>而决定论中，则很可能出现因果循环，即一段信息，来自未来，却又对未来施加着影响，好像这段信息是凭空出现的一样(可以参见短篇小说《你们这些还魂尸——》), 而根据蝴蝶效应，事实上任何回到过去的行为都会造成因果循环，因此——如果宇宙存在一个确定的历史，那么就不允许有回到过去的时间旅行。</p>
<p>前面我们提到按照决定论，宇宙的历史和未来是确定的，这意味着如果我们掌握了宇宙的全部物理定律(这也是物理学家们正在做的事情)，并且知道宇宙任意一刻的状态，那么我们可以随意地计算历史，预测未来，会是这样么？</p>
<p>阻止我们的第一道关卡便是不确定性原理，即粒子的位置和状态(速度)不能被同时确定，但我们可以将位置和速度作为一个整体来看待，这即是量子力学中波函数的概念。</p>
<p>虽然不确定性原理削弱了我们预测未来的能力，但我们仍可以通过波函数进行一定程度的预测。</p>
<p>而第二个障碍是黑洞，黑洞具有极强的引力，以至于光也无法逃脱。黑洞的边缘，即为黑洞的视界，在视界内发生的一切事件将不会对外界造成影响，因为任何影响都不可能超过光速来作用。黑洞将发射仅与其质量相关的辐射，其他的一切信息都会在黑洞消失时被蒸发掉(黑洞无毛理论)。一旦波函数的任意部分掉入黑洞，我们便进一步丧失了对未来的精确预测能力。</p>
<p>总结：</p>
<ul>
<li>由当前到未来的时间旅行是被相对论允许的</li>
<li>目前仍没有完美的理论能够解释回到过去带来的因果关系问题</li>
<li>目前物理学还没有可靠的可以使宏观物体回到过去的理论</li>
<li>目前物理学还无法否认回到过去的时间旅行的存在</li>
<li>因为不确定性原理的存在，我们不可能精确地预测未来</li>
</ul>
<p>(开头的段子改写自《史上第一个时间旅行者》).</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/javascript-karaoke-remove-voice">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/javascript-karaoke-remove-voice" itemprop="url">Removing voice from songs using Javascript</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-17T17:41:54+08:00">
                2013-07-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>These days I have been playing with the Web Audio API in <a href="/karaoke/">a small pet project</a>. It consists on a web page where you can drag and drop an audio file and play it removing the vocals. Perfect for a basic karaoke!<br>And it even works on mobile!</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/javascript-karaoke-remove-voice#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/07/13/2013/2013-07-13#%E6%95%B4%E7%90%86%E4%BA%86%E4%B8%80%E4%B8%8B%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/07/13/2013/2013-07-13#%E6%95%B4%E7%90%86%E4%BA%86%E4%B8%80%E4%B8%8B%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/" itemprop="url">整理了一下我的博客</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-13T00:00:00+08:00">
                2013-07-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <blockquote>
<p>本文于 2015.7.14 修订：更新链接地址</p>
</blockquote>
<p>在两个多月前，我的博客通过了备案，移到了阿里云的位于青岛的国内服务器，同时使用了新的Nginx+PHP-FPM架构，无论是软件还是硬件(网络)上，都有不少性能提升。</p>
<p>所以是时候提高一下内容质量了，说实话我觉得我的日志一直都保持了相当的高质量，不过也有不少历史遗留问题。</p>
<p>本文可能会被转载到其他地方，比如我的QQ空间和论坛等等，请记住我的博客地址<code>https://jysperm.me</code>, 这里可以取得最佳的阅读效果，同时如果日志中有错误，我通常也只会在这里修改。在Google搜索“精英王子”第一个即是我的博客，百度什么的还是不要用了 …</p>
<p>博客新增了SSL版本, 不过目前多说是不支持SSL的，他们承诺近期支持，不过一直都没有消息。</p>
<p>我重新阅读了我所有的日志，116篇，这个博客是我在上高中时建立的，不过我也在陆续把上高中之前的高质量日志移过来。</p>
<p>我为所有日志重新分了类：</p>
<ul>
<li>技术：编程方面的日志</li>
<li>生活：以记叙生活和校园为主的日志</li>
<li>随笔：发表胡思乱想的观点的日志</li>
</ul>
<p>同时我还删去了所有日志的 tag, 之前有无数人吐槽我 tag 加得太泛滥了(好像最多的时候达到了1200个), 重新添加 tag 的标准则吝啬了许多。</p>
<p>再然后，我重写了About Me页面，增加了一个简历页面。</p>
<p>应该说这个博客也算是令我非常自豪的作品之一，每当大家讨论些什么的时候，我可以说这个话题我好久好久以前就写过一篇日志，然后丢出链接——虽然这样很讨人厌的样子。</p>
<p>每篇日志，背后都有一个故事。我可以记起，我在写这篇日志的时候，在做些什么，想些什么；当第一时间发给朋友们时，他们又评论了些什么。</p>
<p>我这可能是我的朋友圈子里写的最长，质量最高的博客了吧。</p>
<p>看着其他人的博客一个个倒闭，我表示非(xìng)常(zāi)惋(lè)惜(huò).</p>
<p>这段时间写的日志挺多的，草稿箱里也有很多写了一半写不下去的，或者写完了觉得不好，没发的，差不多二十多篇。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/07/11/2013/2013-07-11#%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%87%BD%E6%95%B0%E5%92%8C%E6%A0%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/07/11/2013/2013-07-11#%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%87%BD%E6%95%B0%E5%92%8C%E6%A0%88/" itemprop="url">笔记：函数和栈</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-11T00:00:00+08:00">
                2013-07-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>从入门编程开始，我们一直在和函数打交道，但直到今天，我才勉强敢谈一谈对函数的认识。</p>
<p>在以C为代表的，绝大多数“正常”的编程语言中，函数都 是组织代码和组成程序的基本单位，甚至在CPU中也内建了对函数(过程)调用的支持。其他所谓面向对象风格 不过是对函数的进一步封装而已。</p>
<p>程序执行时的控制流，也是以函数为基本单位来进行调度的，每一次函数调用，就标志着一次控制流的转移。在经典的模型中，一个函数可以调用包括自己(调用自身的行为被称为递归)在内的任何函数，被调用的函数也可以再调用其他函数。函数间通过参数和返回值来传递信息，前者用于调用者向被调用信息发送信息，后者用于被调用函数向调用者返回信息。</p>
<p>那么我们如何在脑中构建一幅函数间互相调用的景象呢？这里我就不得不提到栈这个概念。栈是最简单最基础的数据结构之一，栈是一种线性的容器，但其特殊之处在于只能从其中一端插入或取出数据，这一端被称为栈顶。这使得栈具有这样的特征：先被插入栈的数据，要最后被取出；后加入栈的数据，将先被取出，即LIFO(Last In First Out, 后进先出).</p>
<p>函数调用存在着类似的性质：在某一时刻的同一调用树(而不是多个并行执行的函数)上，最先被调用的函数将最后被返回，因为它需要等待所有之后被调用的函数返回才行。 于是在计算机中，我们通过栈来维护函数间的调用状态，这种栈，也被称为运行栈，线程栈，函数栈。</p>
<p>栈上为单个函数所分配的区域，被称为栈帧。栈顶由一个栈顶指针来指示，栈顶指针在函数执行时会随时改变，因此还有另外一个帧指针指向当前栈帧的起始处，函数通常通过帧指针来访问数据。栈指针和帧指针被保存在单独的寄存器上。</p>
<p>函数执行时所定义的局部变量都将被分配在栈上，这些局部变量(和函数参数)决定了函数的执行状态。</p>
<p>当函数调用另一个函数时，首先要保存寄存器的值。因为寄存器是被多个函数所共享的自由，为了防止被调函数覆盖寄存器，主调函数必须负责将部分寄存器的值保存在栈上。然后将要传递给被调函数的参数插入栈中，在参数较少的情况下，也可能直接使用寄存器来传递参数。然后再插入下一条指令的地址，即被调函数返回时要返回到的地址。最后将控制权移交到被调函数的首地址。</p>
<p>被调函数开始执行，这也标志着调用者的栈帧已经结束。被调函数首先在栈上保存当前旧的帧指针，然后将帧指针甚至为栈指针减去1，即当前栈帧的第一项是旧的帧指针。 然后被调函数也开始保存寄存器，调用者和被调函数分别负责保存哪些寄存器是有约定的。</p>
<p>然后被调函数开始执行真正的代码，并通过帧指针来访问参数，参数在栈中的顺序是由调用约定决定的。在函数执行的过程中，函数也可能在栈上创建和销毁局部变量，但均遵循栈的后入先出原则。在函数执行即将结束时，将返回值保存在特定的寄存器中。</p>
<p>当被调函数返回时，首先恢复已保存的寄存器的值，然后将帧指针赋值给栈指针，即丢弃当前栈帧除了已保存的旧的帧指针的全部数据。然后从栈恢复旧的帧指针，至此被调函数已经完成了全部清理工作，帧指针指向调用者的栈帧头部，栈指针指向调用者栈帧的尾部。被调函数将控制权移交给当前栈指针指向的返回地址。</p>
<p>现在控制权回到了调用者，调用者首先弹出栈中的返回地址和参数，然后恢复寄存器的值，接着执行剩下的代码，被调函数的返回值在特定的寄存器中。</p>
<p>本文从栈的角度描述了一个函数的执行过程，着重介绍了4个关键的时间点：调用者调用被调函数、被调函数开始执行、被调函数返回前的清理工作、控制权返回到调用者。</p>
<p>可以看到函数的执行和栈的使用本来就是密不可分的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/07/10/2013/2013-07-10#%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/07/10/2013/2013-07-10#%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/" itemprop="url">笔记：缓冲区溢出</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-10T00:00:00+08:00">
                2013-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>缓冲区溢出可以说是针对系统级软件最常见的攻击方式了，这类攻击可以通过操作系统或软件提供的API接口，或者通过文件和网络，发送一个特定的字节序列，最终改变被攻击程序的行为，甚至取得被攻击进程的权限。</p>
<p>计算机使用栈来维护函数的执行状态，如果函数在栈上分配了一段缓冲区，但向其写入数据时没有进行充分的长度检查，那么溢出的数据就会覆盖栈上之后的内存。因为栈是由高地址向低地址延伸的，即栈底在高地址，而数据写入是由低地址向高地址覆盖的，所以溢出的数据会向着栈底，即调用者的栈帧进行覆盖。</p>
<p>在调用者和被调用者的栈帧交界处，存在着一些相当敏感的数据，如函数的返回地址，通过覆盖这个值，可以将控制权移交到任意地址。</p>
<p>攻击者需要将返回地址指向到攻击者构造的恶意代码，因此攻击者必须知道当前栈帧的地址。在经典的情况下，同一个程序在相同架构，相同的操作系统中的栈地址是固定的，攻击者很容易通过几次尝试来确认这个值。</p>
<p>针对这个思路，较新版本的Linux和GCC使用了一种地址空间布局随机化的技术，同一个程序每次运行时，程序的各个部分，如代码段，数据段，堆和栈，动态链接库都会被装载到随机的地址。</p>
<p>但攻击者可以在真正的恶意代码前加入足够长的nop指令，nop指令不执行操作，只是一个空指令。然后随机地进行跳转，只要能够跳转到nop序列中的任意一条指令，都可以执行到后面的恶意代码。</p>
<p>较新版本的GCC中还加入了一种“栈保护者”的机制，GCC会在每个函数的栈帧开始处加入一个随机的哨兵值，并在函数返回时检查该哨兵值，如果哨兵值发生了变化，即表示出现了缓冲区溢出，程序会中断执行。</p>
<p>因为攻击者需要在栈上构造可执行的恶意代码，因此还有一种思路就是将栈所在页标记为不可执行，由硬件进行这个检查，使得攻击者在栈上的恶意代码根本无法执行，目前有部分CPU支持这项特征。</p>
<p>以上是缓冲区溢出攻击的基本原理，和三种操作系统级别的防御对策，这些防御措施对用户态的程序而言都是透明的，无需程序员额外关注，同时这些机制的效率损失也相当小。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/line-height-mutiple-line-ellipsis-responsiveness">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/line-height-mutiple-line-ellipsis-responsiveness" itemprop="url">Line-height, multiline ellipsis and responsiveness</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-09T21:03:12+08:00">
                2013-07-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Recently I was implementing a pinterest-ish layout in which the elements have a specific height. These elements contain a title that can expand multiple lines, and an additional text to which I would like to apply a multi-line ellipsis. Initially, I don’t know how many lines of text the title will take. The text can be arbitrarily long, and depending on the screen width this number will vary.</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/line-height-mutiple-line-ellipsis-responsiveness#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/spain-js-2013">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/spain-js-2013" itemprop="url">Spain.js 2013</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-07T18:53:42+08:00">
                2013-07-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>During these days I have been attending <a target="_blank" rel="noopener" href="http://spainjs.org/">Spain.js 2013</a> in Madrid. For me, it has been a beautiful experience.<br><img src="/assets/images/posts/tomas-jose-spotify-spainjs-2013.jpg" alt="Tomás Pérez and José M. Pérez in Spain.js 2013"></p>
<p>I was looking forward to visit Madrid, and it didn’t let me down. It had been one year since I left Madrid to move to Sweden. Since then I have tried to keep in contact with some of my ex-workmates in my previous company, <a target="_blank" rel="noopener" href="http://tuenti.com/">Tuenti</a>, and have been following many talented Spanish developers on Twitter.</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/spain-js-2013#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/07/05/2013/2013-07-05#LightPHP%20v5%20%E9%97%B2%E8%81%8A%20PHP%20%E6%A1%86%E6%9E%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/07/05/2013/2013-07-05#LightPHP%20v5%20%E9%97%B2%E8%81%8A%20PHP%20%E6%A1%86%E6%9E%B6/" itemprop="url">LightPHP v5: 闲聊PHP框架</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-07-05T00:00:00+08:00">
                2013-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>展望LightPHP v4是半年前的事情了：<a target="_blank" rel="noopener" href="http://jyprince.me/program/681">http://jyprince.me/program/681</a>.</p>
<p>LightPHP v4算是写出来了，但代码都没经过细致的测试，基本上一边用它写RootPanel一边完善，排Bug, 后来干脆把LightPHP的开发分支丢到RootPanel了。<br>刚刚统计了一下，不知不觉这么多代码了(不计空行)：</p>
<ul>
<li>cli工具集(PHP和部分参杂了PHP的配置文件模版) - 243行</li>
<li>文档(.md) - 251行</li>
<li>LightPHP核心部分 - 1806行</li>
<li>LightPHP杂项文件 - 51行</li>
<li>配置文件 - 75行</li>
<li>控制器(Handler) - 693行</li>
<li>核心文件 - 426行</li>
<li>国际化(目前仅中文) - 507行</li>
<li>数据模型(Model) - 338行</li>
<li>独立的CSS - 186行</li>
<li>独立的JS - 168行</li>
<li>模版文件(参杂了PHP, CSS, JS的HTML文件) - 1479行</li>
<li>杂项文件 - 15行</li>
<li>引用的其他开源项目：jQuery, Bootstrap, 雅黑工作室的3款探针, 本人的taskinfo.php, Kill-IE6</li>
</ul>
<p>列得我好有成就感~</p>
<p>总之，写了这么多代码，重构了那么多次，对于PHP的框架，我又有新的体会要说。</p>
<hr>
<p>正在设计和编写中的LightPHP v5应该说和v4相比变化不算太大，但是根据语义化版本控制(<a target="_blank" rel="noopener" href="http://semver.org/">http://semver.org/</a>)的精神，还是要把它命名为v5.</p>
<p>我有提到，我打算认真写一本PHP的书，暂定《PHP进阶——一个论坛系统的实现》。以我这几年折腾的经验，来谈一谈如何利用好PHP的特征，写出优雅的代码，跳过PHP基础，以一个论坛系统的实现为例，这其中当然也隐含了一个PHP框架的实现。</p>
<p>部分草稿可以看下面，不过最后成品肯定会有很大变化的：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://jyprince.me/program/827">http://jyprince.me/program/827</a></li>
<li><a target="_blank" rel="noopener" href="http://jyprince.me/program/834">http://jyprince.me/program/834</a></li>
</ul>
<p>这个所谓的“以一个论坛系统的实现为例”, 我打算给它起名 LightTalk. 除此之外我还有另一个论坛系统的项目：JyBBS.<br>这两个论坛唯的区别恐怕就是LightTalk是随书的示例，是一个完整的论坛，其部分代码也来自LightPHP, 具有宽松的版权，书写好后不再维护。<br>而JyBBS是基于LightPHP的论坛系统，版权略严格，我打算一直维护。</p>
<p>真是乱呢…</p>
<hr>
<ul>
<li>定位</li>
</ul>
<p>在v4以及之前的版本中，LightPHP虽定位为PHP库，但仍包含了一部分前端模版(v3), 以及Bootstrap, jQuery等东西(v4).<br>v5中将删去他们，LightPHP将成为一个纯粹的PHP库。</p>
<pre><code>// LightPHP v5的结构

lp-class/  --  LightPHP的核心类
lp-config.php  --  配置文件
lp-load.php  --  用于载入LightPHP
...  --  其他杂项文件，如URL重写规则等
</code></pre>
<ul>
<li>数据库, Model</li>
</ul>
<p>LightPHP最初就是从一个MySQL封装开始的(模仿自Abreto), 后来数据库封装也一直是LightPHP的核心部分, 在v3中，我力图实现无关SQL的CRUD.<br>v4中我开始模仿MongoDB的链式调用语法，并且打算实现数据库无关，但我好像失败了。</p>
<p>数据库的差异毕竟是存在的，不可能实现真正的无关，Model不需要处理所有的数据库查询，只要提供最简单的CRUD就够了，复杂的理应交给SQL或具体的数据库API.<br>Model是我学习了最长时间的概念，现在我可以说我真正地理解了。</p>
<p>另外v5中我用PDO代替了C Style MySQL API, 毕竟是大势所趋。</p>
<pre><code>// 抽象的Model基类，以下是经过精简的成员函数列表
abstract class lpPDOModel implements ArrayAccess
&#123;
    static public function select($if = [], $config = []);
    static public function find($if = [], $config = []);
    static public function count($if = [], $config = []);
    static public function insert($data);
    static public function update($if, $data);
    static public function delete($if);
    static public function install();
&#125;

// 通过继承来“实例化”一个Model, 代码有精简
class rpUserModel extends lpPDOModel
&#123;
    static protected $metaData = null;

    // 具体Model特有的常量成员
    const NO = &quot;no&quot;;
    const STD = &quot;std&quot;;
    const EXT = &quot;ext&quot;;
    const FREE = &quot;free&quot;;

    // 为lpPDOModel提供元信息，有了这些信息，lpPDOModel不仅可以检查错误，还可以自动完成数据表的构建
    static protected function metaData()
    &#123;
        if(!self::$metaData) &#123;
            self::$metaData = [
                &quot;db&quot; =&gt; f(&quot;lpDBDrive&quot;),
                &quot;table&quot; =&gt; &quot;user&quot;,
                &quot;engine&quot; =&gt; &quot;MyISAM&quot;,
                &quot;charset&quot; =&gt; &quot;utf8&quot;,
                self::PRIMARY =&gt; &quot;id&quot;
            ];

            self::$metaData[&quot;struct&quot;] = [
                &quot;id&quot; =&gt; [&quot;type&quot; =&gt; self::AI],
                &quot;uname&quot; =&gt; [&quot;type&quot; =&gt; self::VARCHAR, &quot;length&quot; =&gt; 256],
                &quot;passwd&quot; =&gt; [&quot;type&quot; =&gt; self::TEXT],

                // 支持 JSON 格式哦！

                &quot;settings&quot; =&gt; [&quot;type&quot; =&gt; self::JSON],
            ];
        &#125;

        return self::$metaData;
    &#125;

    // Model特有的成员函数
    public function isAllowToPanel()
    &#123;
        if($this[&quot;type&quot;] != self::NO &amp;&amp; !$this-&gt;isAdmin())
            return true;
        return false;
    &#125;
&#125;

// 查询
$passwd = rpUserModel::find([&quot;uname&quot; =&gt; &quot;jybox&quot;])[&quot;passwd&quot;];
// 插入，可以直接插入数组哦，lpPDOModel会将其 json_encode 后储存为字符串，读取时反之
rpUserModel::insert([&quot;uname&quot; =&gt; &quot;jybox&quot;, &quot;settings&quot; =&gt; [&quot;key1&quot; =&gt; &quot;value1&quot;]]);
</code></pre>
<ul>
<li>模版</li>
</ul>
<p>模版也是LightPHP的早期功能之一，我没有选择Smarty之类的专有语言，我直接用PHP编写模版，毕竟PHP本身也算是一个十分方便的模版语言。<br>在v4中，对模版的解析是用eval, 这不仅存在安全问题，而且显得非常不优雅。知道前一阵，我才发现，我要找到的东西其实就近在眼前！其实只要include就好…<br>v5中模版类的代码相比于v4有了不少精简，变得更加“一般化”了。</p>
<p>v5中删去了Bootstrap, jQuery等库，我意识到了静态文件至少逻辑上应该位于单独的服务器，不应该和LightPHP混在一起。</p>
<p>一个模版就是一个普通的PHP文件，参数来自 <code>$this</code>:</p>
<pre><code>Hello &lt;?= $this[&quot;name&quot;];?&gt;
</code></pre>
<p>显示模版：</p>
<pre><code>lpTemplate::outputFile(&quot;/path/to/template.php&quot;, [&quot;name&quot; =&gt; &quot;Jybox&quot;]);
</code></pre>
<ul>
<li>缓存(键&#x2F;值对储存)</li>
</ul>
<p>我是从Asp.Net过来的，很喜欢Application类提供的全局键值对储存，但PHP是并发模型的，没有全局的管理器，语言本身没办法实现这种功能，于是我先后调研了使用文件, MySQL, Memcache, APC来实现。<br>在之前的版本中，一直都有这个功能(虽然Bug成堆), 但v5现在却没有，原因是还没来得及写，我愈发觉得这个功能可能并没有那么重要，大概要等到站点规模大到需要缓存的时候才会用到吧。</p>
<ul>
<li>登录状态验证</li>
</ul>
<p>在v4中，我用接口的方式实现了两套验证组件，分别是经典验证和会话式验证，应该说虽然没实现当初设想的全部功能，但它们工作的还不错。</p>
<ul>
<li>配置文件管理</li>
</ul>
<p>在v3和v4中LightPHP都没有用于管理配置文件的类，只需定义一个数组，然后在程序启动的时候include一下就好了。<br>但是当RootPanel需要4个配置文件(虽然后来精简到了3个), 我发现我需要这么一个玩意了。</p>
<p>编写这么一个单独的类我也是为了去掉全局变量，因为在函数中使用全局变量，还要很麻烦地用gloabl声明一下。</p>
<ul>
<li>调试</li>
</ul>
<p>v5中我引入了一个自己编写的错误处理器，可以在脚本出错时打印一些有用的调试信息。<br>同时我还正在编写一个有用的调试日志系统。</p>
<p>关于错误报告可以参见这篇文章：<a target="_blank" rel="noopener" href="http://jyprince.me/program/1079">http://jyprince.me/program/1079</a></p>
<ul>
<li>构造器</li>
</ul>
<p>构造器的概念来自于设计模式中的所谓单例模式，在一个PHP脚本中，很多对象需要使用多次，每次都构造新的对象是很浪费的，但如果不使用全局变量又很难实现代码的多个部分共享一个对象。<br>构造器以“注册——获取”的功能解决了这个问题，在程序开始时，程序向构造器注册用于构造各种对象的函数，但只有当程序需要获取这个对象时，这个函数才会真正地被执行，而且构造一次后，再反复获取，获取到的都是第一次构造的对象的引用。<br>使用构造器统一构造对象，也省去了接口，LightPHP的类型检查本来就不严格。</p>
<pre><code>// 注册一个构造器
lpFactory::register(&quot;lpLocale&quot;, function() &#123;
    $path = rpROOT . &quot;/locale&quot;;
    return new lpLocale($path, lpLocale::judegeLanguage($path, c(&quot;DefaultLanguage&quot;)));
&#125;);

// 获取一个对象
$rpL = lpFactory::get(&quot;lpLocale&quot;);
</code></pre>
<p>目前该构造器存在一个问题就是无法获得IDE的类型提示，不过目前部分IDE正在着手开发针对于这类构造器的类型提示API.</p>
<ul>
<li>国际化</li>
</ul>
<p>v5首次加入了国际化支持，目前使用的是一种非常简单的，基于数组的专有翻译文件格式，我正在设法改进。</p>
<ul>
<li>路由和分发器</li>
</ul>
<p>路由在v4的基础上仅做了一丁点优化。</p>
<p>例如请求URL是 <code>/user/show/jybox</code><br>那么默认将会创建user类的一个实例, 以jybox为参数, 调用它的show函数。<br>当然，这个过程中会对类名做一些修饰，这些都是可控的，你可以编写自己的分发器。</p>
<ul>
<li>工具</li>
</ul>
<p>v5包含了更多工具组件：分页，锁，Smtp等。</p>
<ul>
<li>插件</li>
</ul>
<p>在v4设计之处我就设法加入插件系统，但我查阅了一些项目的设计之后发现，除了在代码中加入大量的hook, 似乎没啥有效的办法了，不喜欢这种简单粗暴的方式。</p>
<ul>
<li>短函数名</li>
</ul>
<p>之前看ThinkPHP, 看它用了很多一个字母的短函数名，感觉很不优雅，但现在为了折中代码长度，我也不得不定义了四个短函数名。</p>
<pre><code>c() - 配置文件选项
d() - 数据库连接
f() - 构造器
l() - 本地化翻译
</code></pre>
<hr>
<p>LightPHP到底是个啥定位呢，除了README中(<a target="_blank" rel="noopener" href="https://github.com/jybox/LightPHP/blob/master/README.md)%E5%86%99%E7%9A%84%E9%82%A3%E4%BA%9B%E7%B2%BE%E7%A5%9E%E4%B8%8A%E7%9A%84%E4%B8%9C%E8%A5%BF%E3%80%82">https://github.com/jybox/LightPHP/blob/master/README.md)写的那些精神上的东西。</a></p>
<p>LightPHP是我逐渐摸索出来的，后期参考了一些其他框架，抽取了他们最核心，最基本的功能。<br>换句话说，我用20%的代码，实现了他们80%的功能，至于另外比较难实现的20%, 我干脆不要了~</p>
<p>我对LightPHP的定位是一个库，并非框架，这一点可以体现在LightPHP对全局命名空间几乎没有污染，LightPHP的各个部分也比较松散，可以单独使用。<br>LightPHP也从未规定应用的文件如何组织，没对应用的代码做什么假设。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/29/2013/2013-06-29#%E5%87%BA%E5%94%AE%20WordPress%20%E4%B8%BB%E9%A2%98%E6%98%AF%E8%BF%9D%E6%B3%95%E7%9A%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/29/2013/2013-06-29#%E5%87%BA%E5%94%AE%20WordPress%20%E4%B8%BB%E9%A2%98%E6%98%AF%E8%BF%9D%E6%B3%95%E7%9A%84/" itemprop="url">出售WordPress主题是违法的</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-29T00:00:00+08:00">
                2013-06-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>标题党了，应为：出售WordPress主题，并禁止二次分发的行为是违反协议的。</p>
<p>所谓二次分发就是说，我购买了这个主题，然后我又将我买到的主题分享或出售给其他人。</p>
<p>略绕口，听我细细道来。</p>
<p>起因是今天瞧到了一个不错的主题，但是是收费的，于是我又想起来这茬了，开始查相关的资料。</p>
<p>中文的资料没太多的权威性，大部分还是翻的英文的资料。</p>
<p>WordPress使用GPL授权[注1][注2], GPL是一个非常严格的，意图保证源代码自由的协议。</p>
<p>即GPL保障任何人，以任何目使用，获取源代码，修改，分发的自由。</p>
<p>除此之外，GPL还具有苛刻的“传染性”，任何形式的衍生作品，都必须采用同样的GPL协议。</p>
<p>&#8220;Themes are GPL, too&#8221;<a target="_blank" rel="noopener" href="http://wordpress.org/news/2009/07/themes-are-gpl-too/">注3</a>这是WordPress创始人Matt Mullenweg于官方博客发表的文章，大意是经过认真地研读GPL和相关法律，WordPress的主题和插件作为衍生作品，必须使用同样的GPL协议。</p>
<p>其理由是，主题和插件与WordPress是不可分割的部分。主题使用了WordPress提供的接口，在运行时，WordPress和主题存在着交叉调用的行为，主题可以控制WordPress运行的几乎所有细节。不能认为WordPress是一个运行环境，而应该认为主题是对WordPress的扩展，是WordPress的衍生作品。</p>
<p>但图片资源, CSS 和 JS脚本例外，因为它们的运行，与WordPress是分离的，在服务器端由Web服务器提供，在客户端由浏览器运行，并未参与到WordPress的运行逻辑中。</p>
<p>所以，主题的PHP(包括混杂了PHP的HTML)文件必须使用GPL授权, 静态资源不受此限制，但因为GPL的规定，它们必须分别单独打包发布，否则会被传染。</p>
<p>Matt Mullenweg还要求SFLC(自由软件法律中心)澄清WordPress主题面临的法律问题，SFLC认可上述观点<a target="_blank" rel="noopener" href="http://article.yeeyan.org/view/pestwave/118084">注4</a>.</p>
<p>GPL并不限制出售源代码，但关键在于二次分发，GPL保障了购买者二次分发的自由，因此购买者可以随意分享甚至出售购买到的主题。</p>
<p>除非作者提供了额外的服务，如针对性地协助修改源代码，否则在这种情况下很难谈出售了，因为任何人都可以代替你来出售&#8230;</p>
<p>WordPress在其官网<a target="_blank" rel="noopener" href="http://wordpress.org/about/license/">注5</a>委婉地写道“我们认为主题和插件作为衍生作品应当使用GPL, 但目前这还属于法律上的灰色地带，你至少应当使用Apache, BSD等开源协议”.</p>
<p>而同样是GPL授权的Drupal则强硬得多<a target="_blank" rel="noopener" href="https://drupal.org/licensing/faq/#q7">注6</a>, 明确要求所有插件必须以GPL发布。对于是否可以出售主题，其写道<a target="_blank" rel="noopener" href="https://drupal.org/licensing/faq/#q9">注7</a>“你可以出售主题，但必须保障其他人二次分发的自由”，同时还指出，如果代码经过了混淆或压缩，应当提供未经混淆的版本。</p>
<p>在官网论坛，有人提出<a target="_blank" rel="noopener" href="http://wordpress.org/support/topic/gpl-themes-for-money-do-i-understand-the-gpl-right">注8</a>, 是否可以自己建立一个网站，收集付费主题，并提供免费下载。回复者表示这种行为是当然是合法的，但是好像在质疑他的动机，这帖子我没大看懂，有点太长了。</p>
<p>同时这篇文章<a target="_blank" rel="noopener" href="http://www.blogherald.com/2009/06/22/woothemes-goes-gpl-more-will-follow/">注9</a>还指出，法官更可能将WordPress的GPL许可证考虑在先，因此即使主题作者声称禁止二次分发，这种声称也是无效的，任何人依然可以合法地进行二次分发。</p>
<p>结论：</p>
<ul>
<li>WordPress主题和插件是WordPress的衍生作品，必须使用GPL授权</li>
<li>可以出售WordPress的主题和插件, 但GPL赋予了购买者二次分发的权利</li>
<li>不能发布经过加密，混淆，编译的代码，除非提供一份原始代码</li>
<li>即使主题作者声称禁止二次分发，任何人依然可以合法地进行二次分发</li>
<li>这样的话，如果仅仅是出售源代码，没有额外的服务，根本不可能收到钱</li>
<li>除非将静态资源分别打包，否则它们也会被GPL传染</li>
</ul>
<p>参考：</p>
<ul>
<li></li>
<li>[注2]: GPL原文 <a target="_blank" rel="noopener" href="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</a></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/27/2013/2013-06-27#%E5%B0%8F%E7%92%90%E6%98%AF%E5%A5%BD%E4%BA%BA%E3%80%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/27/2013/2013-06-27#%E5%B0%8F%E7%92%90%E6%98%AF%E5%A5%BD%E4%BA%BA%E3%80%82/" itemprop="url">小璐是好人。</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-27T00:00:00+08:00">
                2013-06-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>今天体育活动课，手机没电了，无聊，看着你做物理题，很酷的样子。可你敢不敢让我看看是什么题做了那么久那么费劲。让我坐了半节课，总之我还是很无聊，除了我又想到了一些乱七八糟完全不挨边的记忆碎片。</p>
<p>这一周状态都不怎么样，周一到周五，在学校基本都是一睡就是一整天，脸被压得都是印子&#8230;晚上在家躺下又睡不着，楼下工地连下雨都不停工了，躺下一个小时还睡不着，索性决定不睡了——这样反而能把作息调过来。但拿起手机，不到半个小时又困了&#8230;一直这样，连着几天了。</p>
<p>今天倒是只睡了三节课，和前几天比算少的，总体来说算正常。今天从凌晨开始，RP主机的两个节点就约好了似的一起抽风。今天白天上课我和我亲爱滴上帝们刷了几百条聊天记录，因为学校坑爹的网速，到现在(临近放学)也不能确认到底发生了什么，还得等我回家再说。所以手机就早早地没电了，所以连睡觉的心情都没有了。</p>
<p>想初三临近中考的不到四个月时间，我也曾扑在学校功课上过。我不大喜欢提这段日子，因为从上高中以来，对高中教育越来越失望，觉得当时的努力是不值得的，如果我是去一个略“不好”一点的市重点，或者哪怕不是十中的“快班”，也许老师会更加看重综合能力，而不仅仅是分数。在十中，虽然有几个志同者，但可惜道不合——他们还是要考大学的，没有多少多余的精力。扯远了&#8230;</p>
<p>想初三，从我“扑在学校功课”上之后，几乎是立刻就和班里以前从不说话的(爱学习)的妹纸们搞好了关系(我们班学习的男生&#8230;真心没有吧)，挨个抓住问各种题，主要是数学和英语。数学和英语，以及不想睡觉的时候，去第一排听课，反正临近中考已经不剩几个人了，有得是空座。其他课困了就回最后一排睡觉，初中两年我的座位一直都在最后一排，不像现在的班主任，前前后后来回调。扯远了&#8230;</p>
<p>想初三，英语是我的硬伤之一，于是去找英语老师，约好每天做一张模拟卷，她给我讲解。后来我也没坚持下去，大概只坚持了不到两周吧。因为英语这个硬伤，我以前也一直对英语老师忽冷忽热的，说起来感觉自己都没脸见人家&#8230;没想到现在相比其他科目，我英语倒算是分高的，上次期中考试85分&#8230;这意味着这半年混英文社区有点成效，即使是和学校课程重叠的部分也接近及格了。扯远了&#8230;</p>
<p>想初三，上面说的种种其实也只坚持了差不多两个月而已，一方面是我的数学和英语分数确实都上来了，一方面是我在犹豫去哪个高中甚至上不上高中。总之，中考前的最后两个月，有点泄气了的感觉。无聊，就用忘记是哪个老师送我的本子写日志，当时的日志已经接近现在的水平了，虽然有些话题略显幼稚。坐在第二排的妹纸喜欢看我的日志，于是那是我字写得最好的一个本子。我但凡写下的东西，都是给人看的，但是我不喜欢别人看我没写完的文章。虽然我写的日志题目和内容看起来完全没关系，我嘴上也说毫无关系，但我心里死活认为段落安排，题目的挑选，是有只可意会不可言传之精妙的，看了一半，当然意会不到了。又扯远了&#8230;</p>
<p>我也怀念那段日子，像每一个同学一样，像老师期望的那样，为一个单纯的目标去努力，即使是徒劳无功的，即使是“对人生没有一丁点”帮助的(《那些年，我们一起追过的女孩》). 像初中那样，占着几个科目的第一，可以天天粘着老师跑。像现在的炮哥那样在除了语文和英语以外的科目那么潇洒。</p>
<p>就像前一阵搞社工库那样，看同学们一天天吊儿郎当的样子(今天看你做题，我收回这句话好了)，我总觉得如果是我，我可以做的更好&#8230;</p>
<p>现在我多少还有那么一丁点自卑吧，尤其对那些不是很熟的同学找我借书，借卷子(其实根本不可能还了), 有些语气还特别硬。先不论我以后会不会心血来潮突然用到，你们总说“反正你不用，行个方便”，方便个毛啊，直接不发我卷子，也不用收我钱了岂不是更方便。</p>
<p>现在我说忙也忙，日程表排得很满，GFW还三天两头给我找点麻烦。说闲倒也闲，因为我从来没按日程表走过，总是一拖再拖。而且我还有时间看读者意林青年文摘的鸡汤文，有时间看小说绘那些架空小说，上课有时间玩手机，回家有时间打游戏。说实话看看学校功课的精力也是有的，但是，我一直没找到一个好的理由说服自己这么做，终究不是同路人啊。</p>
<p>恰相反，我觉得上大学才是逃避，你以为考个二本甚至一本有多难(最近勉强从新闻中对这些词有了点概念), 然后我按部就班上大学，什么事情都不用自己操心，照着做就是了，这才叫逃避。和你们不一样，我的目标清晰，明确，不去实现，那就是逃避。唉~终究不是同路人啊。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/23/2013-06-23-alipay-plugin-mechanism/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/23/2013-06-23-alipay-plugin-mechanism/" itemprop="url">分析支付宝客户端的插件机制</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-23T12:39:00+08:00">
                2013-06-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <img src="/images/alipay-plugin-1.jpg" class="">

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为开了 iOSDevTips 的微信公共账号，老收到各种 iOS 开发的问题，前两天收到一个问题的内容是：</p>
<blockquote>
<p>请问像支付宝钱包那样可以在应用里安装自己的应用，是已经在应用里写了逻辑，还是可以向应用里发送代码 ?</p>
</blockquote>
<p>我觉得这个问题挺有意思的，估计大家都感兴趣，所以今天就抽空研究了一下，将支付宝客户端的插件机制具体实现方式介绍给大家。</p>
<p>先介绍一下该插件机制，如上图所示，支付宝客户端在安装后，对于像 “彩票”、“爱心捐赠” 这类功能，需要再点击安装一次，然后才可以使用。有些时候该插件功能进行了升级，需要点击升级才可以继续使用。插件的方式有利于软件动态增加新的功能或升级功能，而不用再一次向 AppStore 提交审核。另外，由于用户不需要的插件可以不用安装，也缩小了应用本身的体积大小，节省了下载流量。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2013/06/23/2013-06-23-alipay-plugin-mechanism/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/20/2013/2013-06-20#%E5%A6%B9%E7%BA%B8%E8%AF%B4%E4%B8%8D%E8%A6%81%E6%88%91%E6%90%9E%E7%A4%BE%E5%B7%A5%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/20/2013/2013-06-20#%E5%A6%B9%E7%BA%B8%E8%AF%B4%E4%B8%8D%E8%A6%81%E6%88%91%E6%90%9E%E7%A4%BE%E5%B7%A5%E5%BA%93/" itemprop="url">妹纸说不要我搞社工库</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-20T00:00:00+08:00">
                2013-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <blockquote>
<p>这个博客创建于精子 7 岁第一天上学的时候，之后的十几年里精子的成长和价值观的改变是很大的。<br>所有的日志发布之后除了错别字都不会再修改，因此他可能并不完全同意早期日志中的观点。</p>
</blockquote>
<p>简单说，社工库是这样一个神奇的东西，你只需要输入一丁点信息，如QQ号，或姓名，手机，就可以查到一个人的其他个人信息。除了QQ, 姓名，手机外，还会有身份证，住址等等，甚至包括他在各大网站的帐号和密码。</p>
<p>行外人可能惊奇于它是如何实现的。事实上网络比你想象得要险恶得多，各大互联网公司时刻都在收集你的个人信息。一个人，一个公司，总会有疏忽，这些资料一旦被泄露出来便无法挽回。久而久之，从这些泄露的资料中找到一个人显得十分简单。</p>
<p>所谓社工库就是要将这些泄露的资料汇总到一起，让查询更为方便，自动化。同时通过计算，在这些资料中挖掘出更多的关联。已经有人在这么做了，但我觉得我能做得更好，所以我开始对这个项目感兴趣。现在流行谈“大数据”，一个人掌握百G级别的数据并加以利用，是很有诱惑力的。</p>
<p>但这种项目的法律风险是显而易见的，我意识到，一旦我付出了努力，我绝不会放弃，也不会甘心于“内部使用”，我一定会(视图)将它做大，但相应的风险是我承受不了的。</p>
<p>于是我决定放弃这个项目，但我依然希望有人能够实现它，所以接下来我将描述关于这个项目我所设想到的所有技术细节，如果有人感兴趣，我可以进一步提供技术方面的指导，不感兴趣的看到这里可以洗洗睡了。</p>
<p>我决定给它起个代号叫做 BC.</p>
<p>BC计划由PHP编写，PHP是最通用，最容易部署的Web语言之一。事实上BC中，PHP的逻辑很少，大部分工作是数据库来完成的，所以使用PHP之外的其他语言来实现也没有问题。当然，如果你需要收费的话，还需要引入一个用户系统。</p>
<p>我决定使用三款数据库：MySQL, MongoDB, Memcached.</p>
<p>MySQL用于储存用户数据，和其他的一些数据量较少的信息。这是因为相比于MongoDB, MySQL还是更为稳定和成熟的。</p>
<p>社工库的主体由MongoDB储存，MongoDB在平时是只读的(平时需写入的数据在MySQL中).</p>
<p>每一份泄露出来的资料都有不同的格式，比如 .mdb, .xls, .sql, 纯文本等等。</p>
<p>我们必须将它们以统一的格式导入到MongoDB中，否则一切都是空谈。</p>
<p>我能想到的最为通用的格式是CSV, 上述各种格式都可以很轻松地被转换到CSV, 而PHP内置了对CSV的支持，更何况自行解析简单的CSV也并不复杂。</p>
<p>我们需要为每一份导出的CSV编写PHP脚本，以将这些数据逐条导入到MongoDB中，好在各个CSV差不多只是字段顺序上的区别。</p>
<p>每一份资料所包含的字段都可能不同，不过这也没有关系，反正MongoDB是无模式的。</p>
<p>至于查询，就很简单了，接下来我们讨论性能优化。</p>
<p>如果不对MongoDB进行索引，那么每次查询都需要遍历百G级别的数据，这是无法容忍的。</p>
<p>BC的情况略为复杂，用户名，QQ, 手机号，这些字段都可能被用作查询。</p>
<p>所以我建议，先使用1G左右，较为典型的数据进行实验，根据结果对查询量最高的2-3个字段添加索引。</p>
<p>分片是MongoDB的重要功能之一，通过分片可以将查询均衡到多台服务器，利用更多的内存来加速查询。</p>
<p>借助于分片，理论上BC可以实现无限扩充，至于片键，还需要通过之前的实验来选择，当然，我觉得更大的可能性是选择用户名做片键。</p>
<p>除了最为基本的查询，我们还可以提供更多的功能。</p>
<p>如通过用户名，查询到了一个手机号，我们可以自动地根据这个手机号继续查下去，挖掘出更多可能同属一个人的信息。</p>
<p>但这样，原来一次简单的查询就可能变成十几次查询，这将会对数据库造成极大的压力。</p>
<p>细想一下，如果没有新的信息(泄露资料)加入，那么查询的结果是不会改变的，所以我们要引入缓存。</p>
<p>Memcached是一种选择，不过实际上，使用文件来缓存已经足够。</p>
<p>我们缓存每一次查询的结果(可以直接是HTML输出)到文件，再有重复的查询时，我们无需经过数据库，只需访问文件缓存即可。</p>
<p>而每当有新的泄露资料加入时，我们要清空缓存。</p>
<p>对于服务器选择，我的建议是选择同在内网的若干台服务器，一台提供Web服务，其他的作为MongoDB以及缓存服务器。</p>
<p>选择2G内存的服务器，每台储存50G的数据。数据服务器不接入外网，Web服务器通过内网向数据服务器进行查询。</p>
<p>至于盈利模式可以选择会员制，以下功能都是收费点：</p>
<ul>
<li>是否可以使用索引之外的字段进行查询</li>
<li>是否自动查找关联帐号</li>
<li>是否仅可以查看缓存</li>
</ul>
<p>附我前几天在邪红色论坛发的帖子：</p>
<blockquote>
<p>我也想搞个社工库，大家意向如何</p>
<p>如题</p>
<p>  我一毛钱的库都没有，但我有资金，有技术，有兴趣。</p>
<p>  我对社工什么的不是很了解，我主要是对“大量的数据”感兴趣。</p>
<p>功能：</p>
<p>  一个搜索框，可以搜用户名，QQ，邮箱，手机号码等。</p>
<p>  查询结果可显示符合条件的帐号的更多信息。</p>
<p>  同时，还会显示和这个帐号相关联的其他帐号(例如他们都使用了同一个手机号码).</p>
<p>  同时利用这些数据我们还会搞一些公益的项目，如统计最为常用的密码等等。</p>
<p>盈利模式：</p>
<p>  每月收取会员费，不限查询次数，未付费用户限每天1-10次查询。</p>
<p>  显示关联帐号也算会员的高级功能。</p>
<p>  上传新数据可抵会员费。</p>
<p>技术细节：</p>
<p>  数据库使用MongoDB, 服务器打算用Linode的服务器，使用Linode的主要原因是数据服务器不用外网IP，直接用内网。</p>
<p>  我会为每一个社工库写脚本，统一转入我们的数据库，进行统一的分析。</p>
<p>工期：</p>
<p>  一个月出雏形，两个月正式运营。</p>
<p>FAQ:</p>
<p>  Q：会员费大概多少？</p>
<p>  A：预计如果是100G左右的数据，会员费大概在10元&#x2F;月，如果数据量增加，会员费显然也要加。</p>
<p>Q：如何防御攻击？</p>
<p>  A：因为数据服务器没有公网IP，不会被DDOS.  提供Web服务的服务器即使被DDOS，也可以随时再开一台新的服务器。</p>
<p>Q：不限查询次数的会员帐号如何防止被人互相借用，导致没人购买新的会员</p>
<p>  A：登录帐号即可直接修改密码，对被盗帐号不予找回，看谁还敢借别人——敢借的都是真朋友，我们就不管了&#8230;</p>
<p>Q：邪红色有特别福利么？</p>
<p>  A：有，等着。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/19/2013/2013-06-19#%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%BE%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/19/2013/2013-06-19#%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%BE%8E/" itemprop="url">编程之美</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-19T00:00:00+08:00">
                2013-06-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>这是一篇文艺型的，科普性的软技术文 …</p>
<p>我所讲的不仅仅是编程，包括整个计算机和互联网领域。</p>
<p>现在，互联网已经遍布了世界的每一个角落，甚至包括地球之外，任何人可以在半秒之内，联结世界上任意两点。</p>
<p>计算机同样每时每刻都出现在我们的生活中。计算机和互联网的发明，可谓人类历史上最重要的科技革命之一。</p>
<p>计算机和互联网同样可以算是由全人类共同构建的，最精密也是最庞大的工程。</p>
<p>每一个芯片都是在纳米级被雕刻而成的，容不得哪怕一粒灰尘的差错。</p>
<p>当你在QQ上发出一条消息时，它会在光纤中穿过大半个中国，经过十几个路由的转发，调用若干台服务器，最后在不到一秒内被对方看到。</p>
<p>无数恐怖分子对互联网虎视眈眈，但它仍健壮地运作。</p>
<p>计算机是完美的，对于最终用户，他们能直接使用着“完美”的软件，而不必关心CPU如何执行指令，也不必关心电子如何在导线中运动。</p>
<p>事实上大部分程序员也不必关心这些。计算机是层层抽象的，每一层都隐去了下一层的丑陋之处。</p>
<p>借助这种抽象，我们可以逃离基于物理定律的现实世界，建立一个全新的，完美的世界。</p>
<p>数学，哲学，文学，都可以构造一个新的世界，但计算机又是以十分直接的方式在影响着现实世界，推动着生产力的提高。</p>
<p>计算机还是一个几乎全新的学科，仅60年历史，而互联网更是仅仅30年。</p>
<p>硬件在以摩尔定律预测的那样每年翻一番，而软件方面则一直没多大进展，没人知道计算机领域今后会发展成怎样。</p>
<p>相比于已经十分稳定的学科，计算机还在快速发展，有更多的变数，也有着更多可能取得突破的机会。</p>
<p>即使仅有60年的历史，计算机领域仍留下了无数的历史遗留问题。不同于自然科学的假设，论证，修正，也不同于数学或哲学的各自为战。</p>
<p>计算机是众人合力搭建的大楼，仅有一次机会，地基中一丁点的错误，都很难被改正，只能以之后更多的努力来尽力弥补。</p>
<p>这样看来，计算机也是不完美的，这就是它的动人之处。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/17/2013-06-17-startup-anniversary-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/17/2013-06-17-startup-anniversary-note/" itemprop="url">写在创业一周年</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-17T20:56:00+08:00">
                2013-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <img src="/images/startup-anniversary.jpg" class="">

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>大约在去年这个时候，我离开网易有道，开始了自己的创业不归路。一年过去了，总是在忙碌，在最忙的时候，我连博客都没有时间更新了。但是这一年的经历对我的成长重大，还是挺值得写下来的，在此将我的故事分享给那些一同走在创业路上的朋友。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2013/06/17/2013-06-17-startup-anniversary-note/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/17/2013/2013-06-17#%E7%94%B5%E5%BD%B1%EF%BC%9A%E9%82%A3%E4%BA%9B%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E8%BF%BD%E7%9A%84%E5%A5%B3%E5%AD%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/17/2013/2013-06-17#%E7%94%B5%E5%BD%B1%EF%BC%9A%E9%82%A3%E4%BA%9B%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E8%BF%BD%E7%9A%84%E5%A5%B3%E5%AD%A9/" itemprop="url">电影：那些年，我们一起追的女孩</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-17T00:00:00+08:00">
                2013-06-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>题目和正文无关。</p>
<p>我是个胆子很小，很不会说话的人，我喜欢写字，这样没有人打断我。</p>
<p>班主任给我的印象，就是一个没有感情的人，永远戴着面具，极少见她摘下来。不是我如何偏激，这是我见过的唯一一个这样的老师。</p>
<p>当白老师对我说“你这要是在我们班敢这么顶撞老师，同学早上去揍你了”时，为什么我听到了另外一层意思。　　</p>
<p>我也试着和她说过一些心里话，但一点用都没有。她就好像一个没有记忆的机器人。“赶紧进入学习状态”，“上操动作都快一点”，“在学校就要穿校服”我不会记差一个字。自诩作为语文老师有很高的文学素养，但骂人除了“恶心”外也只有偶尔的脏字。</p>
<p>班主任的下限随时在刷新。</p>
<p>前一阵，班主任在批评一个同学：“你说你还像一个男子汉么？”，碰巧我对这个同学的人品略有不满，我在等班主任接下来准备讲什么大道理，哪怕是“是男子汉就要争一口气多考几分”也好啊。她说的却是“做人的底线就是按时完成作业”，真让人掉胃口啊。</p>
<p>除了作业，她的做人底线还有“做人的底线就是不迟到”，“做人的底线就是保持安静”，“做人的底线就是天天穿校服”。</p>
<p>说实话，这也不算什么，每个人都有那么几个口头禅，都有点不怎么注意的细节，我也承认老师这个职业是非常非常辛苦的。</p>
<p>电影中，最令我感动的是，当老师怀疑是班级中的同学偷了钱，让同学们写字条互相指认的时候。有不止一个人能够站出来，指出老师不应该这么做，指出自己信任班级里所有的同学。我恨当时这种事发生在自己班上的时候，自己没有这样的胆量，只有在纸上，我才能写出这样一段话。</p>
<p>班主任在上次汽车莫名其妙被划的时候，就像这样让每个人拿一个纸条，写自己怀疑谁，或者其他线索，所有人必须交。在接下来至少一个星期里，整个班级陷入了一种诡异的，互相怀疑的气氛，而且整个事件，到现在也没个结果。</p>
<p>还有一年前，一位同学在交费的时候以十个一毛钱抵一元钱，引起班主任不满。这件小事立刻被上升到道德高度，“这件小事折射出某些同学心灵深处的一些东西”。</p>
<p>接着班主任开始点人，让同学们评价谁对谁错。</p>
<p>今天，班主任见班级纪律混乱，打算制定一番新规定，以及一套不大合情理的惩罚措施。这也没什么，规则要有，惩罚也要有。</p>
<p>但我最不爽的是班主任一定要挨个点同学站起来说该如何惩罚违反规则的人，借同学之口，说班主任她已经想好的话，直到说得满意了，才让人家坐下。</p>
<p>最后好像这些规则惩罚，都是同学们定的一样。最后还不忘要每个同学都写张纸条谈谈对这个规则有什么意见。</p>
<p>试问这种情况下，班级的凝聚力从何而来？作为班主任还有多少威信？有多少同学说的是真心话？</p>
<p>我期待被全班同学揍一顿的那一天。</p>
<p>以上我简单地解释了一下今天我顶撞老师的理由，既然让我写检讨书，就是让我先找理由嘛。</p>
<p>然后我应当反思我的错误。</p>
<p>首先，对于一年前我指正班主任一个微不足道的错误事情，我现在意识到了，是我过于敏感，故意给老师挑毛病。</p>
<p>不指出这个错误也并不影响班主任以不太可靠的论据来教育同学，一直以来我都爱在不值得一提的小事上较真，这确实值得我反思。</p>
<p>而今天的事情，我过于冲动了，我本来可以以略微委婉一些的方式来表达自己的观点，或者直接保持沉默。不应当以非常偏激，讽刺的话来顶撞老师。</p>
<p>从小到大，几乎每个长辈对我的评价无外乎两点，聪明，较真(固执).</p>
<p>我正在写的另一篇日志想说，我并不聪明，也许只是较真而已。不然我不会花那么多那么多的时间，顶着那么大那么大的压力，去读各种老师们所谓的“闲书”。</p>
<p>较真，有利有弊，今后我要尽量做到，对自己，对知识较真。对人对事，能退一步就退一步，用德育处一位老师的话说，“分清理想和现实”，说合适的话。</p>
<p>不得不说，德育处白老师，和我们班主任绝对不是同一等级的，一开始没让我说话，等让我开口的时候，我就知道我已经输了。白老师看人很准，说我较真，固执，幼稚，都十分准确。唯独“缺乏正能量”这点我不能同意，摘我上个月所写的一篇日志[注1]:</p>
<p>“我是个很固执，很天真的人，也许你觉得用天真来形容我很不恰当。但我相信世界总是在向好的方向发展，我相信正义终能战胜邪恶，阴暗面会越来越少，我相信付出总会有收获，我相信会有纯粹的友情和爱情，我相信宪法早晚能够切实落实下去，我相信每个人都有像我一样天真的一面，你相信么？这不是开玩笑，我觉得一个人的世界观，在17岁可以算是初步形成了。”</p>
<p>不管你怎么认为，我的出发点一样是好的，我当然爱这个世界，我的祖国，我的班级。</p>
<p>我的字条：“没(hěn)意(bù)见(shuǎng)，借同学之口，说你的话，有意思么”。</p>
<ul>
<li>注1：<a href="/2013/05/836">电影：致我们终将逝去的青春</a></li>
<li>关于班主任汽车被划事件，我在<a href="/2013/04/794">宽容和公平</a>这篇日志中讨论过</li>
<li>一年前<a target="_blank" rel="noopener" href="http://user.qzone.qq.com/184300584/blog/1341599719">写给班主任的第一封信</a></li>
<li>一年前<a target="_blank" rel="noopener" href="http://user.qzone.qq.com/184300584/blog/1341925882">写给班主任的第二封信</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/16/2013-06-16-ios-dev-tool-app-store-tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/16/2013-06-16-ios-dev-tool-app-store-tool/" itemprop="url">iOS开发工具篇-AppStore统计工具</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-16T12:26:00+08:00">
                2013-06-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>本文首发于 InfoQ，本文版权归 InfoQ 所有，转载请保留 <a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/appstore-statistical-tool">原文链接</a>。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着 iOS 开发的流行，针对 iOS 开发涉及的方方面面，早有一些公司提供了专门的解决方案或工具。这些解决方案或工具包括：用户行为统计工具（友盟，Flurry，Google Analytics 等),  App Store 销售分析工具（例如 App annie)， App crash 收集工具（例如 Crashlytics)，App 测试发布工具（Test Flight）, App Push 服务等。</p>
<p>这些解决方案或工具节省了 iOS 开发者大量的开发时间，但是由于相关介绍文章的缺乏，许多开发者都在重复着自己一次又一次重新造轮子。所以我希望，将我自己使用和调研的相关的第三方服务使用经验，整理成一系列文章，以便广大开发者能够省去大量的重复性工作。</p>
<p>今天介绍 AppStore 统计工具：App Annie 和苹果的命令行统计工具。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2013/06/16/2013-06-16-ios-dev-tool-app-store-tool/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/16/2013/2013-06-16#%E4%B8%BAPHP%E6%9E%84%E5%BB%BA%E5%8F%AF%E8%AF%BB%E7%9A%84%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/16/2013/2013-06-16#%E4%B8%BAPHP%E6%9E%84%E5%BB%BA%E5%8F%AF%E8%AF%BB%E7%9A%84%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A/" itemprop="url">为PHP构建可读的错误报告</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-16T00:00:00+08:00">
                2013-06-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>当年使用ASP.Net时，每当程序出错，ASP.Net均会显示一个“漂亮”的错误页，列出出错所在行附近的代码，调用栈和一些提示信息等等。</p>
<p>相比之下，PHP默认的报错信息十分简陋，仅仅指明了出错的位置。</p>
<p>本文将介绍通过PHP的错误处理相关函数，构造一个类似的，具有丰富的可利用的信息的错误页。</p>
<p><img src="http://social.msdn.microsoft.com/Forums/getfile/234858" alt="Asp.Net的错误页"></p>
<p>提示：本文示例至少需要PHP5.4, 本文使用了PHP5.4中的数组简写语法，和PHP5.3中的匿名函数语法。</p>
<p>应该说很多PHP框架都提供了类似的功能，本文展现的仅仅是其中一种方式。作者我并没有太多地参考其他PHP框架，仅仅是从官网文档下方的注释中精炼出了一些实用的功能。</p>
<p>错误信息并非任何时候都可以展示的，很多情况下，错误信息中包含了很多敏感的数据，容易被攻击者利用。所以显然我们首先要引入一个“运行级别”的概念，该级别将控制我们的错误页展示错误详细信息的程度。</p>
<pre><code>// 为避免污染全局命名空间，已对所有标识符加 `e` 前缀

/**
 *  运行模式
 *  * debug 调试模式, 会开启详细的日志记录和错误提示
 *  * default 默认模式, 会输出错误提示
 *  * production 生产模式, 不会执行任何额外操作, 最高效地执行代码
 */

const eDebug = 2;
const eDefault = 1;
const eProduction = 0;

const eRunMode = eDefault;
</code></pre>
<p>PHP5开始，PHP彻底进入OPP时代，但仍留下了不少历史遗留问题。比如直到目前，PHP的内部错误仍然没有以异常的方式实现，绝大部分的内置函数也没有以异常的方式来报告错误，这种内置的错误报告由<code>error_reporting</code>函数进行控制：</p>
<pre><code>// 默认关掉所有错误提示
error_reporting(0);
// 如果是默认模式，打开致命错误和解析错误的报告
if(eRunMode &amp;gt;= eDefault)
    error_reporting(E_ERROR | E_PARSE);
// 如果是调试模式，打开全部错误提示，并启用修改建议提示
if(eRunMode &amp;gt;= eDebug)
    error_reporting(E_ALL | E_STRICT);
</code></pre>
<p>为了能够在出现错误的时候，去除已有的输出，以及追加 HTTP 头，我们要开启缓冲：</p>
<pre><code>ob_start();
</code></pre>
<p>然后我们需要向PHP引擎申请通过我们自己的函数来接管错误处理的相关流程，这其中有两个关键函数：</p>
<ul>
<li>set_error_handler</li>
<li>set_exception_handler</li>
</ul>
<p>set_error_handler 会注册一个自定义函数用于接管由PHP产生的错误，set_exception_handler 会注册一个自定义函数用于接管在最外层仍未被处理的异常。</p>
<p>在这里，我们会用 error_handler 函数来将PHP产生的错误统一转换为异常，再通过 exception_handler 来实现错误页的展现。</p>
<p>set_error_handler 所注册的自定义函数会被传递5个参数，分别是错误号，错误描述信息，错误文件名和行号，当前上下文的符号表(当前时刻所有变量的值).</p>
<p>PHP文档中推荐我们在自定义函数中重新抛出 ErrorException 类型的异常，这是一个内置的异常类型，但它并没有提供储存符号表的功能，而错误发生时的符号表却是非常有用的，所以这里我选择了自己构造一个异常类型来代替 ErrorException, 以便能将符号表储存下来。</p>
<p>这个工作很简单：</p>
<pre><code>class ePHPException extends Exception
&#123;
    protected $severity;
    protected $varList;

    public function  __construct($message = &quot;&quot;, $code = 0, $severity = 1, $filename = __FILE__, $lineno = __LINE__, Exception $previous = null, $varList = [])
    &#123;
        $this-&amp;gt;severity = $severity;
        $this-&amp;gt;file = $filename;
        $this-&amp;gt;line = $lineno;
        $this-&amp;gt;varList = $varList;

        // 调用父类的构造函数
        parent::__construct($message, $code, $previous);
    &#125;

    public function getSeverity()
    &#123;
        return $this-&amp;gt;severity;
    &#125;

    public function getVarList()
    &#123;
        return $this-&amp;gt;varList;
    &#125;
&#125;
</code></pre>
<p>然后我们使用 set_error_handler 注册一个自定义函数将PHP报告的错误转换为抛出 ePHPException 类型的异常.</p>
<pre><code>set_error_handler(function($no, $str, $file, $line, $varList) &#123;
    throw new ePHPException($str, 0, $no, $file, $line, null, $varList);
&#125;);
</code></pre>
<p>然后我们要重新考虑运行级别的问题，在调试模式和默认模式时，我们打算显示错误信息，而在生产模式下，我们不打算显示任何信息：</p>
<pre><code>if(eRunMode &amp;lt;= eProduction)
&#123;
    set_exception_handler(function(Exception $exception) &#123;
        header(&quot;Content-Type: text/plant; charset=UTF-8&quot;);

        die(header(&quot;HTTP/1.1 500 Internal Server Error&quot;));
    &#125;);
&#125;
</code></pre>
<p>现在我们开始设计真正的错误处理函数，需要显示的信息包括：异常类型名，描述信息，调用栈，符号表，附近代码等等，这些信息都可以轻松地从异常对象上获取到：</p>
<pre><code>else
&#123;
    set_exception_handler(function(Exception $exception) &#123;
        // 暂时我们只打算以纯文本的形式展示信息
        header(&quot;Content-Type: text/plant; charset=UTF-8&quot;);

        // 头部
        print sprintf(
            &quot;Exception `%s`: %s\n&quot;,
            get_class($exception),
            $exception-&amp;gt;getMessage()
        );

        // 运行栈
        print &quot;\n^ Call Stack:\n&quot;;
        // 从异常对象获取运行栈
        $trace = $exception-&amp;gt;getTrace();
        // 如果是 ePHPException 则去除运行栈的第一项，即 error_handler
        if($exception instanceof ePHPException)
            array_shift($trace);

        // 只有在调试模式才会显示参数的值，其他模式下只显示参数类型
        if(eRunMode &amp;lt; eDebug)
            foreach ($trace as $key =&amp;gt; $v)
                $trace[$key][&quot;args&quot;] = array_map(&quot;gettype&quot;, $trace[$key][&quot;args&quot;]);

        // 用于打印参数的函数
        $printArgs = function($a) use(&amp;amp;$printArgs)
        &#123;
            $result = &quot;&quot;;
            foreach($a as $k =&amp;gt; $v)
            &#123;
                if(is_array($v))
                    $v = &quot;[&quot; . $printArgs($v) . &quot;]&quot;;
                else
                    if(is_string($v))
                        $v = &quot;`&#123;$v&#125;`&quot;;
                if(!is_int($k))
                    $v = &quot;`$k` =&amp;gt; $v&quot;;

                $result .= ($result ? &quot;, &#123;$v&#125;&quot; : $v);
            &#125;
            return $result;
        &#125;;

        // 打印运行栈
        foreach ($trace as $k =&amp;gt; $v)
            print sprintf(
                &quot;#%s %s%s %s(%s)\n&quot;,
                $k,
                isset($v[&quot;file&quot;]) ? $v[&quot;file&quot;] : &quot;&quot;,
                isset($v[&quot;line&quot;]) ? &quot;(&#123;$v[&quot;line&quot;]&#125;):&quot; : &quot;&quot;,
                $v[&quot;function&quot;],
                $printArgs($v[&quot;args&quot;])
            );

        print sprintf(
            &quot;#  &#123;main&#125;\n  thrown in %s on line %s\n\n&quot;,
            $exception-&amp;gt;getFile(),
            $exception-&amp;gt;getLine()
        );

        // 如果当前是调试模式，且异常对象是我们构造的 ePHPException 类型，打印符号表和源代码
        if(eRunMode &amp;gt;= eDebug &amp;amp;&amp;amp; $exception instanceof ePHPException)
        &#123;
            // 用于打印符号表的函数
            $printVarList = function($a, $tab=0) use(&amp;amp;$printVarList)
            &#123;
                $tabs = str_repeat(&quot;   &quot;, $tab);
                foreach($a as $k =&amp;gt; $v)
                    if(is_array($v))
                        if(!$v)
                            print &quot;&#123;$tabs&#125;`&#123;$k&#125;` =&amp;gt; []\n&quot;;
                        else
                            print &quot;&#123;$tabs&#125;`&#123;$k&#125;` =&amp;gt; [\n&quot; . $printVarList($v, $tab+1) . &quot;&#123;$tabs&#125;]\n&quot;;
                    else
                        print &quot;&#123;$tabs&#125;`&#123;$k&#125;` =&amp;gt; `&#123;$v&#125;`\n&quot;;
            &#125;;

            print &quot;^ Symbol Table:\n&quot;;
            $printVarList($exception-&amp;gt;getVarList());

            print &quot;\n^ Code:\n&quot;;

            // 显示出错附近行的代码
            $code = file($exception-&amp;gt;getFile());
            $s = max($exception-&amp;gt;getLine()-6, 0);
            $e = min($exception-&amp;gt;getLine()+5, count($code));
            $code = array_slice($code, $s, $e - $s);

            // 为代码添加行号
            $line = $s + 1;
            foreach($code as &amp;amp;$v)
            &#123;
                $l = $line++;
                if(strlen($l) &amp;lt; 4)
                    $l = str_repeat(&quot; &quot;, 4-strlen($l)) . $l;
                if($exception-&amp;gt;getLine() == $l)
                    $v = &quot;&#123;$l&#125;-&amp;gt;&#123;$v&#125;&quot;;
                else
                    $v = &quot;&#123;$l&#125;  &#123;$v&#125;&quot;;
            &#125;

            print implode(&quot;&quot;, $code);
        &#125;

    &#125;);
&#125;
</code></pre>
<p>下面我们编写一个示例来测试一下：</p>
<pre><code>function throwException()
&#123;
    class MyException extends Exception&#123;&#125;
    throw new MyException(&quot;Aal izz well&quot;);
&#125;

function call($func, $arg)
&#123;
    $func($arg);
&#125;

// 错误1：
call(&quot;array_keys&quot;, 1234);
// 错误2：
throwException();
</code></pre>
<p>下面是<code>错误1</code>在eDefault下的显示：</p>
<pre><code>Exception `ePHPException`: array_keys() expects parameter 1 to be array, integer given

^ Call Stack:
#0 /var/www/test.php(188): array_keys(integer)
#1 /var/www/test.php(192): call(string, integer)
#  &#123;main&#125;
  thrown /var/www/test.php on line 188
</code></pre>
<p>很不错！显示了错误信息和运行栈，运行栈中的参数内容都以类型掩去了。</p>
<p>在 eDebug 下：</p>
<pre><code>Exception `ePHPException`: array_keys() expects parameter 1 to be array, integer given

^ Call Stack:
#0 /var/www/test.php(188): array_keys(1234)
#1 /var/www/test.php(192): call(`array_keys`, 1234)
#  &#123;main&#125;
  thrown in /var/www/test.php on line 188

^ Symbol Table:
`func` =&amp;gt; `array_keys`
`arg` =&amp;gt; `1234`

^ Code:
 183      throw new MyException;
 184  &#125;
 185
 186  function call($func, $arg)
 187  &#123;
 188-&amp;gt;    $func($arg);
 189  &#125;
 190
 191  // 错误1：
 192  call(&quot;array_keys&quot;, 1234);
 193  // 错误2：
</code></pre>
<p>也如我们预期一样，在eDebug模式下，在运行栈中会显示参数内容，还会显示符号表和出错附近的代码。</p>
<p>至于eProduction模式，服务器没有返回任何信息，浏览器直接给出了下面的错误提示：</p>
<p>HTTP 错误 500（Internal Server Error）：服务器尝试执行请求时遇到了意外情况。</p>
<p>错误2的eDefault模式(其他两个模式不再详细展示)：</p>
<pre><code>Exception `MyException`: Aal izz well

^ Call Stack:
#0 /var/www/test.php(194): throwException()
#  &#123;main&#125;
  thrown in /var/www/test.php on line 183
</code></pre>
<p>就这样，我们通过百行左右的代码实现了一个具有丰富的可利用信息的PHP错误页，除了我们仅仅是纯文本，已经不逊色于Asp.Net的错误页了。</p>
<p>这将会是非常值得的，会为你的调试工作带来很多方便。</p>
<p>本文全部代码：<a target="_blank" rel="noopener" href="https://gist.github.com/jybox/5789249">https://gist.github.com/jybox/5789249</a></p>
<p>应该说，这个方案是存在硬伤的：PHP并不允许用户使用自定义函数处理致命错误！这包括无法解析的语法，调用未定义的函数等等行为，在发生致命错误时，仍会出现PHP那“丑陋”的错误提示。好在，但凡是致命错误，大都是很容易更正的，反倒是那些乱七八糟的“警告”和“提示”，最难以调试，这也是本文希望解决的问题。</p>
<p>更进一步地，你可以使用PHP的反射机制，获取更多的信息用于调试：<a target="_blank" rel="noopener" href="http://www.php.net/manual/zh/book.reflection.php">http://www.php.net/manual/zh/book.reflection.php</a></p>
<p>所谓反射，就是在运行时，与PHP的解释器进行交互，获取关于代码的元信息，进行“反向工程”的一种机制，使用反射，你可以深入地挖掘类，函数，扩展的元信息。</p>
<p>比如，获取一个匿名函数的源代码：<a target="_blank" rel="noopener" href="http://segmentfault.com/q/1010000000160912">http://segmentfault.com/q/1010000000160912</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/14/2013/2013-06-14#%E9%9B%B6%E6%AF%AB%E7%A7%92%EF%BC%9AKademlia%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/14/2013/2013-06-14#%E9%9B%B6%E6%AF%AB%E7%A7%92%EF%BC%9AKademlia%E7%AC%94%E8%AE%B0/" itemprop="url">零毫秒：Kademlia 笔记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-14T00:00:00+08:00">
                2013-06-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>Kademlia协议(模型)是被电驴，BitTorrent所采用了的，基于异或距离算法的分布式散列表(DHT), 它实现了一个去中心化的信息储存与查询系统。</p>
<p>Kademlia将网络设计为一个具有160层的二叉树，树最末端的每个叶子便是一个节点，节点在树中的位置由同样是160bit的节点ID决定。</p>
<p>每个bit的两种可能值(0或1), 决定了节点在树中属于左面还是右面的子树，160层下来，每个节点ID便都有了一个确定的位置。</p>
<p>Kademlia使用独特的异或距离算法来计算节点间的距离，异或是一种简单的数学计算，它有很多独特的性质，这些性质在之后会为我们带来方便：</p>
<pre><code>自己与自己的距离为0:
x ^ x = 0
不同的节点间必有距离:
x ^ y &gt; 0
交换律，x到y的距离等于y到x的距离:
x ^ y = y ^ x
从a经b绕到c, 要比直接从a到c距离长:
a ^b + b ^ c &gt;= a ^ c
下面两个是资料上提到的，似乎很重要，但我不大理解他们的含义:
a + b &gt;= a ^ b
(a ^ b) ^ (b ^ c) = a ^ c
</code></pre>
<p>在Kademlia中，异或(距离)算法具有单向性(或者说一一对应关系)，即给定一个节点和一个距离，必定存在唯一一个相对应节点。包括距离算法在内的，Kademlia中大部分的概念，都既有算术上的意义，又可以在节点树上表现实际意义。</p>
<p>事实上，节点间距离反映的就是节点ID中比特的差异情况，而且越靠前的比特权值越大。或者说是反映节点在树中相隔了多少个分支，需要向上多少个树节点才能找到共同的祖先节点。</p>
<p>Kademlia中使用了名为K-桶的概念来储存其他(临近)节点的状态信息，这里的状态信息主要指的就是节点ID, IP, 和端口。</p>
<p>对于160bit的节点ID, 就有160个K-桶，对于每一个K-桶i, 它会储存与自己距离在区间 [2^i, 2^(i+1)) 范围内的节点的信息，每个K-桶中储存有k个其他节点的信息，在BitTorrent的实现中，k的取值为8.</p>
<p>下表反映了每个K-桶所储存的信息</p>
<table>
<tr><td>K-桶</td><td>储存的距离区间</td><td>储存的距离范围</td><td>储存比率</td></tr>
<tr><td>0</td><td>[2<sup>0</sup>, 2<sup>1</sup>)</td><td>1</td><td>100%</td></tr>
<tr><td>1</td><td>[2<sup>1</sup>, 2<sup>2</sup>)</td><td>2-3</td><td>100%</td></tr>
<tr><td>2</td><td>[2<sup>2</sup>, 2<sup>3</sup>)</td><td>4-7</td><td>100%</td></tr>
<tr><td>3</td><td>[2<sup>3</sup>, 2<sup>4</sup>)</td><td>8-15</td><td>100%</td></tr>
<tr><td>4</td><td>[2<sup>4</sup>, 2<sup>5</sup>)</td><td>16-31</td><td>75%</td></tr>
<tr><td>5</td><td>[2<sup>5</sup>, 2<sup>6</sup>)</td><td>32-63</td><td>57%</td></tr>
<tr><td>10</td><td>[2<sup>10</sup>, 2<sup>11</sup>)</td><td>1024-2047</td><td>13%</td></tr>
<tr><td>i</td><td>[2<sup>i</sup>, 2<sup>i+1</sup>)</td><td>/</td><td>0.75<sup>i-3</sup></td></tr>
</table>

<p>放在节点树上，即每个节点都更倾向于储存与自己距离近的节点的信息，形成 <strong>储存的离自己近的节点多, 储存离自己远的节点少</strong> 的局面。</p>
<p>从上表可以看出，在1-15这个范围内的节点，只要发现，就会被100%地储存下来，而离自己距离在1000左右的节点，只会储存13%.</p>
<p>对于一个节点而言，K-桶就代表着节点树上那些未知的节点(其实除了自己都是未知的)构成的子树，160个K桶分别是具有1到160层的子树，由小至大。对于节点ID, 160个K-桶分别储存着节点ID前0到159个bit和自己一致的节点。</p>
<p>K-桶中的条目(其他临近节点的状态信息)排序的，每当收到一个消息(如查询)时，就要更新一次K桶。</p>
<p>首先计算自己与对方的距离，然后储存到对应的K-桶中，但如果K-桶已满(前面提到每个K-桶储存有k&#x3D;8个条目), 则会倾向放弃储存，继续保持旧的节点信息(如果还有效的话). 除了距离外，Kademlia更倾向于与在线时间长，稳定的节点建立联系。</p>
<p>这是因为实践证明，累积在线时间越长的节点越稳定，越倾向于继续保持在线，即节点的失效概率和在线时长成反比。</p>
<p>这样还可以在一定程度上抵御攻击行为。因为当大量恶意的新节点涌入时，大家都会选择继续保持旧的节点信息，而不是接受新的。</p>
<p>除此之外，还需要定时检查K-桶中的节点是否任然在线，及时删去已失效节点。</p>
<p>Kademlia协议仅定义了四种操作：</p>
<ul>
<li>PING: 探测一个节点是否在线</li>
<li>STORE: 令对方储存一份数据</li>
<li>FIND NODE: 根据节点ID查找一个节点</li>
<li>FIND VALUE: 根据键查找一个值(数据)</li>
</ul>
<p>当查找一个节点时，首先计算自己与目标节点的距离d, 然后将 log<sub>2</sub>d 向下取整，找到对应的K-桶，从这个K-桶中选取a个节点(在BitTorrent的实现中取值为3), 向它们发送查询。</p>
<p>收到查询的节点同样计算距离后从自己的对应K-桶中选取a个节点返回给查询者。查询者不断重复这个过程，知道找到目标节点，或无法再找到更近的结果。</p>
<p>很多资料将这个过程描述成是递归的，但我觉得这里认为它是迭代的更为恰当。</p>
<p>因为每个节点都更倾向于储存距自己近的节点的信息，而整个网络又是一个二叉树，因此每次查询都会至少取得距离减半的结果，对于有N个节点的网络，至多只需要 log<sub>2</sub>N 次查询。</p>
<p>当进行 FIND VALUE 操作时，查询操作是类型的，每份数据都有一个同样是160bit的键，每份数据都倾向于储存在与键值距离较近的节点上。</p>
<p>当上传者上传一份数据时，上传者首先定位几个较为接近键值的节点，用STORE操作要求他们储存这份数据。</p>
<p>储存有数据的节点，每当发现比自己与键值距离更为接近的节点时，便将数据复制一份到这个节点上。</p>
<p>当一个新节点欲加入网络时，只需找到一个已在网络中的节点，借助它对自己的节点ID进行一次常规查询即可，这样便完成了对自己信息的广播，让距自己较近的节点获知自己的存在。而离开网络不必执行任何操作，一段时间后，你的信息会自动地从其他节点被删除。</p>
<p>毫无疑问，Kademlia要比我之前为零毫秒设想的网络模型优秀得多，更为彻底地实现了去中心化，弱化了关键节点失效对整个网络的影响。而电驴和BitTorrent的实践也证明了kademlia是具有相当的可行性的。</p>
<p>Kademlia的精妙之处在于它选择了异或运算作为计算距离的依据，异或运算不仅具有算术的意义，在二叉树式的网络模型中，同样具有实际意义，同时任何情况下都在强调距离的概念，让节点间通过距离来聚合起来。</p>
<p>在上一篇日志的末尾，我便在思考如何来聚合节点，现在通过Kademlia, 我算是找到了。下一步我想思考的是，既然以上是Kademlia的优势，那么它的弱势在哪？哪些地方存在不足？</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2013/06/12/2013/2013-06-12#%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/12/2013/2013-06-12#%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" itemprop="url">笔记：公钥加密算法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-12T00:00:00+08:00">
                2013-06-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
          
            <p>在一年多以前，我曾计划写一个系列，关于密码学基础的科普文章。但当我写完第一篇，散列算法的时候，便觉得自己功力尚浅，仍需修炼。今天重新捡起来，写下去。</p>
<p>公钥密码学，也称非对称加密，可以说是现代密码学的基础设施之一。公钥密码学也可以说标志着现代密码学的诞生，让密码学从政府，军方之间的斗智斗勇，成为了具有严谨数学基础的学科。</p>
<p>目前使用最为广泛的公钥加密算法：RSA, 其发明者因此获得图灵奖(计算机领域的最高奖项).</p>
<p>应该说密码学一直以来和军队，战争都是密不可分的。</p>
<p>我们设想这样一个场景，同属一个阵营的两个部队，被相隔一段距离，其间都被地方部队占领，这意味着他们之间通过信使传递的所有信息，都是可能被敌人监控(阅读)的。</p>
<p>那么如何在事先没有沟通的情况下安全地交换信息呢？</p>
<p>对于经典的对称加密算法(对等加密, 共享密钥加密), 这是很难做到的。因为对称加密需要一个密钥(密码), 而两个部队事先是没有沟通过的，没有对密钥达成共识。</p>
<p>而且他们现在也不可能再协商密钥，因为现在他们所有的通信都是被监控的了，一旦他们在这种环境下协商密钥，那么敌人也会知道密钥，便也能解密他们之后传送的加密信息。</p>
<p>对称加密对加密和解密都使用同一个密钥，我们可能需要的是一种针对加密和解密，使用不同密钥的加密算法，这便是非对称加密的含义。</p>
<p>试想，部队A可以生成一对密钥，分别用于加密(公钥)和解密(私钥), 然后将公钥发送给部队B. B便可以使用这份密钥对信息进行加密，再将加密信息发送回A了。</p>
<p>这里的公钥，即使被敌人获取也没有关系，因为这里的公钥，仅仅能够用于加密数据，而唯一可以解密数据的私钥，自始自终都在A手中，从未公布出去。</p>
<p>这样一来，A和B便可以在受监控的情况下，没有实现沟通，便能安全地交换信息了。</p>
<p>让我们进一步设想，如果敌人可以篡改A和B之间发送的信息呢？</p>
<p>例如当A发送公钥给B的时候，敌人将公钥拦截下来，自己生成一堆公私钥，将自己的公私钥发送给B. 相当于敌人冒充了B与A建立联系，建立了两个加密通道，分别是从A到敌人，和从敌人到B.</p>
<p>这样以来，敌人便可以在两个通道之间，监控到A和B通信的明文了，同时敌人还可以任意篡改A和B之间发送的信息，即使它们已经被加密。</p>
<p>这便是经典的“中间人攻击”. 应该说如果A和B没有事先沟通过，而且没有一个可信的第三方，那么这个问题几乎是无解的。</p>
<p>但如果允许A和B事先进行沟通，该如何在敌人可以篡改信息的前提下，安全地交换信息呢？</p>
<p>其实这个问题很好解决，只需在实现沟通时互相交换密钥即可，其后敌人(中间人)便无法再进行冒充了，因为密钥根本没有在这时被交换。</p>
<p>然而更为通用的做法是使用“数字签名”，数字签名恰好是公钥加密的逆运算。即将加密密钥保密，而将解密密钥公布出去，使得只有自己可以加密信息，而任何人都可以解密信息。</p>
<p>要实现数字签名，只需自己将要签名的信息(通常是一个散列摘要值)加密并公布即可，其他人可以认为，凡是用你公布出去的解密密钥能解密的信息，都是你自己加密(签名)过的。</p>
<p>这样便可以识别一段信息，是否真正地由其宣传的发信人所发送，识别出被中间人所篡改的信息。</p>
<p>在前面的情况下，我们还需要考虑的是“重放”攻击，即中间人虽然不知道A和B传输的实际内容，但却可以将其中的一份信息复制两遍甚至更多，已达到干扰的目的。通常应对重放攻击只需在加密信息中约定一个递增的编号，或者时间戳即可。</p>
<p>下面我们来讨论公钥加密算法(RSA)背后的数学原理，本人数学很渣，只能大概谈谈应用RSA时需要了解的一些原理，更详细的数学原理请围观各种大牛的文章，如：  <a target="_blank" rel="noopener" href="http://www.matrix67.com/blog/archives/5100">http://www.matrix67.com/blog/archives/5100</a></p>
<p>RSA基于这样一个原理：计算两个数的乘积是十分容易，但对一个数进行因式分解，得到这两个数却十分不易。</p>
<p>可能这个原理并不直观，甚至有点反常识，但RSA选择的两个数的乘积，都是2^2048这样数量级的数字，换算为十进制，那么将会是1后面跟6000多个0.</p>
<p>直到目前，对大数进行因式分解仍是一个难题，数学家还没有找到比试除法更高效一点的方法，因此在目前，对一个足够大的数进行因式分解可以认为是一项不可能完成的任务。但也不排除今后有数学家发明进行因式分解的简单方法，届时，RSA算法，甚至整个密码学，整个世界都会坍塌。</p>
<blockquote>
<p>有点虎头蛇尾啊，本来打算最后举一个RSA计算的例子的，结果还是写不下去 …</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/69/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/69/">69</a><span class="page-number current">70</span><a class="page-number" href="/page/71/">71</a><span class="space">&hellip;</span><a class="page-number" href="/page/79/">79</a><a class="extend next" rel="next" href="/page/71/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1579</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">64</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">914</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
