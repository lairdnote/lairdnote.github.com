<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/20/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/20/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/31/2020-10-28-post06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/31/2020-10-28-post06/" itemprop="url">盘点 Mac 上好用的七个软件</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-31T08:07:38+08:00">
                2020-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>距离上一次写 Mac 上的软件，刚好过去两个月，错过的朋友可以戳这里：  </p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/tTRy9mw8ybFdQl6CZjO-Bg">Mac新手装机软件清单</a></p>
<p>这一次，我又带来了七款新的软件，每款软件的简介如下，其中既有免费也有付费的软件，下面会分明注明每一款软件的价格，方便有需要的朋友进行决策。  </p>
<p><img src="http://cdn.penghh.fun/mweb/16041106783088.jpg" alt="-w854"></p>
<h2 id="小历"><a href="#小历" class="headerlink" title="小历"></a>小历</h2><p>小历，是一款日历增强工具，点击状态栏的软件图标，它会以日历的形式呈现整个月份，且会在日期下方标注节日，如今天是「万圣节」，弥补了 Mac 原生日历的不足。</p>
<p>价格：买断制，18 元，可在 Mac App Store 下载。<br>软件开发者：钟颖，他还开发了一个更知名的应用「Pin」。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041129297630.jpg" alt="-w330"></p>
<h2 id="Keka"><a href="#Keka" class="headerlink" title="Keka"></a>Keka</h2><p>Keka，是一个压缩软件，之所以在 Mac 上要安装压缩软件，有两个原因：  </p>
<ul>
<li>使用 Mac 自带压缩功能压缩得到的压缩包，在 Windows 上可能会出现乱码的问题</li>
<li>Mac 自带的「归档实用工具」不支持解压 rar 格式的压缩包</li>
</ul>
<p>价格：Keka 在 Mac App Store 下载需要付费，在官网下载则是免费的。<br>官网：<a target="_blank" rel="noopener" href="https://www.keka.io/en/">https://www.keka.io/en/</a></p>
<p>附上使用 Keka 压缩文件的方法：右击文件，选择「服务 &gt;&gt; 使用 Keka 压缩」</p>
<p><img src="http://cdn.penghh.fun/mweb/16041133945379.jpg" alt="-w860"></p>
<h2 id="Day-One"><a href="#Day-One" class="headerlink" title="Day One"></a>Day One</h2><p>Day One，是一个设计简约的日记应用，它会在每条记录的左侧s突出显示日期，会自动记录你当前的位置、时间（具体到分钟）。</p>
<p>它还有一个「<strong>那年今日</strong>」的功能，和 QQ 空间的那年今日一样，当你使用 Day One 超过一年，它会在那年今日中显示去年的同一天你写下的东西，帮你唤起回忆。</p>
<p>价格：Day One 下载免费，采用按年订阅的模式，价格 250+（说实话比较贵），会员的功能有支持多台苹果设备同步、无限制添加照片和日记加密等。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041140239019.jpg" alt="-w1051"></p>
<h2 id="Zoommy"><a href="#Zoommy" class="headerlink" title="Zoommy"></a>Zoommy</h2><p>Zoommy，是一个聚合了多个无版权图库的图片应用，这对经常要找图的人来说非常友好，当然也可以用作壁纸软件，支持 Windows、macOS、Linux 三个平台。</p>
<p>我在前几天的文章中介绍过这款软件，还没看过的朋友可以戳：<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/l2bcxmO7igH4sZmGGFwQVg">史上第二全的壁纸下载攻略，以后别再找人要壁纸了。</a></p>
<p>价格：买断制，官网售价 4.99 刀，支付需要使用 Visa、万事达外币卡，图方便的话可以淘宝解决。</p>
<p>补充一下，Unsplash 图库不知从什么时候起，打开速度就变得非常缓慢，而在 Zoommy 中的访问速度还可以接受。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041160240909.jpg" alt="-w1101"></p>
<h2 id="Downie-4"><a href="#Downie-4" class="headerlink" title="Downie 4"></a>Downie 4</h2><p>Downie 4，可能是 Mac 上最强悍的视频下载工具，支持下载 B 站、腾讯、优酷等视频网站的视频，将视频的链接拖拽或复制到软件中，即可开始下载。</p>
<p>价格：买断制，79 元，双 11 期间可能有优惠。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041159502465.jpg" alt="-w1726"></p>
<h2 id="ScreeFlow"><a href="#ScreeFlow" class="headerlink" title="ScreeFlow"></a>ScreeFlow</h2><p>ScreenFlow，一款屏幕录制应用（录屏软件）。之前推荐过的截图软件 iShot 虽然也支持录屏，但它缺少了视频剪辑功能。</p>
<p>使用 ScreenFlow 则可以对录制的视频进行<strong>轻量剪辑</strong>，去除录制失败或多余的视频片段，录屏剪辑导出一条龙。</p>
<p>价格：买断制，848 元，可在 Mac App Store 下载。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041164008851.jpg" alt="-w719"></p>
<h2 id="万兴优转"><a href="#万兴优转" class="headerlink" title="万兴优转"></a>万兴优转</h2><p>万兴优转，是一款多功能的音视频处理工具，支持 Windows 和 macOS 系统，可实现多种用途：</p>
<ul>
<li>转换音视频格式，包含视频转 Gif、视频提取音频等</li>
<li>视频编辑，包含添加滤镜、添加水印和更改视频尺寸等</li>
<li>压缩视频</li>
<li>屏幕录制</li>
</ul>
<p>价格：下载免费，部分功能需购买会员解锁权限。<br>官网：<a target="_blank" rel="noopener" href="https://sourl.cn/92CHfT">https://sourl.cn/92CHfT</a></p>
<p><img src="http://cdn.penghh.fun/mweb/16041167654630.jpg" alt="-w1116"></p>
<p>以上，希望有帮助。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/28/2020-10-28-post05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/28/2020-10-28-post05/" itemprop="url">《如何让你爱的人爱上你》摘录</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-28T08:07:38+08:00">
                2020-10-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本书阅读于得到 App，是一本长期霸榜「得到」电子书榜单的书。即便是以聚集了爱学习的人著称的得到，对脱单、爱情这个话题还是免不了俗。</p>
<p>之前曾看到辉哥奇谭的主理人 @辉哥 说过一句话：</p>
<blockquote>
<p>全世界的人对两件事有天生的「耻感」，第一是金钱，第二是性。但人生的突破机会就在于直视这两点，哪怕你视之为「深渊」。  </p>
</blockquote>
<p>这里我还想补充一点，是关于「爱」的。人本生来孤独，走的时候也是孑然一身，为了让中间的过程更有意思一些，我们会渴望爱、渴望交流、渴望连接，这是一种再正常不过的诉求，但在今天，我们好像不敢直面这种内心诉求，不敢去勇敢追逐爱，甚至不知道怎么去爱。</p>
<h3 id="摘录"><a href="#摘录" class="headerlink" title="摘录"></a>摘录</h3><p>寻找另一半时关注的因素：</p>
<ul>
<li>相貌</li>
<li>财富</li>
<li>地位名望</li>
<li>知识与学问</li>
<li>社交风度或性格</li>
<li>人品</li>
</ul>
<p>对学识的追求是一生的事业，它可以为你带来持久而深刻的欢愉。</p>
<p>在今天这个世界，女人们倾向于爱上那些能够在专业方面帮助她们的男人。对于那些聪慧而进取的女人，你的学识就是春药。</p>
<p>为了提高你的市场价值，<strong>永不停止学习，永不放弃性格塑造与社交技巧，努力培养内在品质</strong>，并且持之以恒。它们像黄金子弹一样，能够射中意中人的芳心。</p>
<p>今天，女猎手想要的是心思细腻、可以与女人分享心情的男人。男猎手幻想的是超级女人，她可以带来绝佳的陪伴、绝佳的子女、绝佳的激情和绝佳的性高潮。</p>
<p>男性喜欢的话题：汽车、体育、事实、商务和政治<br>女性喜欢的话题：健康、艺术、个人成长以及谈心灵</p>
<p>女猎手们，你可以在男性话题中展露聪明才智，但不要比意中人更聪明。</p>
<p>男猎手们，要让你的言谈更具心理学意味。与意中人谈天时，要多谈论人、感受、哲学、基本原理和直觉。</p>
<p>男猎手，如果一个女人讲话时，你插嘴问出一个基本问题：“<strong>对于那件事，你感觉怎么样</strong>？”你就会脱颖而出，成为众多男人中的珍品，真的。基本上，对任何事情你都可以这么问。（这个技巧可以让女人将你视作真正心思细腻的男人）</p>
<p>恋情中，不要过早追问“感受”（献给女猎手）</p>
<h3 id="倾听"><a href="#倾听" class="headerlink" title="倾听"></a>倾听</h3><p>绅士们，当你的恋人看上去纠结、愤怒、心事重重或恼火的时候，献出那句神奇的妙语吧：“究竟发生了什么事，你能和我谈谈吗？”</p>
<p>如果女生一开始拒接了，你也要坚持。说：“来吧，我知道，如果你和我谈谈，心里会舒服一些。我真的很喜欢你把自己的感受拿出来和我一起分享。”</p>
<p>不用害怕，倾听女生分享感受时，你所需要做的只是闭嘴、倾听。</p>
<p>女猎手们，当你的意中人愤怒、不安或沮丧时，你需要学的妙语比男人需要学的还少。事实上，你什么都不必说，只需要闭嘴，像哥们一样尊重他的沉默。</p>
<p>男人通常不习惯与他人分享自己的感受，如果他选择不告诉你他的感受，请不要觉得伤心。在他看来，不拿自己的烦恼为你增加负担，就是在展示对你的敬意。</p>
<p>男猎手们，不要告诉她你们要干什么，而是要先征求她的意见。当意中人向你发问时，不要只从字面上理解，要读出字里行间的言外之意，领悟她的暗示。当她问“你想不想”时，意思可能是“她很想”。<br>（例如，你想吃饭，最好先询问女生，你想吃点什么吗？）</p>
<p>男人想得到信任，女人想得到关心。</p>
<p>接下来的一条建议听起来也许像反女权的疯话，但是我要悲伤地告诉你，这条技巧很管用：<strong>当男人帮你时，永远不要对他提建议——永远不要</strong>。即使他想用透明胶带粘好你漏水的龙头，而你知道有七种更好的办法，也要咬紧牙关别吭声。</p>
<p>男猎手们，当你见到意中人犯难时，请走过去问她是否需要帮忙。和你的哥们不同，她不会觉得你不信任她的能力，她会将你的主动帮忙理解为：你在乎她、对她的难题很上心。</p>
<p>在男性大脑中，自尊和性爱几乎是不可分割的大脑灰质。</p>
<p>男性最普遍的秘密性幻想是什么？幻想同时与两个女人上床，观赏两个女人交欢，观看其他情侣做爱，看女人自慰，服从女王颐指气使的性爱命令，统治女人（最为流行的六种隐秘的男性性幻想）……清单内的项目无穷无尽，内容也会越发异乎寻常、放荡不羁。</p>
<p>多数女人都很聪明，懂得在第一次见到恋人的阳具时要满脸震撼。</p>
<p>男人是视觉动物，也是听觉动物，男人也愿意千遍万遍地听到那些让自己兴奋的词汇。</p>
<p>在意中人耳中，巅峰的听觉性体验是在性爱过程中由你亲口说出他最爱的撩人词汇。</p>
<p>与男人相比，女人对伴侣的品质要求更高。</p>
<p>问问意中人，对她来说爱情意味着什么，弄明白你的意中人最喜欢怎样被爱。<br>在她回答的时候，你要仔细聆听那些撩人词汇。不要立即使用，而是要等到说出“我爱你”的那一刻，再用这些特定的词语编织出美丽的情话。</p>
<p>我们所有人其实都在不停地寻找应对孤独感或疏离感的方式，无论自己是否意识到这件事。</p>
<p>我们孤身一人，从母亲的子宫来到这个世界；我们活在世间，在一片以各自的思想和肉身为疆界的孤独中离群索居；撒手尘寰的时候，也是孑然一身，无人相伴。茫茫生死之间，如果两份孤独能够萍水相逢、两个凡尘俗子能够血脉相连，便能找到真正的幸福。但真爱是件奢侈品而非我们与生俱来的权利。正如追求其他奢侈品一样，我们必须尝试最有力的方法。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/25/%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/25/%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url">权限系统设计</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-25T17:47:30+08:00">
                2020-10-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>权限管理是所有后台系统的都会涉及的一个重要组成部分，主要目的是对不同的人访问资源进行权限的控制，避免因权限控制缺失或操作不当引发的风险问题，如操作错误、隐私数据泄露等问题。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/10/25/%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/25/2020-10-25-post04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/25/2020-10-25-post04/" itemprop="url">博客图床配置之七牛云</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-25T08:07:38+08:00">
                2020-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>之前我曾写过一篇 Mac 上的 Markdown 写作工具——MWeb 相关的文章 《<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/itLe10q1x4B6CBvApRTcCQ">电脑写作利器 MWeb｜如何使用第三方预览样式？</a>》，主要是讲如何在 MWeb 中使用第三方预览样式，让文章的预览视图看起来更舒服。    </p>
<p>这一次我想写一下 MWeb 的图床配置问题，MWeb 内置了「<strong>发布服务</strong>」的功能，支持将本地编辑好的文章直接发布到 Wordpress、Medium、少数派等网站。</p>
<p>但要想让整个过程一气呵成的话，我们需要先解决图床配置的问题，这样你发布的文章中的图片才不会出现丢失或上传失败的问题。  </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%A4%9A%E4%B8%AA%E5%B9%B3%E5%8F%B0.png" alt="多个平台"></p>
<p>在解决这个问题之前，我们需要先了解什么是图床？  </p>
<h2 id="图床是什么？"><a href="#图床是什么？" class="headerlink" title="图床是什么？"></a>图床是什么？</h2><p>图床，可以理解为一个存放图片的网络空间或服务器，你发布到朋友圈的图片，别人之所以能看到，是因为你上传的图片放在了腾讯提供的网络空间上。</p>
<p>这个网络空间充当了桥梁的角色，对已成为微信好友的人或设置为最多可见 10 张图片的陌生人开放，这样别人就看到了你发布在朋友圈的图片。   </p>
<p>对应到写文章这件事，我们也需要将文章中用到的图片，上传到写作平台的图床（服务器），这样读者在读文章时才能顺利看到我们附上的图片。</p>
<p>但如果你和我一样，会<strong>将一篇文章发布到不同的平台</strong>，例如将首发在公众号的文章发布到知乎，你大概率会遇到一个蛋疼的问题——粘贴到知乎编辑器的文章会出现多个「<strong>图片上传失败</strong>」的提示。</p>
<p>之前为了解决这个问题，我的方法是：先将微信文章复制到简书，再从简书复制到知乎编辑器。这个方法几乎能完美解决图片上传失败，少数时候会遇到 Gif 上传失败的问题。</p>
<p>说句题外话，从上面这种解决方法推测，微信为了避免被别的写作平台当成图床（避免被薅羊毛），它<strong>禁用了图片的外链引用</strong>，当它识别到当前的环境不是在微信体系内，图片就会显示失败，这就导致了图片上传失败的问题。  </p>
<p>而现在，我有了一个更好的解决方法——<strong>将图片上传到自己的图床帐户中</strong>。这个方法可以省去上面「粘贴到简书」的中间步骤，简化整个流程，更重要的是，你可以更方便地将文章分发到多个平台，例如自己的个人博客或其他写作平台。   </p>
<h2 id="有哪些可用的图床？"><a href="#有哪些可用的图床？" class="headerlink" title="有哪些可用的图床？"></a>有哪些可用的图床？</h2><h3 id="免费图床"><a href="#免费图床" class="headerlink" title="免费图床"></a>免费图床</h3><p>网上有不少人整理了多个免费的图床，但目前我用过的免费图床只有两个：路过图床和微博图床。   </p>
<ul>
<li>路过图床  <a target="_blank" rel="noopener" href="https://imgchr.com/">https://imgchr.com/</a><br>全球CDN加速, 支持外链, 原图保存, 最大单张支持10 MB   </li>
<li>新浪微博图床  <a target="_blank" rel="noopener" href="https://www.crx4chrome.com/crx/17508/">https://www.crx4chrome.com/crx/17508/</a><br>为了让微博图床更易用，有人开发了一个浏览器插件「新浪微博图床」，支持选择&#x2F;拖拽&#x2F;粘贴上传图片，并生成图片地址、HTML、UBB 和 Markdown 等格式</li>
</ul>
<p><img src="http://cdn.penghh.fun/mweb/%E5%BE%AE%E5%8D%9A%E5%9B%BE%E5%BA%8A%E6%8F%92%E4%BB%B6.png" alt="微博图床插件"><br>免费图床虽然可以不花钱，但我悲观地认为，大多免费且赚不了钱的服务终究走不了长远，也许未来的某一天，你就会突然收到「XX 关停」的通知。  </p>
<p>如果你想更妥善地保存自己的图片数据，最好还是选择大一点或者收费的图床工具。  </p>
<h3 id="收费图床"><a href="#收费图床" class="headerlink" title="收费图床"></a>收费图床</h3><ul>
<li>七牛云  <a target="_blank" rel="noopener" href="https://www.qiniu.com/">https://www.qiniu.com/</a></li>
</ul>
<p>七牛云虽然是一个主打收费的服务，但它对所有注册的<strong>实名用户</strong>，还是免费提供了每月 10 GB 的存储空间、每月 10 GB 的 CDN 回源流量，具体可见下图。 </p>
<p>其实我对这些术语也不是很清楚，但这些免费额度，对于一个没什么访问量的博客来说，已经够用了。  </p>
<p><img src="http://cdn.penghh.fun/mweb/%E4%B8%83%E7%89%9B%E4%BA%91%E4%BB%B7%E6%A0%BC%E8%B4%B9%E7%94%A8.png" alt="七牛云价格费用"><br>了解更多关于七牛云计费方式的内容，可以参考官方的文档：<br><a target="_blank" rel="noopener" href="https://www.qiniu.com/prices/kodo?source=kodo">https://www.qiniu.com/prices/kodo?source=kodo</a></p>
<p>首次使用七牛云，它会给每个人分配一个<strong>临时的测试域名</strong>，有效期为一个月，过期之后如果你还想使用七牛云作为图床的话，就需要自己去注册一个域名。  </p>
<h3 id="MWeb-七牛云图床配置"><a href="#MWeb-七牛云图床配置" class="headerlink" title="MWeb 七牛云图床配置"></a>MWeb 七牛云图床配置</h3><p>MWeb 本身支持的图床服务较多，例如七牛云、腾讯云和阿里云等，还支持自定义更多图床。</p>
<p><img src="http://cdn.penghh.fun/mweb/MWeb%E6%94%AF%E6%8C%81%E7%9A%84%E5%9B%BE%E5%BA%8A.png" alt="MWeb支持的图床"><br>配置之前，我们先在浏览器打开七牛云的「控制台」，切换到「对象存储」，新建一个公开的空间，这里我将空间名称命名为 blog-picbed20，空间名称自行定义，后面会用到。   </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%88%9B%E5%BB%BA%E7%A9%BA%E9%97%B4.png" alt="创建空间"></p>
<p>打开创建好的空间，需要添加「CDN 加速域名」，域名的格式为「cdn.+自己注册的域名」，接着需要配置右侧的「CNAME」，将鼠标移动到 CNAME 上方，它会给出配置 CNAME 的指导。</p>
<p><img src="http://cdn.penghh.fun/mweb/cname.png" alt="cname"></p>
<p>复制七牛云空间的 CNAME 值，接着打开你注册的域名的「DNS 解析页面」，因为我是在腾讯云注册的域名，这里打开的就是腾讯云的管理后台。 </p>
<p>在解析列表中新增一条记录，主机记录为 cdn，记录类型选择 CNAME，记录值位置粘贴刚从七牛云得到的 CNAME 值。   </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%A2%9E%E5%8A%A0%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95.png" alt="增加解析记录"><br>完成这个步骤后，回到七牛云的控制台，刷新页面，直至 CDN 加速域名的状态显示为「成功」，则表示完成了七牛云的配置。   </p>
<p><img src="http://cdn.penghh.fun/mweb/%E6%88%90%E5%8A%9F.png" alt="成功"><br>回到 MWeb，打开「偏好设置」，切换到「发布服务」，添加「七牛云存储」，API 地址选择离你较近的地区即可。</p>
<p>空间名称：前面创建七牛云空间自定义的名称<br>域名：<a target="_blank" rel="noopener" href="http://cdn.+自己注册的域名/">http://cdn.+自己注册的域名</a></p>
<p><img src="http://cdn.penghh.fun/mweb/MWeb%E9%85%8D%E7%BD%AE.png" alt="MWeb配置"><br>而其中的 Access Key 和 Secret Key 则需要再次回到七牛云的后台获取，点击右上角的帐户头像，在弹出的菜单中，选择「密钥管理」，创建一个新的密钥。 </p>
<p>下图的 AK 和 SK 分别对应 MWeb 里的 Access Key 和 Secret Key，分别粘贴到 MWeb 中相应的位置，就完成了 MWeb 中图片的配置。  </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%88%9B%E5%BB%BA%E5%AF%86%E9%92%A5.png" alt="创建密钥"><br>借助 MWeb 集成的将本地图片上传到图床的功能，当你将文章从 MWeb 发布或粘贴到其他平台之前，先选择顶部的菜单「发布–把本地图片传至图床」。 </p>
<p><img src="http://cdn.penghh.fun/mweb/15992331398624.jpg" alt="-w629"></p>
<p>在弹出的窗口中，选择「七牛云图床」，接着点击右下角的「上传本地图片」，MWeb 就会将本地的图片上传到七牛云图床，再自动返回图片上传到图床后的「<strong>远程地址</strong>」。    </p>
<p><img src="http://cdn.penghh.fun/mweb/%E4%B8%8A%E4%BC%A0%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87.png" alt="上传本地图片"></p>
<p>此时如果你想将文档发布到公众号或知乎，先点击「复制带样式的 HTML」，再切换到发布内容的平台，使用 Command + V 粘贴，文章和图片也会随之过去了，一气呵成，不会出现图片丢失的问题。            </p>
<p><img src="http://cdn.penghh.fun/mweb/15992333667413.jpg" alt="-w583"><br>第一次看完整个配置，你可能会觉得非常麻烦，但就像老话说的「万事开头难」，开头的坑趟过去了，后面等着你的可能就是一马平川的广阔天地。</p>
<p><strong>完成第一次稍微有些麻烦的配置，你就可以持续享受一次配置带来的多次收益</strong>，这某种程度上也可以算是一种「复利」行为，何乐而不为？  </p>
<p>以上，希望有帮助。 </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/24/2020-10-24-post03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/24/2020-10-24-post03/" itemprop="url">做新媒体的几点体会</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-24T14:02:38+08:00">
                2020-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>做新媒体起家的公司，前期可能会专门雇人写文章，到后期新媒体公司大概率会变为一家广告公司——不生产文章，只转载文章和广告文章（广告没啥错，错的是什么广告都接）。</p>
<p>你看见很多风马牛不相及的公众号，他们可能就是同一家公司的号。做多个新媒体账号，就像以前玩网游的时候，一个人同时注册多个账号，一方面是安全（不要把鸡蛋放在同个篮子里），一方面是可以多个号同时赚钱。</p>
<p>大号转载小号的文章，有些会抱着是看得起你的心态，作为小号的你不要不识抬举哈。大号会说，按行业惯例，你就必须给我开白名单且不显示转载来源（俗称双勾），不给我白嫖，你就是不对，不守行业惯例，完事了还要在朋友圈发一条动态来吐槽你，说你小号欺负人。</p>
<p>做新媒体的人都很小气，是的，都很小气（包括我）。看见别人写和自己一样的选题，就会本能地怀疑别人洗自己的稿，每个新媒体人或多或少都有「被洗稿妄想症」。</p>
<p>新媒体做久了真的很没意思，同行之间互相研究对方的选题，然后就仿写一篇类似的。</p>
<p>做新媒体真的没有多高大上，没必要抬高自己，也没必要贬低别的职业。有些人总看不起微商，说他们老是在朋友圈发广告，但其实新媒体人也好不到哪去，他们总在朋友圈转发自己写的文章。   </p>
<p><strong>不要羞于宣传自己</strong>。这和上一条看起来有点矛盾，但其实并不矛盾。原因在于：   </p>
<ul>
<li>宣传时你是否站在别人的角度，为别人带来了价值，而不是单纯的打扰</li>
<li>不少人可能碍于各种因素，羞于宣传自己，觉得不好意思，本质上还是你不够认可自己（或者说不够认可自己写的东西）。只有先认可自己的人，大概率才会得到别人的认可，就像爱情中的「爱人先爱己」</li>
<li>宣传自己或者说展示自己，也是一种很好的筛选方式，筛掉那些不喜欢你的人。人的时间有限，要把时间更多地花费在那些喜欢你或认可你的人身上</li>
</ul>
<p>千万不要随便惹做新媒体的，因为他们动不动就会威胁你说，「回头我在公众号说一下这事」、「回头我在公众号挂一下你」。</p>
<p>不要迷信大 V，不要迷信大 V，不要迷信大 V。大 V 真的不是神，在网上看不见摸不着，在网上有时只要让人觉得你很强，你也能成为一些人眼中的大 V。  </p>
<h3 id="为什么要写作？"><a href="#为什么要写作？" class="headerlink" title="为什么要写作？"></a>为什么要写作？</h3><p>写作是一种具有长尾效应的行为，在一个开放的网络环境中，你现在写的内容，特指有价值的内容，而不是煽动情绪的爽文，可能会帮到以后遇到同样问题的人。</p>
<p>写作是一种高质量的社交活动，同频相吸，它会让你和志同道合的人相遇。</p>
<p>写作可能是一种让你获得自由的方式，自由包含精神自由和财务自由。这里我还没有什么经验可谈，只是看了一些做自媒体的博主的案例，但经过今晚的饭局，我再次确认了，<strong>单纯的工资收入并不能使人致富</strong>。   </p>
<p>写作也是一种和自己对话的方式，当你把心中想说的东西写下来的时候，它会让你的内心更轻盈，排出心中积压已久的某种东西，为填入新的东西预留空间。 </p>
<p>写作是一种预防遗忘的手段，之前看过电影《寻梦环游记》，对其中的一句台词印象深刻：</p>
<blockquote>
<p>真正的死亡是世界上再没有一个人记得你。死亡不是真的逝去，遗忘才是永恒的消亡。</p>
</blockquote>
<p>年龄越大，记忆力越差，现在随手写下的东西，暮年闲来无事可以拿出来翻翻看。  </p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>本文大部分内容是之前已经写好的，这次增添了少量的内容。</p>
<p>今天之所以会发这个，除了吃晚饭时和朋友聊的内容，还有另外一个原因：</p>
<p>早上看到了一位关注已久的博主 @路人甲 发布的文章，如果你是一个知乎重度用户，可能对这个 ID 也不陌生。我最开始关注他，是看到他在知乎疯狂输出了很多 Python 相关的内容，觉得他是一位大神级别的人物，即便看不懂他写的代码，也值得关注看看。</p>
<p>后来他从知乎转战微信公众号，也做得挺好的，没记错的话还受到了一个大号「小道消息」的推荐，期间还孵化了一些新的账号。  </p>
<p>今天看到他说从待了三年的公司辞职了，准备创业自己带团队，做出这个决定也是深思熟虑之后的结果。</p>
<p>说实话，有时看到别人辞职单干或者成为一个自由职业者，我的首要感受还是挺羡慕的，羡慕他们十足的底气，也觉得很潇洒。</p>
<p>过后呢，羡慕就会转换为佩服，因为在我看来，创业或者成为自由职业者，需要有极大的热情和驱动力，一个人有时要像一支队伍，看似自由，实则需要极大的自律。  </p>
<p>简言之，<strong>人总会从一条河流踏进另外一条河流</strong>，换成不文艺的说法就是，人总会从一个坑跳到另外一个坑。  </p>
<p>既然还是跳到另外一个坑，那为啥还要做自媒体（写作）呢？   </p>
<p>可能只是多一种选择，可能只是在辞职的时候，更有底气地说出那句，fucxing your money!</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/posts/hui-guang-zhou-yi-nian-you-gan.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/hui-guang-zhou-yi-nian-you-gan.html" itemprop="url">回广州一年有感</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-24T00:38:14+08:00">
                2020-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在去年的这个时候，我写了一篇<a target="_blank" rel="noopener" href="https://4ark.me/posts/why-i-became-a-programmer.html">《我为什么会成为一名程序员》</a>，记录了我为什么会进入软件开发这个行业，以及我对当时现状的忧虑、反思我成为程序员的初心是什么。</p>
<p>那么，一年过去了，我现在是怎么样的呢？我还是曾经那个少年吗？</p>
<h2 id="我回广州了"><a href="#我回广州了" class="headerlink" title="我回广州了"></a>我回广州了</h2><p>是的，我写了那篇文章后，我决定离开当时的公司，离开那个城市，我想要找一个能让我成长的团队，跟一群能够互相激励共同进步的人一起工作，于是我回到广州，来到现在这家公司，在这篇<a target="_blank" rel="noopener" href="https://4ark.me/posts/review-summary.html">《面试总结》</a> 中记录了我面试通过后的一些想法。</p>
<p>在这一年中，我学到了很多东西，这不仅仅只是技术的进步，更多的是思维、做事的方式，这会影响我的一生。</p>
<p>比如，我会在开始工作之前，先写设计文档、技术调研文档；在开发过程中，我会记录开发细节、踩过的坑；总之，不要出现一件事情只存在你的大脑中，一定要有文档记录。</p>
<p>又比如，我会使用 Google 搜索引擎、优先选择查阅英文文档、尽自己能力对开源社区做一些贡献。</p>
<p>还有很多，这些我每天工作做的事情，已经逐渐养成习惯，慢慢影响着我。</p>
<p>其实这些都是一个程序员的基本素养，只是，如果我当初没有选择离开那家公司，来到这里的话，可能到今天我依然还是那个不专业的程序员。</p>
<h2 id="未来作何打算"><a href="#未来作何打算" class="headerlink" title="未来作何打算"></a>未来作何打算</h2><p>由于一些原因，说不定我会离开这里，但，只要有可能，我希望继续留下。</p>
<p>但我想，即便离开了，我在这里养成的习惯，我会坚持做下去，我也希望我能够影响别人做出改变。</p>
<p>至于未来会如何，我也不清楚。</p>
<p>但不管怎样，我希望我始终能看到自己的进步，而不是永远停留在原地。</p>
<h2 id="最后讲讲关于写博客"><a href="#最后讲讲关于写博客" class="headerlink" title="最后讲讲关于写博客"></a>最后讲讲关于写博客</h2><p>我认为，写博客既是记录现在的自己，也是为了给以后的自己看，毕竟就我这个破 blog 看得最多的人肯定还是自己。</p>
<p>虽然我不是一个很有文采的人，我也写不出华丽的句子，但我认为要记录自己，哪怕是用最简单朴素的文字，也已经足够了。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/23/2020-10-23-post02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/23/2020-10-23-post02/" itemprop="url">《夜晚的潜水艇》摘录</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-23T08:07:38+08:00">
                2020-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>《夜晚的潜水艇》作者陈春成，1990 年出生，现居福建泉州，本书是他出版的处女作。在而立之年出版了自己的第一本小说，这让我联想到了村上春树，村上 29 岁开始写小说，次年将作品《且听风吟》投稿到文学杂志《群像》，结果一举赢得 1979 年的群像新人奖。</p>
<p><img src="http://cdn.penghh.fun/mweb/s33718940.jpg" alt="书籍封面来自豆瓣"></p>
<p>这本书是池建强老师推荐之后才买的，他写的推荐语是：</p>
<blockquote>
<p>文字洗练、丰盈、精准，像白描一般的故事情节，虚实交错，读起来让人着迷沉浸。文字如流苏，情节浑然天成，读来不知真假。<br>他的文章让我想起李海鹏、阿城的文字。这是一本处处闪烁光芒的天才之作，期待他能持续写下去。写作是个老天爷赏饭的技能，这种文字，理应让更多人知道。</p>
</blockquote>
<h1 id="我的体会"><a href="#我的体会" class="headerlink" title="我的体会"></a>我的体会</h1><p>在读这本书的过程中，我看到了一些形容非常贴切的比喻、作者丰沛的想象力，可以看出不少句子可能是经过多次的字斟句酌之后，才能有那般的准确。</p>
<p>以前读书时，于我而言，读散文体裁的文章一度让我非常痛苦，因为我觉得它很难理解，作者想表达的东西难以把握。</p>
<h1 id="摘录"><a href="#摘录" class="headerlink" title="摘录"></a>摘录</h1><p>老家被拆，手中剩下的老家钥匙，就是我与老家的最后一丝联系，它像风筝的线头，该如何处置这个「遗物」呢？</p>
<p>——不能放在身边。放在身边，久了，它就成了日常之物，日常的空气会消解它身上的魔力，直到对我失去慰藉作用。</p>
<p>作者选择藏起来，「藏东西，是我惯用的一种自我疗法」。</p>
<p>确定无疑的事情有这么一两桩，也就足以抵御世间的种种无常了。</p>
<p>长年累月 VS 年深日久</p>
<p>e.g. 文笔往往不错，那是一种年深日久的自我修养。</p>
<p>文笔 VS 笔力</p>
<p>但这些仍不能让我满意，笔力得不到充分的驰骋。</p>
<p>“可以惊四座，不可适独坐”，不能取悦自己的文章，再怎么让世人惊佩也没多大意思。</p>
<p><strong>我意识到表达的畅快来自于阻碍和阻碍的消除，而当我的笔无往不利，思路开阔无碍，那种畅快也就不复存在，一切只是熟极而流的操作</strong>。我不得不制定更难的写作计划。</p>
<p>我试图立足于有限的时间里，来用文字笼络住无穷的空间。</p>
<p>我做了一场梦，在梦中遇到了一个素不相识的老人，老人没来由地问了我一个问题：</p>
<blockquote>
<p>如果你可以写出伟大的作品，但只有你自己能领受，无论你生前或死后，都不会有人知道你的伟大——你愿意过这样的一生吗？</p>
</blockquote>
<p>自从那场梦后，我不再有作品示人（得到的传彩笔写出来的文章只有自己能看到），相识的编辑都以为我放弃写作了，这也正常不过，<strong>中年后放弃写作的大有人在</strong>。</p>
<p>古往今来每个春天豪掷的所有花瓣</p>
<p>写文章仿佛是医生在抓药那般：</p>
<blockquote>
<p>起初，我的脑子像一面巨大的中药柜，词汇分门别类地躺在无数抽屉里，我清楚它们的位置，熟练地抓取需要的文字，配成需要的句子。</p>
</blockquote>
<p>在写作的世界里，作者就是造物主：</p>
<blockquote>
<p>我熔铸月光，裁剪浮云，掣长鲸于碧海，我统治天上的星星……</p>
</blockquote>
<p>写作诚然能带来最澎湃的快乐，但他人的认同能让这份快乐变得确切，从滔天的浪涛变成可以珍藏的珠玉……我渴望听到别人的评价，来将这狂喜落到实处。</p>
<p>年轻时有许多次类似的经验：自以为写出了杰作而狂喜，隔了些时候再看，不过敝帚自珍罢了，一场蜃楼。</p>
<p>我穿进了别人的梦里，挨个问当初那老人问过我的问题，他们表示不愿意，将我请出或轰出了他们的梦。毕竟人在梦中没法说谎和逞强。</p>
<p>（我在梦中把传彩笔给了新的主人，第二天醒来）我试图回忆那些诗句，脑中空空荡荡，像从群仙的会饮中骤然离席，再也想不起琼浆的滋味和霓裳的色彩。</p>
<p>我领受过伟大作品的伟大，便无法再满足于这种残次品。饕餮过诸神的盛宴，从此人间脍炙都索然无味。</p>
<h2 id="酿酒师"><a href="#酿酒师" class="headerlink" title="酿酒师"></a>酿酒师</h2><p>喝过一口酒，好像有月光在经脉中流淌，春风吹进了骨髓。</p>
<p>历历在目 VS 朗然在目</p>
<p>e.g. 我试着回想过往人生中的一些细节，无不朗然在目。</p>
<h2 id="李茵的湖"><a href="#李茵的湖" class="headerlink" title="李茵的湖"></a>李茵的湖</h2><p>人生中一个微不足道、但挥之不去的谜团，轻烟一样，弥漫在生活的背面。<br>（生活的正面是什么呢？）</p>
<p>一生的顺遂和坎坷</p>
<p>李茵原名叫李迎男，成年后她自己去改了名字。迎男和招娣，有同一个酸楚的含义。</p>
<p>（野营的）锅里映着明亮的天，天上亮着橘红色的晚霞。</p>
<p>一段记忆，共同经历的人早都随手抛下，她却当珍宝一样收藏至今。</p>
<p>并非宇宙间有什么隐秘的牵连，是人的记忆常把不想干的事物无端地牵扯到一起。</p>
<h2 id="尺波"><a href="#尺波" class="headerlink" title="尺波"></a>尺波</h2><p>尺波是一本刊物的名称，也是一把剑的名字。</p>
<p> 这时天已变黑 VS 这时天已擦黑</p>
<p>也许唯一能将梦中之物带回现实的方法，是让它成为自己的一部分。</p>
<p>古代诗人吟唱过，大地是华美的毯子，神和历代国王在这一面用金线编织就了花纹；另一面却有另外的图案，人只能在梦中窥见。大地是广阔的书页，神和历代英雄在这一面写下史诗；另一面有另外的诗行，人只能在梦中听闻……大地的另一面是梦中的世界；我们则在那个世界的梦中。</p>
<h2 id="音乐家"><a href="#音乐家" class="headerlink" title="音乐家"></a>音乐家</h2><p>云气腾腾<br>潇潇而下<br>绵绵不绝<br>行人寥落</p>
<p>临街的窗口这时半数还亮着，概无例外地拉着窗帘，每一团暧昧的灯光都像在密谋着什么。</p>
<h2 id="音乐家-1"><a href="#音乐家-1" class="headerlink" title="音乐家"></a>音乐家</h2><p>这种散播资产阶级颓废情调的乐器（指萨克斯）在列宁格勒久已绝迹，因此引起了警局的重视。</p>
<p>深夜的敲门声让整栋楼的寂静绑得更紧了一些。</p>
<p>（手表）<strong>细小的齿轮像星体一样完美地运转着，将时间研磨成均等的颗粒</strong>。晶体般洁净的滴答声凭空堆积着，闪烁着无与伦比的秩序美。他喜欢这种透明、安全的声音，喜欢看着自己修好的各式各样的钟表摆满一桌面，然后在满屋子繁密的滴答声中进入无梦的睡眠。</p>
<p>那一段随口吹出的旋律，像一小汪春水，在他心底摇漾着；捧不住，也截不断。一些旧事像杯底的沉渣，因那旋律的翻搅而浮动起来。</p>
<p>他开了灯。他<strong>听见灯光在电线中涓涓流过，然后从灯盏中溢出</strong>，照亮那些细小的零件和他的白发。（运用通感的修辞手法）</p>
<p>他似乎能沿着曲谱追溯到作曲者创作时的心中所想，乃至潜意识里掠过的景象，就像品酒师一沾杯沿，就能说出葡萄生长时的阳光雨露；或者如古生物学家，从一小截指爪化石中还原出巨兽的身影。</p>
<p>年复一年，他一张接一张地读谱，每一张薄薄的乐谱上都升腾起一座庞大而沉重的蜃楼。</p>
<p>（两位老友经历过战争，饥荒，清洗，动荡）……而他们此刻竟完好无损地坐在一起，谈论着圣境般的故乡——只不过他们都被岁月磨蚀得不成样子了。</p>
<p>椋[liáng]鸟的传说：椋鸟终其一生没旁的事，一直在找寻自己的<strong>灰烬之歌</strong>。上帝每造出一只椋鸟，就造出一段旋律，和它灵魂的形状完全一致，藏在世间某处，让这鸟去寻找。也许在泉流中，也许在树梢的摇荡中，也许正盘旋在某个人的脑子里。椋鸟终日乱叫，探索着新的调子，也学它听来的任何声音，就是为找它的旋律。一旦被它偶然唱出，椋鸟的形体就会立时化作灰烬，而它的灵魂就钻进那旋律里，再也不出来了……这只椋鸟没有死，它只是进入了音乐的世界了，那是比尘世更接近上帝的地方……</p>
<p>我摸索了一辈子似乎就为了写出它——就像椋鸟找到了它的灰烬之歌。<strong>它不是伟大的，却是独一无二的，是和我灵魂形状最契合的容器了</strong>。只要听它被演奏上一次，我就再也不奢求什么了。</p>
<p>白天时迥然有别的万物，此刻都被黑暗熔铸成同一件事物了，巨大而阴森，消泯了各自的边界。</p>
<p>（他进入审查办公室后，）他每天在那些蹩脚作品中周旋，忍受着它们带来的乏味而合规的幻象，还得硬着头皮让它们过审，去蹂躏更多的耳朵，他想听到自己作品上演的渴望越发炽热。    </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/21/2020-10-21-post01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/21/2020-10-21-post01/" itemprop="url">我终于拥有自己的独立博客了</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-21T08:07:38+08:00">
                2020-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>这是我使用 Hexo 发布的第一篇博客。   </p>
<p>对于不懂技术的我来说，搭建这个博客一波三折，幸好中间有一位热心网友 @无声 的相助，这个博客才得以搭建起来。   </p>
<p>看着一个博客从 0 到顺利诞生，那种感觉可能就像是</p>
<ul>
<li>产品经理看着自己做的第一个产品顺利上线</li>
<li>准备要当妈妈的女人听到孩子第一声啼哭的那个瞬间</li>
</ul>
<p>那种感觉不言而喻，虽累但成就感满满，一切值得。     </p>
<p>我之前曾写过两篇技术小白搭建博客的文章：   </p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/cRqTBEfHTmt0TvxCP7PjjA">可能是最最最最简单的搭建博客方法</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/6Dp26H4YCXK5yNr3EvO90g">不会代码，如何零成本搭建个人博客？</a>    </p>
<p>这两篇文章都用到了同一个网站 GitHub，这个网站是世界上最大的代码托管平台，可用来托管代码，也可以用来存放文章数据，作为托管博客的站点，省去购买域名和租用服务器的钱。   </p>
<p>但使用这个方法存在一个弊端：访问时打开的速度很慢，需要使用网络代理，才能以正常的速度打开网站。   </p>
<p>此外，在没有购买域名和租用服务器的情况下，搭建的博客网址通常是「GitHub用户名.github.io」，github.io 后缀的网站以前虽然打开的速度慢，但至少还能访问。   </p>
<p>但在不久前，我想起自己许久没更新的博客，想打开看一下，发现 github.io 后缀的网站也打不开了。显而易见的是，它也被加入了大陆屏蔽的列表。   </p>
<p>正是这个问题，促使我萌生了再次搭建新博客的念头，我想搭建一个存在时间尽可能长、且能在国内正常访问的博客。    </p>
<h2 id="搭建博客的流程"><a href="#搭建博客的流程" class="headerlink" title="搭建博客的流程"></a>搭建博客的流程</h2><h3 id="购买域名"><a href="#购买域名" class="headerlink" title="购买域名"></a>购买域名</h3><p>域名可以理解为我们平常所说的网址，例如 baidu.com，我购买的域名是 penghh.fun。</p>
<p>这个域名是从腾讯云购买的，网站会提供各式各样的域名后缀，如.com、.net、.cn 等，在顶部的搜索框输入你想注册的域名，下面会返回加上不同后缀的域名及价格。   </p>
<p><img src="http://cdn.penghh.fun/mweb/16031995888236.jpg">  </p>
<p>域名是按年收费的，可只买一年，也可一次性买好几年，一次性购买多年的价格会划算一些。  </p>
<p>如果你像我一样，不确定一年之后是否有精力维护博客，那最好就只买域名的 1 年使用期。   </p>
<p>购买域名时的注意点：<strong>不要购买域名后缀为中文的域名</strong>。   </p>
<h3 id="租用一台服务器"><a href="#租用一台服务器" class="headerlink" title="租用一台服务器"></a>租用一台服务器</h3><p>在进行下一步域名备案之前，我们需要先租用一台服务器。</p>
<p>服务器可以理解为一台 24 小时不关机的电脑，如果你将博客的数据存放在上面，它就能随时随地被访问，无需担心电脑是否处于开机状态，且服务器能同时接收多个客户端的请求，因此它可以实现多人同时访问一个网站。    </p>
<p>下图是我租用的服务器配置，应该是最便宜的服务器，一年的费用为 99 元。   </p>
<p><img src="http://cdn.penghh.fun/mweb/WechatIMG196.png" alt="WechatIMG196"></p>
<p>腾讯云服务器：<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/act/double11/go">https://cloud.tencent.com/act/double11/go</a></p>
<h3 id="域名备案"><a href="#域名备案" class="headerlink" title="域名备案"></a>域名备案</h3><p>如果你的网站想在国内正常访问，需要向互联网管理局提交备案，获得<strong>备案号</strong>后才能正常访问。  </p>
<p><img src="http://cdn.penghh.fun/mweb/16032063895650.jpg"></p>
<p>我是通过腾讯云提交备案的，在手机上通过小程序「腾讯云网站备案」提交网站名称和网站的备注信息等，网站名称存在着很多隐藏的限制，例如不能出现「分享」、「工具」等涉及诱导分享或商业性质的字样，我因为网站名称命中敏感词、描述不清而被驳回了三次。   </p>
<p>网站名称最后还是腾讯的客服根据备注信息帮我起的——「个人电子产品使用心得」，与我最开始想设置的「效率工具指南」相去甚远。   </p>
<p>此外，备案时还需要提交一个紧急联系人电话，可以将其设置为你的对象、家人或朋友，后续腾讯云客服在审核的过程中也会联系你留的紧急联系人电话，因此最好事先与紧急联系人打个招呼。    </p>
<p>提交的备案信息通过腾讯云审核后，客服会将你的信息提交到管局，正常情况下 10 个工作日之后就能收到审核的结果，顺利的话就能拿到网站的备案号。  </p>
<p>备案要点：耐心！耐心！耐心！尤其是在我们这个国家。   </p>
<h3 id="配置域名解析"><a href="#配置域名解析" class="headerlink" title="配置域名解析"></a>配置域名解析</h3><p>之前我对域名的理解是，只要在浏览器地址栏中输入域名 penghh.fun，就能打开我的博客，但后来发现输入 <a target="_blank" rel="noopener" href="http://www.penghh.fun/">www.penghh.fun</a> 和 penghh.fun 是不一样的，在未正确配置域名解析的情况下，penghh.fun 打开失败，而 <a target="_blank" rel="noopener" href="http://www.penghh.fun/">www.penghh.fun</a> 则打开正常。   </p>
<p><img src="http://cdn.penghh.fun/mweb/16032386324163.jpg"></p>
<p>咨询了网友 @无声 后，找到了解决方法，需要在服务器的 DNS 解析页面新增一条值为 @ 的主机记录，这里的 @ 代表直接解析域名 penghh.fun，将其指向与 <a target="_blank" rel="noopener" href="http://www.penghh.fun/">www.penghh.fun</a> 相同的 IP。   </p>
<p><img src="http://cdn.penghh.fun/mweb/16032389387266.jpg"></p>
<p>完成配置后，之后无论是否输入带有 www. 的网址，都可以正常访问网站，打开同一个页面。     </p>
<p><img src="http://cdn.penghh.fun/mweb/16032393923196.jpg"></p>
<h3 id="安装-Hexo-框架"><a href="#安装-Hexo-框架" class="headerlink" title="安装 Hexo 框架"></a>安装 Hexo 框架</h3><p>搭建博客有两个比较多人用的<strong>框架</strong>：Hexo 和 Hugo，我选择的是 Hexo。</p>
<p>关于 Hexo，引用 IIssNan 介绍 Hexo 时说的一段话：   </p>
<blockquote>
<p>Hexo 是高效的静态站点生成框架，它基于 Node.js。通过 Hexo 你可以轻松地使用 Markdown 编写文章，除了 Markdown 本身的语法之外，还可以使用 Hexo 提供的 标签插件 来快速的插入特定形式的内容。  </p>
</blockquote>
<p>安装 Hexo 框架之前，需要先安装其他环境或软件：</p>
<ul>
<li>Git</li>
<li>Node.js</li>
</ul>
<p>Git，是一个版本控制软件，后面在将博客 push 到 GitHub 仓库时会用到。   </p>
<p>Node.js 目前已集成到包管理工具 npm 中，因此只要你安装了 npm，就会附带安装 Node.js。   </p>
<p>关于如何在本地安装 Hexo 框架，可以参考 B 站 Up 主 @CodeSheep 的视频教程，视频讲解得非常详细，说是一个保姆级教程也不为过。  </p>
<p>教程地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Yb411a7ty">手把手教你从0开始搭建自己的个人博客 |无坑版视频教程| hexo</a>    </p>
<h3 id="配置服务器"><a href="#配置服务器" class="headerlink" title="配置服务器"></a>配置服务器</h3><p>在搭建博客的整个流程中，我觉得配置服务器对我来说是最难的，一方面是配置时需要在服务器和本地之间分别进行操作，你需要分清某个命令是要在服务上还是在本地上操作，但这东西一来二去就把我搞晕了，另一方面，配置服务器时全程用的是黑黢黢的<strong>命令行窗口</strong>，而不是我们常用的图形化界面。   </p>
<p>为了弄清在服务器上输入的某行命令产生了什么效果，例如是否在正确的路径下创建了文件夹，我们需要使用一些远程连接软件，将本地的电脑与服务器连接起来，通过软件查看服务器端生成的文件。    </p>
<p>Mac 电脑：远程连接软件推荐使用 Royal TSX<br>Windows 电脑：远程连接软件推荐使用 Xshell   </p>
<p>关于 Royal TSX 的用法，可以查看 B 站 Up 主 @老郭种树 的视频：<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av70623689">怎样在Mac上SSH和FTP？完美替代XShell是哪个软件？item2吗？Royal TSX! 没有比它更好</a></p>
<p>不一边输命令，一边查看生成的文件，我觉得心里特没底，特别没有安全感。  </p>
<p>最终，服务器的配置还是网友 @无声 帮我弄好的，因此我少了这一步的实践，想了解的朋友，可以查看 @千古壹号 写的一篇搭建博客的文章：   </p>
<p><a target="_blank" rel="noopener" href="https://www.qianguyihao.com/2020-09-19-hexo-aliyun-blog/#1%E3%80%81%E5%AE%89%E8%A3%85-git-%E7%8E%AF%E5%A2%83">hexo+阿里云搭建博客网站</a></p>
<h3 id="部署到-GitHub"><a href="#部署到-GitHub" class="headerlink" title="部署到 GitHub"></a>部署到 GitHub</h3><p>我的博客不是直接从本地部署到服务器的，它相比前者中间多了一步：部署到 GitHub。后面再通过 GitHub 的 Actions 命令自动部署到服务器。   </p>
<p>之所以要加多这一步（指部署到 GitHub），我的理解是，将 GitHub 作为一个备份的方案，它可能可以解决的问题有：  </p>
<ul>
<li>本地的博客文章数据丢失了  </li>
<li>换了新的电脑  </li>
<li>服务器欠费未缴清</li>
</ul>
<p>对于前两个问题，只需要通过 git pull 或 git clone 命令，就能将之前提交到 GitHub 的博客文章恢复到本地，无需担心数据丢失或迁移带来的麻烦。  </p>
<p>第三个问题，由于 GitHub 是免费的，即便后面你不想租服务器了，将博客文章暂存到 GitHub 上，其实也是可以正常浏览的哈哈哈哈。    </p>
<h3 id="使用-GitHub-Actions-实现博客自动部署到服务器"><a href="#使用-GitHub-Actions-实现博客自动部署到服务器" class="headerlink" title="使用 GitHub Actions 实现博客自动部署到服务器"></a>使用 GitHub Actions 实现博客自动部署到服务器</h3><p>GitHub Actions 是 GitHub 提供的一个<strong>自动化工作流</strong>，它有点类似于 iPhone 上的「快捷指令」。   </p>
<p>在 GitHub 仓库根目录中创建一个工作流文件，即将博客自动化部署到服务器的配置文件，之后你每次将本地的博客提交到 GitHub，就会自动触发 GitHub Actions 执行，稍等一小会，它就会将所有更改同步到远端的服务器。  </p>
<p>这时，刷新一下之前停留的博客页面，就可以看到刚刚更新的博客文章了。   </p>
<p>能让程序自动化的，千万不要手动操作，正如 Perl 编程语言的作者 Larry Wall 所说的：   </p>
<blockquote>
<p>程序员的三大美德：懒惰，急切，傲慢。  </p>
</blockquote>
<p>懒才是第一生产力。        </p>
<h2 id="可能会用到的命令行"><a href="#可能会用到的命令行" class="headerlink" title="可能会用到的命令行"></a>可能会用到的命令行</h2><h3 id="查看-Git-Node-js-的版本号"><a href="#查看-Git-Node-js-的版本号" class="headerlink" title="查看 Git&#x2F;Node.js 的版本号"></a>查看 Git&#x2F;Node.js 的版本号</h3><p>git –version（也可以简写成 git –v）<br>node –version（同理可以简写成 node –v）</p>
<h3 id="路径操作"><a href="#路径操作" class="headerlink" title="路径操作"></a>路径操作</h3><p>进入 blog 文件夹：cd blog<br>进入 blog 文件夹下的子文件夹 posts：cd blog&#x2F;posts<br>返回根目录：cd<br>返回上一级目录：cd ..</p>
<h3 id="显示当前路径"><a href="#显示当前路径" class="headerlink" title="显示当前路径"></a>显示当前路径</h3><p>pwd</p>
<h3 id="在当前路径下创建一个新的文件夹"><a href="#在当前路径下创建一个新的文件夹" class="headerlink" title="在当前路径下创建一个新的文件夹"></a>在当前路径下创建一个新的文件夹</h3><p>mkdir+空格+文件夹名称</p>
<h3 id="查看当前路径下所有文件的管控状态"><a href="#查看当前路径下所有文件的管控状态" class="headerlink" title="查看当前路径下所有文件的管控状态"></a>查看当前路径下所有文件的管控状态</h3><p>ls -l<br>*注：上面的两个字母是 L 的小写</p>
<h3 id="获取-Git-的-ssh-公钥"><a href="#获取-Git-的-ssh-公钥" class="headerlink" title="获取 Git 的 ssh 公钥"></a>获取 Git 的 ssh 公钥</h3><p>cat ~&#x2F;.ssh&#x2F;id_rsa.pub  </p>
<h3 id="博客-push-到-GitHub"><a href="#博客-push-到-GitHub" class="headerlink" title="博客 push 到 GitHub"></a>博客 push 到 GitHub</h3><p>git add .<br>git commit -m”附带的信息，例如在某个时间点编辑了博客”<br>git push</p>
<h3 id="Vim-编辑器模式下的操作-命令行"><a href="#Vim-编辑器模式下的操作-命令行" class="headerlink" title="Vim 编辑器模式下的操作 &amp; 命令行"></a>Vim 编辑器模式下的操作 &amp; 命令行</h3><p>快捷键 i：i 是 insert 的缩写，表示插入<br>:q——退出<br>:wq——保存并退出   </p>
<p>命令行虽然可能不像我们现在用的<strong>图形化界面</strong>那么直观，不那么易于理解，但通过输入短短的几行英文，就能实现某个看起来有些复杂的操作，那个感觉有时真的妙不可言，给人一种「我是上帝，正在造物」的错觉。   </p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>搭建这个新的博客，最要感谢的还是我在即刻偶然认识的一位网友 @无声，他很耐心地帮我解决了大部分问题，如博客部署到服务器、使用 GitHub Actions 实现博客自动化部署，即便他晚上工作到 10 点多才下班，依然很有耐心地帮我解决了遇到的所有问题。   </p>
<p>这也让我看到了一个技术人身上那种不屈不挠、誓要把问题解决的韧劲，他在帮我搭建博客的过程中，同样会遇到最初不知道怎么解决的问题，但他没有因为这是我的事情就草草地放弃了，反而是愈战愈勇。    </p>
<p>一个人之所以强大，不止是来自于强健的体魄，更重要的可能是拥有一颗「大心脏」，能扛得住各种磨难、不畏难，甚至是主动挑战困难，这也是我一直以来佩服做技术的人的原因。       </p>
<p>原本是想写一个详细的搭建 Hexo 博客教程，但写的时候发现自己还是不够耐心，就写了这篇比较笼统的文章，因为我自己其实也没有完全理清一些操作的意图或者命令，有些命令随着终端的关闭也消失了。。。好吧，这都是我的借口。   </p>
<p>以上，希望有帮助。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>IIssNan - <a target="_blank" rel="noopener" href="http://theme-next.iissnan.com/getting-started.html">开始使用 NexT 主题</a><br>老郭种树 - <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av70623689">怎样在Mac上SSH和FTP？完美替代XShell是哪个软件？item2吗？Royal TSX! 没有比它更好</a><br>千古壹号 - <a target="_blank" rel="noopener" href="https://www.qianguyihao.com/2020-09-19-hexo-aliyun-blog/#1%E3%80%81%E5%AE%89%E8%A3%85-git-%E7%8E%AF%E5%A2%83">hexo+阿里云搭建博客网站</a><br>Frost’s Blog - <a target="_blank" rel="noopener" href="https://frostming.com/2020/04-26/github-actions-deploy">使用 GitHub Actions 实现博客自动化部署</a><br>知乎 - <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/220689883">如何配置七牛云图床 - OpenWrite</a><br>zkqiang - <a target="_blank" rel="noopener" href="https://github.com/fluid-dev/hexo-theme-fluid">hexo-theme-fluid</a>    </p>
<p><em>本博客使用了优雅的 Fluid 主题，在此对开发这个主题的开发者 zkqiang 表示衷心的感谢。</em></p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/20/%E4%B8%80%E9%81%93HashSet%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E8%9D%B4%E8%9D%B6%E6%95%88%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/20/%E4%B8%80%E9%81%93HashSet%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E8%9D%B4%E8%9D%B6%E6%95%88%E5%BA%94/" itemprop="url">一道 HashSet 面试题引发的蝴蝶效应</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-20T12:19:02+08:00">
                2020-10-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>没错，我又借着“面试题”的名头来搞事情了，今天要说的是 HashSet ，而这确实是一个实际面试中遇到的问题。当时的场景大概是这样的，面试官在了解了你的知识广度以后，决心来考察一番你的基本功底，抛出了一个看起来平平无奇的问题：说一说你平时工作中都用到了哪些数据结构。你心想，这还不简单，<code>Array</code>、<code>ArrayList</code>、<code>List</code>、<code>Dictionary</code>、<code>HashSet</code>、<code>Stack</code>、<code>Queue</code>…等等各种集合类简直如数家珍，甚至你还能说出这些数据结构间的优劣以及各自使用的场景。可没想到，面试官话锋一转，直接来一句，“你能说说 HashSet 去重的原理吗”，好家伙，你这简直不按套路出牌啊…本着每次面试都有一点收获的初心，于是就有了今天这篇博客，不同的是，顺着这个思路继续深挖下去，博主又发现了几个平时关注不到的技术盲点，所以，博主称之为：一道 HashSet 面试题引发的蝴蝶效应。</p>
<h1 id="HashSet-源代码解读"><a href="#HashSet-源代码解读" class="headerlink" title="HashSet 源代码解读"></a>HashSet 源代码解读</h1><p>OK，首先，我们来回答第一个问题，即：<strong>HashSet 去重的原理是什么？</strong>。为此，博主翻阅了 HashSet 的 <a target="_blank" rel="noopener" href="https://referencesource.microsoft.com/#System.Core/System/Collections/Generic/HashSet.cs,1044">源代码</a>。首先，我们会注意到 HashSet 的构造函数，它需要一个类型为<code>IEqualityComparer&lt;T&gt;</code>的参数。从这个命名上我们就可以知道，这是一个用于相等性比较的接口，我们初步推测，HashSet 去重应该和这个接口有关：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>()</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">EqualityComparer&lt;T&gt;.Default</span>)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params"><span class="built_in">int</span> capacity</span>)</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">capacity, EqualityComparer&lt;T&gt;.Default</span>)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params">IEqualityComparer&lt;T&gt; comparer</span>)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params">IEnumerable&lt;T&gt; collection</span>)</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">collection, EqualityComparer&lt;T&gt;.Default</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params">IEnumerable&lt;T&gt; collection, IEqualityComparer&lt;T&gt; comparer</span>)</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">comparer</span>)</span> &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>我们都知道 HashSet 可以去重，比如，我们向 HashSet 添加多个相同的元素，实际上 HashSet 中最终只会有一个元素。所以，我们自然而然地想到，看看 HashSet 中的 <code>Add()</code> 方法呗，或许能从这里看出一点端倪。HashSet 中一共有两个 <code>Add()</code> 方法，它们内部都调用了 <code>AddIfNotPresent()</code> 方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ICollection&lt;T&gt;.Add(T item) &#123;</span><br><span class="line">    AddIfNotPresent(item);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Add</span>(<span class="params">T item</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> AddIfNotPresent(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续循着蛛丝马迹一路 F12 ，我们来看看这个方法的具体实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">AddIfNotPresent</span>(<span class="params">T <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (m_buckets == <span class="literal">null</span>) &#123;</span><br><span class="line">        Initialize(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">int</span> hashCode = InternalGetHashCode(<span class="keyword">value</span>);</span><br><span class="line">    <span class="built_in">int</span> bucket = hashCode % m_buckets.Length;</span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> FEATURE_RANDOMIZED_STRING_HASHING &amp;&amp; !FEATURE_NETCORE</span></span><br><span class="line">        <span class="built_in">int</span> collisionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = m_buckets[hashCode % m_buckets.Length] - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i = m_slots[i].next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_slots[i].hashCode == hashCode &amp;&amp; m_comparer.Equals(m_slots[i].<span class="keyword">value</span>, <span class="keyword">value</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">if</span> FEATURE_RANDOMIZED_STRING_HASHING &amp;&amp; !FEATURE_NETCORE</span></span><br><span class="line">            collisionCount++;</span><br><span class="line">        <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">int</span> index;</span><br><span class="line">    <span class="keyword">if</span> (m_freeList &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        index = m_freeList;</span><br><span class="line">        m_freeList = m_slots[index].next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_lastIndex == m_slots.Length) &#123;</span><br><span class="line">            IncreaseCapacity();</span><br><span class="line">            <span class="comment">// this will change during resize</span></span><br><span class="line">            bucket = hashCode % m_buckets.Length;</span><br><span class="line">        &#125;</span><br><span class="line">        index = m_lastIndex;</span><br><span class="line">        m_lastIndex++;</span><br><span class="line">    &#125;</span><br><span class="line">    m_slots[index].hashCode = hashCode;</span><br><span class="line">    m_slots[index].<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">    m_slots[index].next = m_buckets[bucket] - <span class="number">1</span>;</span><br><span class="line">    m_buckets[bucket] = index + <span class="number">1</span>;</span><br><span class="line">    m_count++;</span><br><span class="line">    m_version++;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> FEATURE_RANDOMIZED_STRING_HASHING &amp;&amp; !FEATURE_NETCORE</span></span><br><span class="line">        <span class="keyword">if</span> (collisionCount &gt; HashHelpers.HashCollisionThreshold &amp;&amp; HashHelpers.IsWellKnownEqualityComparer(m_comparer)) &#123;</span><br><span class="line">            m_comparer = (IEqualityComparer&lt;T&gt;) HashHelpers.GetRandomizedEqualityComparer(m_comparer);</span><br><span class="line">            SetCapacity(m_buckets.Length, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span> // FEATURE_RANDOMIZED_STRING_HASHING</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以注意到，在这段代码中，首先，会通过 <code>InternalGetHashCode()</code> 方法计算一个 HashCode。其中，<code>Lower31BitMask</code> 是一个常量 <code>0x7FFFFFFF</code> ：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">int</span> <span class="title">InternalGetHashCode</span>(<span class="params">T item</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> m_comparer.GetHashCode(item) &amp; Lower31BitMask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，在 HashSet 内部使用了<code>Slot</code> 这个结构来存储元素，该结构设计上类似于链表，每一个 <code>Slot</code> 中都记录对应元素的值、HashCode 以及下一个元素的索引。所以，只需要对它做一次遍历，如果对应元素的 HashCode 和 值 都相等，则认为该元素在 HashSet中已经存在了。此时，<code>AddIfNotPresent()</code> 方法会返回 false。这就是 HashSet 去重的原理啦。在比较元素的值是否相等的时候，我们前面提到的 <code>IEqualityComparer&lt;T&gt;</code> 终于登场，它提供的 <code>Equals()</code> 方法恰好可以比较两个元素是否相等：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">struct</span> Slot &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="built_in">int</span> hashCode;  <span class="comment">// Lower 31 bits of hash code, -1 if unused</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="built_in">int</span> next;  <span class="comment">// Index of next entry, -1 if last</span></span><br><span class="line">    <span class="keyword">internal</span> T <span class="keyword">value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IEqualityComparer</span>&lt;<span class="keyword">in</span> <span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">T x, T y</span>)</span>;</span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">GetHashCode</span>(<span class="params">T obj</span>)</span>;                </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>再接下来，如果对应元素的 HashCode 或 值 都不相等，则认为该元素在 HashSet 中不存在。此时，需要考虑 HashSet 的容量是否足以放得下这个新元素。在容量不满足的情况下，就需要对 HashSet 进行扩容。值得一提的是，这里是使用质数进行扩容的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">IncreaseCapacity</span>()</span> &#123;</span><br><span class="line">    Debug.Assert(m_buckets != <span class="literal">null</span>, <span class="string">&quot;IncreaseCapacity called on a set with no elements&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">int</span> newSize = HashHelpers.ExpandPrime(m_count);</span><br><span class="line">    <span class="keyword">if</span> (newSize &lt;= m_count) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(SR.GetString(SR.Arg_HSCapacityOverflow));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Able to increase capacity; copy elements to larger array and rehash</span></span><br><span class="line">    SetCapacity(newSize, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">ExpandPrime</span>(<span class="params"><span class="built_in">int</span> oldSize</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> newSize = <span class="number">2</span> * oldSize;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Allow the hashtables to grow to maximum possible size (~2G elements) before encoutering capacity overflow.</span></span><br><span class="line">    <span class="comment">// Note that this check works even when _items.Length overflowed thanks to the (uint) cast</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">uint</span>)newSize &gt; MaxPrimeArrayLength &amp;&amp; MaxPrimeArrayLength &gt; oldSize)</span><br><span class="line">    &#123;</span><br><span class="line">        Contract.Assert( MaxPrimeArrayLength == GetPrime(MaxPrimeArrayLength), <span class="string">&quot;Invalid MaxPrimeArrayLength&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> MaxPrimeArrayLength;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> GetPrime(newSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="IEqualityComparer接口"><a href="#IEqualityComparer接口" class="headerlink" title="IEqualityComparer接口"></a>IEqualityComparer<T>接口</h1><p>OK，现在我们知道了，HashSet 之所以可以去重，一个重要的原因是 <code>IEqualityComparer&lt;T&gt;</code> 。而回到这个接口本身呢，它只有 <code>Equals()</code> 和 <code>GetHashCode()</code>，这其实非常符合我们的认知，因为这两个方法在对象相等的场景中十分常见，有一个准则是：如果重写了 <code>Equals()</code> 方法，那么，应该同时去重写 <code>GetHashCode()</code> 方法，即，两者在表达相等这个含义时应该具有一致性。这里可能会有一点疑问，那就是，我们平时使用 HashSet 的时候，完全不需要指定 <code>IEqualityComparer&lt;T&gt;</code> ，它一样可以正常工作啊？没错，这是因为微软提供了一个默认的实现：<code>EqualityComparer&lt;T&gt;.Default</code>。我们同样来看看它的实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="title">EqualityComparer</span>&lt;<span class="title">T</span>&gt; <span class="title">CreateComparer</span>()</span> &#123;</span><br><span class="line">    Contract.Ensures(Contract.Result&lt;EqualityComparer&lt;T&gt;&gt;() != <span class="literal">null</span>);</span><br><span class="line"> </span><br><span class="line">    RuntimeType t = (RuntimeType)<span class="keyword">typeof</span>(T);</span><br><span class="line">    <span class="comment">// Specialize type byte for performance reasons</span></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">typeof</span>(<span class="built_in">byte</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)(<span class="built_in">object</span>)(<span class="keyword">new</span> ByteEqualityComparer());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If T implements IEquatable&lt;T&gt; return a GenericEqualityComparer&lt;T&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(IEquatable&lt;T&gt;).IsAssignableFrom(t)) &#123;</span><br><span class="line">        <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(GenericEqualityComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If T is a Nullable&lt;U&gt; where U implements IEquatable&lt;U&gt; return a NullableEqualityComparer&lt;U&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (t.IsGenericType &amp;&amp; t.GetGenericTypeDefinition() == <span class="keyword">typeof</span>(Nullable&lt;&gt;)) &#123;</span><br><span class="line">        RuntimeType u = (RuntimeType)t.GetGenericArguments()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(IEquatable&lt;&gt;).MakeGenericType(u).IsAssignableFrom(u)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(NullableEqualityComparer&lt;<span class="built_in">int</span>&gt;), u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">            </span><br><span class="line">    <span class="comment">// See the METHOD__JIT_HELPERS__UNSAFE_ENUM_CAST and METHOD__JIT_HELPERS__UNSAFE_ENUM_CAST_LONG cases in getILIntrinsicImplementation</span></span><br><span class="line">    <span class="keyword">if</span> (t.IsEnum) &#123;</span><br><span class="line">        TypeCode underlyingTypeCode = Type.GetTypeCode(Enum.GetUnderlyingType(t));</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Depending on the enum type, we need to special case the comparers so that we avoid boxing</span></span><br><span class="line">        <span class="comment">// Note: We have different comparers for Short and SByte because for those types we need to make sure we call GetHashCode on the actual underlying type as the </span></span><br><span class="line">        <span class="comment">// implementation of GetHashCode is more complex than for the other types.</span></span><br><span class="line">        <span class="keyword">switch</span> (underlyingTypeCode) &#123;</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Int16: <span class="comment">// short</span></span><br><span class="line">               <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(ShortEnumEqualityComparer&lt;<span class="built_in">short</span>&gt;), t);</span><br><span class="line">            <span class="keyword">case</span> TypeCode.SByte:</span><br><span class="line">                <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(SByteEnumEqualityComparer&lt;<span class="built_in">sbyte</span>&gt;), t);</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Int32:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.UInt32:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Byte:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.UInt16: <span class="comment">//ushort</span></span><br><span class="line">                <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(EnumEqualityComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Int64:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.UInt64:</span><br><span class="line">                <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(LongEnumEqualityComparer&lt;<span class="built_in">long</span>&gt;), t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Otherwise return an ObjectEqualityComparer&lt;T&gt;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ObjectEqualityComparer&lt;T&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，<code>EqualityComparer&lt;T&gt;</code> 类是一个抽象类，实现了 <code>IEqualityComparer&lt;T&gt;</code> 接口。简单来说，对于简单类型如整型、字节型等，微软实现了相应的 <code>IEqualityComparer&lt;T&gt;</code> 接口；而对于复杂的类型，微软提供了 <code>ObjectEqualityComparer&lt;T&gt;</code> 这一实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">ObjectEqualityComparer</span>&lt;<span class="title">T</span>&gt;: <span class="title">EqualityComparer</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Pure</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">T x, T y</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> x.Equals(y);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    [<span class="meta">Pure</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">GetHashCode</span>(<span class="params">T obj</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> obj.GetHashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以，现在又回到我们刚刚聊起的话题，为什么说一个类型的 <code>Equals()</code> 和 <code>GetHashCode()</code> 方法非常重要呢？因为如果我们不能正确地实现这两个方法，微软实现的这个  <code>ObjectEqualityComparer&lt;T&gt;</code> 就会出现问题，导致 HashSet 在判断元素是否存在时出现问题，所以，这是一系列的连锁反应。有人可能会问，博主你说的这个好夸张耶，像我就从来没有重写过这两个方法。OK，现在来回答我的一个问题，如果你定义了一个类型 <code>Foo</code> ，并尝试用它作为一个字典中的 Key ，那么，你觉得这个字典应该怎么判断这个 Key 是否存在呢？我觉得这是一个好问题，因为它引发了我们在 .NET 知识体系中的蝴蝶效应。</p>
<h1 id="排序与去重是亲家"><a href="#排序与去重是亲家" class="headerlink" title="排序与去重是亲家"></a>排序与去重是亲家</h1><p>排序与去重，在我看来是亲家关系，因为两者都需要“比较”。所以，下面我想从 .NET 中选取一部分接口来阐述我的观点，以及当我们有了 LINQ 以后，是否就应该抛弃它们。可能这些接口大家平时都用不到多少，但我还是想花点时间来梳理这些知识盲点，因为我发现，与其为整个行业 35 岁的的职业生涯而焦虑，倒不如重新捡起这个行业的初心，好好地学一学数据结构、算法和数学。整个行业的火热，容易让每一个人都陷入一种“我非常厉害”的错觉，我写博客的时候，在心里想了这样一句话：<strong>战士上战场，整天就知道 CRUD，连 HashSet 都不知道，早晚是个死</strong>。用王布斯的口吻说出来，会不会有一种紧迫感呢？</p>
<h2 id="IEquatable接口"><a href="#IEquatable接口" class="headerlink" title="IEquatable接口"></a>IEquatable<T>接口</h2><p><code>IEquatable&lt;T&gt;</code> 接口在微软官方文档中的定义是，<strong>定义值类型或类实现的通用方法，以创建用于确定实例相等性的类型特定方法</strong>。我承认，这不是一个特别好的定义，不过，我们可以换个角度来审视这个接口存在的意义。虽然 <code>Object</code> 这个基类提供了 <code>Equals()</code> 方法，但是这个方法只能接受一个 <code>object</code> 类型的参数， 所以，它本身会面临<strong>类型安全性缺失</strong>和<strong>装箱</strong>两个问题。为了解决这个问题，就必须要定义一个新的 <code>Equals()</code> 方法，确保它可以接收和当前类型一致的参数，所以就需要这样一个接口，你可以理解为它是 <code>Equals()</code> 方法的泛型版本，而众所周知 C# 是一门不支持多继承的语言，所以，这里只能以接口的形式提供出来。这里说一下我的结论，<code>IEquatable&lt;T&gt;</code> 接口对值类型更有用一点，相反，对引用类型就没有那么有用，因为它没有考虑到协变的问题，对引用类型的继承相对无力。下面是一个简单的例子：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义类型Foo，实现IEquatable&lt;Foo&gt;接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span> : <span class="title">IEquatable</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Weight &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params"><span class="built_in">object</span> other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Equals(other <span class="keyword">as</span> Foo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">Foo other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (other == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span>.Value == other.Value &amp;&amp; <span class="keyword">this</span>.Weight == other.Weight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//平平无奇的代码</span></span><br><span class="line"><span class="keyword">var</span> foo1 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line"><span class="keyword">var</span> foo2 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line">Assert.AreEqual(<span class="literal">true</span>, foo1.Equals(foo2));</span><br></pre></td></tr></table></figure>

<h2 id="ICompareable-ICompareable接口"><a href="#ICompareable-ICompareable接口" class="headerlink" title="ICompareable&#x2F;ICompareable接口"></a>ICompareable&#x2F;ICompareable<T>接口</h2><p><code>ICompareable</code> 和 <code>ICompareable&lt;T&gt;</code>是是同一个接口的非泛型与泛型版本，都需要实现 <code>CompareTo()</code> 方法。可能大家会觉得这几个接口都差不多啊，实际上，大家细心观察就能发现它们的区别，“相等”这一类的接口的返回值是布尔型，关注的是两个对象是否相等；而“比较”这一类的接口的返回值是整数型，关注的是哪个大哪个小。我们继续以 <code>Foo</code> 这个类型为例，分别实现<code>IComparerable</code>  和 <code>IComparerable&lt;T&gt;</code>两个接口：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继续实现IComparable, IComparable&lt;Foo&gt;接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span> : <span class="title">IEquatable</span>&lt;<span class="title">Foo</span>&gt;, <span class="title">IComparable</span>, <span class="title">IComparable</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Weight &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params"><span class="built_in">object</span> other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Equals(other <span class="keyword">as</span> Foo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">Foo other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (other == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span>.Value == other.Value &amp;&amp; <span class="keyword">this</span>.Weight == other.Weight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">CompareTo</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> other = obj <span class="keyword">as</span> Foo;</span><br><span class="line">        <span class="keyword">return</span> CompareTo(other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">CompareTo</span>(<span class="params">[AllowNull] Foo other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (other == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">int</span>)((Value * Weight) - (other.Value * other.Weight));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//平平无奇的代码</span></span><br><span class="line"><span class="keyword">var</span> foo1 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line"><span class="keyword">var</span> foo2 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">20</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line">Assert.IsTrue(foo2.CompareTo(foo1) &gt; <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h2 id="IComparer接口"><a href="#IComparer接口" class="headerlink" title="IComparer接口"></a>IComparer<T>接口</h2><p>对于排序来说，理论上有<code>ICompareable</code> 和 <code>ICompareable&lt;T&gt;</code>这两个接口就可以了，为什么还要再定义一组接口呢？其实，我们结合生活中的场景就能想明白，不管是判断两个对象是否相等，还是对两个对象进行排序，这些条件都属于“变量”。<code>ICompareable</code> 和 <code>ICompareable&lt;T&gt;</code>这两个接口设计上的确没什么问题，但这都是一锤子买卖，一旦实现了对应的接口，就意味着如何比较两个对象的逻辑是确定好了的。可生活常识告诉我们，同一组信息不同的人考虑的维度是不一样的，譬如学生的成绩，可以按照某一个科目的成绩来排序，还可以按照各个科目的总成绩甚至是平均分来排序。对于上面的类型 <code>Foo</code>，我们不妨考虑按照 <code>Value</code> 和 <code>Weight</code> 分别进行排序，此时可以这样写：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//按Value排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FooValueComparer</span> : <span class="title">IComparer</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Compare</span>(<span class="params">[AllowNull] Foo x, [AllowNull] Foo y</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">int</span>)(x.Value - y.Value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按Weight排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FooWeightComparer</span> : <span class="title">IComparer</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Compare</span>(<span class="params">[AllowNull] Foo x, [AllowNull] Foo y</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">int</span>)(x.Weight - y.Weight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//平平无奇的代码</span></span><br><span class="line"><span class="keyword">var</span> list= <span class="keyword">new</span> List&lt;Foo&gt;&#123;</span><br><span class="line">    <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">2.0</span>M &#125;,</span><br><span class="line">    <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用默认的排序器</span></span><br><span class="line">list.Sort(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//按Value进行排序</span></span><br><span class="line">list.Sort(<span class="keyword">new</span> FooValueComparer());</span><br><span class="line">list.OrderBy(x =&gt; x.Value);</span><br><span class="line"></span><br><span class="line"><span class="comment">//按Weight进行排序</span></span><br><span class="line">list.Sort(<span class="keyword">new</span> FooWeightComparer());</span><br><span class="line">list.OrderBy(x =&gt; x.Weight);</span><br></pre></td></tr></table></figure>
<p>在这里有一个点是，在不指定排序器的时候，微软帮我们提供了一个默认的排序器。而这个默认排序器会遵循这样的策略。如果类型 T 实现了 <code>IComparable&lt;T&gt;</code> 接口，则返回 <code>GenericComparer&lt;int&gt;</code> 实例；如果类型 T 实现是一个可空类型 <code>Nullable&lt;U&gt;</code> 并且类型 U 实现了 <code>IComparable&lt;T&gt;</code> 接口，则返回 <code>NullableComparer&lt;int&gt;</code> 实例；否则返回 <code>ObjectComparer&lt;T&gt;</code> 实例。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Comparer&lt;T&gt; <span class="title">CreateComparer</span>()</span> &#123;</span><br><span class="line">    RuntimeType t = (RuntimeType)<span class="keyword">typeof</span>(T);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// If T implements IComparable&lt;T&gt; return a GenericComparer&lt;T&gt;</span></span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> FEATURE_LEGACYNETCF</span></span><br><span class="line">        <span class="comment">// Pre-Apollo Windows Phone call the overload that sorts the keys, not values this achieves the same result</span></span><br><span class="line">        <span class="keyword">if</span> (CompatibilitySwitches.IsAppEarlierThanWindowsPhone8) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t.ImplementInterface(<span class="keyword">typeof</span>(IComparable&lt;T&gt;))) &#123;</span><br><span class="line">                <span class="keyword">return</span> (Comparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(GenericComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(IComparable&lt;T&gt;).IsAssignableFrom(t)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(GenericComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// If T is a Nullable&lt;U&gt; where U implements IComparable&lt;U&gt; return a NullableComparer&lt;U&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (t.IsGenericType &amp;&amp; t.GetGenericTypeDefinition() == <span class="keyword">typeof</span>(Nullable&lt;&gt;)) &#123;</span><br><span class="line">        RuntimeType u = (RuntimeType)t.GetGenericArguments()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(IComparable&lt;&gt;).MakeGenericType(u).IsAssignableFrom(u)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(NullableComparer&lt;<span class="built_in">int</span>&gt;), u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Otherwise return an ObjectComparer&lt;T&gt;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ObjectComparer&lt;T&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更有意思的是，<code>GenericComparer&lt;T&gt;</code> 就是利用 <code>IComparable&lt;T&gt;</code> 的 <code>CompareTo()</code> 方法来说实现的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">GenericComparer</span>&lt;<span class="title">T</span>&gt; : <span class="title">Comparer</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span>: <span class="title">IComparable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">Compare</span>(<span class="params">T x, T y</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> x.CompareTo(y);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Equals method for the comparer itself. </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">Object obj</span>)</span>&#123;</span><br><span class="line">        GenericComparer&lt;T&gt; comparer = obj <span class="keyword">as</span> GenericComparer&lt;T&gt;;</span><br><span class="line">        <span class="keyword">return</span> comparer != <span class="literal">null</span>;</span><br><span class="line">    &#125;        </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">GetHashCode</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.GetType().Name.GetHashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在我们有了 <code>LINQ</code> 以后，通过 <code>OrderBy</code> 和 <code>OrderByDescending</code> 就可以进行排序，如果这个排序字段是一个简单类型，比如字符型、整型、日期型，这些简单类型微软都已经实现了相应的“排序”逻辑，而如果这个排序字段是一个复杂类型，比如一个自定义的类或者结构，此时，为了让这些方法能够“适应”这些复杂类型，最好的还是去实现 <code>IComparer&lt;T&gt;</code> 或者 <code>ICompareable&lt;T&gt;</code> 接口，然后传递给这两个排序方法。类似地，还有 <code>Distinct</code> 这个方法，它接收一个 <code>IEqualityComparer&lt;T&gt;</code> 类型的参数，所以，当你对一个列表进行去重(<strong>Distinct</strong>)操作时，千万不要想当然地人为它会按照你的期望去去重，如果结果不符合你的期望，很大原因是你没有给它提供一个合适的<code>IEqualityComparer&lt;T&gt;</code> 。所以，你看，我们绕了一大圈，从 HashSet 说到 <code>IEqualityComparer&lt;T&gt;</code>，又从排序说到去重，最终又回到了起点，这是多么有趣的一件事情。而去重(<strong>Distinct</strong>)这件事情，其实涉及到<code>Dictionary</code> 和 <code>HashSet</code> 两个数据结构，通过结构来推演性质，又通过性质来扫清盲点，这可能是这段时间刷 LeetCode 最大的一个收获吧！</p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>面试中偶然遇到的 HashSet 问题，让我发现自己的知识体系中存在着盲点。通过解读 HashSet 源代码，我们认识到 HashSet 可以去重的一个重要原因是<code>IEqualityComparer&lt;T&gt;</code> 接口，它决定了两个对象的实例在什么情况下可以被判定为相等。而这个接口，不单单在 HashSet 出现，在 Dictionary 中同样会出现，甚至在我们最熟悉不过的去重(<strong>Distinct</strong>)中还会出现，所以，通过 HashSet 这一个点上的疑问，我搞清楚了很多相关联的内容，这不是蝴蝶效应又是什么呢？而与去重(<strong>Distinct</strong>)相关联的则是排序，在此基础上，对 <code>IEquatable&lt;T&gt;</code> 接口、<code>ICompareable</code>&#x2F;<code>ICompareable&lt;T&gt;</code> 接口、<code>IComparer&lt;T&gt;</code> 接口等知识盲点进行梳理。总而言之，排序需要关注的是 <code>ICompareable</code>&#x2F;<code>ICompareable&lt;T&gt;</code> 接口、<code>IComparer&lt;T&gt;</code> 接口，去重需要关注的是 <code>IEqualityComparer&lt;T&gt;</code> 接口。好了，今天的这只蝴蝶就飞到这里，欢迎大家在博客中留言，谢谢大家！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/18/2020/campus-network-sharing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/18/2020/campus-network-sharing/" itemprop="url">绕过校园网分享限制，构建愉快的宿舍网络环境</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-18T16:45:00+08:00">
                2020-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>最近大一新生们开学了，就有几位学弟来问我说，咱们学校的校园网要怎么才能开 WiFi 热点、能不能用路由器。回想一下当初我也折腾了好一段时间，本来想水篇博客的，后来不知道怎么的就咕咕咕了……正好借此机会分享一下。</p>
<p>其实吧，学校有的是办法搞你。除了强制一人一号、恶心的专用拨号客户端防共享以外，还能通过 <a target="_blank" rel="noopener" href="https://www.xavier.wang/post/45-suck-shit-lan/">IPID、TTL、时钟偏移检测</a>，甚至是 DPI 深度包检测的方法来防私接，就看校方做得够不够绝了。当然破解的方法也有，但基本也不会让你好受。如果碰到这样的校园网，推荐你直接躺平，给这种垃圾网络交钱还不如开个无限流量套餐呢。</p>
<p><strong>免责声明：日后你惹出祸来，不把师父说出来就行了.jpg</strong></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/10/18/2020/campus-network-sharing/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/18/%E5%BD%93%E5%A7%9C%E5%AD%90%E7%89%99%E9%81%87%E8%A7%81%E6%9C%B1%E4%B8%80%E6%97%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/18/%E5%BD%93%E5%A7%9C%E5%AD%90%E7%89%99%E9%81%87%E8%A7%81%E6%9C%B1%E4%B8%80%E6%97%A6/" itemprop="url">当姜子牙遇见朱一旦</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-18T12:19:02+08:00">
                2020-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>当导演张策宣布，不再为朱一旦系列担任编剧和配音时，我终于意识到，“十佳员工”不再是一个梗，而是一个活生生的人。也许，身为老板的“朱一旦”，永远都没有读懂这些黑色幽默背后的含义。而显然，站在普通人对立面的资本家们，终究不会因此而洗心革面，代表劳苦大众向这个时代发声。不管是后浪还是非浪，资本家们不会选择和钱过不去，所以，即使有像鲁迅一般针砭时弊的张策，可在一个“屁股决定脑袋”的世界里，“十佳员工”突然就变成一个不再好笑的词汇，因为，这个人可以是你，可以是我，可以是我们中的任何一个。在新冠疫情肆虐的时候，『一块劳力士的回家之路』让我们感受到了现实的魔幻，可此时此刻，我们终于知道，“艺术来源于生活，而往往高于生活”，果然，如有雷同，是不胜荣幸的了。可能是因为我此刻在经历着同样的事情，所以，难免感同身受地想到 C 座 802 里这群真实存在着的人们。</p>
<p>我有一位为公司奉献 11 年青春的同事，可当他离开这家公司时，并没有我想象的中那样充满不舍，大概“鸟尽弓藏”、“大地茫茫真干净”这些句子，从古至今就是这样子的吧！马老师说，“996 是一种福报”，而此前的一位马老师则说，“资本家生来就是剥削劳动者的一切剩余价值”。历史像个任人打扮的小姑娘，你方唱罢我登场，文过饰非，到底谁又讲得清对错？有人说，一个人开始成熟，就是从学习这几千年来的厚黑学、阴谋论开始，的确啊，连封神都开始变成一场阴谋，不同的是，这次的因果都落在原始天尊身上，每一个人都渴望像姜子牙一样，断天梯、破枷锁，似乎一定要执著于什么东西，这样的人生会显得更真实一点。可每个人自以为最完美的安排，终究无法让每一个人信服啊，正如“朱一旦”们喜欢“非洲安排”，马小策与张策，说到底不过是一种代号而已，当这种“安排”无法调和的时候，人和神仙一样，都会暴走，都会变身，唯一不同的是，人是要吃饭的，而神仙们早已学会辟谷。</p>
<p>所以，在“救一个人还是救苍生”这个问题上，其实谁都没有错，我特别喜欢李诞在『奇葩说』中表达的一个观点，<strong>“以自私却不伤害别人的方式活着，才能维持世界的运转。而正是那些为了宏图伟业不计后果的牺牲‘小猫’的人，频频地让我们的世界陷入「大火」”</strong>。朱一旦不想再做“任人摆布”的老板，张策不想再做“默默无名”的幕后英雄，马老师早已看破这一切，“钱没给到位”，“心委屈了”，身在其位时榨干身体的“996”，人走茶凉时送瘟神般“高效”，一冷一热，果然是“环球同此凉热”呢。在全球变暖的趋势下，如果我们以自私却不伤害别人的方式活着，虽然活得有一点清冷、没有人情味，但这样是不是会更安心一点，骨子里与生俱来就带着“竞争”的基因的我们，是不是一定要学会“狠”、学会“不择手段”、学会“伤害”。我二十多岁的时候，想努力去照顾好一个人，而等到我快要三十岁的时候，我终于能勉强照顾好自己，这简直是一种幸运。</p>
<p>这种感慨在某个场景下会更加明显，譬如一个人去看电影的时候，虽然我很喜欢和邻座的小朋友说话，可对方父母一句友善的“叔叔”，终于还是让两个人产生了距离。譬如找工作面试的时候，发觉三十上下的“哥哥姐姐”们，都开始面对“总监”级别职位时的恍惚感。也许，我们这一代人真的已经老了吧，而那个人早已离开你很久很久，我无意去对立资本家与劳动者间积怨久矣的矛盾，更无意去揣测封神台下蛰伏已久的阴谋。回想以前，乐无异在『古剑奇谭 2』中说出一句，<strong>“众生虽苦，还请诸恶莫作”</strong>，当时大概只是觉得这句话酷到不行，倘若议论公平，C 座 802 诸如三濑子、马小玲、马小浩等等角色，每一个都带着无数的梗，没有他们就没有整个朱一旦宇宙，当人们为张策惋惜的时候，是不是就选择性地遗忘了他们呢？朱一旦不会成为劳苦大众的代言人，而且任何人都不会，因为一切的流量到最后都是生意。</p>
<p>我在 B 站关注过一位阿婆主，起初，他在厂里打工，下班后的“入味儿”是他主要的拍摄内容。后来，因为疫情的原因，他开始学别人拍做菜的视频。再后来，发现他变成了一位外卖小哥。世人皆苦，家家有本难念的经，可我们除了祝福以外，又能做一点什么呢？成人世界里，利益、立场、观点……，该有的一切都有，唯独没有对错，希望一个组织有一致的步伐、一致的声音，可偏偏人是一根会思考的芦苇，我知道，当一个人在某一种身份下，他必须要去推动一种文化形成，可如果这些声音连他自己都不信，这种文化的底蕴应该不会特别丰富，很容易成为政治博弈的牺牲品。我从前天真地以为，在互联网这样一个相对开放的环境里，不会存在政治这种产物。而出于对这种东西的逃避，我没有选择成为三线小城市里的一个公务员，实际上我尝试过，结果证明我真的不适合。可后来我发现我错了，只要有人的地方就会存在政治，无论是公司还是社区，每天都有人宣扬这样或者那样的“文化”，这个时候，我希望我们每一个人都去用心甄别这些概念，因为作为人的自觉，他只会说对自己有利的话，正如择偶标准是最毫无标准可言的标准一样，王垠说编程世界里充满宗派，就是最好的证明。</p>
<p>所以，我不大愿意去统一什么东西，充满多样性、充满个性的世界，才是一个正常的世界，以结果论的观点而言，只要能送大家都目的地，是飞机还是高铁还是火车，真的重要吗？如果非要去统一什么，我希望是“语言”或者“领域语言”，因为，我们的沟通，因为存在太多的翻译而逐渐失真、甚至被曲解，我们一般把这样的沟通称之为扯皮，就像土味情话虽然美妙动听，但它携带了大量无用的信息。所以，即使冒着成为“钢铁直男”的危险，我依然想成为一个表达清晰的人。有人说，姜子牙就不能和原始天尊好好商量一下吗？非要自断天梯逼得鸿钧老祖出手吗？人类啊，归根到底，只愿意相信自己相信的，只愿意看见自己看见的，这种意念在成年后往往更加强烈，有多少遗憾就是得不到有效沟通造成的呢？九尾狐自觉被原始天尊欺骗、过河拆桥，而原始天尊认为“非我族类，其心必异”，都是选择性地相信了自己愿意去相信的东西。有人说，姜子牙有强迫症，为什么会任由师尊披头散发？因为不是每个人都能像约翰·纳什那样，在最亲密的人面前直抒胸臆，人类就是这么奇怪，和陌生人玩什么真心话大冒险，在亲人面前反而含蓄、羞怯起来，可能是因为某种特殊的磁力限制了声道发声吧，科学与玄学往往就是这么切换自如。</p>
<p>思绪就像一个无底黑洞，姜子牙与朱一旦，两个八竿子不十竿子都打不着的人，就这么神奇地在我脑海里，完成了一次对话。如果思维存在奇点，将会坍陷于何处，苏格拉有没有底不重要，马老师们谁说得对同样不重要，甚至你看我这满纸荒唐言依然不重要，它仅仅表明我此时此刻在思考，我是一个活生生的人，所谓“我思故我在”，无非给枯燥的人生多一点无用的点缀罢了，你说朱一旦都不枯燥了，我们却还停留在这里，你说，还有比这个更枯燥的事情吗？申公豹形神俱灭，从头开始修行，居然连基因都发生了突变，大概，在这世间，没有什么可以永恒。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/posts/hsts-problem-solving-experience.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/hsts-problem-solving-experience.html" itemprop="url">记一次因 HSTS 导致跨域问题的经历</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-17T12:56:49+08:00">
                2020-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>Access to XMLHttpRequest at ‘<a target="_blank" rel="noopener" href="http://a.com/api">http://a.com/api</a>‘ from origin ‘<a target="_blank" rel="noopener" href="http://b.com/">http://b.com</a>‘ has been blocked by CORS policy: Response to preflight request doesn’t pass access control check: Redirect is not allowed for a preflight request.</p>
</blockquote>
<p>生产上多次出现上面这个奇怪的跨域问题，但神奇的是强刷新后或者使用无痕模式打开就正常了。<br />到底是哪里出了问题呢？本文将一探究竟。<br /></p>
<blockquote>
<p>本文首发于知乎：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/245511588">https://zhuanlan.zhihu.com/p/245511588</a></p>
</blockquote>
<p><a name="T7LWX"></a></p>
<h2 id="先说结论"><a href="#先说结论" class="headerlink" title="先说结论"></a>先说结论</h2><p>排查后发现，出现这个报错的原因是：<strong>之前使用过 HTTPS 访问页面，所以也请求了 HTTPS 协议的 API，然后 API 的域名被记录在 <code>HSTS</code> 列表中，之后使用 HTTP 访问页面，而 API 请求却被重定向到 HTTPS，而因为预检请求(OPTIONS)不能被重定向，所以导致出现 CORS 错误。</strong><br /><br><br />关于 CORS 更详细的介绍可以点击查看：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">HTTP 访问控制（CORS）</a><br /><br><br />总的来说原因在于前后端 HTTP 和 HTTPS 混用导致的，正常的情况下如果统一为 HTTP 或者 HTTPS 则不会出现这个问题。<br /><br><br />所以如果要开启 <code>HSTS</code> ，请确保前后端都开启，否则就会出现与本文一样的错误。<br /><br><br />那么前端页面要开启 HSTS 的话，需要做哪些操作呢？需要在 web 服务器添加响应头 ，以 Nginx 为例：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span> always;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />如果是其他 web 服务器，可以到参考<a target="_blank" rel="noopener" href="https://www.techbrown.com/configure-hsts-apache-nginx-iis-lighttpd-web-servers/">这里</a>。<br /><br><br />这里还要注意：<br /></p>
<ol>
<li>即便关掉 HSTS 也需要等到 max-age 过期才会从 HSTS 列表清除，所以除非让用户手动清除，否则这段时间内还是会被重定向到 HTTPS。</li>
<li>如果加了 includeSubDomains ，该网站的所有子域名都会被重定向到 HTTPS ，那会有什么影响呢？假设生产环境为 <a target="_blank" rel="noopener" href="http://a.com/">http://a.com</a>，而测试环境为 <a target="_blank" rel="noopener" href="http://test.a.com/">http://test.a.com</a>，当访问 <a target="_blank" rel="noopener" href="http://a.com/">http://a.com</a> 后，即便在测试环境没有 HTTPS 的情况下也会被重定向</li>
</ol>
<p><br />好了，说完结论，那下面来讲讲我是如何使用 Chrome 自带的网络记录工具定位到此问题的。<br /></p>
<p><a name="n8wDb"></a></p>
<h2 id="是缓存的问题？"><a href="#是缓存的问题？" class="headerlink" title="是缓存的问题？"></a>是缓存的问题？</h2><p>既然强刷新或者使用无痕模式是正常的，那么就很有可能是因为缓存导致，对比会出现跨域和正常的请求头，发现两者有很大不同：<br /><br><br />这是正常的 👇<br /></p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_1.png">这是出现跨域的 👇<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_2.png"><br />可以看出下面这个会出现跨域的请求少了很多内容，而猜测会不会是因为缺少 CORS 相关的部分请求头，所以导致跨域呢？<br /><br><br /><del>根据关键词「跨域 无痕模式」在搜索引擎找到这篇《</del><a target="_blank" rel="noopener" href="https://blog.techbridge.cc/2018/08/18/cors-issue/"><del>原來 CORS 沒有我想像中的簡單</del></a><del>》，其中说到是因为浏览器缓存的问题，使用 <code>crossorigin=&quot;anonymous&quot;</code> 让每次发出的请求带上 origin header， 但是这个属性只适用于 <code>&lt;img&gt;</code> 、 <code>&lt;script&gt;</code> 等，于是我去寻找在 axios 请求库对应的属性</del>，然并卵。<br /><br><br />那么有没有可能问题根本不是出在前端发送请求上呢？<br /></p>
<p><a name="8lHSO"></a></p>
<h2 id="使用-Chrome-排查网络问题"><a href="#使用-Chrome-排查网络问题" class="headerlink" title="使用 Chrome 排查网络问题"></a>使用 Chrome 排查网络问题</h2><p>既然这样，那就来看看浏览器发送请求的过程中到底发生了什么，于是我通过 chrome:&#x2F;&#x2F;net-export 记录会发生跨域的页面请求日志：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_3.png"><br />导出日志文件后，发现了一个很奇怪的点：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_4.png"><br />在上图可以看到，明明请求 HTTP 协议的 API，但是因为 <code>HSTS</code> ，将请求重定向到了 HTTPS 协议下。<br /><br><br />简单来说一下 <code>HSTS</code> 是什么：</p>
<blockquote>
<p>HTTP Strict Transport Security（通常简称为 HSTS）是一个安全功能，它告诉浏览器只能通过 HTTPS 访问当前资源，而不是 HTTP —— <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Security/HTTP_Strict_Transport_Security">MDN</a></p>
</blockquote>
<p><br />就是说如果浏览器发现该网站开启了 <code>HSTS</code> ，则会自动把所有请求重定向到 HTTPS 下。<br /><br><br />为了验证是不是因为这个原因，在无痕模式下也进行了一次记录，发现该日志下找不到 <code>HSTS</code> 的身影：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_5.png"><br />随后我又通过 Chrome 的 <code>HSTS</code> 设置页面进一步验证了两者的不同，打开 <a href="">chrome:&#x2F;&#x2F;net-internals&#x2F;#hsts</a> 查询发送跨域的请求域名：<br /><br><br />出现跨域的浏览器窗口 👇<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_6.png"><br />正常请求的浏览器窗口（无痕模式）👇<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_7.png"><br /></p>
<p><a name="CDmgs"></a></p>
<h2 id="都是-HSTS-惹的祸"><a href="#都是-HSTS-惹的祸" class="headerlink" title="都是 HSTS 惹的祸"></a>都是 HSTS 惹的祸</h2><p>没想到，竟然是因为 <code>HSTS</code> ，那为什么一个会有 <code>HSTS</code> 而另一个却没有呢？这时候我留意到出现跨域的页面使用的是 HTTP 访问，但其实是支持 HTTPS 的，所以我猜想会不会是：<strong>之前使用过 HTTPS 访问页面，所以也请求了 HTTPS 的 API，然后 API 的域名被记录在 <code>HSTS</code> 列表中，之后使用 HTTP 访问页面，而 API 请求却被重定向到 HTTPS，所以导致跨域？</strong><br /><br><br />为了验证上面的猜想，特地开了一个新的无痕模式，按照上面所说的步骤操作，完美复现跨域错误！<br /><br><br /><strong>更重要的是我在原本出现跨域的页面改为 HTTPS 访问，也正常请求了。</strong><br /></p>
<p><a name="7Nc9R"></a></p>
<h2 id="为什么会出现这种情况？"><a href="#为什么会出现这种情况？" class="headerlink" title="为什么会出现这种情况？"></a>为什么会出现这种情况？</h2><p>为什么请求 API 会被自动重定向到 HTTPS，而请求页面却不会呢？<br /><br><br />原来 <code>HSTS</code> 是根据响应头有没有 <code>strict-transport-security</code> 字段决定是否加入 <code>HSTS</code> 列表的，<strong>经排查发现前端页面的响应头是没有这个字段的，但 API 响应头却有</strong>。<br /><br><br />页面响应头：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20201017132900.png"><br><br />API 响应头：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20201017132926.png"><br><a name="3pm3v"></a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如果出现奇怪的网络请求问题，可以尝试使用 Chrome 自带的网络请求分析工具，说不定会有收获。<br /></p>
<p><a name="MB4GK"></a></p>
<h2 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h2><ul>
<li><a target="_blank" rel="noopener" href="https://support.google.com/chrome/a/answer/6271171?hl=zh-Hans">排查 Chrome 网络问题</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">HTTP 访问控制（CORS）</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Security/HTTP_Strict_Transport_Security">HTTP Strict Transport Security</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/6866942131777306631">浏览器跨域问题与服务器中的 CORS</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/16/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%9130%E5%B9%B4%E5%8F%98%E8%BF%81%E5%8F%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/16/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%9130%E5%B9%B4%E5%8F%98%E8%BF%81%E5%8F%B2/" itemprop="url">前端开发30年变迁史</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-16T21:53:49+08:00">
                2020-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>缅怀司徒正美大神，愿天堂没有996！</p>
</blockquote>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/10/16/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%9130%E5%B9%B4%E5%8F%98%E8%BF%81%E5%8F%B2/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/12/2020-10-12-antifragile-book-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/12/2020-10-12-antifragile-book-summary/" itemprop="url">从不确定性中获益 - 读《反脆弱》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-12T12:13:24+08:00">
                2020-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>最近读完了《反脆弱》一书，这是《黑天鹅》的作者塔勒布的又一本畅销书。</p>
<p>全书的内容比较啰嗦，核心讲的就是两个方面：<br>1、什么是反脆弱性<br>2、如何应对不确定性，并从中获得收益</p>
<h2 id="什么是反脆弱性"><a href="#什么是反脆弱性" class="headerlink" title="什么是反脆弱性"></a>什么是反脆弱性</h2><p>首先我们应该看到世界是不确定的，人们试图预测很多事情，但是最终发现，对世界产生巨大影响的事情，人们基本上都预测失败了（比如今年的新冠疫情）。这种不确定性一方面是由于世界本身是很难预测的，另一方面是极端事情发生的可能性并不低。</p>
<p>尼采说：“杀不死我的，只会让我更坚强”。作者的反脆弱性就是指这种现象。如果面对压力，有一些事物反而呈现出更好的自己，这类事物就是反脆弱的。</p>
<p>书中举了很多案例，我觉得最容易理解的案例就是：如果把体力消耗看成一种压力：</p>
<ul>
<li>如果我们面对高强度体力消耗，累死了，我们就是脆弱的。</li>
<li>如果我们面对高强度体力消耗，没累死，我们就是强韧的。</li>
<li>如果我们面对高强度体力消耗，变得更强壮了，我们就是反脆弱的。</li>
</ul>
<p>我还看到一个读者的比喻：</p>
<ul>
<li>一阵微风就可以吹灭蜡烛，蜡烛是脆弱的；</li>
<li>一阵风吹不灭所有的蜡烛，蜡烛就是强韧的；</li>
<li>一阵风反而助长了蜡烛的火焰，蜡烛就是反脆弱。</li>
</ul>
<p>书中还举了很多组织的反脆弱案例，比如国家或者社区的某一个个体的悲剧，使得整个群体关注到一些危险，从而使得整个群体变得更加安全和健康。</p>
<h2 id="如何应对不确定性"><a href="#如何应对不确定性" class="headerlink" title="如何应对不确定性"></a>如何应对不确定性</h2><p>作者推荐通过加强自己的反脆弱性来应对不确定性。我印象中的包括：</p>
<p>1、杠铃策略。把 90% 的投入到安全领域，把 10% 投入到损失很小，但是可以提高自己的反脆弱性的事情上。例如买保险，灾难可能使得你获得更多；例如培养自己的第二技能，万一失业还可以另谋生计。</p>
<p>又例如在股票市场上，买入股票的同时又买入看跌期权，这样万一股票大跌，你可以从看跌期权的对冲中锁定自己的损失。股票的期权权利金叫做 premium，这个单词本身就有保险的意思。</p>
<p>2、主动理性试错。做成功率虽然低，但是低风险高收益的事情。你要考虑的事情只有两件，一是万一失败是否致命，二是万一成功收益是否不成比例的多，如果同时符合这两点，这类事情就是多多益善，二者缺其一的事，则尽量少做，按照这样的做事策略，反脆弱性就会提高。</p>
<p>例如：加入一家早期的创业公司，就是符合这种策略的。因为加入一家创业公司收入和技能锻炼并不少，但是潜在的收益可能很高。</p>
<p>3、通过备份，即使一个备份丢失，你仍有别的备份可供使用。计算机系统上，我们就通常用线上从库 + Binary Log + 离线备份来实在数据的冗余备份。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>人们常说，不要把鸡蛋放在一个篮子里面，这其实就是一种避免风险的办法。《反脆弱》用更系统的方式介绍了生活中各种有趣的案例，教我们通过杠铃策略、主动理性试错、备份等方式来应对不确定性。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/11/%E5%9F%BA%E4%BA%8EOptions%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0-NET-Core%E7%9A%84%E9%85%8D%E7%BD%AE%E7%83%AD%E6%9B%B4%E6%96%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/11/%E5%9F%BA%E4%BA%8EOptions%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0-NET-Core%E7%9A%84%E9%85%8D%E7%BD%AE%E7%83%AD%E6%9B%B4%E6%96%B0/" itemprop="url">基于选项模式实现.NET Core 的配置热更新</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-11T12:19:02+08:00">
                2020-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">数据存储</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>最近在面试的时候，遇到了一个关于 .NET Core 配置热更新的问题，顾名思义，就是在应用程序的配置发生变化时，如何在不重启应用的情况下使用当前配置。从 .NET Framework 一路走来，对于 Web.Config 以及 App.Config 这两个配置文件，我们应该是非常熟悉了，通常情况下， IIS 会检测这两个配置文件的变化，并自动完成配置的加载，可以说它天然支持热更新，可当我们的视野伸向分布式环境的时候，这种配置方式就变得繁琐起来，因为你需要修改一个又一个配置文件，更不用说这些配置文件可能都是放在容器内部。而有经验的朋友，可能会想到，利用 Redis 的发布-订阅来实现配置的下发，这的确是一个非常好的思路。总而言之，我们希望应用可以随时感知配置的变化，所以，在今天这篇博客里，我们来一起聊聊 .NET Core 中配置热更新相关的话题，这里特指全新的选项模式(<strong>Options</strong>)。</p>
<h1 id="Options-三剑客"><a href="#Options-三剑客" class="headerlink" title="Options 三剑客"></a>Options 三剑客</h1><p>在 .NET Core 中，选项模式(<strong>Options</strong>)使用类来对一组配置信息进行强类型访问，因为按照<code>接口分隔原则(ISP)</code>和<code>关注点分离</code>这两个工程原则，应用的不同部件的配置应该是各自独立的，这意味着每一个用于访问配置信息的类，应该是只依赖它所需要的配置信息的。举一个简单的例子，虽然 Redis 和 MySQL 都属于数据持久化层的设施，但是两者属于不同类型的部件，它们拥有属于各自的配置信息，而这两套配置信息应该是相互独立的，即 MySQL 不会因为 Redis 的配置存在问题而停止工作。此时，选项模式(<strong>Options</strong>)推荐使用两个不同的类来访问各自的配置。我们从下面这个例子开始：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Learning&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Years&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Topic&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;Hotfix&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.NET Core&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Options&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Skill&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C#&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Score&quot;</span><span class="punctuation">:</span> <span class="number">3.9</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Score&quot;</span><span class="punctuation">:</span> <span class="number">2.6</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JavaScript&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Score&quot;</span><span class="punctuation">:</span> <span class="number">2.8</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>此时，如果希望访问<code>Learning</code>节点下的信息，我们有很多种实现方式：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式1</span></span><br><span class="line"><span class="keyword">var</span> learningSection = Configuration.GetSection(<span class="string">&quot;Learning&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> careerYears = learningSection.GetValue&lt;<span class="built_in">decimal</span>&gt;(<span class="string">&quot;Years&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> topicHotfix = learningSection.GetValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;Topic:0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//方式2</span></span><br><span class="line"><span class="keyword">var</span> careerYears = Configuration[<span class="string">&quot;Learning:Years&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> topicHotfix = Configuration[<span class="string">&quot;Learning:Topic:0&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>而更好的方式是，定义一个类来访问这组配置信息：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> [<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LearningOptions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Years &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; Topic &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;SkillItem&gt; Skill &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SkillItem</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Lang &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span>? Score &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样地，茴香的<code>茴</code>字有几种写法，你可知道?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//写法1：手动绑定</span><br><span class="line">var leaningOptions = new LearningOptions();</span><br><span class="line">Configuration.GetSection(&quot;Learning&quot;).Bind(leaningOptions);</span><br><span class="line"></span><br><span class="line">//写法2：自动绑定</span><br><span class="line">leaningOptions = Configuration.GetSection(&quot;Learning&quot;).Get&lt;LearningOptions&gt;();</span><br><span class="line"></span><br><span class="line">//写法3：自动绑定 + 依赖注入</span><br><span class="line">services.Configure&lt;LearningOptions&gt;(Configuration.GetSection(&quot;Learning&quot;));</span><br><span class="line"></span><br><span class="line">//写法4：配置的二次加工</span><br><span class="line">services.PostConfigure&lt;LearningOptions&gt;(options =&gt; options.Years += 1);</span><br><span class="line"></span><br><span class="line">//写法5：委托绑定</span><br><span class="line">services.Configure&lt;AppInfoOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">  options.AppName = &quot;ASP.NET Core&quot;;</span><br><span class="line">  options.AppVersion = &quot;1.2.1&quot;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>我们知道，在 .NET Core 里依赖注入被提升到了一等公民的位置，可谓是无处不在。当我们在 IoC 容器中注入<code>LearningOptions</code>以后，就可以在服务层或者控制器层直接使用它们，此时，我们就会遇到传说中的 Options 三剑客，即<code>IOptions&lt;TOptions&gt;</code>、<code>IOptionsSnapshot&lt;TOptions&gt;</code>和<code>IOptionsMonitor&lt;TOptions&gt;</code>。关于它们三个的区别，<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/configuration/options?view=aspnetcore-3.1">官方文档</a>里给出了详细的说明：</p>
<ul>
<li>IOptions<TOptions>：生命周期为 Singleton，在应用启动时完成初始化。应用启动后，对配置的修改是非响应式的。</li>
<li>IOptionsSnapshot<TOptions>：生命周期为 Scoped，每次请求时会重新计算选项。应用启动后，对配置的修改是响应式的。</li>
<li>IOptionsMonitor<TOptions>：生命周期为 Singleton，可以随时检索当前配置项。应用启动后，对配置的修改是响应式的。</li>
</ul>
<p>是不是听起来有一点还有一点绕？长话短说就是，如果希望修改完配置立即生效，那么，更推荐使用<code>IOptionsSnapshot&lt;TOptions&gt;</code>和<code>IOptionsMonitor&lt;TOptions&gt;</code>，前者是在下一次请求时生效，后者则是访问<code>CurrentValue</code>的时候生效。而对于像<code>3.14</code>或者<code>0.618</code>这种运行时期间不会修改的“常量”，更推荐使用<code>IOptions&lt;TOptions&gt;</code>。下面是关于它们的一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[ApiController]</span><br><span class="line">[Route(&quot;[controller]&quot;)]</span><br><span class="line">public class WeatherForecastController : ControllerBase</span><br><span class="line">&#123;</span><br><span class="line">    private readonly ILogger&lt;WeatherForecastController&gt; _logger;</span><br><span class="line">    private readonly IOptions&lt;LearningOptions&gt; _learningOptions;</span><br><span class="line">    private readonly IOptionsSnapshot&lt;LearningOptions&gt; _learningOptionsSnapshot;</span><br><span class="line">    private readonly IOptionsMonitor&lt;LearningOptions&gt; _learningOptionsMonitor;</span><br><span class="line">    private readonly IConfiguration _configuration;</span><br><span class="line"></span><br><span class="line">    public WeatherForecastController(ILogger&lt;WeatherForecastController&gt; logger, </span><br><span class="line">        IOptions&lt;LearningOptions&gt; learningOptions, </span><br><span class="line">        IOptionsSnapshot&lt;LearningOptions&gt; learningOptionsSnapshot, </span><br><span class="line">        IOptionsMonitor&lt;LearningOptions&gt; learningOptionsMonitor,</span><br><span class="line">        IConfiguration configuration</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        _logger = logger;</span><br><span class="line">        _learningOptions = learningOptions;</span><br><span class="line">        _learningOptionsSnapshot = learningOptionsSnapshot;</span><br><span class="line">        _learningOptionsMonitor = learningOptionsMonitor;</span><br><span class="line">        _configuration = configuration;</span><br><span class="line">        _learningOptionsMonitor.OnChange((options, value) =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            _logger.LogInformation($&quot;OnChnage =&gt; &#123;JsonConvert.SerializeObject(options)&#125;&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [HttpGet(&quot;&#123;action&#125;&quot;)]</span><br><span class="line">    public ActionResult GetOptions()</span><br><span class="line">    &#123;</span><br><span class="line">        var builder = new StringBuilder();</span><br><span class="line">        builder.AppendLine(&quot;learningOptions:&quot;);</span><br><span class="line">        builder.AppendLine(JsonConvert.SerializeObject(_learningOptions.Value));</span><br><span class="line">        builder.AppendLine(&quot;learningOptionsSnapshot:&quot;);</span><br><span class="line">        builder.AppendLine(JsonConvert.SerializeObject(_learningOptionsSnapshot.Value));</span><br><span class="line">        builder.AppendLine(&quot;learningOptionsMonitor:&quot;);</span><br><span class="line">        builder.AppendLine(JsonConvert.SerializeObject(_learningOptionsMonitor.CurrentValue));</span><br><span class="line">        return Content(builder.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们修改一下配置文件，因为我们为<code>_learningOptionsMonitor</code>注册了回调函数，可以在控制台看到对应的日志：</p>
<p><img src="https://i.loli.net/2020/10/11/s1XFSKvOLZz6Imo.png" alt="监听配置文件变化"></p>
<p>此时，我们通过 Postman 调用接口，我们会得到下面的结果：</p>
<p><img src="https://i.loli.net/2020/10/11/j5ENWpSCGtQw73O.png" alt="learningOptions的值并未更新"></p>
<p>可以注意到，此时，learningOptions 中的值依然是更新前的值，这就是它们三者的区别，清楚了吗？</p>
<p>除了这些以外，选项模式(<strong>Options</strong>)中还有一个需要注意的地方，是所谓的命名选项(<strong>IConfigureNamedOptions</strong>)，主要用在多个 Section 绑定统一属性时。譬如现在的应用程序都流行深色主题，实际上深色主题和浅色主题具有相同的结构，比如前景色和背景色，两者唯一的区别是这些颜色配置不一样。考虑下面的配置信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Themes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Dark&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#fff&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;White&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#fff&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>此时，我们该如何定义这个主题选项呢？</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ThemeOptions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Foreground &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Background &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，我们通过命名的方式来注入两个不同的主题：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">services.Configure&lt;ThemeOptions&gt;(<span class="string">&quot;DarkTheme&quot;</span>, Configuration.GetSection(<span class="string">&quot;Themes:Dark&quot;</span>));</span><br><span class="line">services.Configure&lt;ThemeOptions&gt;(<span class="string">&quot;WhiteTheme&quot;</span>, Configuration.GetSection(<span class="string">&quot;Themes:White&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>在任何你希望使用它们的地方，注入<code>IOptionsSnapshot&lt;ThemeOptions&gt;</code>和<code>IOptionsMonitor&lt;ThemeOptions&gt;</code>即可，这两个类型都提供了一个<code>Get()</code>方法，传入前面定义好的主题就可以获取到对应的主题了。细心的朋友，应该会发现一件事情，这里三剑客只提到了后面两个，<code>IOptions&lt;ThemeOptions&gt;</code>直接被无视了。请记住下面这段话：<strong>命名的选项只能通过 IOptionsSnapshot<T>和 IOptionsMonitor<T>来访问。所有选项都是命名实例。 IConfigureOptions<TOptions> 实例将被视为面向 Options.DefaultName 实例，即 string.Empty。 IConfigureNamedOptions<TOptions> 还可实现 IConfigureOptions<TOptions>。 IOptionsFactory<TOptions> 的默认实现具有适当地使用每个实例的逻辑。 null 命名选项用于面向所有命名实例，而不是某一特定命名实例。 ConfigureAll 和 PostConfigureAll 使用此约定。</strong></p>
<h1 id="IChnageToken"><a href="#IChnageToken" class="headerlink" title="IChnageToken"></a>IChnageToken</h1><p>现在，让我们回到本文的主题，博主你不是要说配置热更新这个话题吗？截至到目前为止，我们修改配置文件的时候，ASP.NET Core 应用明明就会更新配置啊，所以，博主你到底想说什么？其实，博主想说的是，的确我们的目的已经达到了，但我们不能永远停留在“知其然”的水平，如果不试图去了解内在的机制，当我们去尝试实现一个自定义配置源的时候，就会遇到一些你没有办法想明白的事情。所以，接下来要讲的<code>IChnageToken</code>这个接口可以说是非常重要。</p>
<p>首先，我们把目光聚焦到<code>CreateDefaultBuilder</code>这个方法，它通常在入口文件<code>Program.cs</code>中被调用，主要作用是构造一个 IWebHostBuilder 实例并返回，下面是这个方法的内部实现，博主这里对其进行了精简：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IWebHostBuilder <span class="title">CreateDefaultBuilder</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//以下简化后的代码片段</span></span><br><span class="line">    builder.ConfigureAppConfiguration((hostingContext, config) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> env = hostingContext.HostingEnvironment;</span><br><span class="line"></span><br><span class="line">        config.AddJsonFile(<span class="string">&quot;appsettings.json&quot;</span>, optional: <span class="literal">true</span>, reloadOnChange: <span class="literal">true</span>)</span><br><span class="line">            .AddJsonFile(<span class="string">$&quot;appsettings.<span class="subst">&#123;env.EnvironmentName&#125;</span>.json&quot;</span>, optional: <span class="literal">true</span>, reloadOnChange: <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (env.IsDevelopment())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> appAssembly = Assembly.Load(<span class="keyword">new</span> AssemblyName(env.ApplicationName));</span><br><span class="line">            <span class="keyword">if</span> (appAssembly != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                config.AddUserSecrets(appAssembly, optional: <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        config.AddEnvironmentVariables();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (args != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            config.AddCommandLine(args);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以注意到，通过<code>ConfigureAppConfiguration()</code>方法，框架主要做了下面的工作：</p>
<ul>
<li>从<code>appsettings.json</code>和<code>appsettings.$&#123;env.EnvironmentName&#125;.json</code>两个配置文件中加载配置</li>
<li>从<code>机密管理器</code>中加载配载</li>
<li>从环境变量中加载配置</li>
<li>从命令行参数中加载配置</li>
</ul>
<p>实际上，.NET Core 可以从配置文件、环境变量、Azure Key Vault、Azure 应用程序配置、命令行参数、已安装或已创建的自定义提供程序、目录文件、内存中的 .NET 对象等各种各样的来源中加载配置，这里的<code>appsettings.json</code>使用的是<code>JsonConfigurationProvider</code>类，位于<code>Microsoft.Extensions.Configuration.Json</code>这个命名空间，可以注意到，它继承自<code>FileConfigurationProvider</code>类，并重写了<code>Load()</code>方法，通过这些关系，我们最终可以找到这样一段代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FileConfigurationProvider</span>(<span class="params">FileConfigurationSource source</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (source == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(source));</span><br><span class="line">    &#125;</span><br><span class="line">            </span><br><span class="line">    Source = source;</span><br><span class="line">    <span class="keyword">if</span> (Source.ReloadOnChange &amp;&amp; Source.FileProvider != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _changeTokenRegistration = ChangeToken.OnChange(</span><br><span class="line">            () =&gt; Source.FileProvider.Watch(Source.Path),</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">                Thread.Sleep(Source.ReloadDelay);</span><br><span class="line">                Load(reload: <span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以，真相就是,所有基于文件的配置提供者，都依赖于<code>FileConfigurationSource</code>，而通过<code>FileConfigurationSource</code>暴露出来的<code>FileProvider</code>都具备监视文件变化的能力，更本质上的代码其实应该是下面这样：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ChangeToken + IFileProvider 实现对文件的监听</span></span><br><span class="line"><span class="keyword">var</span> filePath = <span class="string">@&quot;C:\Users\admin\Downloads\孔乙己.txt&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> directory = System.IO.Path.GetDirectoryName(filePath);</span><br><span class="line"><span class="keyword">var</span> fileProvider = <span class="keyword">new</span> PhysicalFileProvider(directory);</span><br><span class="line">ChangeToken.OnChange(</span><br><span class="line">    () =&gt; fileProvider.Watch(<span class="string">&quot;孔乙己.txt&quot;</span>),</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        _logger.LogInformation(<span class="string">&quot;孔乙己，你一定又偷人家书了吧！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>所以，真相只有一个，真正帮助我们实现配置热更新的，其实是<code>IChangeToken</code>这个接口，我们只需要把这样一个实例传入到<code>ChangeToken.OnChange()</code>方法中，就可以在特定的时机触发这个回调函数，而显然，对于大多数的<code>IConfigurationProvider</code>接口而言，这个回调函数其实就是<code>Load()</code>方法，关于微软提供的<code>ChangeToken</code>静态类的实现，大家如果有兴趣去了解的话，可以参考这里：<a target="_blank" rel="noopener" href="https://github.com/dotnet/extensions/blob/release/3.1/src/Primitives/src/ChangeToken.cs">https://github.com/dotnet/extensions/blob/release/3.1/src/Primitives/src/ChangeToken.cs</a>。话说回来，我们说<code>IOptionsSnapshot&lt;T&gt;</code>和<code>IOptionsMonitor&lt;T&gt;</code>是响应式的，当配置发生改变的时候，它们对应的值会跟着改变，从某种意义上来说，是因为<code>IChangeToken</code>提供了这样一个可以监听变化的的能力，试想一下，我们只需要给每一个<code>IConfigurationProvider</code>对应的<code>IChangeToken</code>注册相同的回调函数，那么，当某一个<code>IConfigurationProvider</code>需要重新加载的时候，我们就可以针对这个<code>IConfigurationProvider</code>里对应的键值对进行处理。事实上，微软官方在实现<code>IConfigurationRoot</code>的时候，的确就是这样做的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConfigurationRoot</span> : <span class="title">IConfigurationRoot</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> ConfigurationReloadToken _changeToken = <span class="keyword">new</span> ConfigurationReloadToken();</span><br><span class="line">    <span class="keyword">private</span> IList&lt;IConfigurationProvider&gt; _providers;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConfigurationRoot</span>(<span class="params">IList&lt;IConfigurationProvider&gt; providers</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _providers = providers;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> provider <span class="keyword">in</span> providers)</span><br><span class="line">        &#123;</span><br><span class="line">            provider.Load();</span><br><span class="line">            ChangeToken.OnChange(() =&gt; provider.GetReloadToken(), <span class="keyword">this</span>.RaiseChanged);</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> IChangeToken <span class="title">GetReloadToken</span>()</span> =&gt; <span class="keyword">return</span> _changeToken;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RaiseChanged</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">          Interlocked.Exchange&lt;ConfigurationReloadToken&gt;(<span class="keyword">ref</span> _changeToken, <span class="keyword">new</span> ConfigurationReloadToken()).OnReload();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reload</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> provider <span class="keyword">in</span> _providers)</span><br><span class="line">        &#123;</span><br><span class="line">            provider.Load();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.RaiseChanged();</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="自定义配置源"><a href="#自定义配置源" class="headerlink" title="自定义配置源"></a>自定义配置源</h1><p>好了，现在你可以说你了解 .NET Core 的配置热更新这个话题了，因为截至到此时此刻，我们不仅仅达到了一开始的目的，而且深刻地理解了它背后蕴含的原理。这样，我们就可以向着下一个目标：自定义配置源努力了。前面提到过，.NET Core 里面支持各种各样的配置源，实际中可能会遇到更多的配置源，比如不同的数据库、YAML 格式以及 Apollo、Consul、Nacos 这些配置中心等等，所以，了解如何去写一个自定义的配置源还是非常有必要的。我们在一开始的时候提到了 Redis 的发布-订阅，那么，下面我们就来基于发布-订阅实现一个简单的配置中心，当我们需要修改配置时，只需要通过可视化的 Redis 工具进行修改，然后再给指定的客户端发一条消息即可。</p>
<p>实现自定义配置源，需要实现<code>IConfigurationSource</code>和<code>IConfigurationProvider</code>两个接口，前者实现起来非常简单，因为只要返回我们定义的<code>RedisConfigurationProvider</code>实例即可：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RedisConfigurationSource</span> : <span class="title">IConfigurationSource</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> RedisConfigurationOptions _options;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisConfigurationSource</span>(<span class="params">RedisConfigurationOptions options</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _options = options;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IConfigurationProvider <span class="title">Build</span>(<span class="params">IConfigurationBuilder builder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisConfigurationProvider(_options);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来是<code>RedisConfigurationProvider</code>类的实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RedisConfigurationProvider</span> : <span class="title">ConfigurationProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> CSRedisClient _redisClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> RedisConfigurationOptions _options;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisConfigurationProvider</span>(<span class="params">RedisConfigurationOptions options </span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _options = options;</span><br><span class="line">        _redisClient = <span class="keyword">new</span> CSRedisClient(_options.ConnectionString);</span><br><span class="line">        <span class="keyword">if</span> (options.AutoReload)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//利用Redis的发布-订阅重新加载配置</span></span><br><span class="line">            _redisClient.Subscribe((_options.HashCacheChannel, msg =&gt; Load()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Load</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Data = _redisClient.HGetAll&lt;<span class="built_in">string</span>&gt;(_options.HashCacheKey) ?? <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了用起来更得心应手，扩展方法是少不了的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">RedisConfigurationExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IConfigurationBuilder <span class="title">AddRedisConfiguration</span>(<span class="params"><span class="keyword">this</span> IConfigurationBuilder builder, RedisConfigurationOptions options</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> builder.Add(<span class="keyword">new</span> RedisConfigurationSource(options));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，我们改一下入口类<code>Program.cs</code>，因为在这个阶段依赖注入是无法使用的，所以，看起来有一点难受，从命名就可以看出来，内部使用了<code>Hash</code>这种结构，理论上每个客户端应该使用不同的 Key 来进行缓存，应该使用不同的 Channel 来接收配置更新的通知：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IHostBuilder <span class="title">CreateHostBuilder</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> =&gt;</span><br><span class="line">    Host.CreateDefaultBuilder(args)</span><br><span class="line">        .ConfigureAppConfiguration(configurationBuilder =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            configurationBuilder.AddRedisConfiguration(<span class="keyword">new</span> Models.RedisConfigurationOptions()</span><br><span class="line">            &#123;</span><br><span class="line">                AutoReload = <span class="literal">true</span>,</span><br><span class="line">                ConnectionString = <span class="string">&quot;127.0.0.1:6379&quot;</span>,</span><br><span class="line">                HashCacheKey = <span class="string">&quot;aspnet:config&quot;</span>,</span><br><span class="line">                HashCacheChannel = <span class="string">&quot;aspnet:config:change&quot;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .ConfigureWebHostDefaults(webBuilder =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            webBuilder.UseStartup&lt;Startup&gt;();</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>假设现在 Redis 里存储着下图所示的信息：</p>
<p><img src="https://i.loli.net/2020/10/11/MwaYZTmsIRkFWKt.png" alt="Redis中的存储结构"></p>
<p>相应地，我们可以在<code>Startup</code>中进行绑定：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.Configure&lt;AppInfoOptions&gt;(Configuration.GetSection(<span class="string">&quot;App&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>调一下接口看看？完全一致！Yes！</p>
<p><img src="https://i.loli.net/2020/10/11/lHxtYwjLp5qFank.png" alt="Redis与客户端的配置一致"></p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>回想起这个面试中“邂逅”的问题，针对对这块内容，其实当时并没有和面试官进行太深的交流，提到了分布式配置、配置中心以及像缓存的雪崩、击穿等等常见的问题，我隐约记得配置文件<code>appsettings.json</code>配置的部分有热更新的配置项，但我并没有对选项模式(<strong>Options</strong>)里的三剑客做过深入的挖掘，所以，这篇博客，一方面是系统地了解了一下选项模式(<strong>Options</strong>)的使用，而另一方面是由配置热更新这个话题引申出来的一系列细节，在没有理解<code>IChangeToken</code>的时候，实现一个自定义的配置源是有一点困难的，在这篇博客的最后，我们基于 Redis 的发布-订阅实现了一个简单的配置中心，不得不说，Redis 里用<code>:</code>来分割 Key 的方式，实在是太棒了，因为它可以完美地和 .NET Core 里的配置系统整合起来，这一点只能用赏心悦目来形容，好了，国庆节以后的第一篇博客就是这样了，谢谢大家！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/10/09/2020-10-09-value-book-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/09/2020-10-09-value-book-summary/" itemprop="url">高瓴张磊的投资思考 - 读《价值》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-09T12:16:02+08:00">
                2020-10-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="一、序言"><a href="#一、序言" class="headerlink" title="一、序言"></a>一、序言</h2><p>国庆期间读完了高瓴资本的创始人张磊的新作<a target="_blank" rel="noopener" href="https://book.douban.com/subject/35188914/">《价值》</a>。高瓴资本也是我所在的猿辅导在线教育的投资方，不久前猿辅导融资10亿美元的投资就是高瓴资本领投的。</p>
<p>《价值》全书分三个部分：<br> • 第一个部分是张磊自己的成长史，介绍他如何一步步走向投资生涯。<br> • 第二个部分是张磊总结的投资哲学和修养。<br> • 第三个部分是投资执行层面上的原则与案例。</p>
<p>以下是我的一些读后感。</p>
<h2 id="二、以德修身"><a href="#二、以德修身" class="headerlink" title="二、以德修身"></a>二、以德修身</h2><p>全书有很多地方讲到了品德。我印象深刻的几个案例有几个：</p>
<p>1、“这些钱一定要还”。张磊回国的首次创业“中华创业网”失败了，虽然投资人没有要求，但是张磊坚持要还投资人的投资款项。这种从法律上本可以不还的投资，现在越来越成为一种创始人对自己更高要求的行为。</p>
<p>罗永浩欠了4个亿，我想那应该是锤子公司欠的，但是罗永浩自己卖艺还债。我身边也有不少这样的朋友，创业失败了，但是总想着以后把投资人亏的钱补上。</p>
<p>2、史文森掌管着耶鲁捐赠基金，张磊说他最初能够通过面试，就是因为他在面试的时候展现出来的诚实。史文森一直觉得：“投资的目标是盈利还是实现某种社会理想，其间的平衡必须把握”。</p>
<p>3、张磊在介绍自己的投资哲学的时候，第一点就是坚持高度道德自律，“守正用奇”。</p>
<h2 id="三、重仓腾讯的逻辑"><a href="#三、重仓腾讯的逻辑" class="headerlink" title="三、重仓腾讯的逻辑"></a>三、重仓腾讯的逻辑</h2><p>腾讯早期发展得很不顺利，小马哥甚至尝试卖掉它。在《腾讯传》里面我们能够看到，很多机构虽然投资了，但是也没能坚持下来，比如李泽楷的盈科以及IDG就在腾讯很早期退出了。真正大手笔买入的只有南非 MIH。</p>
<p>高瓴资本也买入了腾讯，不过是在腾讯上市一年之后。但即便这样，也是需要很大勇气的。因为当时腾讯的收入主要来自 QQ 空间，也不算特别有想象力。</p>
<p>如果从收入，利润，市盈率这些基本面指标，很难做出重仓的决定。但高瓴买入腾讯核心看重的是社会价值。当张磊发现社会各行各业都用QQ号的时候，他觉得这是巨大的价值。“只要是为社会疯狂创造价值的企业，它的收入、利润早晚会兑现，社会最终会给予它长远的奖励”。</p>
<h2 id="四、如何做研究"><a href="#四、如何做研究" class="headerlink" title="四、如何做研究"></a>四、如何做研究</h2><p>关于如何研究，张磊给出了下面这张图：</p>
<img src="/images/value-book-research.jpg" class="">

<p>这里面我欠缺的是后面两个，我一方面对于一个行业的关键时点和关键变化关注不多。一方面独立性还不太够，经常还是消化和吸收别人的观点。</p>
<h2 id="五、张磊的投资哲学"><a href="#五、张磊的投资哲学" class="headerlink" title="五、张磊的投资哲学"></a>五、张磊的投资哲学</h2><p>张磊的投资哲学有3点：<br> • 守正用奇<br> • 弱水三千，但取一瓢<br> • 桃李不言，下自成蹊</p>
<img src="/images/value-book-invest-tao.jpg" class="">

<p>我感受下来就是坚持基本的道德，保持耐心和专注，坚持长期累进的事情不在意一时得失。</p>
<h2 id="六、小结"><a href="#六、小结" class="headerlink" title="六、小结"></a>六、小结</h2><p>全书其实就是张磊对于价值的诠释，价值不是纸面上的数字。</p>
<p>对于投资人来说：价值是道德，是自律，是坚持。对于企业来说，价值是对行业的颠覆，是对用户的连接，对需求的重塑。只有这样才能看得更高，看得更远。</p>
<p>很棒的一本书，推荐给大家。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/d33db2d3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/d33db2d3.html" itemprop="url">九月总结</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-03T01:15:52+08:00">
                2020-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h1 id="九月总结"><a href="#九月总结" class="headerlink" title="九月总结"></a>九月总结</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天已经是十月三号了，本来 30 号那天就想着写总结，但是被其它事情耽误（下面说的 ttrss 的事），所以直到今天才有空好好写一下总结。</p>
<h2 id="公众号文章抄袭申诉"><a href="#公众号文章抄袭申诉" class="headerlink" title="公众号文章抄袭申诉"></a>公众号文章抄袭申诉</h2><p>有一天晚上我像往常一样刷 RSS，结果发现有一篇文章抄袭我一年前写的<a target="_blank" rel="noopener" href="https://4ark.me/post/b6c7c0a2.html">《在浏览器输入 URL 回车之后发生了什么（超详细版）》</a>，还在多个平台标注原创，于是我通过他文章末尾的微信号沟通（应该做私域流量的），结果此人态度恶劣，最后通过微信公众号平台，最后是官方把这篇侵权的文章删掉结束这件事情。<br>我还在 V2EX 发了个<a target="_blank" rel="noopener" href="https://v2ex.com/t/703344">帖子</a>，对于这件事我想说的几个点：</p>
<ol>
<li>我是在 <a target="_blank" rel="noopener" href="https://segmentfault.com/">segmentfault</a> 看到的这篇文章，结果这个平台上的举报选项没有侵权的选项。</li>
<li>由于我之前没有在微信公众号发过这片文章，所以在申诉起来很麻烦，而且用户体验贼差，就说最不能忍受的两点：<ol>
<li>需要上传身份证正反面，但居然只能上传一张图片（还得自己拼在一起上传</li>
<li>上传资料只能是图片，且备注只能写 150 个字</li>
</ol>
</li>
<li>微信公众号说七个工作日内<strong>下发</strong>申诉结果，结果还真的是等了足足七天</li>
<li>这种抄袭或洗稿的行为太多了，根本无法阻止，个人原创者也没有精力天天查被谁抄袭，至于其他外部因素， V2EX 上的那个帖子已经很多人发表自己的看法了，这就不重复引述了。</li>
<li>最后，我希望中文互联网环境的内容越来越好</li>
</ol>
<h2 id="新增一些-RSS-订阅源"><a href="#新增一些-RSS-订阅源" class="headerlink" title="新增一些 RSS 订阅源"></a>新增一些 RSS 订阅源</h2><p>由于越来越觉得现在的中文互联网产出的内容不太行，于是我用 <a target="_blank" rel="noopener" href="https://docs.rsshub.app/">RSSHub</a> 制作了几个 RSS 源，爬了一下一些比较知名的中文博客文章，每天 5 篇这样子，翻翻以前的内容，目前已经做了的博客：</p>
<ol>
<li>阮一峰</li>
<li>酷壳</li>
<li>梁文道</li>
<li>绿帽子大学</li>
<li>Tsung’s Blog</li>
<li>泰晓资讯</li>
</ol>
<p>除此之外，我还基于维基百科的人物列表做了一些源，增长一下见识：</p>
<ol>
<li>中华民国大陆时期人物</li>
<li>图灵奖获得者</li>
<li>影响人类历史进程的 100 名人排行榜</li>
<li>本世纪最重要的人物</li>
</ol>
<p>还有一些杂七杂八的，比如某本开源书籍每天一章、reddit 上每天热门帖子汇总等等。<br>每天利用上下班通勤时间（差不多两个小时呢），我可以：</p>
<ol>
<li>因为都是一些自己感兴趣的博客或内容，每天看几篇，时间长了慢慢就能看完，总比直接打开博客从头到尾一篇一篇地读要容易</li>
<li>通过阅读早起的博客文章（比如阮一峰的博客是从 03 年开始的），我可以了解到一些那个时期发生的事或者流行的东西，虽然有一些已经随着时间的流逝慢慢被大家遗忘，但互联网还记得</li>
</ol>
<p>最后还是要说，每天刷刷 RSS 权当消磨时间，如果要真正让自己提升、构建思维体系，还是得老老实实看书。</p>
<h2 id="ttrss-换成-freshrss"><a href="#ttrss-换成-freshrss" class="headerlink" title="ttrss 换成 freshrss"></a>ttrss 换成 freshrss</h2><p>有一天早上发现部署在服务器的 ttrss 里面订阅的同一台机器的 RSS 订阅源失效了，试了各种方案：不用 docker 部署、重启、重装还是没有解决，奇怪的是我根本没有修改任何配置、或升级哪些服务，就这样搞了几天，终于放弃了，换到 freshrss。<br>所幸的 freshrss 没有问题，只是用着没有 ttrss 舒服，不过先用着吧。</p>
<h2 id="服务器开启-v2ray-占用-cpu-和内存过大"><a href="#服务器开启-v2ray-占用-cpu-和内存过大" class="headerlink" title="服务器开启 v2ray 占用 cpu 和内存过大"></a>服务器开启 v2ray 占用 cpu 和内存过大</h2><p>上面说换到 freshrss 之后（经过重装服务器系统），隔了一天，发现服务器明显变慢了，最后排查出问题是出在 v2ray 上，看到 GitHub 有人提过这个<a target="_blank" rel="noopener" href="https://github.com/v2ray/v2ray-core/issues/1961">问题</a>，估计是 v2ray 新版本的 bug，最终通过编译安装旧版本(v4.26.0)，发现没有这个问题。</p>
<h2 id="读完的书"><a href="#读完的书" class="headerlink" title="读完的书"></a>读完的书</h2><p>这个月看完了两本书：</p>
<ol>
<li>清醒思考的艺术</li>
<li>ThoughtWorks：从敏捷开发到技术雷达</li>
</ol>
<p>第一本是 leader 推荐我看的，副标题是《你最好让别人去犯的 52 种思维错误》，顾名思义，里面讲了 52 条逻辑谬误，其中有一些我之前就从别的地方看到过，但这本书讲得通俗易懂，读下来还是比较顺畅的。<br>第二本是我们部门每人轮流读一章，读完的，讲敏捷开发，了解别人是如何进行敏捷开发的，结合我们部门团队日常工作，截长补短。</p>
<h2 id="准备读的书"><a href="#准备读的书" class="headerlink" title="准备读的书"></a>准备读的书</h2><ol>
<li>《退步集》—— 陈丹青</li>
<li>《说话的力量》—— 孙路弘</li>
</ol>
<h2 id="最近的一些看法"><a href="#最近的一些看法" class="headerlink" title="最近的一些看法"></a>最近的一些看法</h2><p>这两天发生了挺多事，其中最让人津津乐道的自然就是特朗普感染新冠这件事了，起初我得知这件事，感到非常震惊之余，也好奇国内会有什么反应，果不其然，第二天微博就炸了，让我感到最不可思议的是，居然有这么多人庆祝一个人感染病毒，这是一种什么样的心态？<br>这让我想起多年前，日本地震时，我们的反应，好像也是差不多的，也就是说，这么多年过去了，我们还是没有变。<br>对于这件事，有一种声音我是比较赞同的：如果你家着火了（不是故意的），自己是摆脱险境了，但烧到别人家去，你非但没有同情别人，但嘲笑别人无法自救，甚至幸灾乐祸，这到底是一种什么样的心态呢？<br>退一万步来讲，即便这火真不是自家引起的，作为一个自诩有大国担当的国家人民，这也不是一个正常的举动吧？<br>当然这种声音，少之又少，说出来还会被大家喷。<br>这种民族主义是好是坏，我不知道，但是我想说，如果一个社会，不管你做的这件事情本身是否可耻，只要你的初衷是爱国，就能得到理解；或者反过来，不管你之前做过什么令人骄傲的事，只要你表现出不爱国的举动（可能还是误解，因为现在大家批判别人爱不爱国的标准都太过于简单了），就全盘否认这个人的话，这个民族不是有病吗？</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/09/24/2020-09-24-how-to-interview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/24/2020-09-24-how-to-interview/" itemprop="url">面试的艺术 - 如何面试别人</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-24T20:41:55+08:00">
                2020-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>工作这十年来，我面试了很多不同岗位的人。刚开始是面技术，后面是面产品，再后面是测试、运营、教研、设计。最近还面试了很多硬件相关岗位的人，比如 ID 设计师、结构设计师、质量工程师等。</p>
<p>我肯定不可能同时是这些岗位的专家，大部分情况下，我都是外行。但是我又要面试这些岗位，尽可能招聘到优秀的候选人。团队如果组建得不好，工作执行上肯定会受影响。</p>
<p>面试某种程度上是一门艺术，非常不标准化，又非常不确定，每个候选人都是一个独特的个体，需要你调整自己的问题，尽可能准确地判断出候选人的水平，这几乎不可能 100% 做到。</p>
<p>我是如何面试各种岗位的呢？以下是我的一些小结。</p>
<h2 id="如何面试别人"><a href="#如何面试别人" class="headerlink" title="如何面试别人"></a>如何面试别人</h2><h3 id="从-JD-开始"><a href="#从-JD-开始" class="headerlink" title="从 JD 开始"></a>从 JD 开始</h3><p>当你招聘一个岗位，肯定是工作上具体的事情需要增加人手完成，所以梳理 JD（岗位描述）是招聘的第一步。</p>
<p>通常 HR、面试官、候选人也是通过 JD 来达成对于目标工作的一致性认知。</p>
<p>JD 主要包括两部分：</p>
<ul>
<li>岗位职责</li>
<li>任职要求</li>
</ul>
<p>岗位职责将这个人进来之后的工作细化，便于你理清楚到底为什么需要这个人，这个人进来之后可以改善哪部分的工作。</p>
<p>任职要求是对候选人核心素质的描述，便于提前过滤掉不合格的候选人，也便于你之后对核心素质进行考查。</p>
<h3 id="承认面试考查的不完美"><a href="#承认面试考查的不完美" class="headerlink" title="承认面试考查的不完美"></a>承认面试考查的不完美</h3><p>一个候选人，你只花不到一个小时聊，很难完整得判断出这个人的水平。所以，面试考查算是一个不完备的决策行为。你可能误判，错过一个优秀的候选人。你也可能失误，把一个不合格的候选人招进来。</p>
<p>面试的第一步，就是承认这种决策的不完美。面试就是：</p>
<p><strong>在非常有限的时间内从一堆候选人中挑出能够胜任的同学。</strong></p>
<p>而我们能做的就是尽可能提高面试的 <strong>正确率</strong> 和 <strong>召回率</strong>。</p>
<h3 id="进行有区分度的考查"><a href="#进行有区分度的考查" class="headerlink" title="进行有区分度的考查"></a>进行有区分度的考查</h3><p>面试过程中，你可以提很多问题，但是如果一个问题所有候选人都答对或者答错，那么这个问题就完全没有区分度了。你不可能全部通过或者拒绝所有候选人。</p>
<p>所以，我们需要精心设计问题，让优秀的候选人能够被挑出来，不合格的能够被淘汰掉。</p>
<p>在技术面试中，算法题目就是一类有区分度的问题。常常有人问：某某公司面算法，工作中用得到么？其实答案就是，如果不面算法，一般的工程开发问题都答上来了又有什么意义？面试又不是考查记忆力。</p>
<p>对于工程师来说，逻辑能力和智力都是很重要的底层能力，而算法题就可以做到很好地筛选出这方面优秀的人。</p>
<h3 id="用细节和数据来佐证"><a href="#用细节和数据来佐证" class="headerlink" title="用细节和数据来佐证"></a>用细节和数据来佐证</h3><p>候选人的简历可能非常光鲜，但是细问一下就会发现水分。所以面试的时候，我们需要就着细节问，一个事情他负责的，我们可以：</p>
<ul>
<li>问宏观。为什么做这个事情，意义是什么，目标是什么。</li>
<li>问时间。这个事情什么时候开始的，具体每个阶段做了什么。</li>
<li>问人员和流程。这个事情相关的同事有哪些，相互之间如何配合的。</li>
<li>问方案。这个事情具体的方案细节是什么样的。</li>
<li>问数据。这个事情最终的数据如何，如何评价这个数据。</li>
<li>问困难。这个事情最大的挑战是什么，如何克服的。</li>
<li>问收获。对这个事情有什么复盘，下一次做会有哪些不一样。</li>
</ul>
<p>除了问，我们还可以当场看。对于设计&#x2F;产品&#x2F;教研岗位，可以当场让他给你看线上的作品，讨论作品的细节。</p>
<p>有了细节，你就可以更真实地判断出来他的简历是否真实，事情做得到底好不好。</p>
<h3 id="关注核心基础素质"><a href="#关注核心基础素质" class="headerlink" title="关注核心基础素质"></a>关注核心基础素质</h3><p>虽然我们面试的岗位千差万别，但是有一些基础的素质，每一个岗位都需要。</p>
<p>比如说：表达沟通能力。有些候选人连自己的答案都说不清楚，如何能够做好工作？而有一些候选人，说起话来滔滔不绝，但是一句也没有回答到重点上，这种人也是表达沟通能力有问题的表现。这种是信息表达的“密度”很低，和这种人工作会特别耽误时间。</p>
<p>除了表达沟通能力之外，我看重的核心能力还包括：</p>
<ul>
<li>工作热情。</li>
<li>团队精神。</li>
<li>学习习惯。</li>
</ul>
<p>通过问一些案例和工作上的细节，我就可以对候选人的这些能力有一个感受。</p>
<h3 id="考查核心专业能力"><a href="#考查核心专业能力" class="headerlink" title="考查核心专业能力"></a>考查核心专业能力</h3><p>不同岗位的人专业能力不一样，如果条件允许，最好还是让候选人展示一下他的专业能力。如果面试当时时间不够，也可以是以作业的方式来考查。</p>
<ul>
<li>对于技术岗位，可以当场考查一些代码。</li>
<li>对于产品岗位，可以留一个产品分析的作业，或者当场对一些产品交互进行分析。</li>
<li>对于设计岗位，可以让他当场手绘一张图或者留一个设计作业。</li>
<li>对于测试岗位，可以当场分析一些用例。</li>
<li>对于硬件产品经理，可以做一个策划作业。</li>
</ul>
<h2 id="标准化和复盘"><a href="#标准化和复盘" class="headerlink" title="标准化和复盘"></a>标准化和复盘</h2><p>当你面试一个岗位的人久了，你就可以形成自己的面试「方法论」。这个方法论包括：</p>
<ul>
<li>一组你熟悉的面试题目，你可以灵活地使用。</li>
<li>对于这套题目的答案好坏程度的经验值，帮助你将候选人分级。</li>
</ul>
<p>这套方法论固化下来，可以共享给同事，大家用一个统一的标准来面试。</p>
<p>每隔一段时间，你也需要复盘一下。有时候因为环境的变化，一些题目不太适用或者已经太普遍了，无法产生区分度，这个时候需要进行调整。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>面试从梳理 JD 开始，在承认面试不可能完美的前提下：</p>
<ul>
<li>关注候选人的核心基础能力，通过问细节和数据来获得更详细的信息。</li>
<li>在专业考查上，通过现场和事后的作业，保证专业能力过关。</li>
<li>通过标准化和复盘，总结和迭代自己的面试方法。</li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/09/19/2020-09-19-study-of-HUA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/19/2020-09-19-study-of-HUA/" itemprop="url">关于高尿酸的一些研究</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-19T21:46:27+08:00">
                2020-09-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <img src="/images/586px-Uric_acid3D.png" class="">

<blockquote><p>题图：尿酸的分子结构。</p>
</blockquote>

<h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><p>我因为自己有 5 年的高尿酸（指标大于 550) 的情况，加上最近在服药控制，所以查了一些资料。</p>
<p>中国的高尿酸比例其实挺高的，<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/MckwgiBW7m_ca2XpbhP6GQ">相关资料</a>显示总体患病率为 13.3%，保守估计有 1.8 亿高尿酸患者，痛风患者达 1700 万。</p>
<p>如果你也和我有相似的身体情况，希望本文对你也有一些帮助。</p>
<h2 id="高尿酸是什么"><a href="#高尿酸是什么" class="headerlink" title="高尿酸是什么"></a>高尿酸是什么</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>高尿酸症状的医学说法叫：高尿酸血症（hyperuricemia，简称 HUA）。</p>
<p>高尿酸是指血液中尿酸的浓度超过了健康人的指标。血尿酸正常值：</p>
<ul>
<li>成人男性为 <code>149～416μmol/L</code> ；女性为 <code>89～357μmol/L</code>。</li>
<li>年龄大于 60 岁的男性为：<code>250～476μmol/L</code>； 女性为：<code>190～434μmol/L</code>。</li>
</ul>
<h3 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h3><p>尿酸在血液中的浓度如果过高，就不能完全溶解于血液中，于是就会出现析出结晶。这些结晶在关节处累积，就会诱发痛风。</p>
<p>通常高尿酸不会那么快导致痛风，也有很多人高尿酸但是一直没有痛风，但是两者的相关性极大。我自己高尿酸 5 年了还没有痛风，但我一个朋友也就 3 年左右就开始痛风了。</p>
<p><a target="_blank" rel="noopener" href="http://www.china-endo.org/x_uploadfiles/%E9%AB%98%E5%B0%BF%E9%85%B8%E8%A1%80%E7%97%87%E5%92%8C%E7%97%9B%E9%A3%8E%E6%B2%BB%E7%96%97%E7%9A%84%E4%B8%AD%E5%9B%BD%E4%B8%93%E5%AE%B6%E5%85%B1%E8%AF%86.pdf">《高尿酸血症和痛风治疗的中国专家共识》</a> 建议：如果低嘌呤饮食的情况下，高尿酸还在 540 以上，或高于420（男）&#x2F;360（女）持续半年以上，即需要进行降尿酸治疗（下图）。</p>
<img src="/images/hua-treatment-map.jpg" class="">

<p>我自己在这件事情上还是拖了很多年，其实是不对的。</p>
<h3 id="来源和排泄"><a href="#来源和排泄" class="headerlink" title="来源和排泄"></a>来源和排泄</h3><p>尿酸（uric acid）是嘌呤的代谢产物。整体上人体的尿酸来自两类：</p>
<ul>
<li>内源性。依赖于自身代谢产生，这部分占到体内尿酸总量的 80%。</li>
<li>外源性。从饮食中直接摄入的，这部分占到体内尿酸总量的 20%。</li>
</ul>
<p>尿酸产生之后，主要通过肾脏排泄（占比 70%），其余通过消化道排泄。</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>刚刚说到来源和排泄，所以产生高尿酸的原因主要是两种：</p>
<ul>
<li>来源来得太多了。主要包括自身代谢紊乱（内源性）或者饮食中摄入（外源性）太多。</li>
<li>排泄得太少。主要是肾脏排泄能力下降导致。</li>
</ul>
<p>当你体检时发现尿酸高的时候，医生或者朋友第一个建议你的事情就是：在饮食上进行控制，进行低嘌呤饮食。嘌呤主要来源于海鲜、内脏以及肉汤。</p>
<p>但是就像我们刚刚提到的，这部分只占到体内尿酸生成总量的 20%。所以如果是自身代谢紊乱或者肾脏排泄能力下降的话，即便是低嘌呤饮食也无法降低尿酸。</p>
<p>医生可以通过测量 24 小时尿尿酸来判断是否排泄减少：</p>
<ul>
<li>小于 600mg(3.6mmol) 定义为尿酸排泄减少型</li>
<li>超过 800mg(4.8mmol) 定为尿酸产生过多型</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.china-endo.org/x_uploadfiles/%E9%AB%98%E5%B0%BF%E9%85%B8%E8%A1%80%E7%97%87%E5%92%8C%E7%97%9B%E9%A3%8E%E6%B2%BB%E7%96%97%E7%9A%84%E4%B8%AD%E5%9B%BD%E4%B8%93%E5%AE%B6%E5%85%B1%E8%AF%86.pdf">研究表明</a>，有 90% 的原发性高尿酸都是排泄减少型。对于排泄减少型，即使你坚持低嘌呤饮食，影响也相当有限。</p>
<h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><p>精确地测量尿酸值，需要到医院抽晨血（抽血前不能进食）。我自己研究发现，可以购买尿酸测试仪在家自行测量，用于定期的监控。我买的是三诺的 EA-12 测试仪（下图），别的品牌也没试过。</p>
<img src="/images/sano.jpg" class="">

<p>我自己在去医院测试的同一天用测试仪也测试，发现这款家用测试仪误差大概在 50 以内，凑合能够接受吧。</p>
<h2 id="治疗"><a href="#治疗" class="headerlink" title="治疗"></a>治疗</h2><h3 id="低嘌呤饮食"><a href="#低嘌呤饮食" class="headerlink" title="低嘌呤饮食"></a>低嘌呤饮食</h3><p>饮食对于尿酸的影响占比是20%，当患者是代谢或者排泄问题导致高尿酸时，低嘌呤饮食虽然很多时候并不能解决问题，但是对控制尿酸还是有一些帮助的。</p>
<p>我个人总结的经验是，除了严禁的食物外，其它不用刻意地控制，因为如果真要严格控制，很多东西都吃不了了。严禁的食物是：</p>
<ul>
<li>动物内脏，比如鹅肝。</li>
<li>海鲜。</li>
<li>浓肉汤和肉汁。</li>
<li>酒。</li>
</ul>
<p>高尿酸鼓励吃的食物是：</p>
<ul>
<li>脱脂或低脂奶制品</li>
<li>鸡蛋</li>
<li>蔬菜</li>
<li>低生糖指数谷物</li>
<li>饮水大于 2000 ML</li>
</ul>
<p>可能有一些人还是忍不住想喝酒，现在研究只能证明啤酒和烈酒会引发痛风，而红酒与痛风的相关性<a target="_blank" rel="noopener" href="http://www.360doc.com/content/20/0523/17/31446682_914102994.shtml">证据还不足</a>，所以你如果实在忍不住，就喝红酒吧。</p>
<h3 id="别嘌醇（Allopurinol）"><a href="#别嘌醇（Allopurinol）" class="headerlink" title="别嘌醇（Allopurinol）"></a>别嘌醇（Allopurinol）</h3><img src="/images/Allopurinol.jpg" class="">

<p>别嘌醇是一个老药了，1966 年在美国被FDA批准上市，到现在已经经过了半个世纪的使用。根据相关<a target="_blank" rel="noopener" href="https://clincalc.com/DrugStats/Drugs/Allopurinol">统计</a>，别嘌醇在美国一年被开的处方次数为 1400 万次，在 2017 年排名第 54 位。</p>
<img src="/images/allopurinol.png" class="">

<p>别嘌醇的用量：</p>
<ul>
<li>初使剂量：50mg，一天1-2次。</li>
<li>一般剂量：200-300mg 一天。</li>
<li>最高剂量：600mg 一天。</li>
</ul>
<p>别嘌醇对部分人会有超敏反应，严重情况致死。所以服用初期要密切关注身体状况。后来人们研究发现，超敏反应与白细胞 <code>HLA-B5801</code> 基因相关，所以在国内，有条件的医院就会在患者服用别嘌醇前，给他开<code>HLA-B5801</code> 基因的检测（这个检测也是可以走医保的）。</p>
<p>下图是我的检测结果：</p>
<img src="/images/HLA5801.jpg" class="">

<p>刚刚我们提到这个药在美国使用得非常普遍，但是在中国使用得很少，这里面有一个重要原因，是白细胞 <code>HLA-B5801</code> 基因在不同种族人群间的差异：</p>
<ul>
<li>中国汉族的基因频率为 6%-8%</li>
<li>白人的基因频率为 2%</li>
</ul>
<p>所以即使在美国，如果是给亚裔人群开别嘌醇，都建议先检测 <code>HLA-B5801</code> 基因。</p>
<p>而中国不是每个医院都有这个基因检测设备，加上有后面两种提到的替代药品，所以如果你不是对那两种药过敏，否则医生默认都不会给你开这个药。</p>
<p>这个药虽然超敏反应严重，但是也有一个好处，就是特别便宜。一般剂量的情况下，每天的费用只需要花 0.5 - 1 元钱。因为降尿酸的药需要天天吃，所以全年算下来就不算贵。而后面我即将介绍到的非布司他就比较贵，每天的费用大概是别嘌醇价格的 10 倍。</p>
<h3 id="非布司他（Febuxostat）"><a href="#非布司他（Febuxostat）" class="headerlink" title="非布司他（Febuxostat）"></a>非布司他（Febuxostat）</h3><img src="/images/Febuxostat.jpg" class="">

<p>非布司他相比别嘌醇来说是一个新药，它 2008 年在欧洲上市，2009 年在美国上市，2013年国内上市。整个中国人的药物使用数据还不到 10 年（相比来说别嘌醇有半个世纪的使用历史）。</p>
<p>非布司他和别嘌醇都同属于抑制身体内部尿酸的合成，以此来达到降尿酸的目的。通常剂量是 40 - 80 mg 每天。</p>
<p>刚刚也提到非布司他比较贵，每天的费用大概是 10 元钱。</p>
<p>非布司他刚开始的时候没有发现什么副作用，后来美国 FDA 怀疑它会导致一些心血管疾病加重，但是相关的研究没有证实或证伪这件事情，所以 FDA 在 2017 年前公布了一个警告，建议有心血管疾病的患者慎重选择非布司他。</p>
<p>这个警告我在「用药助手App」上也查到了，如下图：</p>
<img src="/images/feb-warning.jpg" class="">

<p>我刚开始也因为这个警告有点担心，但是咨询了多位协和医院的医生，基本上大部分都还是推荐非布司他。所以这个药是我现在正服用的药物。</p>
<h3 id="苯溴马隆（Benzbromarone）"><a href="#苯溴马隆（Benzbromarone）" class="headerlink" title="苯溴马隆（Benzbromarone）"></a>苯溴马隆（Benzbromarone）</h3><img src="/images/Benzbromarone.jpg" class="">

<p>相对于上面两种药，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Benzbromarone">苯溴马隆</a>的历史就有点波折了。</p>
<p>苯溴马隆在 1970 年上市，但是在 2003 年，因为发现了严重的不良反应，所以发明它的公司 Sanofi-Synthélabo 将它从多个国家退市。</p>
<p>但是在很长一段时间，因为也没有找到它的替代药品，所以包括中国在内，别的一些药厂一直在向市场继续提供苯溴马隆。我查了一下，它的主要不良反应是肝功能异常，在欧美国家的不良反应率是 <code>1/17000</code>，国内还无此项数据公布。</p>
<p>苯溴马隆的降尿酸原理和前两者都不同，前两种药是尿酸抑制药物，而苯溴马隆是通过促进尿酸排泄来达成降尿酸。因为它将大量的尿酸通过尿液排出，所以为了避免尿液中的尿酸太高形成结石，服药期间需要进行大量的饮水，每天饮水量不少于 2000ML。</p>
<p>我当时为了测量饮水量还专门买了一个 1升 的巨型水杯，每天喝完两杯就算达标了。</p>
<p>因为尿酸大量进入到了尿液中，所以尿液的 PH 值会偏酸性，如果 PH 值过低，会影响尿酸的排泄，所以通常我们还需要服用碳酸氢钠片（其实就是小苏打）来碱化尿液。</p>
<p>但是碳酸氢钠片服用过多对胃还是有一点影响，我当时就感受胃比较胀气，毕竟碳酸氢钠和酸中和的时候会产生气体。和面的时候放小苏打能让面发胀也是这个原理。</p>
<p>我去年服用过一段时间苯溴马隆，后来主要是3个原因想换药：</p>
<ol>
<li>查到这个药在国外退市。</li>
<li>每天必须喝够 2 升水让人感觉很麻烦和紧张，有时候出差路途不方便喝不了那么多水，就会感觉不方便。</li>
<li>我对碳酸氢钠有点胀气反应，胃不舒服。</li>
</ol>
<p>苯溴马隆的价格介于别嘌醇和非布司他之间，每天服药的费用约为 2.5 元。</p>
<h2 id="信息对比汇总"><a href="#信息对比汇总" class="headerlink" title="信息对比汇总"></a>信息对比汇总</h2><table>
<thead>
<tr>
<th></th>
<th>别嘌醇（Allopurinol）</th>
<th>非布司他（Febuxostat）</th>
<th>苯溴马隆（Benzbromarone）</th>
</tr>
</thead>
<tbody><tr>
<td>上市时间</td>
<td>1966年在美国上市</td>
<td>2008年欧洲上市、<br>2009年美国上市、<br>2013年国内上市</td>
<td>1970年上市。<br>2003年从多个国家退市。</td>
</tr>
<tr>
<td>使用风险</td>
<td>超敏反应，严重情况致死。<br>超敏反应与白细胞HLA-B5801基因相关。</td>
<td>怀疑有心血管风险，但是没有被证实或证伪。</td>
<td>肝功能异常</td>
</tr>
<tr>
<td>风险数据统计</td>
<td>HLA-B5801基因：白人2%，亚裔8%</td>
<td>几十个怀疑案例</td>
<td>欧美国家的肝功能异常率为 1&#x2F;17000，国内无数据。</td>
</tr>
<tr>
<td>Wiki</td>
<td><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Allopurinol">https://en.wikipedia.org/wiki/Allopurinol</a></td>
<td><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Febuxostat">https://en.wikipedia.org/wiki/Febuxostat</a></td>
<td><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Benzbromarone">https://en.wikipedia.org/wiki/Benzbromarone</a></td>
</tr>
<tr>
<td>初使用量</td>
<td>一次50mg 1-2次&#x2F;d</td>
<td>20-40mg 1次&#x2F;d</td>
<td>50mg 1次&#x2F;d</td>
</tr>
<tr>
<td>每次递增</td>
<td>50-100mg</td>
<td>20mg</td>
<td>50mg</td>
</tr>
<tr>
<td>一般剂量</td>
<td>200-300mg 分2-3次服用</td>
<td>40mg</td>
<td>50mg</td>
</tr>
<tr>
<td>最高用量</td>
<td>600mg&#x2F;d</td>
<td>80mg</td>
<td>100mg</td>
</tr>
<tr>
<td>处方量统计</td>
<td><a target="_blank" rel="noopener" href="https://clincalc.com/DrugStats/Drugs/Allopurinol">1400w 一年</a></td>
<td><a target="_blank" rel="noopener" href="https://clincalc.com/DrugStats/Drugs/Febuxostat">90w 一年</a></td>
<td>退市</td>
</tr>
<tr>
<td>每天费用</td>
<td>100mg 约 0.5-1 元</td>
<td>40mg 约 10 元</td>
<td>50mg 约 2.5 元</td>
</tr>
</tbody></table>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>高尿酸血症是一个内分泌代谢紊乱的病，如果不治疗有可能引发痛风。</p>
<p>国内最常用的治疗药物是别嘌醇，非布司他和苯溴马隆。</p>
<p>我自己研究下来，推荐大家有经济条件的话选择非布司他。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.china-endo.org/x_uploadfiles/%E9%AB%98%E5%B0%BF%E9%85%B8%E8%A1%80%E7%97%87%E5%92%8C%E7%97%9B%E9%A3%8E%E6%B2%BB%E7%96%97%E7%9A%84%E4%B8%AD%E5%9B%BD%E4%B8%93%E5%AE%B6%E5%85%B1%E8%AF%86.pdf">《高尿酸血症和痛风治疗的中国专家共识》</a></li>
<li><a target="_blank" rel="noopener" href="http://www.360doc.com/content/20/0523/17/31446682_914102994.shtml">《痛风及高尿酸血症基层诊疗指南（2019年）》</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/MckwgiBW7m_ca2XpbhP6GQ">苯溴马隆，您不了解的 “新” 机制</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/s0NJUWbpIJ2hT1KHJRZ9JQ">24小时尿尿酸检查</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%B0%BF%E9%85%B8%E5%80%BC">尿酸值</a></li>
<li>Uric acid: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Uric_acid">https://en.wikipedia.org/wiki/Uric_acid</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/7b1778ee.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/7b1778ee.html" itemprop="url">升级 IOS 14 的一些坑</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-19T15:37:23+08:00">
                2020-09-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>IOS 14 正式版已经发布差不多一个星期了，也看到社区不少人开始讨论新特性，我当然也要跟上脚步，于是也开始把我的 iPhone 和 iPad 更新了，但这过程中却是踩了不少的坑，先记录下来，让后来者少花一些时间。</p>
<h2 id="先说结论"><a href="#先说结论" class="headerlink" title="先说结论"></a>先说结论</h2><p>我最终成功更新的过程是：</p>
<ol>
<li>在 Windows 下载最新版本的 iTunes</li>
<li>在 <a target="_blank" rel="noopener" href="https://www.iplaysoft.com/item/ios-ipsw-download">异次元</a> 下载 IOS 14 固件</li>
<li>打开 <code>Service.msc</code> ，将 <code>Remote Desktop Services</code> 设置为启用和自动</li>
<li>Windows 连接手机热点，不要连接宽带网络</li>
<li>在 iTunes 连接手机，按住 Shift 点击更新，选择固件，等待更新</li>
</ol>
<p>PS：先备份好手机数据，以防万一！</p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>收到推送的当天晚上睡觉前我就在手机和平板上都点了更新，然而等我早上起床打算愉快地体验新系统时，却发现没有更新，进入更新界面才发现下载了不到一半，显示「正在预估剩余时间」，第二天晚上再试了一下，结果还是一样。</p>
<p>既然在手机上更新不了，那就在电脑更新，于是连接到 Mac，点击更新，到最后一步出现「iPad “4Ark 的 iPad” 的软件下载时被损坏，断开后再次连接…」，换了 Windows 也是一样的问题。</p>
<p>于是我自己在网上找 IOS 14 的固件，最初我打算在官方，想着系统固件还是官方的比较安全，结果发现最新版本还是停留在 IOS 13.7，于是在一个相对比较靠谱的 <a target="_blank" rel="noopener" href="https://www.iplaysoft.com/item/ios-ipsw-download">异次元</a> 里把 IOS 和 iPadOs 固件下载回来。</p>
<p>因为我是在 Windows 下载的，所以也就在 Windows 最新版的 iTunes 上面更新，连接上手机，按住 Shift 点击更新，选择固件，结果出现「未能更新 iPhone，发生未知错误 53」，在 <a target="_blank" rel="noopener" href="https://discussionschinese.apple.com/thread/251504194">这里</a> 找到了解决方案，主要是电脑上的网络不要连接宽带，而是连接移动网络的热点。</p>
<p>结果在更新过程中，一直停留在「正在准备 iPhone 以进行软件更新」十几分钟，根据以往的折腾经验，准备工作超过十分钟基本就是有问题的了，于是果然在 <a target="_blank" rel="noopener" href="https://hcwang.pixnet.net/blog/post/40515550">这里</a> 找到了解决方案，主要就是：打开 <code>Service.msc</code> ，将 <code>Remote Desktop Services</code> 设置为启用和自动，重启 iTunes，重新连接手机，这时候终于可以更新了。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>前两天还看到社区里的人都是手机上直接升级的，一睡醒就好了，怎么到我这里就一大堆问题 😩</p>
<p>但不管怎么说，这些问题我肯定不是第一个，更不可能是最后一个，本文就是为了让大家不要再浪费时间。</p>
<p>毕竟，周末美好时光，不能白白浪费嘛。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/73/">73</a><a class="extend next" rel="next" href="/page/21/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1451</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">914</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
