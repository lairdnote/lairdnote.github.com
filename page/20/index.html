<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="codeva-HZoIBm8yNp" />
<meta name="bytedance-verification-code" content="xa6iZeY+/XCOJvarHaDY" />








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/20/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/20/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/2020-11-04-my-opensource-nas-build/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/2020-11-04-my-opensource-nas-build/" itemprop="url">我的 NAS 选型与搭建过程（基于开源方案）</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-03T16:00:00+00:00">
                2020-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>在 2016 年我拥有了第一台 NAS —— 群晖的 DS215J，其实在之后的很长一段时间其实并没有派上多大用场，因为我的数据并不多，大都存储在云端，更多的是体验一下 NAS 的功能和工作流。</p>
<p>直到最近我才开始真正地将 NAS 利用上，于是准备升级一下，但考虑到群晖的性价比实在太低，再加上去年配置 Linux 软路由让我对基于「原生 Linux」的开源解决方案信心和兴趣大增，于是准备自己 DIY 一台 NAS，计划解决未来十年的存储需求。</p>
<p>我依然选择了我最熟悉的 Ubuntu 作为操作系统、Ansible 作为配置管理工具，因此这个 NAS 的大部分配置都可以在我的 <a target="_blank" rel="noopener" href="https://github.com/jysperm/playbooks/tree/master/roles">GitHub</a> 上找到。</p>
<blockquote>
<p>注意这个仓库中的 Ansible 配置仅供参考，不建议直接运行，因为我在编写这些配置时并未充分考虑兼容性和可移植性。</p>
</blockquote>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><p>对于一台 NAS 来说最重要的当然是文件系统，不需要太多调研就可以找到 <a target="_blank" rel="noopener" href="https://openzfs.github.io/openzfs-docs/index.html">ZFS</a> —— 可能是目前在数据可靠性上下功夫最多的单机文件系统了，于是我的整个选型就围绕 ZFS 展开了。</p>
<p>ZFS 既是文件系统，同时又是阵列（RAID）管理器，这为它带来了一些其他文件系统难以提供的能力：</p>
<ul>
<li>ZFS 为每个块都存储了校验和，同时会定期扫描整个硬盘，从 RAID 中的其他硬盘修复意外损坏的数据（如宇宙射线导致的比特翻转）。</li>
<li>在 RAID 的基础上可以 <a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E19253-01/819-5461/gevpg/index.html">指定某些目录以更多的份数冗余存储</a>，对于重要的数据即使损坏的硬盘超过了 RAID 方案的限制，依然有可能找回。</li>
</ul>
<p>ZFS 还支持数据加密、压缩和去重，这三项功能以一种巧妙的顺序工作，并不会互相冲突，同时这些所有选项都可以设置在目录（dataset）级别、可以随时更改（只对新数据生效）。</p>
<p>ZFS 当然也支持快照，快照可以被导出为二进制流，被存储到任何地方。这个功能可以让你在不丢失任何元信息的情况下对 ZFS 的文件系统进行备份、传输和恢复。</p>
<h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><p>我并不擅长淘硬件，于是就选择了 HPE 的 MicroServer Gen10，一个四盘位的成品微型服务器，CPU 是 AMD X3421 ，8G ECC 内存，也是标准的 x86 通用硬件，应该不太容易遇到坑。</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2020/nas-gen-10.png"></p>
<p>我用转接卡在 PCI-E 插槽上装了一块 NVME SSD，用作系统盘和 ZFS 的读缓存（L2ARC，不过从后面的统计来看效果并不明显），数据盘则暂时用的是旧的硬盘，最终会升级到四块 4T 的硬盘。这里需要注意的是因为 ZFS 不支持更改 RAID 的结构，所以必须在一开始就配置足够的硬盘来占位，后续再升级容量，我甚至用 USB 接了一块移动硬盘来凑数。</p>
<h2 id="ZFS"><a href="#ZFS" class="headerlink" title="ZFS"></a>ZFS</h2><p>因为是四盘位，所以我采用了 raidz1（RAID5），冗余一块盘作为校验，如果最终所有的盘都升级到 4T，一共是 12T 的实际可用容量。</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@infinity:~# zpool status</span><br><span class="line">  pool: storage</span><br><span class="line"> state: ONLINE</span><br><span class="line">config:</span><br><span class="line">    NAME                                 STATE     READ WRITE CKSUM</span><br><span class="line">    storage                              ONLINE       0     0     0</span><br><span class="line">      raidz1-0                           ONLINE       0     0     0</span><br><span class="line">        sda                              ONLINE       0     0     0</span><br><span class="line">        sdb                              ONLINE       0     0     0</span><br><span class="line">        sdc                              ONLINE       0     0     0</span><br><span class="line">        sdd                              ONLINE       0     0     0</span><br><span class="line">    cache</span><br><span class="line">      nvme0n1p4                          ONLINE       0     0     0</span><br><span class="line"></span><br><span class="line">root@infinity:~# zpool list</span><br><span class="line">NAME      SIZE  ALLOC   FREE  CKPOINT   FRAG    CAP  DEDUP    HEALTH</span><br><span class="line">storage  7.27T  3.52T  3.75T        -    10%    48%  1.00x    ONLINE</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通常认为 RAID5 在出现硬盘故障的恢复过程中存在着较高的风险发生第二块盘故障、最终丢失数据的的情况；或者硬盘上的数据随着时间推移发生比特翻转导致数据损坏。但考虑到 ZFS 会定期做数据校验来保证数据的正确性，再综合考虑盘位数量和容量，我认为这个风险还是可以接受的，后面也会提到还有异地备份作为兜底措施。</p>
</blockquote>
<p>我开启了 ZFS 的加密功能，但这带来了一个问题：我不能把密钥以明文的方式存储在 NAS 的系统盘 —— 否则密钥和密文放在一起的话，这个加密就失去意义了。所以每次 NAS 重启后，都需要我亲自输入密码、挂载 ZFS 的 dataset，然后再启动其他依赖存储池的服务。</p>
<p>我还开启了 ZFS 的数据压缩，默认的 lz4 只会占用少量的 CPU 却可以在一些情况下提高 IO 性能 —— 因为需要读取的数据量变少了。因为去重对资源的需求较高，相当于需要为整个硬盘建立一个索引来找到重复的块，我并没有开启去重功能。</p>
<blockquote>
<p>一些评论认为 ZFS 对内存的需求高、必须使用 ECC 内存。这其实是一种误解：更多的内存可以提升 ZFS 的性能，ECC 则可以避免系统中所有应用遇到内存错误，但这些并不是必须的，即使没有更多的内存或 ECC，ZFS 依然有着不输其他文件系统的性能和数据完整性保证。</p>
</blockquote>
<h2 id="存储服务"><a href="#存储服务" class="headerlink" title="存储服务"></a>存储服务</h2><blockquote>
<p>小知识：SMB 是目前应用得最广泛的局域网文件共享协议，在主流的操作系统中都有内建的支持。CIFS 是微软（Windows）对 SMB 的一个实现，而我们会用到的 Samba 是另一个实现了 SMB 协议的自由软件。</p>
</blockquote>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2020/nas-samba.png"></p>
<p>作为 NAS 最核心的功能就是通过 SMB 协议向外提供存储服务，所有的成品 NAS 都有丰富的选项来配置 SMB 的功能，但我们就只能直接去编辑 Samba 的配置文件了，Samba 直接采用了 Linux 的用户和文件权限机制，配置起来也不算太麻烦：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># 可以在 path 中使用占位符来为每个用户提供单独的 Home 目录</span><br><span class="line"># 可以在 valid users 中使用用户组来控制可访问的用户</span><br><span class="line">[Home]</span><br><span class="line">path = /storage/private/homes/%U</span><br><span class="line">writeable = yes</span><br><span class="line">valid users = @staff</span><br><span class="line"></span><br><span class="line"># Samba 默认以登录用户创建文件，但 NextCloud 以 www-data 运行，可以用 force user 覆盖为特定的用户</span><br><span class="line">[NextCloud]</span><br><span class="line">path = /storage/nextcloud/data/%U/files</span><br><span class="line">writeable = yes</span><br><span class="line">valid users = @staff</span><br><span class="line">force user = www-data</span><br><span class="line"></span><br><span class="line"># 通过这些设置可以让 macOS 的 TimeMachine 也通过 SMB 进行备份</span><br><span class="line"># 详见 https://www.reddit.com/r/homelab/comments/83vkaz/howto_make_time_machine_backups_on_a_samba/</span><br><span class="line">[TimeMachine]</span><br><span class="line">path = /storage/backups/timemachines/%U</span><br><span class="line">writable = yes</span><br><span class="line">valid users = @staff</span><br><span class="line">durable handles = yes</span><br><span class="line">kernel oplocks = no</span><br><span class="line">kernel share modes = no</span><br><span class="line">posix locking = no</span><br><span class="line">vfs objects = catia fruit streams_xattr</span><br><span class="line">ea support = yes</span><br><span class="line">inherit acls = yes</span><br><span class="line">fruit:time machine = yes</span><br><span class="line"></span><br><span class="line"># 对于共享的目录可以用 force group 覆盖文件的所属组、用 create mask 覆盖文件的权限位</span><br><span class="line">[VideoWorks]</span><br><span class="line">path = /storage/shares/VideoWorks</span><br><span class="line">writeable = yes</span><br><span class="line">valid users = @staff</span><br><span class="line">force group = staff</span><br><span class="line">create mask = 0775</span><br><span class="line"></span><br><span class="line"># 还可以设置游客可读、指定用户组可写的公开目录</span><br><span class="line">[Resources]</span><br><span class="line">path = /storage/public/Resources</span><br><span class="line">guest ok = yes</span><br><span class="line">write list = @staff</span><br><span class="line">force group = +staff</span><br><span class="line">create mask = 0775</span><br></pre></td></tr></table></figure>

<p>从上面的配置中也可以看到这些共享目录分散在几个不同的路径，为了匹配不同的数据类型、方便在目录级别进行单独设置，我划分了几个 dataset:</p>
<ul>
<li><code>db</code> 存放应用的数据库文件，将 recordsize 设置为了 8k（默认 128k）。</li>
<li><code>nextcloud</code> NextCloud 的数据目录，也可被 SMB 访问。</li>
<li><code>private</code> 每个用户的个人文件。</li>
<li><code>shares</code> 家庭内部共享的文件（如拍摄的视频）。</li>
<li><code>public</code> 可以从互联网上下载到的文件，不参与异地备份。</li>
<li><code>backups</code> 备份（Time Machine 等），不参与异地备份。</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@infinity:~# zfs list</span><br><span class="line">NAME                USED  AVAIL     REFER  MOUNTPOINT</span><br><span class="line">storage            2.27T   286G      169K  /storage</span><br><span class="line">storage/backups     793G   286G      766G  /storage/backups</span><br><span class="line">storage/db          741M   286G      339M  /storage/db</span><br><span class="line">storage/nextcloud   207G   286G      207G  /storage/nextcloud</span><br><span class="line">storage/private    62.2G   286G     62.2G  /storage/private</span><br><span class="line">storage/public      648G   286G      613G  /storage/public</span><br><span class="line">storage/shares      615G   286G      609G  /storage/shares</span><br></pre></td></tr></table></figure>

<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>首先我安装了 <a target="_blank" rel="noopener" href="https://github.com/netdata/netdata">Netdata</a>，这是一个开箱即用的监控工具，在仅占用少量资源的情况下提供秒级精度的大量统计指标，非常适合用于监控单台服务器的性能瓶颈。</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2020/nas-netdata.jpg"></p>
<p>其余的应用都被我运行在了 Docker 中（使用 docker-compose 来管理），这样可以隔离应用的运行环境，提升宿主机的稳定性，安装、升级、卸载应用也会更方便。</p>
<p>其中最重要的一个应用是 <a target="_blank" rel="noopener" href="https://nextcloud.com/">NextCloud</a>，这是一个开源的同步盘，我主要看中它的 iOS 应用和 iOS 有不错的整合，可以正确地同步 Live Photo，也可以在 iOS 的文件应用中被调用。</p>
<p><img src="https://r2-lc-cn.jysperm.me/pictures/2020/nas-nextcloud.jpg"></p>
<p>NextCloud 服务端会直接读写文件系统中的文件，而不是将文件存储在数据库里，这意味着 NextCloud 的数据目录同时也可以通过 Samba 来访问，这一点非常方便（不过需要一个定时任务来刷新 NextCloud 数据库中的元信息）。</p>
<p>我还在 Docker 中运行了这些服务，它们都是开源的：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://miniflux.app/">Miniflux</a>，一个 RSS 服务端，通过 Fever API 支持绝大部分的 RSS 客户端。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/dani-garcia/bitwarden_rs">Bitwarden</a>（非官方实现），一个密码管理器，提供有各平台的客户端和浏览器插件。</li>
<li><a target="_blank" rel="noopener" href="https://transmissionbt.com/">Transmission</a>，一个 BitTorrent 客户端，提供基于 Web 的管理界面。</li>
</ul>
<h2 id="外部访问"><a href="#外部访问" class="headerlink" title="外部访问"></a>外部访问</h2><p>如果要真正地用 NAS 来替代网盘的话，还是需要保证不在家里的内网的时候也可以访问到文件的。</p>
<p>通常的做法是使用 DDNS（动态 DNS）将一个域名解析至家庭宽带的 IP，这要求家庭宽带有公网 IP，而且运营商允许在 80 或 443 端口提供 Web 服务。我不想依赖这一点，所以想到了用 <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frp</a> 来进行「反向代理」，如果你确实有公网 IP 的话，也可以使用 DDNS 的方案，这样会省去一个中转服务器，也可以有更好的速度。</p>
<p>为了让 NextCloud 能有一个固定的地址（如 <code>https://nextcloud.example.com</code>）我将域名在内外网分别进行了解析，在家时解析到内网地址，在外解析到中转服务器。无论是内外网，数据流都会经过 Let’s Encrypt 的 SSL 加密，这样就不需要中转服务器有较高的安全保证。</p>
<p>虽然不需要先拨一个 VPN 确实很方便，但将 NextCloud 开放在公网上 <a target="_blank" rel="noopener" href="https://www.cvedetails.com/vulnerability-list/vendor_id-15913/Nextcloud.html">并不安全</a>，在社区中已有用户 <a target="_blank" rel="noopener" href="https://github.com/nextcloud/ios/issues/847">要求 NextCloud 客户端支持双向 SSL 认证</a>，我也非常期待这个功能，可以在公网访问上提供更好的安全性。</p>
<p>我还在 NAS 上安装了 <a target="_blank" rel="noopener" href="https://www.wireguard.com/">WireGuard</a>，这是一个内建在 Linux 内核中的 VPN 模块，同样通过 frp 暴露在外网，除了 NextCloud 之外的服务，如 SMB、SSH 和 Nextdata 都可以通过 WireGuard 来访问。</p>
<p>如果你不执着于开源方案的话，也可以试试 <a target="_blank" rel="noopener" href="https://www.zerotier.com/">ZeroTier</a>，它提供了 NAT 穿透的能力，让你的设备和 NAS 之间可以不借助中转服务器直接传输，改善连接速度。</p>
<h2 id="备份和数据完整性"><a href="#备份和数据完整性" class="headerlink" title="备份和数据完整性"></a>备份和数据完整性</h2><p>在 raidz1 的基础上，我设置了定时任务让 ZFS 每天生成一个快照，还写了一个脚本来按照类似 Time Machine 的规则来清理备份：保留最近一周的每天快照、最近一个月的每周快照、最近一年的每月快照、以及每年的快照。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@infinity:~# zfs list storage/nextcloud -t snapshot</span><br><span class="line">NAME                           USED  AVAIL     REFER  MOUNTPOINT</span><br><span class="line">storage/nextcloud@2020-09-05  83.9M      -      182G  -</span><br><span class="line">storage/nextcloud@2020-09-15  35.2M      -      207G  -</span><br><span class="line">storage/nextcloud@2020-09-21  30.2M      -      207G  -</span><br><span class="line">storage/nextcloud@2020-09-23  29.7M      -      207G  -</span><br><span class="line">storage/nextcloud@2020-09-26  29.3M      -      207G  -</span><br><span class="line">storage/nextcloud@2020-09-27  28.2M      -      207G  -</span><br><span class="line">storage/nextcloud@2020-09-28  28.2M      -      207G  -</span><br><span class="line">storage/nextcloud@2020-09-29  29.1M      -      207G  -</span><br><span class="line">storage/nextcloud@2020-09-30  33.5M      -      207G  -</span><br></pre></td></tr></table></figure>

<p>快照主要是为了防止人工的误操作，除了单纯的、当场就能发现的手滑之外，有时你会误以为你不会用到这个文件而将它删除，直到很久之后才发现并非如此。</p>
<p>同时每周会有定时任务使用 <a target="_blank" rel="noopener" href="https://restic.net/">restic</a> 备份一个快照到 <a target="_blank" rel="noopener" href="https://www.backblaze.com/b2/cloud-storage.html">Backblaze B2</a> 作为异地备份，这是一个价格较低的对象存储，非常适合备份。restic 支持增量的快照备份，也支持加密。出于成本考虑，异地备份仅包括由我产生的数据，并不包括 public 和 backups 目录。</p>
<p>我曾考虑过直接在远端运行一个 ZFS 来进行备份，zfs send &#x2F; recv 支持以二进制流的形式传输一个快照 —— 不需要远端安装其他任何的工具，只需要用 shell 的管道操作符将 zfs send 的字节流重定向到 ssh 命令即可。这个方案非常具有技术美感，但考虑到块存储的价格是对象存储的十倍以上，最后还是放弃了这个方案。</p>
<h2 id="成本核算"><a href="#成本核算" class="headerlink" title="成本核算"></a>成本核算</h2><p>硬件上其实我预算并不紧张，留的余量也比较大，如果换一些性价比更高的硬件的话，价格还可以下降很多。</p>
<ul>
<li>主机（主板、CPU、内存、系统盘） 3500 元</li>
<li>硬盘（4 * 4T） 2200 元（其实目前只买了一块，其他三块是旧的）</li>
</ul>
<p>考虑到我之前的群辉用了五年，新的 NAS 设计使用寿命定在十年：</p>
<ul>
<li>硬件成本折合每年 570 元</li>
<li>电费（35W）每年 110 元</li>
<li>远程访问每年 100 元（国内年付促销服务器，如有公网 IP 使用 DDNS 则无需此项）</li>
<li>异地备份每年 415 元（按量付费，这里按 1T 需要异地备份的数据计算）</li>
</ul>
<p>总共 12T 的容量每年 1195 元，折合 1T 每月 8 元，如果去掉远程访问和异地备份的话则是 1T 每月 5 元。</p>
<h2 id="为什么要用自部署方案"><a href="#为什么要用自部署方案" class="headerlink" title="为什么要用自部署方案"></a>为什么要用自部署方案</h2><p>相比于使用云服务，第一个理由自然是对数据的「掌控感」，虽然没有什么确凿的理由说云服务就一定不安全，但有些人就是喜欢这种对个人数据的掌控感。</p>
<p>还有一个技术原因是部署在家中内网的 NAS 可以通过 SMB 简单地支持一些「在线编辑」，如直接加载 NAS 上的素材进行视频剪辑、甚至将整个工程文件都直接放在 NAS 上。使用云服务的话一方面是没有 SMB 协议的支持，即使支持延迟对于在线编辑来说也是无法接受的。</p>
<p>另外一个不能忽略的话题就是成本，在这里我们只考虑以容量为计价方案的网盘服务，iCloud、Google Drive、Dropbox 的价格方案都非常接近，在超过 200G（大概 $3）这一档之后就直接跳到了 2T（大概 $10），这时云服务按量付费的优势其实就没有了，是一个切换到自部署方案的一个不错的时间点，一次性投入之后只需 2 - 3 年即可回本。</p>
<p>当然最重要的一点是兴趣，在这个折腾的过程中你需要做很多决定、遇到很多困难，最后搭建出来一个几乎是独一无二的自部署方案。如果你能在这个过程中找到乐趣的话，那当然是非常值得的；反过来如果你没有兴趣，算上投入的时间成本，自部署方案的性价比将会非常低。</p>
<p>任何自部署的方案都需要长期的维护才能保持工作，对后端运维完全没有兴趣怎么办，不如了解一下 <a target="_blank" rel="noopener" href="https://www.leancloud.cn/">LeanCloud</a>，领先的 BaaS 提供商，为移动开发提供强有力的后端支持。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/edb9a744.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/edb9a744.html" itemprop="url">十月总结</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-03T13:49:33+00:00">
                2020-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="几篇新文章"><a href="#几篇新文章" class="headerlink" title="几篇新文章"></a>几篇新文章</h2><ul>
<li><a target="_blank" rel="noopener" href="https://4ark.me/posts/hsts-problem-solving-experience.html">记一次因 HSTS 导致跨域问题的经历</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/269036804">浏览器通知推送服务选型</a></li>
<li><a target="_blank" rel="noopener" href="https://4ark.me/posts/hui-guang-zhou-yi-nian-you-gan.html">回广州一年有感</a></li>
</ul>
<h2 id="最近在折腾什么"><a href="#最近在折腾什么" class="headerlink" title="最近在折腾什么"></a>最近在折腾什么</h2><h3 id="ish-shell"><a href="#ish-shell" class="headerlink" title="ish shell"></a>ish shell</h3><p>最近 <a target="_blank" rel="noopener" href="https://github.com/ish-app/ish">ish</a> 上架 app store，趁着暂时还没收费，赶紧在手机和 iPad 装上体验一波，玩了一下发现好像还真的只能当个玩具…</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20201103220016.jpg"></p>
<h2 id="最近在看什么书"><a href="#最近在看什么书" class="headerlink" title="最近在看什么书"></a>最近在看什么书</h2><h3 id="史记"><a href="#史记" class="headerlink" title="史记"></a>史记</h3><p>其实今年开始对历史感兴趣，之前也看过几本历史相关的书，例如《中国大历史》、《中国近代史》，还有《明朝那些事儿》（这个是听的），然而如果对中国历史感兴趣，那自然绕不过《史记》，这本巨著的伟大之处，想必无须我多说，最近决定拜读。</p>
<p>起初，我想看繁体版的原版，那感觉会更有味道，奈何学识有限，最后只能决定先看一遍白话文的版本，以后再来重新读原版。</p>
<h3 id="苏菲的世界"><a href="#苏菲的世界" class="headerlink" title="苏菲的世界"></a>苏菲的世界</h3><p>这本书有多经典，同样不需要我多说，它可以说是最好的一本哲学入门书，很多人在学生阶段已经读过。</p>
<p>其实我原本对哲学并不是很感兴趣，但是我的偶像黄子华，他是读哲学的，他的偶像李小龙也是同样读哲学的，那我自然也不得不对哲学产生兴趣。</p>
<h2 id="谷歌测试之道-重新定义团队"><a href="#谷歌测试之道-重新定义团队" class="headerlink" title="谷歌测试之道 &amp; 重新定义团队"></a>谷歌测试之道 &amp; 重新定义团队</h2><p>这两本书是和公司的小伙伴一起读的，每人轮流读一章，由于这些书都比较贴近我们的日常工作，看看谷歌的团队是如何做项目测试、怎么样工作的，也经常能够从中获得一些灵感。</p>
<h3 id="一些杂书"><a href="#一些杂书" class="headerlink" title="一些杂书"></a>一些杂书</h3><p>除此之外，我也在看以下的书：</p>
<ul>
<li>半小时漫画 xxx 系列</li>
<li>把时间当做朋友</li>
<li>我的奋斗（罗永浩）</li>
</ul>
<p>其实上面这些书我并不是很正式地看，我是通过它们的 epub 版本转换到 html，然后制作成了 rss 订阅源，每天推送一章，慢慢地就能读完了，当然这种阅读方式仅适用于那些不需要怎样做笔记，看过了就算的书。</p>
<h2 id="还是不够慎重"><a href="#还是不够慎重" class="headerlink" title="还是不够慎重"></a>还是不够慎重</h2><p>最近做了个不大不小的决定，事后才发现自己其实还有很多东西没有考虑清楚，当时只看到眼前的利益，却忽略了一些更重要的事情，以至于突然醒悟后的心理落差，让我又开始怀疑自己做的这个决定到底是对是错。</p>
<p>一方面，自己还是太过图样，阅历不够，还需继续修炼，希望能够吃一鳖长一智。</p>
<p>另一方面，下次再遇到这种需要抉择的情况，哪怕我心里已有答案，我也会先找几个信任的朋友商量，避免再次出现这种当局者迷旁观者清的情况。</p>
<h2 id="最后说几句"><a href="#最后说几句" class="headerlink" title="最后说几句"></a>最后说几句</h2><p>一年又准备到头了，一方面希望这种苦逼的日子早点过去，另一方面又感慨时间真得过得好快，转眼间，又快到 2021 年了，我曾经许下的无数诺言，还不知道何日能够兑现。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-11-3-post08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-11-3-post08/" itemprop="url">锁定微信防别人偷看，苹果电脑上的微信有何不同？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-03T00:07:38+00:00">
                2020-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>这是临时想到的一个题目，就想简单写一下苹果电脑的 Mac 版微信与 Windows 版本有何不同。    </p>
<h2 id="锁定微信"><a href="#锁定微信" class="headerlink" title="锁定微信"></a>锁定微信</h2><p>当你在电脑上登录微信后，移动端的微信首页顶部会显示「Windows&#x2F;Mac 微信已登录」。</p>
<p>如果你是在 Mac 上登录微信，点击顶部的登录状态，相比在 Windows 上登录，菜单中会多出「<strong>锁定</strong>」的选项。</p>
<p><img src="http://cdn.penghh.fun/mweb/IMG_6997.jpeg" alt="IMG_6997"><br>点击锁定，Mac 上的微信会呈现下图的状态，当你离开座位且不锁定屏幕时，就可以很好地保护你的个人隐私。</p>
<p>这个功能还有个小细节：锁定和解锁 Mac 微信会有两个不同的<strong>音效</strong>，微信在声音设计上还下足了功夫。</p>
<p><img src="http://cdn.penghh.fun/mweb/16043344708914.jpg" alt="-w866"></p>
<h2 id="服务号消息收纳到订阅号中"><a href="#服务号消息收纳到订阅号中" class="headerlink" title="服务号消息收纳到订阅号中"></a>服务号消息收纳到订阅号中</h2><p>公众号主要分为两类，一类是订阅号，一类是服务号，这两类的区别在于，服务号给你发送推文或模板消息时，你会像收到微信好友消息一样收到通知，它推送的内容属于一种<strong>强通知</strong>。</p>
<p>而订阅号则位于「订阅号消息」或「公众号」中，所有订阅号推送的内容都被收纳到这个「盒子」里，相比服务号，它推送内容对用户的打扰更少。</p>
<p><img src="http://cdn.penghh.fun/mweb/16043612333771.jpg" alt="-w866"><br>在 Mac 微信上，每当收到新的微信消息时，桌面右上角都会弹出消息提醒，这个通知方式继承了微信移动端的设计。</p>
<p><img src="http://cdn.penghh.fun/mweb/16043622506897.jpg" alt="-w411"><br>可能是为了减少服务号这类强通知对用户的打扰，Mac 微信将服务号也收纳到了订阅号中，如此一来，当服务号给你推送内容时，它推送的内容就会出现在「公众号」这个盒子里，不会出现一个新消息的红点提醒。</p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%BE%AE%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%8F%B7.png" alt="微信服务号"></p>
<h2 id="在微信中使用苹果自带的-Emoji"><a href="#在微信中使用苹果自带的-Emoji" class="headerlink" title="在微信中使用苹果自带的 Emoji"></a>在微信中使用苹果自带的 Emoji</h2><p>和 iPhone 一样，在 Mac 上同样可以使用苹果自带的 Emoji，快捷键为「Control + Command + 空格」。</p>
<p>你可以在任何可以输入内容的地方，使用快捷键调出 Emoji 面板，例如微信的聊天窗口、微信的搜索栏等等。</p>
<p><img src="http://cdn.penghh.fun/mweb/16043636759293.jpg" alt="-w382"></p>
<h2 id="管理微信聊天数据"><a href="#管理微信聊天数据" class="headerlink" title="管理微信聊天数据"></a>管理微信聊天数据</h2><p>在微信的设置中，Windows 和 Mac 微信都可以找到管理聊天数据的选项，区别在于：</p>
<p>Mac 上的管理界面更加<strong>人性化</strong>，继承了移动端的设计，它可以很清楚地让你看到过往聊天中产生的数据量，而不是像 Windows 客户端会打开存放聊天数据的源文件夹，让用户一脸懵逼、摸不着头脑。</p>
<p><img src="http://cdn.penghh.fun/mweb/16043641460853.jpg" alt="-w456"></p>
<h2 id="应用商店的微信-VS-官网下载的微信"><a href="#应用商店的微信-VS-官网下载的微信" class="headerlink" title="应用商店的微信 VS 官网下载的微信"></a>应用商店的微信 VS 官网下载的微信</h2><p>从 Mac 应用商店下载的微信，是一个阉割版的微信，它使用不了微信小程序，这是苹果而非微信的锅，微信为了上架应用商店不得不向苹果妥协。</p>
<p>如果你想在 Mac 上使用功能完整的微信，请前往微信官网下载。  </p>
<h2 id="状态栏的更多功能"><a href="#状态栏的更多功能" class="headerlink" title="状态栏的更多功能"></a>状态栏的更多功能</h2><p>Mac 上的每个软件，在屏幕左上角的状态栏都会有相应的菜单，微信也不例外，如下图的「文件」、「编辑」、「显示」和「窗口」。</p>
<p>以「窗口」菜单为例，里面就会有与 Mac 相关的操作或功能，例如：</p>
<ul>
<li>窗口操作「将窗口拼贴到屏幕左侧」</li>
<li>Mac 的随航功能，将微信窗口移动到 iPad 上</li>
</ul>
<p>但说实话，状态栏的微信菜单我并不常用，这里仅作提及，感兴趣的朋友可以去点开看看。</p>
<p><img src="http://cdn.penghh.fun/mweb/16043646540173.jpg" alt="-w491">    </p>
<p>以上，希望有帮助。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-11-02-manage-work-book-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-11-02-manage-work-book-summary/" itemprop="url">埃森哲的工作法 - 《掌控工作》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-02T02:14:36+00:00">
                2020-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>埃森哲作为一家咨询公司，对外输出了很多人才和工作法。这次我读到的，是前埃森哲的员工邵文瀚的作品《掌控工作》。他将一个问题的解决过程进行了层层梳理和拆解，帮助我们用一个固定的流程来思考复杂的问题，以下是我的一些笔记。</p>
<h2 id="掌控工作四步法"><a href="#掌控工作四步法" class="headerlink" title="掌控工作四步法"></a>掌控工作四步法</h2><p>作者首先抛出了咨询师的问题梳理流程：</p>
<ul>
<li>界定问题</li>
<li>拆解问题</li>
<li>执行解决</li>
<li>总结复盘</li>
</ul>
<h3 id="界定问题"><a href="#界定问题" class="headerlink" title="界定问题"></a>界定问题</h3><p>面对一个新的陌生领域，界定问题分成以下三步：</p>
<ul>
<li>熟悉和理解专业术语。作者推荐的方法包括：<ul>
<li>案头研究。即自己查阅搜索引擎、国家统计局资料、专门书籍、知网数据库、行为研究报告。</li>
<li>访谈类研究。包括专家访谈、用户访谈、实地走访。</li>
</ul>
</li>
</ul>
<p>在案头研究方面，作者推荐了很多权威的数据收集渠道，比如：</p>
<ul>
<li>国家统计局。有大部分的人口、产值、贸易数据。</li>
<li>海关总署网站。可以找到进出口情况。</li>
<li>教育部网站。可以查到招生人数，毕业人数。</li>
</ul>
<p>作者还介绍了一种 what-else 的研究方法。拿 iOS 开发举例，如果你不懂 iOS 开发，你可以这么来研究：</p>
<ul>
<li>(what)什么是 iOS 开发？然后你可能通过查找资料发现这是一种移动开发技术。</li>
<li>(else)还有哪些是移动开发。你可能找到 Android开发，Windows Mobile 开发等。</li>
<li>(what)Android 是什么？然后你可能查到这是 Google 出的移动开发技术。</li>
<li>(else)Google 家还出了哪些开发语言？然后你可能查到 Flutter。</li>
</ul>
<h3 id="拆解问题"><a href="#拆解问题" class="headerlink" title="拆解问题"></a>拆解问题</h3><p>在完成问题的界定之后，我们就需要着手拆解问题。</p>
<p>假如我们的问题是“iOS开发如何提高”，那么我们就可以从“输入”和“输出”两个角度来拆解它。</p>
<ul>
<li>输入方面：我们可以拆解成阅读博客，阅读图书，看相关的视频，听相关的分享，参加相关的会议，找同事请教等。</li>
<li>输出方面：我们可以拆解成写总结的文章，代码练习，分享等。</li>
</ul>
<p>我们还可以进一步拆解，比如代码练习又可以拆解成：工作上的代码优化、面试题目代码的练习、开源项目的参与等。</p>
<p>下图是一个示例：</p>
<img src="/images/manage-work-2.jpg" class="">


<p>拆解问题讲就 MECE 原则，这是《金字塔原理》那本书首次提到的，即不重不漏。</p>
<p>拆解问题作者介绍了自上而下，自下而上两种方法，同时建议我们在遇到一些不确定的问题，使用“假设驱动”的方法来寻找关键点。</p>
<p>拆解问题后我们需要注意的是采用 28原则 来将关键问题定位。因为这种拆解很容易让我们陷入大量的 Todo 中去，不知道做什么，哪个也做不好。所以我们应该聚焦关键问题，把别的问题排除掉。</p>
<p>又回到刚刚说的“iOS开发如何提高”这个问题上。其实借助工作上的问题，进行相关的代码优化，就是最高效的提升方法。因为这个方法是有实际的产出做检验，也有实际的回报做出激励，很多工作也有时间限制，让我们能够有紧张感来推进工作，大部分时候把这个做好就能提升很多很多。</p>
<h3 id="执行解决"><a href="#执行解决" class="headerlink" title="执行解决"></a>执行解决</h3><p>执行的起来，作者建议如下 4 步的规划：</p>
<ul>
<li>第一步：确定工作目标，估算工作量。</li>
<li>第二步：对工作进行优先级排序。</li>
<li>第三步：确定时间规划，把工作指派给各项目负责人。</li>
<li>第四步：考虑项目可能的风险点，并提出预案。</li>
</ul>
<p>规划好之后，就开始执行了。执行的时候肯定不是一帆风顺的。所以我们要定期进行进度的同步。定期同步可以是邮件或者会议的形式，主要关注关键目标和时间点的达成情况。</p>
<p>书中介绍了不少提高个人执行力的手段，比如我自己也常使用的番茄工作法。</p>
<h3 id="总结复盘"><a href="#总结复盘" class="headerlink" title="总结复盘"></a>总结复盘</h3><p>复盘是非常重要的环节，一个复盘的流程分为以下 4 步：</p>
<ul>
<li>第一步：回顾目标</li>
<li>第二步：评估结果</li>
<li>第三步：原因分析</li>
<li>第四步：优化改善</li>
</ul>
<p>对于一些新的领域，如果通过复盘形成一些总结或者方法论，从而推进成为团队执行的一些潜在标准，则是更好的事情。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>《掌控工作》是作者从咨询公司的 7 步工作法提炼总结出来的日常工作常见的工作原则。通过界定问题、拆解问题、执行解决、总结复盘四个大的步骤，将所有工作问题的解决框定在这个范围内。</p>
<p>本书非常适合职场新人来梳理自己的工作框架，推荐给大家。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E4%BD%BF%E7%94%A8dotTrace%E5%AF%B9.NET%E5%BA%94%E7%94%A8%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E4%BD%BF%E7%94%A8dotTrace%E5%AF%B9.NET%E5%BA%94%E7%94%A8%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" itemprop="url">使用 dotTrace 对 .NET 应用进行性能分析与优化</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-01T04:19:02+00:00">
                2020-11-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>前几天，有位朋友问我，你平时都是怎么去排查一个程序的性能问题的啊。不要误会，这位朋友不是我啦，因为我真的有这样一位叫做 Toby 的朋友。说到性能问题，可能大家立马会想到类似<strong>并发数</strong>、<strong>吞吐量</strong>、<strong>响应时间</strong>、<strong>QPS</strong>、<strong>TPS</strong>等等这些指标，这些指标的确可以反映出一个系统性能的好坏。可随着我们的系统结构变得越来越复杂，要找到这样一个性能的“损耗点”，同样会变得越来越困难。在不同的人的眼中，对于性能好坏的评判标准是不一样的，譬如在前端眼中，页面打开速度的快慢代表着性能的好坏；而在后端眼中，并发数、吞吐量和响应时间代表着性能的好坏；而在 DBA 眼中，一条 SQL 语句的执行效率代表着性能的好坏。更不用说，现实世界中的程序要在硬件、网络的世界里来回穿梭了，所以，从 80%的功能堆积到 100%，是件非常容易的事情；而从 80%的性能优化到 85%，则不是件非常轻松的事情。想清楚这一点非常简单，因为我们的系统从来都不是简单的<code>1 + 1 = 2</code>。此时，我们需要一个性能分析工具，而今天给大家分享的是 <code>JetBrains</code> 出品的 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a> 。</p>
<h1 id="快速开始-Quick-Start"><a href="#快速开始-Quick-Start" class="headerlink" title="快速开始(Quick Start)"></a>快速开始(Quick Start)</h1><p>安装软件的过程此处不表，这里建议大家同时安装 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a> 和  <a target="_blank" rel="noopener" href="https://www.jetbrains.com/dotmemory/">dotMemery</a>。因为这都是 <code>JetBrains</code> 全家桶中的软件，安装的时候选一下就可以了，可谓是举手之劳。安装好以后的界面是这样的，可以注意到，它可以对进程中的 .NET 应用、本机的 .NET 应用以及远程的 .NET 应用进行检测，因为这里写一个 .NET Core 应用来作为演示，所以，我们选择 <code>Profile Local App</code>：</p>
<p><img src="https://i.loli.net/2020/11/01/MJA1avuHhIOSnsZ.png" alt="dotTrace主界面"></p>
<p>在这里，我们准备了一个简单的控制台程序：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        CPUHack();</span><br><span class="line">        MemeryHack();</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MemeryHack</span>()</span> &#123;</span><br><span class="line">        Console.ReadLine();</span><br><span class="line">        <span class="keyword">var</span> bytes = GC.GetTotalAllocatedBytes();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;AllocatedBytes: <span class="subst">&#123; bytes &#125;</span> bytes&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> list = <span class="keyword">new</span> List&lt;<span class="built_in">byte</span>[]&gt;();</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">              list.Add(<span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">85000</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (OutOfMemoryException) &#123;</span><br><span class="line">            Console.WriteLine(<span class="keyword">nameof</span>(OutOfMemoryException));</span><br><span class="line">            Console.WriteLine(list.Count);</span><br><span class="line">            bytes = GC.GetTotalAllocatedBytes();</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;AllocatedBytes: <span class="subst">&#123; bytes &#125;</span> bytes&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.ReadLine();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CPUHack</span>()</span> &#123;</span><br><span class="line">        Parallel.For(<span class="number">0</span>, Environment.ProcessorCount,</span><br><span class="line">            <span class="keyword">new</span> ParallelOptions() &#123;</span><br><span class="line">                MaxDegreeOfParallelism = Environment.ProcessorCount</span><br><span class="line">            &#125;,</span><br><span class="line">            i =&gt; &#123;</span><br><span class="line">              </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，<code>CPUHack()</code>方法来自：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/weihanli/p/implement-full-cpu.html">打爆你的 CPU</a>; <code>MemeryHack()</code>方法来自：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/weihanli/p/implement-out-of-memory.html">通过代码实现 OutOfMemory</a>。顾名思义，我们将利用这两个方法来分别测试 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a> 和  <a target="_blank" rel="noopener" href="https://www.jetbrains.com/dotmemory/">dotMemery</a>。</p>
<p><a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a> 目前支持以下平台：.NET、.NET Core、WPF、UWP(<strong>Universal Windows Platform</strong>)、ASP.NET、Windows 服务、WCF、Mono 和 Unity。可以注意到它有四种监测方式，即 Sampling、Tracing、Line by Line 以及 Timeline。按照界面上的描述，Sampling 适用于大多数场景下调用时间的精确测量、Tracing 适用于算法复杂度分析场景下调用次数的精确测量、Line by Line 适用于更高级别的使用场景，Timeline 适用于含多线程在内的数据处理的精确测量。所以，我们这里选择好一个可执行文件，然后选择 Sampling，再点击 “Run”：</p>
<p><img src="https://i.loli.net/2020/11/01/FSvbD5wlE43CJxd.png" alt="对进行程序进行采样、生成快照"></p>
<p>此时，我们会看到对应程序的的工具栏，我们可以点击 “Get Snapshot and Wait” 进行采样，每次采样会生成一个快照，默认情况下会自动打开生成的快照。我们还可以点击 “Start” 重新进行采样，直至采集到满意的样本为止，而在完成采样后，则可以点击 “Kill” 结束采样。下面来看看生成的快照：</p>
<p><img src="https://i.loli.net/2020/11/01/NCO8flxrA7c69mB.png" alt="dotTrace性能快照"></p>
<p>通过这两图，我们可以非常清晰的看到，最耗时的正是我们这里的<code>CPUHack()</code>方法，并且这里一共有四个线程，这是因为博主的计算机使用的是一款 4 核的 i3 处理器，并且在<a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a>中可以直接看到相关的代码片段，当然，这一切的前提是你没有对应用程序做过混淆处理，这样，我们就完成了一个简单的性能分析。类似地，我们启动<a target="_blank" rel="noopener" href="https://www.jetbrains.com/dotmemory/">dotMemery</a>。此时，可以得到下面的结果：</p>
<p><img src="https://i.loli.net/2020/11/01/JMKZajbkWwGPT3v.png" alt="dotMemery内存分析"></p>
<p>这里，我们通过<code>&lt;YourApp&gt;.runtimeconfig.json</code>文件，设定了 GC 堆的最大值是 1M，而每次向列表中添加超过 85K 的 byte 数组时，当前对象会被分配到大对象堆上。通过这张图我们可以很清楚的看到，整个曲线中蓝色区域的 LOH 占了绝对的比例，换言之，几乎所有的内存都是分配到大对象堆(<strong>LOH</strong>)上的。此外，有些小对象从 0 代升到了 1 代，在这个例子中，由于可分配的内存不足，最终引发了<code>OutOfMemoryException</code>。而这和我们看到的结果是相符合的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;runtimeOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tfm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;netcoreapp3.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;framework&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Microsoft.NETCore.App&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.1.0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configProperties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">&quot;System.GC.HeapHardLimit&quot;</span><span class="punctuation">:</span> <span class="number">1048576</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="从-Dump-文件进行分析"><a href="#从-Dump-文件进行分析" class="headerlink" title="从 Dump 文件进行分析"></a>从 Dump 文件进行分析</h1><p>到此为止，关于 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a> 和  <a target="_blank" rel="noopener" href="https://www.jetbrains.com/dotmemory/">dotMemery</a> 的使用就基本上讲解完啦！可能这时候有些朋友会产生疑问，如果性能问题发生在生产环境怎么办啊。不错，这里我们调试的都是本地的程序，生产环境是没有机会让你这样去搞的。此时，我们可以借助内存转储文件(<strong>Dump</strong>)文件，它是进程的内存镜像，可以把程序的执行状态通过调试器保存在 Dump 文件中，试想一下，如果程序在前一秒崩溃了，而你在这一瞬间获得了当时程序的状态信息，相当于拿到了“故障”遗留在现场的“罪证”。在 Windows 系统中创建 Dump 文件是非常简单的，通过<code>任务管理器</code>-&gt;<code>创建转储文件</code>即可完成，我们继续使用上面提到的例子：</p>
<p><img src="https://i.loli.net/2020/11/01/fWZ4dGENeUcoOI7.jpg" alt="创建Dump文件"></p>
<p>其实，拿到 Dump 文件以后，分析它的工具非常多，比如常见的 WinDBG、DebugDiag 等等，这里我们可以直接使用 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/dotmemory/">dotMemery</a> ，因为它本身就支持 Dump 文件的导入，相比前面两种在使用上要更加友好一点。此时，导入这个 Dump 文件，我们就可以获得下面的结果：</p>
<p><img src="https://i.loli.net/2020/11/02/wa7ok2LcGuVh9v1.png" alt="大对象堆分布情况"></p>
<p><img src="https://i.loli.net/2020/11/02/upfPZQkhNgTi6nH.png" alt="一、二代GC分布情况"></p>
<p>这和我们前面分析出的结论是一致的，即，几乎所有的内存都是分配到大对象堆(<strong>LOH</strong>)上的。除此以外，针对.NET Core，官方提供了<br><code>dotnet-dump</code>和<code>dotnet-gcdump</code>两个命令行工具，可以通过下面的命令安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet tool install -g dotnet-dump</span><br><span class="line">dotnet tool install -g dotnet-gcdump</span><br></pre></td></tr></table></figure>
<p>这两个命令同样可以对内存进行分析，关于更多的.NET Core 的诊断教程，请参考：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/event-counter-perf">https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/event-counter-perf</a>，这些细节都是针对.NET Core 的，可能不具有普适性，感兴趣的朋友可以自行前去了解。和大多数<code>JetBrains</code>的应用一样，这些程序都有 Visual Studio 的扩展程序，可以直接集成到 Visual Studio 中，这个同样看个人喜好，不再详细讲解。</p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>结合一个简单的示例程序，本文简单地介绍了来自 <code>JetBrains</code> 的两款软件 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a> 和  <a target="_blank" rel="noopener" href="https://www.jetbrains.com/dotmemory/">dotMemery</a> 的基本使用，以及如何通过内存转储文件(Dump)对生产环境中的内存进行诊断。在以往的关于程序性能优化的经历中，我个人还使用过 <a target="_blank" rel="noopener" href="https://www.red-gate.com/products/dotnet-development/ants-performance-profiler/">ANTS-Performance-Profiler</a>  这个软件，但体验上感觉还是 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/profiler/">dotTrace</a> 和  <a target="_blank" rel="noopener" href="https://www.jetbrains.com/dotmemory/">dotMemery</a> 稍微好用一点，而对于更一般的代码角度的性能分析，我推荐一个轻量级的项目<a target="_blank" rel="noopener" href="https://miniprofiler.com/">MiniProfiler</a>，性能优化不能靠猜，可是从初中就开始学的“控制变量法”未尝不是一个不错的思路。刷 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/u/qinyuanpei/">LeetCode</a> 的这段时间，一个最大的感悟就是，程序的性能，真的是一点一点的优化出来的，就拿最简单的排序来说，你真的要在上面提交很多次，才能渐渐地明白为什么说有些排序算法是“不稳定”的。也许，现在硬件水平越来越好，我们不必像前辈们一样“锱铢必较”，可这一切其实很都公平，你写代码的时候有多浪费，你玩游戏的时候就有多心疼，这里要特别表扬育碧对叛变这一作的优化。好了，这就是这篇博客的内容啦，谢谢大家，晚安！</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.jetbrains.com/zh-cn/profiler/">https://www.jetbrains.com/zh-cn/profiler/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jetbrains.com/zh-cn/dotmemory">https://www.jetbrains.com/zh-cn/dotmemory</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/debug-linux-dumps">https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/debug-linux-dumps</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/debug-memory-leak">https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/debug-memory-leak</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/debug-highcpu?tabs=windows">https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/debug-highcpu?tabs=windows</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-31-post07/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-31-post07/" itemprop="url">如何对自己感到更满意一些？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-31T08:28:38+00:00">
                2020-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>多数人对自己的现状或多或少都有不满意的地方<br>不满意的原因不一而足</p>
<p>当你不满足于现状<br>你可能会试着去改变<br>尝试开始做一些不一样的事情</p>
<p>目前我觉得让自己对自己更满意一些的方法是：</p>
<ul>
<li>试着逼自己写点什么，不包括这一篇，这个月更新了 16 篇文章。写东西会让自己暂时充当一个生产者而非消费者的角色，会让自己觉得可能对这个世界产生了一点影响</li>
<li>尽可能每天能留出 7 分钟的运动时间，这个月我做了 26 次运动（包含周末的户外跑步）</li>
<li>在滴答清单中写简短的日记、摘抄语录、记下自己临时想到的东西。之前看过一句话，<strong>LIVE A LIFE YOU WILL REMEMBER</strong>（去过带给你回忆的生活）。如何让以后的自己不忘记某段回忆？一种比较好的方式是借助某种<strong>载体</strong>，它可以是文字，可以是音乐，可以是照片，可以是视频，可以是录音等等</li>
</ul>
<p>当然，自己对自己满意的这种状态，它不会布满在过去或当下的每分每秒，有时还是会受到外部的影响：</p>
<ul>
<li>你妈和你说某某人的儿子月薪两万</li>
<li>你妈怨你当初为啥不去读研</li>
<li>在朋友圈看到别人的好消息</li>
</ul>
<p>破坏原先那种状态的根源在于——和别人比较，通过与别人的比较来确定自己的位置，这本质上还是学生时代分数思维的一种延续。（说到比较，父母有时候跟我说到别人家的孩子，本意可能是想借别人的例子来激励我奋起直追，但现实是我身边或者网络上并不缺少优秀的例子）</p>
<p>人生在世，你说做到完全不和别人比，基本上是不可能，但我们可以选择比较的对象。  </p>
<p>不少有智慧的人也曾告诉我们，「不要和别人比，只和昨天的自己比」，当你把比较的参照物从别人转移到自己身上，你会摆脱原先的竞争思维，专注于自己的优势，聚焦在自己能改变的事情上，而不是深深地陷入对自己的怀疑或自我否定之中。  </p>
<p>人生是一场长跑，每个人都有每个人的节奏，日拱一卒，道阻且长，行则将至。</p>
<h2 id="本月碎碎念"><a href="#本月碎碎念" class="headerlink" title="本月碎碎念"></a>本月碎碎念</h2><p>当我想回顾自己这个月做过什么<br>我会打开滴答清单<br>看一看我在过去的一个月写下的东西<br>其中少了几天的记录<br>可能那几天就是没有想写点什么的欲望</p>
<h3 id="本月阅读的书（包含未读完的书）："><a href="#本月阅读的书（包含未读完的书）：" class="headerlink" title="本月阅读的书（包含未读完的书）："></a>本月阅读的书（包含未读完的书）：</h3><ul>
<li>《夜晚的潜水艇》</li>
<li>《你当像鸟飞往你的山》</li>
<li>《最好的告别》</li>
</ul>
<h3 id="本月的碎片摘录"><a href="#本月的碎片摘录" class="headerlink" title="本月的碎片摘录"></a>本月的碎片摘录</h3><ul>
<li>凡他人承受的，有很大可能性会落在自己身上，这是一个非常沉痛的人生体会。——读库张立宪（江湖人称老六）</li>
<li>我做过的事，并不是每件都让我问心无愧，但要是再来一次，我肯定还会那么做的。——电影《遗愿清单》</li>
<li>人们看电影是为了时间：为了已经流逝、消耗，或者尚未拥有的时间。——安德烈·塔可夫斯基（来自豆瓣日历 2021 扉页）</li>
<li>我并不是在为自由而战，而是在用自己的存在证明自由并未消失。——Telegram 创始人 Pavel Durov</li>
<li>世界上最鼓舞人心的，莫过于看到一个都市忙于建设。我们受苦受难，乃是为了拯救未来。——《约翰·克里斯朵夫》</li>
<li>旅行是最劳顿，最麻烦，叫人本相毕露的时候。经过长期苦旅行而彼此不讨厌的人，才可以结交作朋友……结婚以后的蜜月旅行是次序颠倒的，应该先同旅行一个月，一个月舟车仆仆以后，双方还没有彼此看破，彼此厌恶，还没有吵嘴翻脸，还要维持原来的婚约，这种夫妇保证不会离婚。——钱钟书《围城》  </li>
<li>完美的相处关系是什么？窝在爱人怀里孤独。——英国心理学家唐纳德·温尼科特</li>
<li>小时候，我等待思想成熟，等待经验积累，等待抉择坚定，等待成为一个成年人的样子。那个人，或者那个化身，曾经有所归属。我属于那座山，是那座山塑造了我。只是随着年龄的增长，我开始思考，<strong>我的起点是否就是我的终点</strong>——一个人初具的雏形是否就是他唯一真实的样貌。——《你当像鸟飞往你的山》</li>
</ul>
<h3 id="后面可能会写的话题"><a href="#后面可能会写的话题" class="headerlink" title="后面可能会写的话题"></a>后面可能会写的话题</h3><ul>
<li>不要把人物化（来自于知乎的一个问题「你们怎样看待把朋友视为工具的这种人？」）</li>
<li>每个人的 KPI（爸妈的 KPI、自己的 KPI）</li>
<li>人生的种种遗憾（这是看到一篇文章后想到的）</li>
</ul>
<p>以上，祝秋安。    </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-28-post06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-28-post06/" itemprop="url">盘点 Mac 上好用的七个软件</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-31T00:07:38+00:00">
                2020-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>距离上一次写 Mac 上的软件，刚好过去两个月，错过的朋友可以戳这里：  </p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/tTRy9mw8ybFdQl6CZjO-Bg">Mac新手装机软件清单</a></p>
<p>这一次，我又带来了七款新的软件，每款软件的简介如下，其中既有免费也有付费的软件，下面会分明注明每一款软件的价格，方便有需要的朋友进行决策。  </p>
<p><img src="http://cdn.penghh.fun/mweb/16041106783088.jpg" alt="-w854"></p>
<h2 id="小历"><a href="#小历" class="headerlink" title="小历"></a>小历</h2><p>小历，是一款日历增强工具，点击状态栏的软件图标，它会以日历的形式呈现整个月份，且会在日期下方标注节日，如今天是「万圣节」，弥补了 Mac 原生日历的不足。</p>
<p>价格：买断制，18 元，可在 Mac App Store 下载。<br>软件开发者：钟颖，他还开发了一个更知名的应用「Pin」。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041129297630.jpg" alt="-w330"></p>
<h2 id="Keka"><a href="#Keka" class="headerlink" title="Keka"></a>Keka</h2><p>Keka，是一个压缩软件，之所以在 Mac 上要安装压缩软件，有两个原因：  </p>
<ul>
<li>使用 Mac 自带压缩功能压缩得到的压缩包，在 Windows 上可能会出现乱码的问题</li>
<li>Mac 自带的「归档实用工具」不支持解压 rar 格式的压缩包</li>
</ul>
<p>价格：Keka 在 Mac App Store 下载需要付费，在官网下载则是免费的。<br>官网：<a target="_blank" rel="noopener" href="https://www.keka.io/en/">https://www.keka.io/en/</a></p>
<p>附上使用 Keka 压缩文件的方法：右击文件，选择「服务 &gt;&gt; 使用 Keka 压缩」</p>
<p><img src="http://cdn.penghh.fun/mweb/16041133945379.jpg" alt="-w860"></p>
<h2 id="Day-One"><a href="#Day-One" class="headerlink" title="Day One"></a>Day One</h2><p>Day One，是一个设计简约的日记应用，它会在每条记录的左侧s突出显示日期，会自动记录你当前的位置、时间（具体到分钟）。</p>
<p>它还有一个「<strong>那年今日</strong>」的功能，和 QQ 空间的那年今日一样，当你使用 Day One 超过一年，它会在那年今日中显示去年的同一天你写下的东西，帮你唤起回忆。</p>
<p>价格：Day One 下载免费，采用按年订阅的模式，价格 250+（说实话比较贵），会员的功能有支持多台苹果设备同步、无限制添加照片和日记加密等。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041140239019.jpg" alt="-w1051"></p>
<h2 id="Zoommy"><a href="#Zoommy" class="headerlink" title="Zoommy"></a>Zoommy</h2><p>Zoommy，是一个聚合了多个无版权图库的图片应用，这对经常要找图的人来说非常友好，当然也可以用作壁纸软件，支持 Windows、macOS、Linux 三个平台。</p>
<p>我在前几天的文章中介绍过这款软件，还没看过的朋友可以戳：<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/l2bcxmO7igH4sZmGGFwQVg">史上第二全的壁纸下载攻略，以后别再找人要壁纸了。</a></p>
<p>价格：买断制，官网售价 4.99 刀，支付需要使用 Visa、万事达外币卡，图方便的话可以淘宝解决。</p>
<p>补充一下，Unsplash 图库不知从什么时候起，打开速度就变得非常缓慢，而在 Zoommy 中的访问速度还可以接受。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041160240909.jpg" alt="-w1101"></p>
<h2 id="Downie-4"><a href="#Downie-4" class="headerlink" title="Downie 4"></a>Downie 4</h2><p>Downie 4，可能是 Mac 上最强悍的视频下载工具，支持下载 B 站、腾讯、优酷等视频网站的视频，将视频的链接拖拽或复制到软件中，即可开始下载。</p>
<p>价格：买断制，79 元，双 11 期间可能有优惠。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041159502465.jpg" alt="-w1726"></p>
<h2 id="ScreeFlow"><a href="#ScreeFlow" class="headerlink" title="ScreeFlow"></a>ScreeFlow</h2><p>ScreenFlow，一款屏幕录制应用（录屏软件）。之前推荐过的截图软件 iShot 虽然也支持录屏，但它缺少了视频剪辑功能。</p>
<p>使用 ScreenFlow 则可以对录制的视频进行<strong>轻量剪辑</strong>，去除录制失败或多余的视频片段，录屏剪辑导出一条龙。</p>
<p>价格：买断制，848 元，可在 Mac App Store 下载。</p>
<p><img src="http://cdn.penghh.fun/mweb/16041164008851.jpg" alt="-w719"></p>
<h2 id="万兴优转"><a href="#万兴优转" class="headerlink" title="万兴优转"></a>万兴优转</h2><p>万兴优转，是一款多功能的音视频处理工具，支持 Windows 和 macOS 系统，可实现多种用途：</p>
<ul>
<li>转换音视频格式，包含视频转 Gif、视频提取音频等</li>
<li>视频编辑，包含添加滤镜、添加水印和更改视频尺寸等</li>
<li>压缩视频</li>
<li>屏幕录制</li>
</ul>
<p>价格：下载免费，部分功能需购买会员解锁权限。<br>官网：<a target="_blank" rel="noopener" href="https://sourl.cn/92CHfT">https://sourl.cn/92CHfT</a></p>
<p><img src="http://cdn.penghh.fun/mweb/16041167654630.jpg" alt="-w1116"></p>
<p>以上，希望有帮助。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-28-post05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-28-post05/" itemprop="url">《如何让你爱的人爱上你》摘录</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-28T00:07:38+00:00">
                2020-10-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>本书阅读于得到 App，是一本长期霸榜「得到」电子书榜单的书。即便是以聚集了爱学习的人著称的得到，对脱单、爱情这个话题还是免不了俗。</p>
<p>之前曾看到辉哥奇谭的主理人 @辉哥 说过一句话：</p>
<blockquote>
<p>全世界的人对两件事有天生的「耻感」，第一是金钱，第二是性。但人生的突破机会就在于直视这两点，哪怕你视之为「深渊」。  </p>
</blockquote>
<p>这里我还想补充一点，是关于「爱」的。人本生来孤独，走的时候也是孑然一身，为了让中间的过程更有意思一些，我们会渴望爱、渴望交流、渴望连接，这是一种再正常不过的诉求，但在今天，我们好像不敢直面这种内心诉求，不敢去勇敢追逐爱，甚至不知道怎么去爱。</p>
<h3 id="摘录"><a href="#摘录" class="headerlink" title="摘录"></a>摘录</h3><p>寻找另一半时关注的因素：</p>
<ul>
<li>相貌</li>
<li>财富</li>
<li>地位名望</li>
<li>知识与学问</li>
<li>社交风度或性格</li>
<li>人品</li>
</ul>
<p>对学识的追求是一生的事业，它可以为你带来持久而深刻的欢愉。</p>
<p>在今天这个世界，女人们倾向于爱上那些能够在专业方面帮助她们的男人。对于那些聪慧而进取的女人，你的学识就是春药。</p>
<p>为了提高你的市场价值，<strong>永不停止学习，永不放弃性格塑造与社交技巧，努力培养内在品质</strong>，并且持之以恒。它们像黄金子弹一样，能够射中意中人的芳心。</p>
<p>今天，女猎手想要的是心思细腻、可以与女人分享心情的男人。男猎手幻想的是超级女人，她可以带来绝佳的陪伴、绝佳的子女、绝佳的激情和绝佳的性高潮。</p>
<p>男性喜欢的话题：汽车、体育、事实、商务和政治<br>女性喜欢的话题：健康、艺术、个人成长以及谈心灵</p>
<p>女猎手们，你可以在男性话题中展露聪明才智，但不要比意中人更聪明。</p>
<p>男猎手们，要让你的言谈更具心理学意味。与意中人谈天时，要多谈论人、感受、哲学、基本原理和直觉。</p>
<p>男猎手，如果一个女人讲话时，你插嘴问出一个基本问题：“<strong>对于那件事，你感觉怎么样</strong>？”你就会脱颖而出，成为众多男人中的珍品，真的。基本上，对任何事情你都可以这么问。（这个技巧可以让女人将你视作真正心思细腻的男人）</p>
<p>恋情中，不要过早追问“感受”（献给女猎手）</p>
<h3 id="倾听"><a href="#倾听" class="headerlink" title="倾听"></a>倾听</h3><p>绅士们，当你的恋人看上去纠结、愤怒、心事重重或恼火的时候，献出那句神奇的妙语吧：“究竟发生了什么事，你能和我谈谈吗？”</p>
<p>如果女生一开始拒接了，你也要坚持。说：“来吧，我知道，如果你和我谈谈，心里会舒服一些。我真的很喜欢你把自己的感受拿出来和我一起分享。”</p>
<p>不用害怕，倾听女生分享感受时，你所需要做的只是闭嘴、倾听。</p>
<p>女猎手们，当你的意中人愤怒、不安或沮丧时，你需要学的妙语比男人需要学的还少。事实上，你什么都不必说，只需要闭嘴，像哥们一样尊重他的沉默。</p>
<p>男人通常不习惯与他人分享自己的感受，如果他选择不告诉你他的感受，请不要觉得伤心。在他看来，不拿自己的烦恼为你增加负担，就是在展示对你的敬意。</p>
<p>男猎手们，不要告诉她你们要干什么，而是要先征求她的意见。当意中人向你发问时，不要只从字面上理解，要读出字里行间的言外之意，领悟她的暗示。当她问“你想不想”时，意思可能是“她很想”。<br>（例如，你想吃饭，最好先询问女生，你想吃点什么吗？）</p>
<p>男人想得到信任，女人想得到关心。</p>
<p>接下来的一条建议听起来也许像反女权的疯话，但是我要悲伤地告诉你，这条技巧很管用：<strong>当男人帮你时，永远不要对他提建议——永远不要</strong>。即使他想用透明胶带粘好你漏水的龙头，而你知道有七种更好的办法，也要咬紧牙关别吭声。</p>
<p>男猎手们，当你见到意中人犯难时，请走过去问她是否需要帮忙。和你的哥们不同，她不会觉得你不信任她的能力，她会将你的主动帮忙理解为：你在乎她、对她的难题很上心。</p>
<p>在男性大脑中，自尊和性爱几乎是不可分割的大脑灰质。</p>
<p>男性最普遍的秘密性幻想是什么？幻想同时与两个女人上床，观赏两个女人交欢，观看其他情侣做爱，看女人自慰，服从女王颐指气使的性爱命令，统治女人（最为流行的六种隐秘的男性性幻想）……清单内的项目无穷无尽，内容也会越发异乎寻常、放荡不羁。</p>
<p>多数女人都很聪明，懂得在第一次见到恋人的阳具时要满脸震撼。</p>
<p>男人是视觉动物，也是听觉动物，男人也愿意千遍万遍地听到那些让自己兴奋的词汇。</p>
<p>在意中人耳中，巅峰的听觉性体验是在性爱过程中由你亲口说出他最爱的撩人词汇。</p>
<p>与男人相比，女人对伴侣的品质要求更高。</p>
<p>问问意中人，对她来说爱情意味着什么，弄明白你的意中人最喜欢怎样被爱。<br>在她回答的时候，你要仔细聆听那些撩人词汇。不要立即使用，而是要等到说出“我爱你”的那一刻，再用这些特定的词语编织出美丽的情话。</p>
<p>我们所有人其实都在不停地寻找应对孤独感或疏离感的方式，无论自己是否意识到这件事。</p>
<p>我们孤身一人，从母亲的子宫来到这个世界；我们活在世间，在一片以各自的思想和肉身为疆界的孤独中离群索居；撒手尘寰的时候，也是孑然一身，无人相伴。茫茫生死之间，如果两份孤独能够萍水相逢、两个凡尘俗子能够血脉相连，便能找到真正的幸福。但真爱是件奢侈品而非我们与生俱来的权利。正如追求其他奢侈品一样，我们必须尝试最有力的方法。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url">权限系统设计</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-25T09:47:30+00:00">
                2020-10-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>权限管理是所有后台系统的都会涉及的一个重要组成部分，主要目的是对不同的人访问资源进行权限的控制，避免因权限控制缺失或操作不当引发的风险问题，如操作错误、隐私数据泄露等问题。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-25-post04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-25-post04/" itemprop="url">博客图床配置之七牛云</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-25T00:07:38+00:00">
                2020-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>之前我曾写过一篇 Mac 上的 Markdown 写作工具——MWeb 相关的文章 《<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/itLe10q1x4B6CBvApRTcCQ">电脑写作利器 MWeb｜如何使用第三方预览样式？</a>》，主要是讲如何在 MWeb 中使用第三方预览样式，让文章的预览视图看起来更舒服。    </p>
<p>这一次我想写一下 MWeb 的图床配置问题，MWeb 内置了「<strong>发布服务</strong>」的功能，支持将本地编辑好的文章直接发布到 Wordpress、Medium、少数派等网站。</p>
<p>但要想让整个过程一气呵成的话，我们需要先解决图床配置的问题，这样你发布的文章中的图片才不会出现丢失或上传失败的问题。  </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%A4%9A%E4%B8%AA%E5%B9%B3%E5%8F%B0.png" alt="多个平台"></p>
<p>在解决这个问题之前，我们需要先了解什么是图床？  </p>
<h2 id="图床是什么？"><a href="#图床是什么？" class="headerlink" title="图床是什么？"></a>图床是什么？</h2><p>图床，可以理解为一个存放图片的网络空间或服务器，你发布到朋友圈的图片，别人之所以能看到，是因为你上传的图片放在了腾讯提供的网络空间上。</p>
<p>这个网络空间充当了桥梁的角色，对已成为微信好友的人或设置为最多可见 10 张图片的陌生人开放，这样别人就看到了你发布在朋友圈的图片。   </p>
<p>对应到写文章这件事，我们也需要将文章中用到的图片，上传到写作平台的图床（服务器），这样读者在读文章时才能顺利看到我们附上的图片。</p>
<p>但如果你和我一样，会<strong>将一篇文章发布到不同的平台</strong>，例如将首发在公众号的文章发布到知乎，你大概率会遇到一个蛋疼的问题——粘贴到知乎编辑器的文章会出现多个「<strong>图片上传失败</strong>」的提示。</p>
<p>之前为了解决这个问题，我的方法是：先将微信文章复制到简书，再从简书复制到知乎编辑器。这个方法几乎能完美解决图片上传失败，少数时候会遇到 Gif 上传失败的问题。</p>
<p>说句题外话，从上面这种解决方法推测，微信为了避免被别的写作平台当成图床（避免被薅羊毛），它<strong>禁用了图片的外链引用</strong>，当它识别到当前的环境不是在微信体系内，图片就会显示失败，这就导致了图片上传失败的问题。  </p>
<p>而现在，我有了一个更好的解决方法——<strong>将图片上传到自己的图床帐户中</strong>。这个方法可以省去上面「粘贴到简书」的中间步骤，简化整个流程，更重要的是，你可以更方便地将文章分发到多个平台，例如自己的个人博客或其他写作平台。   </p>
<h2 id="有哪些可用的图床？"><a href="#有哪些可用的图床？" class="headerlink" title="有哪些可用的图床？"></a>有哪些可用的图床？</h2><h3 id="免费图床"><a href="#免费图床" class="headerlink" title="免费图床"></a>免费图床</h3><p>网上有不少人整理了多个免费的图床，但目前我用过的免费图床只有两个：路过图床和微博图床。   </p>
<ul>
<li>路过图床  <a target="_blank" rel="noopener" href="https://imgchr.com/">https://imgchr.com/</a><br>全球CDN加速, 支持外链, 原图保存, 最大单张支持10 MB   </li>
<li>新浪微博图床  <a target="_blank" rel="noopener" href="https://www.crx4chrome.com/crx/17508/">https://www.crx4chrome.com/crx/17508/</a><br>为了让微博图床更易用，有人开发了一个浏览器插件「新浪微博图床」，支持选择&#x2F;拖拽&#x2F;粘贴上传图片，并生成图片地址、HTML、UBB 和 Markdown 等格式</li>
</ul>
<p><img src="http://cdn.penghh.fun/mweb/%E5%BE%AE%E5%8D%9A%E5%9B%BE%E5%BA%8A%E6%8F%92%E4%BB%B6.png" alt="微博图床插件"><br>免费图床虽然可以不花钱，但我悲观地认为，大多免费且赚不了钱的服务终究走不了长远，也许未来的某一天，你就会突然收到「XX 关停」的通知。  </p>
<p>如果你想更妥善地保存自己的图片数据，最好还是选择大一点或者收费的图床工具。  </p>
<h3 id="收费图床"><a href="#收费图床" class="headerlink" title="收费图床"></a>收费图床</h3><ul>
<li>七牛云  <a target="_blank" rel="noopener" href="https://www.qiniu.com/">https://www.qiniu.com/</a></li>
</ul>
<p>七牛云虽然是一个主打收费的服务，但它对所有注册的<strong>实名用户</strong>，还是免费提供了每月 10 GB 的存储空间、每月 10 GB 的 CDN 回源流量，具体可见下图。 </p>
<p>其实我对这些术语也不是很清楚，但这些免费额度，对于一个没什么访问量的博客来说，已经够用了。  </p>
<p><img src="http://cdn.penghh.fun/mweb/%E4%B8%83%E7%89%9B%E4%BA%91%E4%BB%B7%E6%A0%BC%E8%B4%B9%E7%94%A8.png" alt="七牛云价格费用"><br>了解更多关于七牛云计费方式的内容，可以参考官方的文档：<br><a target="_blank" rel="noopener" href="https://www.qiniu.com/prices/kodo?source=kodo">https://www.qiniu.com/prices/kodo?source=kodo</a></p>
<p>首次使用七牛云，它会给每个人分配一个<strong>临时的测试域名</strong>，有效期为一个月，过期之后如果你还想使用七牛云作为图床的话，就需要自己去注册一个域名。  </p>
<h3 id="MWeb-七牛云图床配置"><a href="#MWeb-七牛云图床配置" class="headerlink" title="MWeb 七牛云图床配置"></a>MWeb 七牛云图床配置</h3><p>MWeb 本身支持的图床服务较多，例如七牛云、腾讯云和阿里云等，还支持自定义更多图床。</p>
<p><img src="http://cdn.penghh.fun/mweb/MWeb%E6%94%AF%E6%8C%81%E7%9A%84%E5%9B%BE%E5%BA%8A.png" alt="MWeb支持的图床"><br>配置之前，我们先在浏览器打开七牛云的「控制台」，切换到「对象存储」，新建一个公开的空间，这里我将空间名称命名为 blog-picbed20，空间名称自行定义，后面会用到。   </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%88%9B%E5%BB%BA%E7%A9%BA%E9%97%B4.png" alt="创建空间"></p>
<p>打开创建好的空间，需要添加「CDN 加速域名」，域名的格式为「cdn.+自己注册的域名」，接着需要配置右侧的「CNAME」，将鼠标移动到 CNAME 上方，它会给出配置 CNAME 的指导。</p>
<p><img src="http://cdn.penghh.fun/mweb/cname.png" alt="cname"></p>
<p>复制七牛云空间的 CNAME 值，接着打开你注册的域名的「DNS 解析页面」，因为我是在腾讯云注册的域名，这里打开的就是腾讯云的管理后台。 </p>
<p>在解析列表中新增一条记录，主机记录为 cdn，记录类型选择 CNAME，记录值位置粘贴刚从七牛云得到的 CNAME 值。   </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%A2%9E%E5%8A%A0%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95.png" alt="增加解析记录"><br>完成这个步骤后，回到七牛云的控制台，刷新页面，直至 CDN 加速域名的状态显示为「成功」，则表示完成了七牛云的配置。   </p>
<p><img src="http://cdn.penghh.fun/mweb/%E6%88%90%E5%8A%9F.png" alt="成功"><br>回到 MWeb，打开「偏好设置」，切换到「发布服务」，添加「七牛云存储」，API 地址选择离你较近的地区即可。</p>
<p>空间名称：前面创建七牛云空间自定义的名称<br>域名：<a target="_blank" rel="noopener" href="http://cdn.+自己注册的域名/">http://cdn.+自己注册的域名</a></p>
<p><img src="http://cdn.penghh.fun/mweb/MWeb%E9%85%8D%E7%BD%AE.png" alt="MWeb配置"><br>而其中的 Access Key 和 Secret Key 则需要再次回到七牛云的后台获取，点击右上角的帐户头像，在弹出的菜单中，选择「密钥管理」，创建一个新的密钥。 </p>
<p>下图的 AK 和 SK 分别对应 MWeb 里的 Access Key 和 Secret Key，分别粘贴到 MWeb 中相应的位置，就完成了 MWeb 中图片的配置。  </p>
<p><img src="http://cdn.penghh.fun/mweb/%E5%88%9B%E5%BB%BA%E5%AF%86%E9%92%A5.png" alt="创建密钥"><br>借助 MWeb 集成的将本地图片上传到图床的功能，当你将文章从 MWeb 发布或粘贴到其他平台之前，先选择顶部的菜单「发布–把本地图片传至图床」。 </p>
<p><img src="http://cdn.penghh.fun/mweb/15992331398624.jpg" alt="-w629"></p>
<p>在弹出的窗口中，选择「七牛云图床」，接着点击右下角的「上传本地图片」，MWeb 就会将本地的图片上传到七牛云图床，再自动返回图片上传到图床后的「<strong>远程地址</strong>」。    </p>
<p><img src="http://cdn.penghh.fun/mweb/%E4%B8%8A%E4%BC%A0%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87.png" alt="上传本地图片"></p>
<p>此时如果你想将文档发布到公众号或知乎，先点击「复制带样式的 HTML」，再切换到发布内容的平台，使用 Command + V 粘贴，文章和图片也会随之过去了，一气呵成，不会出现图片丢失的问题。            </p>
<p><img src="http://cdn.penghh.fun/mweb/15992333667413.jpg" alt="-w583"><br>第一次看完整个配置，你可能会觉得非常麻烦，但就像老话说的「万事开头难」，开头的坑趟过去了，后面等着你的可能就是一马平川的广阔天地。</p>
<p><strong>完成第一次稍微有些麻烦的配置，你就可以持续享受一次配置带来的多次收益</strong>，这某种程度上也可以算是一种「复利」行为，何乐而不为？  </p>
<p>以上，希望有帮助。 </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-24-post03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-24-post03/" itemprop="url">做新媒体的几点体会</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-24T06:02:38+00:00">
                2020-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>做新媒体起家的公司，前期可能会专门雇人写文章，到后期新媒体公司大概率会变为一家广告公司——不生产文章，只转载文章和广告文章（广告没啥错，错的是什么广告都接）。</p>
<p>你看见很多风马牛不相及的公众号，他们可能就是同一家公司的号。做多个新媒体账号，就像以前玩网游的时候，一个人同时注册多个账号，一方面是安全（不要把鸡蛋放在同个篮子里），一方面是可以多个号同时赚钱。</p>
<p>大号转载小号的文章，有些会抱着是看得起你的心态，作为小号的你不要不识抬举哈。大号会说，按行业惯例，你就必须给我开白名单且不显示转载来源（俗称双勾），不给我白嫖，你就是不对，不守行业惯例，完事了还要在朋友圈发一条动态来吐槽你，说你小号欺负人。</p>
<p>做新媒体的人都很小气，是的，都很小气（包括我）。看见别人写和自己一样的选题，就会本能地怀疑别人洗自己的稿，每个新媒体人或多或少都有「被洗稿妄想症」。</p>
<p>新媒体做久了真的很没意思，同行之间互相研究对方的选题，然后就仿写一篇类似的。</p>
<p>做新媒体真的没有多高大上，没必要抬高自己，也没必要贬低别的职业。有些人总看不起微商，说他们老是在朋友圈发广告，但其实新媒体人也好不到哪去，他们总在朋友圈转发自己写的文章。   </p>
<p><strong>不要羞于宣传自己</strong>。这和上一条看起来有点矛盾，但其实并不矛盾。原因在于：   </p>
<ul>
<li>宣传时你是否站在别人的角度，为别人带来了价值，而不是单纯的打扰</li>
<li>不少人可能碍于各种因素，羞于宣传自己，觉得不好意思，本质上还是你不够认可自己（或者说不够认可自己写的东西）。只有先认可自己的人，大概率才会得到别人的认可，就像爱情中的「爱人先爱己」</li>
<li>宣传自己或者说展示自己，也是一种很好的筛选方式，筛掉那些不喜欢你的人。人的时间有限，要把时间更多地花费在那些喜欢你或认可你的人身上</li>
</ul>
<p>千万不要随便惹做新媒体的，因为他们动不动就会威胁你说，「回头我在公众号说一下这事」、「回头我在公众号挂一下你」。</p>
<p>不要迷信大 V，不要迷信大 V，不要迷信大 V。大 V 真的不是神，在网上看不见摸不着，在网上有时只要让人觉得你很强，你也能成为一些人眼中的大 V。  </p>
<h3 id="为什么要写作？"><a href="#为什么要写作？" class="headerlink" title="为什么要写作？"></a>为什么要写作？</h3><p>写作是一种具有长尾效应的行为，在一个开放的网络环境中，你现在写的内容，特指有价值的内容，而不是煽动情绪的爽文，可能会帮到以后遇到同样问题的人。</p>
<p>写作是一种高质量的社交活动，同频相吸，它会让你和志同道合的人相遇。</p>
<p>写作可能是一种让你获得自由的方式，自由包含精神自由和财务自由。这里我还没有什么经验可谈，只是看了一些做自媒体的博主的案例，但经过今晚的饭局，我再次确认了，<strong>单纯的工资收入并不能使人致富</strong>。   </p>
<p>写作也是一种和自己对话的方式，当你把心中想说的东西写下来的时候，它会让你的内心更轻盈，排出心中积压已久的某种东西，为填入新的东西预留空间。 </p>
<p>写作是一种预防遗忘的手段，之前看过电影《寻梦环游记》，对其中的一句台词印象深刻：</p>
<blockquote>
<p>真正的死亡是世界上再没有一个人记得你。死亡不是真的逝去，遗忘才是永恒的消亡。</p>
</blockquote>
<p>年龄越大，记忆力越差，现在随手写下的东西，暮年闲来无事可以拿出来翻翻看。  </p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>本文大部分内容是之前已经写好的，这次增添了少量的内容。</p>
<p>今天之所以会发这个，除了吃晚饭时和朋友聊的内容，还有另外一个原因：</p>
<p>早上看到了一位关注已久的博主 @路人甲 发布的文章，如果你是一个知乎重度用户，可能对这个 ID 也不陌生。我最开始关注他，是看到他在知乎疯狂输出了很多 Python 相关的内容，觉得他是一位大神级别的人物，即便看不懂他写的代码，也值得关注看看。</p>
<p>后来他从知乎转战微信公众号，也做得挺好的，没记错的话还受到了一个大号「小道消息」的推荐，期间还孵化了一些新的账号。  </p>
<p>今天看到他说从待了三年的公司辞职了，准备创业自己带团队，做出这个决定也是深思熟虑之后的结果。</p>
<p>说实话，有时看到别人辞职单干或者成为一个自由职业者，我的首要感受还是挺羡慕的，羡慕他们十足的底气，也觉得很潇洒。</p>
<p>过后呢，羡慕就会转换为佩服，因为在我看来，创业或者成为自由职业者，需要有极大的热情和驱动力，一个人有时要像一支队伍，看似自由，实则需要极大的自律。  </p>
<p>简言之，<strong>人总会从一条河流踏进另外一条河流</strong>，换成不文艺的说法就是，人总会从一个坑跳到另外一个坑。  </p>
<p>既然还是跳到另外一个坑，那为啥还要做自媒体（写作）呢？   </p>
<p>可能只是多一种选择，可能只是在辞职的时候，更有底气地说出那句，fucxing your money!</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/posts/hui-guang-zhou-yi-nian-you-gan.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/hui-guang-zhou-yi-nian-you-gan.html" itemprop="url">回广州一年有感</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-23T16:38:14+00:00">
                2020-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在去年的这个时候，我写了一篇<a target="_blank" rel="noopener" href="https://4ark.me/posts/why-i-became-a-programmer.html">《我为什么会成为一名程序员》</a>，记录了我为什么会进入软件开发这个行业，以及我对当时现状的忧虑、反思我成为程序员的初心是什么。</p>
<p>那么，一年过去了，我现在是怎么样的呢？我还是曾经那个少年吗？</p>
<h2 id="我回广州了"><a href="#我回广州了" class="headerlink" title="我回广州了"></a>我回广州了</h2><p>是的，我写了那篇文章后，我决定离开当时的公司，离开那个城市，我想要找一个能让我成长的团队，跟一群能够互相激励共同进步的人一起工作，于是我回到广州，来到现在这家公司，在这篇<a target="_blank" rel="noopener" href="https://4ark.me/posts/review-summary.html">《面试总结》</a> 中记录了我面试通过后的一些想法。</p>
<p>在这一年中，我学到了很多东西，这不仅仅只是技术的进步，更多的是思维、做事的方式，这会影响我的一生。</p>
<p>比如，我会在开始工作之前，先写设计文档、技术调研文档；在开发过程中，我会记录开发细节、踩过的坑；总之，不要出现一件事情只存在你的大脑中，一定要有文档记录。</p>
<p>又比如，我会使用 Google 搜索引擎、优先选择查阅英文文档、尽自己能力对开源社区做一些贡献。</p>
<p>还有很多，这些我每天工作做的事情，已经逐渐养成习惯，慢慢影响着我。</p>
<p>其实这些都是一个程序员的基本素养，只是，如果我当初没有选择离开那家公司，来到这里的话，可能到今天我依然还是那个不专业的程序员。</p>
<h2 id="未来作何打算"><a href="#未来作何打算" class="headerlink" title="未来作何打算"></a>未来作何打算</h2><p>由于一些原因，说不定我会离开这里，但，只要有可能，我希望继续留下。</p>
<p>但我想，即便离开了，我在这里养成的习惯，我会坚持做下去，我也希望我能够影响别人做出改变。</p>
<p>至于未来会如何，我也不清楚。</p>
<p>但不管怎样，我希望我始终能看到自己的进步，而不是永远停留在原地。</p>
<h2 id="最后讲讲关于写博客"><a href="#最后讲讲关于写博客" class="headerlink" title="最后讲讲关于写博客"></a>最后讲讲关于写博客</h2><p>我认为，写博客既是记录现在的自己，也是为了给以后的自己看，毕竟就我这个破 blog 看得最多的人肯定还是自己。</p>
<p>虽然我不是一个很有文采的人，我也写不出华丽的句子，但我认为要记录自己，哪怕是用最简单朴素的文字，也已经足够了。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-23-post02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-23-post02/" itemprop="url">《夜晚的潜水艇》摘录</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-23T00:07:38+00:00">
                2020-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>《夜晚的潜水艇》作者陈春成，1990 年出生，现居福建泉州，本书是他出版的处女作。在而立之年出版了自己的第一本小说，这让我联想到了村上春树，村上 29 岁开始写小说，次年将作品《且听风吟》投稿到文学杂志《群像》，结果一举赢得 1979 年的群像新人奖。</p>
<p><img src="http://cdn.penghh.fun/mweb/s33718940.jpg" alt="书籍封面来自豆瓣"></p>
<p>这本书是池建强老师推荐之后才买的，他写的推荐语是：</p>
<blockquote>
<p>文字洗练、丰盈、精准，像白描一般的故事情节，虚实交错，读起来让人着迷沉浸。文字如流苏，情节浑然天成，读来不知真假。<br>他的文章让我想起李海鹏、阿城的文字。这是一本处处闪烁光芒的天才之作，期待他能持续写下去。写作是个老天爷赏饭的技能，这种文字，理应让更多人知道。</p>
</blockquote>
<h1 id="我的体会"><a href="#我的体会" class="headerlink" title="我的体会"></a>我的体会</h1><p>在读这本书的过程中，我看到了一些形容非常贴切的比喻、作者丰沛的想象力，可以看出不少句子可能是经过多次的字斟句酌之后，才能有那般的准确。</p>
<p>以前读书时，于我而言，读散文体裁的文章一度让我非常痛苦，因为我觉得它很难理解，作者想表达的东西难以把握。</p>
<h1 id="摘录"><a href="#摘录" class="headerlink" title="摘录"></a>摘录</h1><p>老家被拆，手中剩下的老家钥匙，就是我与老家的最后一丝联系，它像风筝的线头，该如何处置这个「遗物」呢？</p>
<p>——不能放在身边。放在身边，久了，它就成了日常之物，日常的空气会消解它身上的魔力，直到对我失去慰藉作用。</p>
<p>作者选择藏起来，「藏东西，是我惯用的一种自我疗法」。</p>
<p>确定无疑的事情有这么一两桩，也就足以抵御世间的种种无常了。</p>
<p>长年累月 VS 年深日久</p>
<p>e.g. 文笔往往不错，那是一种年深日久的自我修养。</p>
<p>文笔 VS 笔力</p>
<p>但这些仍不能让我满意，笔力得不到充分的驰骋。</p>
<p>“可以惊四座，不可适独坐”，不能取悦自己的文章，再怎么让世人惊佩也没多大意思。</p>
<p><strong>我意识到表达的畅快来自于阻碍和阻碍的消除，而当我的笔无往不利，思路开阔无碍，那种畅快也就不复存在，一切只是熟极而流的操作</strong>。我不得不制定更难的写作计划。</p>
<p>我试图立足于有限的时间里，来用文字笼络住无穷的空间。</p>
<p>我做了一场梦，在梦中遇到了一个素不相识的老人，老人没来由地问了我一个问题：</p>
<blockquote>
<p>如果你可以写出伟大的作品，但只有你自己能领受，无论你生前或死后，都不会有人知道你的伟大——你愿意过这样的一生吗？</p>
</blockquote>
<p>自从那场梦后，我不再有作品示人（得到的传彩笔写出来的文章只有自己能看到），相识的编辑都以为我放弃写作了，这也正常不过，<strong>中年后放弃写作的大有人在</strong>。</p>
<p>古往今来每个春天豪掷的所有花瓣</p>
<p>写文章仿佛是医生在抓药那般：</p>
<blockquote>
<p>起初，我的脑子像一面巨大的中药柜，词汇分门别类地躺在无数抽屉里，我清楚它们的位置，熟练地抓取需要的文字，配成需要的句子。</p>
</blockquote>
<p>在写作的世界里，作者就是造物主：</p>
<blockquote>
<p>我熔铸月光，裁剪浮云，掣长鲸于碧海，我统治天上的星星……</p>
</blockquote>
<p>写作诚然能带来最澎湃的快乐，但他人的认同能让这份快乐变得确切，从滔天的浪涛变成可以珍藏的珠玉……我渴望听到别人的评价，来将这狂喜落到实处。</p>
<p>年轻时有许多次类似的经验：自以为写出了杰作而狂喜，隔了些时候再看，不过敝帚自珍罢了，一场蜃楼。</p>
<p>我穿进了别人的梦里，挨个问当初那老人问过我的问题，他们表示不愿意，将我请出或轰出了他们的梦。毕竟人在梦中没法说谎和逞强。</p>
<p>（我在梦中把传彩笔给了新的主人，第二天醒来）我试图回忆那些诗句，脑中空空荡荡，像从群仙的会饮中骤然离席，再也想不起琼浆的滋味和霓裳的色彩。</p>
<p>我领受过伟大作品的伟大，便无法再满足于这种残次品。饕餮过诸神的盛宴，从此人间脍炙都索然无味。</p>
<h2 id="酿酒师"><a href="#酿酒师" class="headerlink" title="酿酒师"></a>酿酒师</h2><p>喝过一口酒，好像有月光在经脉中流淌，春风吹进了骨髓。</p>
<p>历历在目 VS 朗然在目</p>
<p>e.g. 我试着回想过往人生中的一些细节，无不朗然在目。</p>
<h2 id="李茵的湖"><a href="#李茵的湖" class="headerlink" title="李茵的湖"></a>李茵的湖</h2><p>人生中一个微不足道、但挥之不去的谜团，轻烟一样，弥漫在生活的背面。<br>（生活的正面是什么呢？）</p>
<p>一生的顺遂和坎坷</p>
<p>李茵原名叫李迎男，成年后她自己去改了名字。迎男和招娣，有同一个酸楚的含义。</p>
<p>（野营的）锅里映着明亮的天，天上亮着橘红色的晚霞。</p>
<p>一段记忆，共同经历的人早都随手抛下，她却当珍宝一样收藏至今。</p>
<p>并非宇宙间有什么隐秘的牵连，是人的记忆常把不想干的事物无端地牵扯到一起。</p>
<h2 id="尺波"><a href="#尺波" class="headerlink" title="尺波"></a>尺波</h2><p>尺波是一本刊物的名称，也是一把剑的名字。</p>
<p> 这时天已变黑 VS 这时天已擦黑</p>
<p>也许唯一能将梦中之物带回现实的方法，是让它成为自己的一部分。</p>
<p>古代诗人吟唱过，大地是华美的毯子，神和历代国王在这一面用金线编织就了花纹；另一面却有另外的图案，人只能在梦中窥见。大地是广阔的书页，神和历代英雄在这一面写下史诗；另一面有另外的诗行，人只能在梦中听闻……大地的另一面是梦中的世界；我们则在那个世界的梦中。</p>
<h2 id="音乐家"><a href="#音乐家" class="headerlink" title="音乐家"></a>音乐家</h2><p>云气腾腾<br>潇潇而下<br>绵绵不绝<br>行人寥落</p>
<p>临街的窗口这时半数还亮着，概无例外地拉着窗帘，每一团暧昧的灯光都像在密谋着什么。</p>
<h2 id="音乐家-1"><a href="#音乐家-1" class="headerlink" title="音乐家"></a>音乐家</h2><p>这种散播资产阶级颓废情调的乐器（指萨克斯）在列宁格勒久已绝迹，因此引起了警局的重视。</p>
<p>深夜的敲门声让整栋楼的寂静绑得更紧了一些。</p>
<p>（手表）<strong>细小的齿轮像星体一样完美地运转着，将时间研磨成均等的颗粒</strong>。晶体般洁净的滴答声凭空堆积着，闪烁着无与伦比的秩序美。他喜欢这种透明、安全的声音，喜欢看着自己修好的各式各样的钟表摆满一桌面，然后在满屋子繁密的滴答声中进入无梦的睡眠。</p>
<p>那一段随口吹出的旋律，像一小汪春水，在他心底摇漾着；捧不住，也截不断。一些旧事像杯底的沉渣，因那旋律的翻搅而浮动起来。</p>
<p>他开了灯。他<strong>听见灯光在电线中涓涓流过，然后从灯盏中溢出</strong>，照亮那些细小的零件和他的白发。（运用通感的修辞手法）</p>
<p>他似乎能沿着曲谱追溯到作曲者创作时的心中所想，乃至潜意识里掠过的景象，就像品酒师一沾杯沿，就能说出葡萄生长时的阳光雨露；或者如古生物学家，从一小截指爪化石中还原出巨兽的身影。</p>
<p>年复一年，他一张接一张地读谱，每一张薄薄的乐谱上都升腾起一座庞大而沉重的蜃楼。</p>
<p>（两位老友经历过战争，饥荒，清洗，动荡）……而他们此刻竟完好无损地坐在一起，谈论着圣境般的故乡——只不过他们都被岁月磨蚀得不成样子了。</p>
<p>椋[liáng]鸟的传说：椋鸟终其一生没旁的事，一直在找寻自己的<strong>灰烬之歌</strong>。上帝每造出一只椋鸟，就造出一段旋律，和它灵魂的形状完全一致，藏在世间某处，让这鸟去寻找。也许在泉流中，也许在树梢的摇荡中，也许正盘旋在某个人的脑子里。椋鸟终日乱叫，探索着新的调子，也学它听来的任何声音，就是为找它的旋律。一旦被它偶然唱出，椋鸟的形体就会立时化作灰烬，而它的灵魂就钻进那旋律里，再也不出来了……这只椋鸟没有死，它只是进入了音乐的世界了，那是比尘世更接近上帝的地方……</p>
<p>我摸索了一辈子似乎就为了写出它——就像椋鸟找到了它的灰烬之歌。<strong>它不是伟大的，却是独一无二的，是和我灵魂形状最契合的容器了</strong>。只要听它被演奏上一次，我就再也不奢求什么了。</p>
<p>白天时迥然有别的万物，此刻都被黑暗熔铸成同一件事物了，巨大而阴森，消泯了各自的边界。</p>
<p>（他进入审查办公室后，）他每天在那些蹩脚作品中周旋，忍受着它们带来的乏味而合规的幻象，还得硬着头皮让它们过审，去蹂躏更多的耳朵，他想听到自己作品上演的渴望越发炽热。    </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-21-post01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-21-post01/" itemprop="url">我终于拥有自己的独立博客了</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-21T00:07:38+00:00">
                2020-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>这是我使用 Hexo 发布的第一篇博客。   </p>
<p>对于不懂技术的我来说，搭建这个博客一波三折，幸好中间有一位热心网友 @无声 的相助，这个博客才得以搭建起来。   </p>
<p>看着一个博客从 0 到顺利诞生，那种感觉可能就像是</p>
<ul>
<li>产品经理看着自己做的第一个产品顺利上线</li>
<li>准备要当妈妈的女人听到孩子第一声啼哭的那个瞬间</li>
</ul>
<p>那种感觉不言而喻，虽累但成就感满满，一切值得。     </p>
<p>我之前曾写过两篇技术小白搭建博客的文章：   </p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/cRqTBEfHTmt0TvxCP7PjjA">可能是最最最最简单的搭建博客方法</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/6Dp26H4YCXK5yNr3EvO90g">不会代码，如何零成本搭建个人博客？</a>    </p>
<p>这两篇文章都用到了同一个网站 GitHub，这个网站是世界上最大的代码托管平台，可用来托管代码，也可以用来存放文章数据，作为托管博客的站点，省去购买域名和租用服务器的钱。   </p>
<p>但使用这个方法存在一个弊端：访问时打开的速度很慢，需要使用网络代理，才能以正常的速度打开网站。   </p>
<p>此外，在没有购买域名和租用服务器的情况下，搭建的博客网址通常是「GitHub用户名.github.io」，github.io 后缀的网站以前虽然打开的速度慢，但至少还能访问。   </p>
<p>但在不久前，我想起自己许久没更新的博客，想打开看一下，发现 github.io 后缀的网站也打不开了。显而易见的是，它也被加入了大陆屏蔽的列表。   </p>
<p>正是这个问题，促使我萌生了再次搭建新博客的念头，我想搭建一个存在时间尽可能长、且能在国内正常访问的博客。    </p>
<h2 id="搭建博客的流程"><a href="#搭建博客的流程" class="headerlink" title="搭建博客的流程"></a>搭建博客的流程</h2><h3 id="购买域名"><a href="#购买域名" class="headerlink" title="购买域名"></a>购买域名</h3><p>域名可以理解为我们平常所说的网址，例如 baidu.com，我购买的域名是 penghh.fun。</p>
<p>这个域名是从腾讯云购买的，网站会提供各式各样的域名后缀，如.com、.net、.cn 等，在顶部的搜索框输入你想注册的域名，下面会返回加上不同后缀的域名及价格。   </p>
<p><img src="http://cdn.penghh.fun/mweb/16031995888236.jpg">  </p>
<p>域名是按年收费的，可只买一年，也可一次性买好几年，一次性购买多年的价格会划算一些。  </p>
<p>如果你像我一样，不确定一年之后是否有精力维护博客，那最好就只买域名的 1 年使用期。   </p>
<p>购买域名时的注意点：<strong>不要购买域名后缀为中文的域名</strong>。   </p>
<h3 id="租用一台服务器"><a href="#租用一台服务器" class="headerlink" title="租用一台服务器"></a>租用一台服务器</h3><p>在进行下一步域名备案之前，我们需要先租用一台服务器。</p>
<p>服务器可以理解为一台 24 小时不关机的电脑，如果你将博客的数据存放在上面，它就能随时随地被访问，无需担心电脑是否处于开机状态，且服务器能同时接收多个客户端的请求，因此它可以实现多人同时访问一个网站。    </p>
<p>下图是我租用的服务器配置，应该是最便宜的服务器，一年的费用为 99 元。   </p>
<p><img src="http://cdn.penghh.fun/mweb/WechatIMG196.png" alt="WechatIMG196"></p>
<p>腾讯云服务器：<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/act/double11/go">https://cloud.tencent.com/act/double11/go</a></p>
<h3 id="域名备案"><a href="#域名备案" class="headerlink" title="域名备案"></a>域名备案</h3><p>如果你的网站想在国内正常访问，需要向互联网管理局提交备案，获得<strong>备案号</strong>后才能正常访问。  </p>
<p><img src="http://cdn.penghh.fun/mweb/16032063895650.jpg"></p>
<p>我是通过腾讯云提交备案的，在手机上通过小程序「腾讯云网站备案」提交网站名称和网站的备注信息等，网站名称存在着很多隐藏的限制，例如不能出现「分享」、「工具」等涉及诱导分享或商业性质的字样，我因为网站名称命中敏感词、描述不清而被驳回了三次。   </p>
<p>网站名称最后还是腾讯的客服根据备注信息帮我起的——「个人电子产品使用心得」，与我最开始想设置的「效率工具指南」相去甚远。   </p>
<p>此外，备案时还需要提交一个紧急联系人电话，可以将其设置为你的对象、家人或朋友，后续腾讯云客服在审核的过程中也会联系你留的紧急联系人电话，因此最好事先与紧急联系人打个招呼。    </p>
<p>提交的备案信息通过腾讯云审核后，客服会将你的信息提交到管局，正常情况下 10 个工作日之后就能收到审核的结果，顺利的话就能拿到网站的备案号。  </p>
<p>备案要点：耐心！耐心！耐心！尤其是在我们这个国家。   </p>
<h3 id="配置域名解析"><a href="#配置域名解析" class="headerlink" title="配置域名解析"></a>配置域名解析</h3><p>之前我对域名的理解是，只要在浏览器地址栏中输入域名 penghh.fun，就能打开我的博客，但后来发现输入 <a target="_blank" rel="noopener" href="http://www.penghh.fun/">www.penghh.fun</a> 和 penghh.fun 是不一样的，在未正确配置域名解析的情况下，penghh.fun 打开失败，而 <a target="_blank" rel="noopener" href="http://www.penghh.fun/">www.penghh.fun</a> 则打开正常。   </p>
<p><img src="http://cdn.penghh.fun/mweb/16032386324163.jpg"></p>
<p>咨询了网友 @无声 后，找到了解决方法，需要在服务器的 DNS 解析页面新增一条值为 @ 的主机记录，这里的 @ 代表直接解析域名 penghh.fun，将其指向与 <a target="_blank" rel="noopener" href="http://www.penghh.fun/">www.penghh.fun</a> 相同的 IP。   </p>
<p><img src="http://cdn.penghh.fun/mweb/16032389387266.jpg"></p>
<p>完成配置后，之后无论是否输入带有 www. 的网址，都可以正常访问网站，打开同一个页面。     </p>
<p><img src="http://cdn.penghh.fun/mweb/16032393923196.jpg"></p>
<h3 id="安装-Hexo-框架"><a href="#安装-Hexo-框架" class="headerlink" title="安装 Hexo 框架"></a>安装 Hexo 框架</h3><p>搭建博客有两个比较多人用的<strong>框架</strong>：Hexo 和 Hugo，我选择的是 Hexo。</p>
<p>关于 Hexo，引用 IIssNan 介绍 Hexo 时说的一段话：   </p>
<blockquote>
<p>Hexo 是高效的静态站点生成框架，它基于 Node.js。通过 Hexo 你可以轻松地使用 Markdown 编写文章，除了 Markdown 本身的语法之外，还可以使用 Hexo 提供的 标签插件 来快速的插入特定形式的内容。  </p>
</blockquote>
<p>安装 Hexo 框架之前，需要先安装其他环境或软件：</p>
<ul>
<li>Git</li>
<li>Node.js</li>
</ul>
<p>Git，是一个版本控制软件，后面在将博客 push 到 GitHub 仓库时会用到。   </p>
<p>Node.js 目前已集成到包管理工具 npm 中，因此只要你安装了 npm，就会附带安装 Node.js。   </p>
<p>关于如何在本地安装 Hexo 框架，可以参考 B 站 Up 主 @CodeSheep 的视频教程，视频讲解得非常详细，说是一个保姆级教程也不为过。  </p>
<p>教程地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Yb411a7ty">手把手教你从0开始搭建自己的个人博客 |无坑版视频教程| hexo</a>    </p>
<h3 id="配置服务器"><a href="#配置服务器" class="headerlink" title="配置服务器"></a>配置服务器</h3><p>在搭建博客的整个流程中，我觉得配置服务器对我来说是最难的，一方面是配置时需要在服务器和本地之间分别进行操作，你需要分清某个命令是要在服务上还是在本地上操作，但这东西一来二去就把我搞晕了，另一方面，配置服务器时全程用的是黑黢黢的<strong>命令行窗口</strong>，而不是我们常用的图形化界面。   </p>
<p>为了弄清在服务器上输入的某行命令产生了什么效果，例如是否在正确的路径下创建了文件夹，我们需要使用一些远程连接软件，将本地的电脑与服务器连接起来，通过软件查看服务器端生成的文件。    </p>
<p>Mac 电脑：远程连接软件推荐使用 Royal TSX<br>Windows 电脑：远程连接软件推荐使用 Xshell   </p>
<p>关于 Royal TSX 的用法，可以查看 B 站 Up 主 @老郭种树 的视频：<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av70623689">怎样在Mac上SSH和FTP？完美替代XShell是哪个软件？item2吗？Royal TSX! 没有比它更好</a></p>
<p>不一边输命令，一边查看生成的文件，我觉得心里特没底，特别没有安全感。  </p>
<p>最终，服务器的配置还是网友 @无声 帮我弄好的，因此我少了这一步的实践，想了解的朋友，可以查看 @千古壹号 写的一篇搭建博客的文章：   </p>
<p><a target="_blank" rel="noopener" href="https://www.qianguyihao.com/2020-09-19-hexo-aliyun-blog/#1%E3%80%81%E5%AE%89%E8%A3%85-git-%E7%8E%AF%E5%A2%83">hexo+阿里云搭建博客网站</a></p>
<h3 id="部署到-GitHub"><a href="#部署到-GitHub" class="headerlink" title="部署到 GitHub"></a>部署到 GitHub</h3><p>我的博客不是直接从本地部署到服务器的，它相比前者中间多了一步：部署到 GitHub。后面再通过 GitHub 的 Actions 命令自动部署到服务器。   </p>
<p>之所以要加多这一步（指部署到 GitHub），我的理解是，将 GitHub 作为一个备份的方案，它可能可以解决的问题有：  </p>
<ul>
<li>本地的博客文章数据丢失了  </li>
<li>换了新的电脑  </li>
<li>服务器欠费未缴清</li>
</ul>
<p>对于前两个问题，只需要通过 git pull 或 git clone 命令，就能将之前提交到 GitHub 的博客文章恢复到本地，无需担心数据丢失或迁移带来的麻烦。  </p>
<p>第三个问题，由于 GitHub 是免费的，即便后面你不想租服务器了，将博客文章暂存到 GitHub 上，其实也是可以正常浏览的哈哈哈哈。    </p>
<h3 id="使用-GitHub-Actions-实现博客自动部署到服务器"><a href="#使用-GitHub-Actions-实现博客自动部署到服务器" class="headerlink" title="使用 GitHub Actions 实现博客自动部署到服务器"></a>使用 GitHub Actions 实现博客自动部署到服务器</h3><p>GitHub Actions 是 GitHub 提供的一个<strong>自动化工作流</strong>，它有点类似于 iPhone 上的「快捷指令」。   </p>
<p>在 GitHub 仓库根目录中创建一个工作流文件，即将博客自动化部署到服务器的配置文件，之后你每次将本地的博客提交到 GitHub，就会自动触发 GitHub Actions 执行，稍等一小会，它就会将所有更改同步到远端的服务器。  </p>
<p>这时，刷新一下之前停留的博客页面，就可以看到刚刚更新的博客文章了。   </p>
<p>能让程序自动化的，千万不要手动操作，正如 Perl 编程语言的作者 Larry Wall 所说的：   </p>
<blockquote>
<p>程序员的三大美德：懒惰，急切，傲慢。  </p>
</blockquote>
<p>懒才是第一生产力。        </p>
<h2 id="可能会用到的命令行"><a href="#可能会用到的命令行" class="headerlink" title="可能会用到的命令行"></a>可能会用到的命令行</h2><h3 id="查看-Git-Node-js-的版本号"><a href="#查看-Git-Node-js-的版本号" class="headerlink" title="查看 Git&#x2F;Node.js 的版本号"></a>查看 Git&#x2F;Node.js 的版本号</h3><p>git –version（也可以简写成 git –v）<br>node –version（同理可以简写成 node –v）</p>
<h3 id="路径操作"><a href="#路径操作" class="headerlink" title="路径操作"></a>路径操作</h3><p>进入 blog 文件夹：cd blog<br>进入 blog 文件夹下的子文件夹 posts：cd blog&#x2F;posts<br>返回根目录：cd<br>返回上一级目录：cd ..</p>
<h3 id="显示当前路径"><a href="#显示当前路径" class="headerlink" title="显示当前路径"></a>显示当前路径</h3><p>pwd</p>
<h3 id="在当前路径下创建一个新的文件夹"><a href="#在当前路径下创建一个新的文件夹" class="headerlink" title="在当前路径下创建一个新的文件夹"></a>在当前路径下创建一个新的文件夹</h3><p>mkdir+空格+文件夹名称</p>
<h3 id="查看当前路径下所有文件的管控状态"><a href="#查看当前路径下所有文件的管控状态" class="headerlink" title="查看当前路径下所有文件的管控状态"></a>查看当前路径下所有文件的管控状态</h3><p>ls -l<br>*注：上面的两个字母是 L 的小写</p>
<h3 id="获取-Git-的-ssh-公钥"><a href="#获取-Git-的-ssh-公钥" class="headerlink" title="获取 Git 的 ssh 公钥"></a>获取 Git 的 ssh 公钥</h3><p>cat ~&#x2F;.ssh&#x2F;id_rsa.pub  </p>
<h3 id="博客-push-到-GitHub"><a href="#博客-push-到-GitHub" class="headerlink" title="博客 push 到 GitHub"></a>博客 push 到 GitHub</h3><p>git add .<br>git commit -m”附带的信息，例如在某个时间点编辑了博客”<br>git push</p>
<h3 id="Vim-编辑器模式下的操作-命令行"><a href="#Vim-编辑器模式下的操作-命令行" class="headerlink" title="Vim 编辑器模式下的操作 &amp; 命令行"></a>Vim 编辑器模式下的操作 &amp; 命令行</h3><p>快捷键 i：i 是 insert 的缩写，表示插入<br>:q——退出<br>:wq——保存并退出   </p>
<p>命令行虽然可能不像我们现在用的<strong>图形化界面</strong>那么直观，不那么易于理解，但通过输入短短的几行英文，就能实现某个看起来有些复杂的操作，那个感觉有时真的妙不可言，给人一种「我是上帝，正在造物」的错觉。   </p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>搭建这个新的博客，最要感谢的还是我在即刻偶然认识的一位网友 @无声，他很耐心地帮我解决了大部分问题，如博客部署到服务器、使用 GitHub Actions 实现博客自动化部署，即便他晚上工作到 10 点多才下班，依然很有耐心地帮我解决了遇到的所有问题。   </p>
<p>这也让我看到了一个技术人身上那种不屈不挠、誓要把问题解决的韧劲，他在帮我搭建博客的过程中，同样会遇到最初不知道怎么解决的问题，但他没有因为这是我的事情就草草地放弃了，反而是愈战愈勇。    </p>
<p>一个人之所以强大，不止是来自于强健的体魄，更重要的可能是拥有一颗「大心脏」，能扛得住各种磨难、不畏难，甚至是主动挑战困难，这也是我一直以来佩服做技术的人的原因。       </p>
<p>原本是想写一个详细的搭建 Hexo 博客教程，但写的时候发现自己还是不够耐心，就写了这篇比较笼统的文章，因为我自己其实也没有完全理清一些操作的意图或者命令，有些命令随着终端的关闭也消失了。。。好吧，这都是我的借口。   </p>
<p>以上，希望有帮助。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>IIssNan - <a target="_blank" rel="noopener" href="http://theme-next.iissnan.com/getting-started.html">开始使用 NexT 主题</a><br>老郭种树 - <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av70623689">怎样在Mac上SSH和FTP？完美替代XShell是哪个软件？item2吗？Royal TSX! 没有比它更好</a><br>千古壹号 - <a target="_blank" rel="noopener" href="https://www.qianguyihao.com/2020-09-19-hexo-aliyun-blog/#1%E3%80%81%E5%AE%89%E8%A3%85-git-%E7%8E%AF%E5%A2%83">hexo+阿里云搭建博客网站</a><br>Frost’s Blog - <a target="_blank" rel="noopener" href="https://frostming.com/2020/04-26/github-actions-deploy">使用 GitHub Actions 实现博客自动化部署</a><br>知乎 - <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/220689883">如何配置七牛云图床 - OpenWrite</a><br>zkqiang - <a target="_blank" rel="noopener" href="https://github.com/fluid-dev/hexo-theme-fluid">hexo-theme-fluid</a>    </p>
<p><em>本博客使用了优雅的 Fluid 主题，在此对开发这个主题的开发者 zkqiang 表示衷心的感谢。</em></p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E4%B8%80%E9%81%93HashSet%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E8%9D%B4%E8%9D%B6%E6%95%88%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E4%B8%80%E9%81%93HashSet%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E8%9D%B4%E8%9D%B6%E6%95%88%E5%BA%94/" itemprop="url">一道 HashSet 面试题引发的蝴蝶效应</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-20T04:19:02+00:00">
                2020-10-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>没错，我又借着“面试题”的名头来搞事情了，今天要说的是 HashSet ，而这确实是一个实际面试中遇到的问题。当时的场景大概是这样的，面试官在了解了你的知识广度以后，决心来考察一番你的基本功底，抛出了一个看起来平平无奇的问题：说一说你平时工作中都用到了哪些数据结构。你心想，这还不简单，<code>Array</code>、<code>ArrayList</code>、<code>List</code>、<code>Dictionary</code>、<code>HashSet</code>、<code>Stack</code>、<code>Queue</code>…等等各种集合类简直如数家珍，甚至你还能说出这些数据结构间的优劣以及各自使用的场景。可没想到，面试官话锋一转，直接来一句，“你能说说 HashSet 去重的原理吗”，好家伙，你这简直不按套路出牌啊…本着每次面试都有一点收获的初心，于是就有了今天这篇博客，不同的是，顺着这个思路继续深挖下去，博主又发现了几个平时关注不到的技术盲点，所以，博主称之为：一道 HashSet 面试题引发的蝴蝶效应。</p>
<h1 id="HashSet-源代码解读"><a href="#HashSet-源代码解读" class="headerlink" title="HashSet 源代码解读"></a>HashSet 源代码解读</h1><p>OK，首先，我们来回答第一个问题，即：<strong>HashSet 去重的原理是什么？</strong>。为此，博主翻阅了 HashSet 的 <a target="_blank" rel="noopener" href="https://referencesource.microsoft.com/#System.Core/System/Collections/Generic/HashSet.cs,1044">源代码</a>。首先，我们会注意到 HashSet 的构造函数，它需要一个类型为<code>IEqualityComparer&lt;T&gt;</code>的参数。从这个命名上我们就可以知道，这是一个用于相等性比较的接口，我们初步推测，HashSet 去重应该和这个接口有关：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>()</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">EqualityComparer&lt;T&gt;.Default</span>)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params"><span class="built_in">int</span> capacity</span>)</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">capacity, EqualityComparer&lt;T&gt;.Default</span>)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params">IEqualityComparer&lt;T&gt; comparer</span>)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params">IEnumerable&lt;T&gt; collection</span>)</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">collection, EqualityComparer&lt;T&gt;.Default</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span>(<span class="params">IEnumerable&lt;T&gt; collection, IEqualityComparer&lt;T&gt; comparer</span>)</span></span><br><span class="line"><span class="function">    : <span class="title">this</span>(<span class="params">comparer</span>)</span> &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>我们都知道 HashSet 可以去重，比如，我们向 HashSet 添加多个相同的元素，实际上 HashSet 中最终只会有一个元素。所以，我们自然而然地想到，看看 HashSet 中的 <code>Add()</code> 方法呗，或许能从这里看出一点端倪。HashSet 中一共有两个 <code>Add()</code> 方法，它们内部都调用了 <code>AddIfNotPresent()</code> 方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ICollection&lt;T&gt;.Add(T item) &#123;</span><br><span class="line">    AddIfNotPresent(item);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Add</span>(<span class="params">T item</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> AddIfNotPresent(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续循着蛛丝马迹一路 F12 ，我们来看看这个方法的具体实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">AddIfNotPresent</span>(<span class="params">T <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (m_buckets == <span class="literal">null</span>) &#123;</span><br><span class="line">        Initialize(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">int</span> hashCode = InternalGetHashCode(<span class="keyword">value</span>);</span><br><span class="line">    <span class="built_in">int</span> bucket = hashCode % m_buckets.Length;</span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> FEATURE_RANDOMIZED_STRING_HASHING &amp;&amp; !FEATURE_NETCORE</span></span><br><span class="line">        <span class="built_in">int</span> collisionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = m_buckets[hashCode % m_buckets.Length] - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i = m_slots[i].next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_slots[i].hashCode == hashCode &amp;&amp; m_comparer.Equals(m_slots[i].<span class="keyword">value</span>, <span class="keyword">value</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">if</span> FEATURE_RANDOMIZED_STRING_HASHING &amp;&amp; !FEATURE_NETCORE</span></span><br><span class="line">            collisionCount++;</span><br><span class="line">        <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">int</span> index;</span><br><span class="line">    <span class="keyword">if</span> (m_freeList &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        index = m_freeList;</span><br><span class="line">        m_freeList = m_slots[index].next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_lastIndex == m_slots.Length) &#123;</span><br><span class="line">            IncreaseCapacity();</span><br><span class="line">            <span class="comment">// this will change during resize</span></span><br><span class="line">            bucket = hashCode % m_buckets.Length;</span><br><span class="line">        &#125;</span><br><span class="line">        index = m_lastIndex;</span><br><span class="line">        m_lastIndex++;</span><br><span class="line">    &#125;</span><br><span class="line">    m_slots[index].hashCode = hashCode;</span><br><span class="line">    m_slots[index].<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">    m_slots[index].next = m_buckets[bucket] - <span class="number">1</span>;</span><br><span class="line">    m_buckets[bucket] = index + <span class="number">1</span>;</span><br><span class="line">    m_count++;</span><br><span class="line">    m_version++;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> FEATURE_RANDOMIZED_STRING_HASHING &amp;&amp; !FEATURE_NETCORE</span></span><br><span class="line">        <span class="keyword">if</span> (collisionCount &gt; HashHelpers.HashCollisionThreshold &amp;&amp; HashHelpers.IsWellKnownEqualityComparer(m_comparer)) &#123;</span><br><span class="line">            m_comparer = (IEqualityComparer&lt;T&gt;) HashHelpers.GetRandomizedEqualityComparer(m_comparer);</span><br><span class="line">            SetCapacity(m_buckets.Length, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span> // FEATURE_RANDOMIZED_STRING_HASHING</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以注意到，在这段代码中，首先，会通过 <code>InternalGetHashCode()</code> 方法计算一个 HashCode。其中，<code>Lower31BitMask</code> 是一个常量 <code>0x7FFFFFFF</code> ：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">int</span> <span class="title">InternalGetHashCode</span>(<span class="params">T item</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> m_comparer.GetHashCode(item) &amp; Lower31BitMask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，在 HashSet 内部使用了<code>Slot</code> 这个结构来存储元素，该结构设计上类似于链表，每一个 <code>Slot</code> 中都记录对应元素的值、HashCode 以及下一个元素的索引。所以，只需要对它做一次遍历，如果对应元素的 HashCode 和 值 都相等，则认为该元素在 HashSet中已经存在了。此时，<code>AddIfNotPresent()</code> 方法会返回 false。这就是 HashSet 去重的原理啦。在比较元素的值是否相等的时候，我们前面提到的 <code>IEqualityComparer&lt;T&gt;</code> 终于登场，它提供的 <code>Equals()</code> 方法恰好可以比较两个元素是否相等：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">struct</span> Slot &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="built_in">int</span> hashCode;  <span class="comment">// Lower 31 bits of hash code, -1 if unused</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="built_in">int</span> next;  <span class="comment">// Index of next entry, -1 if last</span></span><br><span class="line">    <span class="keyword">internal</span> T <span class="keyword">value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IEqualityComparer</span>&lt;<span class="keyword">in</span> <span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">T x, T y</span>)</span>;</span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">GetHashCode</span>(<span class="params">T obj</span>)</span>;                </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>再接下来，如果对应元素的 HashCode 或 值 都不相等，则认为该元素在 HashSet 中不存在。此时，需要考虑 HashSet 的容量是否足以放得下这个新元素。在容量不满足的情况下，就需要对 HashSet 进行扩容。值得一提的是，这里是使用质数进行扩容的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">IncreaseCapacity</span>()</span> &#123;</span><br><span class="line">    Debug.Assert(m_buckets != <span class="literal">null</span>, <span class="string">&quot;IncreaseCapacity called on a set with no elements&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">int</span> newSize = HashHelpers.ExpandPrime(m_count);</span><br><span class="line">    <span class="keyword">if</span> (newSize &lt;= m_count) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(SR.GetString(SR.Arg_HSCapacityOverflow));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Able to increase capacity; copy elements to larger array and rehash</span></span><br><span class="line">    SetCapacity(newSize, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">ExpandPrime</span>(<span class="params"><span class="built_in">int</span> oldSize</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> newSize = <span class="number">2</span> * oldSize;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Allow the hashtables to grow to maximum possible size (~2G elements) before encoutering capacity overflow.</span></span><br><span class="line">    <span class="comment">// Note that this check works even when _items.Length overflowed thanks to the (uint) cast</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">uint</span>)newSize &gt; MaxPrimeArrayLength &amp;&amp; MaxPrimeArrayLength &gt; oldSize)</span><br><span class="line">    &#123;</span><br><span class="line">        Contract.Assert( MaxPrimeArrayLength == GetPrime(MaxPrimeArrayLength), <span class="string">&quot;Invalid MaxPrimeArrayLength&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> MaxPrimeArrayLength;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> GetPrime(newSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="IEqualityComparer接口"><a href="#IEqualityComparer接口" class="headerlink" title="IEqualityComparer接口"></a>IEqualityComparer<T>接口</h1><p>OK，现在我们知道了，HashSet 之所以可以去重，一个重要的原因是 <code>IEqualityComparer&lt;T&gt;</code> 。而回到这个接口本身呢，它只有 <code>Equals()</code> 和 <code>GetHashCode()</code>，这其实非常符合我们的认知，因为这两个方法在对象相等的场景中十分常见，有一个准则是：如果重写了 <code>Equals()</code> 方法，那么，应该同时去重写 <code>GetHashCode()</code> 方法，即，两者在表达相等这个含义时应该具有一致性。这里可能会有一点疑问，那就是，我们平时使用 HashSet 的时候，完全不需要指定 <code>IEqualityComparer&lt;T&gt;</code> ，它一样可以正常工作啊？没错，这是因为微软提供了一个默认的实现：<code>EqualityComparer&lt;T&gt;.Default</code>。我们同样来看看它的实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="title">EqualityComparer</span>&lt;<span class="title">T</span>&gt; <span class="title">CreateComparer</span>()</span> &#123;</span><br><span class="line">    Contract.Ensures(Contract.Result&lt;EqualityComparer&lt;T&gt;&gt;() != <span class="literal">null</span>);</span><br><span class="line"> </span><br><span class="line">    RuntimeType t = (RuntimeType)<span class="keyword">typeof</span>(T);</span><br><span class="line">    <span class="comment">// Specialize type byte for performance reasons</span></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">typeof</span>(<span class="built_in">byte</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)(<span class="built_in">object</span>)(<span class="keyword">new</span> ByteEqualityComparer());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If T implements IEquatable&lt;T&gt; return a GenericEqualityComparer&lt;T&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(IEquatable&lt;T&gt;).IsAssignableFrom(t)) &#123;</span><br><span class="line">        <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(GenericEqualityComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If T is a Nullable&lt;U&gt; where U implements IEquatable&lt;U&gt; return a NullableEqualityComparer&lt;U&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (t.IsGenericType &amp;&amp; t.GetGenericTypeDefinition() == <span class="keyword">typeof</span>(Nullable&lt;&gt;)) &#123;</span><br><span class="line">        RuntimeType u = (RuntimeType)t.GetGenericArguments()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(IEquatable&lt;&gt;).MakeGenericType(u).IsAssignableFrom(u)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(NullableEqualityComparer&lt;<span class="built_in">int</span>&gt;), u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">            </span><br><span class="line">    <span class="comment">// See the METHOD__JIT_HELPERS__UNSAFE_ENUM_CAST and METHOD__JIT_HELPERS__UNSAFE_ENUM_CAST_LONG cases in getILIntrinsicImplementation</span></span><br><span class="line">    <span class="keyword">if</span> (t.IsEnum) &#123;</span><br><span class="line">        TypeCode underlyingTypeCode = Type.GetTypeCode(Enum.GetUnderlyingType(t));</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Depending on the enum type, we need to special case the comparers so that we avoid boxing</span></span><br><span class="line">        <span class="comment">// Note: We have different comparers for Short and SByte because for those types we need to make sure we call GetHashCode on the actual underlying type as the </span></span><br><span class="line">        <span class="comment">// implementation of GetHashCode is more complex than for the other types.</span></span><br><span class="line">        <span class="keyword">switch</span> (underlyingTypeCode) &#123;</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Int16: <span class="comment">// short</span></span><br><span class="line">               <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(ShortEnumEqualityComparer&lt;<span class="built_in">short</span>&gt;), t);</span><br><span class="line">            <span class="keyword">case</span> TypeCode.SByte:</span><br><span class="line">                <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(SByteEnumEqualityComparer&lt;<span class="built_in">sbyte</span>&gt;), t);</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Int32:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.UInt32:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Byte:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.UInt16: <span class="comment">//ushort</span></span><br><span class="line">                <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(EnumEqualityComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">            <span class="keyword">case</span> TypeCode.Int64:</span><br><span class="line">            <span class="keyword">case</span> TypeCode.UInt64:</span><br><span class="line">                <span class="keyword">return</span> (EqualityComparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(LongEnumEqualityComparer&lt;<span class="built_in">long</span>&gt;), t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Otherwise return an ObjectEqualityComparer&lt;T&gt;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ObjectEqualityComparer&lt;T&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，<code>EqualityComparer&lt;T&gt;</code> 类是一个抽象类，实现了 <code>IEqualityComparer&lt;T&gt;</code> 接口。简单来说，对于简单类型如整型、字节型等，微软实现了相应的 <code>IEqualityComparer&lt;T&gt;</code> 接口；而对于复杂的类型，微软提供了 <code>ObjectEqualityComparer&lt;T&gt;</code> 这一实现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">ObjectEqualityComparer</span>&lt;<span class="title">T</span>&gt;: <span class="title">EqualityComparer</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Pure</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">T x, T y</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> x.Equals(y);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    [<span class="meta">Pure</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">GetHashCode</span>(<span class="params">T obj</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> obj.GetHashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以，现在又回到我们刚刚聊起的话题，为什么说一个类型的 <code>Equals()</code> 和 <code>GetHashCode()</code> 方法非常重要呢？因为如果我们不能正确地实现这两个方法，微软实现的这个  <code>ObjectEqualityComparer&lt;T&gt;</code> 就会出现问题，导致 HashSet 在判断元素是否存在时出现问题，所以，这是一系列的连锁反应。有人可能会问，博主你说的这个好夸张耶，像我就从来没有重写过这两个方法。OK，现在来回答我的一个问题，如果你定义了一个类型 <code>Foo</code> ，并尝试用它作为一个字典中的 Key ，那么，你觉得这个字典应该怎么判断这个 Key 是否存在呢？我觉得这是一个好问题，因为它引发了我们在 .NET 知识体系中的蝴蝶效应。</p>
<h1 id="排序与去重是亲家"><a href="#排序与去重是亲家" class="headerlink" title="排序与去重是亲家"></a>排序与去重是亲家</h1><p>排序与去重，在我看来是亲家关系，因为两者都需要“比较”。所以，下面我想从 .NET 中选取一部分接口来阐述我的观点，以及当我们有了 LINQ 以后，是否就应该抛弃它们。可能这些接口大家平时都用不到多少，但我还是想花点时间来梳理这些知识盲点，因为我发现，与其为整个行业 35 岁的的职业生涯而焦虑，倒不如重新捡起这个行业的初心，好好地学一学数据结构、算法和数学。整个行业的火热，容易让每一个人都陷入一种“我非常厉害”的错觉，我写博客的时候，在心里想了这样一句话：<strong>战士上战场，整天就知道 CRUD，连 HashSet 都不知道，早晚是个死</strong>。用王布斯的口吻说出来，会不会有一种紧迫感呢？</p>
<h2 id="IEquatable接口"><a href="#IEquatable接口" class="headerlink" title="IEquatable接口"></a>IEquatable<T>接口</h2><p><code>IEquatable&lt;T&gt;</code> 接口在微软官方文档中的定义是，<strong>定义值类型或类实现的通用方法，以创建用于确定实例相等性的类型特定方法</strong>。我承认，这不是一个特别好的定义，不过，我们可以换个角度来审视这个接口存在的意义。虽然 <code>Object</code> 这个基类提供了 <code>Equals()</code> 方法，但是这个方法只能接受一个 <code>object</code> 类型的参数， 所以，它本身会面临<strong>类型安全性缺失</strong>和<strong>装箱</strong>两个问题。为了解决这个问题，就必须要定义一个新的 <code>Equals()</code> 方法，确保它可以接收和当前类型一致的参数，所以就需要这样一个接口，你可以理解为它是 <code>Equals()</code> 方法的泛型版本，而众所周知 C# 是一门不支持多继承的语言，所以，这里只能以接口的形式提供出来。这里说一下我的结论，<code>IEquatable&lt;T&gt;</code> 接口对值类型更有用一点，相反，对引用类型就没有那么有用，因为它没有考虑到协变的问题，对引用类型的继承相对无力。下面是一个简单的例子：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义类型Foo，实现IEquatable&lt;Foo&gt;接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span> : <span class="title">IEquatable</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Weight &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params"><span class="built_in">object</span> other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Equals(other <span class="keyword">as</span> Foo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">Foo other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (other == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span>.Value == other.Value &amp;&amp; <span class="keyword">this</span>.Weight == other.Weight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//平平无奇的代码</span></span><br><span class="line"><span class="keyword">var</span> foo1 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line"><span class="keyword">var</span> foo2 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line">Assert.AreEqual(<span class="literal">true</span>, foo1.Equals(foo2));</span><br></pre></td></tr></table></figure>

<h2 id="ICompareable-ICompareable接口"><a href="#ICompareable-ICompareable接口" class="headerlink" title="ICompareable&#x2F;ICompareable接口"></a>ICompareable&#x2F;ICompareable<T>接口</h2><p><code>ICompareable</code> 和 <code>ICompareable&lt;T&gt;</code>是是同一个接口的非泛型与泛型版本，都需要实现 <code>CompareTo()</code> 方法。可能大家会觉得这几个接口都差不多啊，实际上，大家细心观察就能发现它们的区别，“相等”这一类的接口的返回值是布尔型，关注的是两个对象是否相等；而“比较”这一类的接口的返回值是整数型，关注的是哪个大哪个小。我们继续以 <code>Foo</code> 这个类型为例，分别实现<code>IComparerable</code>  和 <code>IComparerable&lt;T&gt;</code>两个接口：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继续实现IComparable, IComparable&lt;Foo&gt;接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span> : <span class="title">IEquatable</span>&lt;<span class="title">Foo</span>&gt;, <span class="title">IComparable</span>, <span class="title">IComparable</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Weight &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params"><span class="built_in">object</span> other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Equals(other <span class="keyword">as</span> Foo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">Foo other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (other == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span>.Value == other.Value &amp;&amp; <span class="keyword">this</span>.Weight == other.Weight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">CompareTo</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> other = obj <span class="keyword">as</span> Foo;</span><br><span class="line">        <span class="keyword">return</span> CompareTo(other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">CompareTo</span>(<span class="params">[AllowNull] Foo other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (other == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">int</span>)((Value * Weight) - (other.Value * other.Weight));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//平平无奇的代码</span></span><br><span class="line"><span class="keyword">var</span> foo1 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line"><span class="keyword">var</span> foo2 = <span class="keyword">new</span> Foo() &#123; Value = <span class="number">20</span>, Weight = <span class="number">1.0</span>M &#125;;</span><br><span class="line">Assert.IsTrue(foo2.CompareTo(foo1) &gt; <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h2 id="IComparer接口"><a href="#IComparer接口" class="headerlink" title="IComparer接口"></a>IComparer<T>接口</h2><p>对于排序来说，理论上有<code>ICompareable</code> 和 <code>ICompareable&lt;T&gt;</code>这两个接口就可以了，为什么还要再定义一组接口呢？其实，我们结合生活中的场景就能想明白，不管是判断两个对象是否相等，还是对两个对象进行排序，这些条件都属于“变量”。<code>ICompareable</code> 和 <code>ICompareable&lt;T&gt;</code>这两个接口设计上的确没什么问题，但这都是一锤子买卖，一旦实现了对应的接口，就意味着如何比较两个对象的逻辑是确定好了的。可生活常识告诉我们，同一组信息不同的人考虑的维度是不一样的，譬如学生的成绩，可以按照某一个科目的成绩来排序，还可以按照各个科目的总成绩甚至是平均分来排序。对于上面的类型 <code>Foo</code>，我们不妨考虑按照 <code>Value</code> 和 <code>Weight</code> 分别进行排序，此时可以这样写：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//按Value排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FooValueComparer</span> : <span class="title">IComparer</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Compare</span>(<span class="params">[AllowNull] Foo x, [AllowNull] Foo y</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">int</span>)(x.Value - y.Value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按Weight排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FooWeightComparer</span> : <span class="title">IComparer</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Compare</span>(<span class="params">[AllowNull] Foo x, [AllowNull] Foo y</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span> &amp;&amp; y == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> &amp;&amp; y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">int</span>)(x.Weight - y.Weight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//平平无奇的代码</span></span><br><span class="line"><span class="keyword">var</span> list= <span class="keyword">new</span> List&lt;Foo&gt;&#123;</span><br><span class="line">    <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">2.0</span>M &#125;,</span><br><span class="line">    <span class="keyword">new</span> Foo() &#123; Value = <span class="number">10</span>, Weight = <span class="number">1.0</span>M &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用默认的排序器</span></span><br><span class="line">list.Sort(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//按Value进行排序</span></span><br><span class="line">list.Sort(<span class="keyword">new</span> FooValueComparer());</span><br><span class="line">list.OrderBy(x =&gt; x.Value);</span><br><span class="line"></span><br><span class="line"><span class="comment">//按Weight进行排序</span></span><br><span class="line">list.Sort(<span class="keyword">new</span> FooWeightComparer());</span><br><span class="line">list.OrderBy(x =&gt; x.Weight);</span><br></pre></td></tr></table></figure>
<p>在这里有一个点是，在不指定排序器的时候，微软帮我们提供了一个默认的排序器。而这个默认排序器会遵循这样的策略。如果类型 T 实现了 <code>IComparable&lt;T&gt;</code> 接口，则返回 <code>GenericComparer&lt;int&gt;</code> 实例；如果类型 T 实现是一个可空类型 <code>Nullable&lt;U&gt;</code> 并且类型 U 实现了 <code>IComparable&lt;T&gt;</code> 接口，则返回 <code>NullableComparer&lt;int&gt;</code> 实例；否则返回 <code>ObjectComparer&lt;T&gt;</code> 实例。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Comparer&lt;T&gt; <span class="title">CreateComparer</span>()</span> &#123;</span><br><span class="line">    RuntimeType t = (RuntimeType)<span class="keyword">typeof</span>(T);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// If T implements IComparable&lt;T&gt; return a GenericComparer&lt;T&gt;</span></span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> FEATURE_LEGACYNETCF</span></span><br><span class="line">        <span class="comment">// Pre-Apollo Windows Phone call the overload that sorts the keys, not values this achieves the same result</span></span><br><span class="line">        <span class="keyword">if</span> (CompatibilitySwitches.IsAppEarlierThanWindowsPhone8) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t.ImplementInterface(<span class="keyword">typeof</span>(IComparable&lt;T&gt;))) &#123;</span><br><span class="line">                <span class="keyword">return</span> (Comparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(GenericComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(IComparable&lt;T&gt;).IsAssignableFrom(t)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(GenericComparer&lt;<span class="built_in">int</span>&gt;), t);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// If T is a Nullable&lt;U&gt; where U implements IComparable&lt;U&gt; return a NullableComparer&lt;U&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (t.IsGenericType &amp;&amp; t.GetGenericTypeDefinition() == <span class="keyword">typeof</span>(Nullable&lt;&gt;)) &#123;</span><br><span class="line">        RuntimeType u = (RuntimeType)t.GetGenericArguments()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(IComparable&lt;&gt;).MakeGenericType(u).IsAssignableFrom(u)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparer&lt;T&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(NullableComparer&lt;<span class="built_in">int</span>&gt;), u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Otherwise return an ObjectComparer&lt;T&gt;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ObjectComparer&lt;T&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更有意思的是，<code>GenericComparer&lt;T&gt;</code> 就是利用 <code>IComparable&lt;T&gt;</code> 的 <code>CompareTo()</code> 方法来说实现的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">GenericComparer</span>&lt;<span class="title">T</span>&gt; : <span class="title">Comparer</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span>: <span class="title">IComparable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">Compare</span>(<span class="params">T x, T y</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> x.CompareTo(y);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (y != <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Equals method for the comparer itself. </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">Object obj</span>)</span>&#123;</span><br><span class="line">        GenericComparer&lt;T&gt; comparer = obj <span class="keyword">as</span> GenericComparer&lt;T&gt;;</span><br><span class="line">        <span class="keyword">return</span> comparer != <span class="literal">null</span>;</span><br><span class="line">    &#125;        </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">GetHashCode</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.GetType().Name.GetHashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在我们有了 <code>LINQ</code> 以后，通过 <code>OrderBy</code> 和 <code>OrderByDescending</code> 就可以进行排序，如果这个排序字段是一个简单类型，比如字符型、整型、日期型，这些简单类型微软都已经实现了相应的“排序”逻辑，而如果这个排序字段是一个复杂类型，比如一个自定义的类或者结构，此时，为了让这些方法能够“适应”这些复杂类型，最好的还是去实现 <code>IComparer&lt;T&gt;</code> 或者 <code>ICompareable&lt;T&gt;</code> 接口，然后传递给这两个排序方法。类似地，还有 <code>Distinct</code> 这个方法，它接收一个 <code>IEqualityComparer&lt;T&gt;</code> 类型的参数，所以，当你对一个列表进行去重(<strong>Distinct</strong>)操作时，千万不要想当然地人为它会按照你的期望去去重，如果结果不符合你的期望，很大原因是你没有给它提供一个合适的<code>IEqualityComparer&lt;T&gt;</code> 。所以，你看，我们绕了一大圈，从 HashSet 说到 <code>IEqualityComparer&lt;T&gt;</code>，又从排序说到去重，最终又回到了起点，这是多么有趣的一件事情。而去重(<strong>Distinct</strong>)这件事情，其实涉及到<code>Dictionary</code> 和 <code>HashSet</code> 两个数据结构，通过结构来推演性质，又通过性质来扫清盲点，这可能是这段时间刷 LeetCode 最大的一个收获吧！</p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>面试中偶然遇到的 HashSet 问题，让我发现自己的知识体系中存在着盲点。通过解读 HashSet 源代码，我们认识到 HashSet 可以去重的一个重要原因是<code>IEqualityComparer&lt;T&gt;</code> 接口，它决定了两个对象的实例在什么情况下可以被判定为相等。而这个接口，不单单在 HashSet 出现，在 Dictionary 中同样会出现，甚至在我们最熟悉不过的去重(<strong>Distinct</strong>)中还会出现，所以，通过 HashSet 这一个点上的疑问，我搞清楚了很多相关联的内容，这不是蝴蝶效应又是什么呢？而与去重(<strong>Distinct</strong>)相关联的则是排序，在此基础上，对 <code>IEquatable&lt;T&gt;</code> 接口、<code>ICompareable</code>&#x2F;<code>ICompareable&lt;T&gt;</code> 接口、<code>IComparer&lt;T&gt;</code> 接口等知识盲点进行梳理。总而言之，排序需要关注的是 <code>ICompareable</code>&#x2F;<code>ICompareable&lt;T&gt;</code> 接口、<code>IComparer&lt;T&gt;</code> 接口，去重需要关注的是 <code>IEqualityComparer&lt;T&gt;</code> 接口。好了，今天的这只蝴蝶就飞到这里，欢迎大家在博客中留言，谢谢大家！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/campus-network-sharing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/campus-network-sharing/" itemprop="url">绕过校园网分享限制，构建愉快的宿舍网络环境</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-18T08:45:00+00:00">
                2020-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>最近大一新生们开学了，就有几位学弟来问我说，咱们学校的校园网要怎么才能开 WiFi 热点、能不能用路由器。回想一下当初我也折腾了好一段时间，本来想水篇博客的，后来不知道怎么的就咕咕咕了……正好借此机会分享一下。</p>
<p>其实吧，学校有的是办法搞你。除了强制一人一号、恶心的专用拨号客户端防共享以外，还能通过 <a target="_blank" rel="noopener" href="https://www.xavier.wang/post/45-suck-shit-lan/">IPID、TTL、时钟偏移检测</a>，甚至是 DPI 深度包检测的方法来防私接，就看校方做得够不够绝了。当然破解的方法也有，但基本也不会让你好受。如果碰到这样的校园网，推荐你直接躺平，给这种垃圾网络交钱还不如开个无限流量套餐呢。</p>
<p><strong>免责声明：日后你惹出祸来，不把师父说出来就行了.jpg</strong></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/campus-network-sharing/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E5%BD%93%E5%A7%9C%E5%AD%90%E7%89%99%E9%81%87%E8%A7%81%E6%9C%B1%E4%B8%80%E6%97%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E5%BD%93%E5%A7%9C%E5%AD%90%E7%89%99%E9%81%87%E8%A7%81%E6%9C%B1%E4%B8%80%E6%97%A6/" itemprop="url">当姜子牙遇见朱一旦</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-18T04:19:02+00:00">
                2020-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>当导演张策宣布，不再为朱一旦系列担任编剧和配音时，我终于意识到，“十佳员工”不再是一个梗，而是一个活生生的人。也许，身为老板的“朱一旦”，永远都没有读懂这些黑色幽默背后的含义。而显然，站在普通人对立面的资本家们，终究不会因此而洗心革面，代表劳苦大众向这个时代发声。不管是后浪还是非浪，资本家们不会选择和钱过不去，所以，即使有像鲁迅一般针砭时弊的张策，可在一个“屁股决定脑袋”的世界里，“十佳员工”突然就变成一个不再好笑的词汇，因为，这个人可以是你，可以是我，可以是我们中的任何一个。在新冠疫情肆虐的时候，『一块劳力士的回家之路』让我们感受到了现实的魔幻，可此时此刻，我们终于知道，“艺术来源于生活，而往往高于生活”，果然，如有雷同，是不胜荣幸的了。可能是因为我此刻在经历着同样的事情，所以，难免感同身受地想到 C 座 802 里这群真实存在着的人们。</p>
<p>我有一位为公司奉献 11 年青春的同事，可当他离开这家公司时，并没有我想象的中那样充满不舍，大概“鸟尽弓藏”、“大地茫茫真干净”这些句子，从古至今就是这样子的吧！马老师说，“996 是一种福报”，而此前的一位马老师则说，“资本家生来就是剥削劳动者的一切剩余价值”。历史像个任人打扮的小姑娘，你方唱罢我登场，文过饰非，到底谁又讲得清对错？有人说，一个人开始成熟，就是从学习这几千年来的厚黑学、阴谋论开始，的确啊，连封神都开始变成一场阴谋，不同的是，这次的因果都落在原始天尊身上，每一个人都渴望像姜子牙一样，断天梯、破枷锁，似乎一定要执著于什么东西，这样的人生会显得更真实一点。可每个人自以为最完美的安排，终究无法让每一个人信服啊，正如“朱一旦”们喜欢“非洲安排”，马小策与张策，说到底不过是一种代号而已，当这种“安排”无法调和的时候，人和神仙一样，都会暴走，都会变身，唯一不同的是，人是要吃饭的，而神仙们早已学会辟谷。</p>
<p>所以，在“救一个人还是救苍生”这个问题上，其实谁都没有错，我特别喜欢李诞在『奇葩说』中表达的一个观点，<strong>“以自私却不伤害别人的方式活着，才能维持世界的运转。而正是那些为了宏图伟业不计后果的牺牲‘小猫’的人，频频地让我们的世界陷入「大火」”</strong>。朱一旦不想再做“任人摆布”的老板，张策不想再做“默默无名”的幕后英雄，马老师早已看破这一切，“钱没给到位”，“心委屈了”，身在其位时榨干身体的“996”，人走茶凉时送瘟神般“高效”，一冷一热，果然是“环球同此凉热”呢。在全球变暖的趋势下，如果我们以自私却不伤害别人的方式活着，虽然活得有一点清冷、没有人情味，但这样是不是会更安心一点，骨子里与生俱来就带着“竞争”的基因的我们，是不是一定要学会“狠”、学会“不择手段”、学会“伤害”。我二十多岁的时候，想努力去照顾好一个人，而等到我快要三十岁的时候，我终于能勉强照顾好自己，这简直是一种幸运。</p>
<p>这种感慨在某个场景下会更加明显，譬如一个人去看电影的时候，虽然我很喜欢和邻座的小朋友说话，可对方父母一句友善的“叔叔”，终于还是让两个人产生了距离。譬如找工作面试的时候，发觉三十上下的“哥哥姐姐”们，都开始面对“总监”级别职位时的恍惚感。也许，我们这一代人真的已经老了吧，而那个人早已离开你很久很久，我无意去对立资本家与劳动者间积怨久矣的矛盾，更无意去揣测封神台下蛰伏已久的阴谋。回想以前，乐无异在『古剑奇谭 2』中说出一句，<strong>“众生虽苦，还请诸恶莫作”</strong>，当时大概只是觉得这句话酷到不行，倘若议论公平，C 座 802 诸如三濑子、马小玲、马小浩等等角色，每一个都带着无数的梗，没有他们就没有整个朱一旦宇宙，当人们为张策惋惜的时候，是不是就选择性地遗忘了他们呢？朱一旦不会成为劳苦大众的代言人，而且任何人都不会，因为一切的流量到最后都是生意。</p>
<p>我在 B 站关注过一位阿婆主，起初，他在厂里打工，下班后的“入味儿”是他主要的拍摄内容。后来，因为疫情的原因，他开始学别人拍做菜的视频。再后来，发现他变成了一位外卖小哥。世人皆苦，家家有本难念的经，可我们除了祝福以外，又能做一点什么呢？成人世界里，利益、立场、观点……，该有的一切都有，唯独没有对错，希望一个组织有一致的步伐、一致的声音，可偏偏人是一根会思考的芦苇，我知道，当一个人在某一种身份下，他必须要去推动一种文化形成，可如果这些声音连他自己都不信，这种文化的底蕴应该不会特别丰富，很容易成为政治博弈的牺牲品。我从前天真地以为，在互联网这样一个相对开放的环境里，不会存在政治这种产物。而出于对这种东西的逃避，我没有选择成为三线小城市里的一个公务员，实际上我尝试过，结果证明我真的不适合。可后来我发现我错了，只要有人的地方就会存在政治，无论是公司还是社区，每天都有人宣扬这样或者那样的“文化”，这个时候，我希望我们每一个人都去用心甄别这些概念，因为作为人的自觉，他只会说对自己有利的话，正如择偶标准是最毫无标准可言的标准一样，王垠说编程世界里充满宗派，就是最好的证明。</p>
<p>所以，我不大愿意去统一什么东西，充满多样性、充满个性的世界，才是一个正常的世界，以结果论的观点而言，只要能送大家都目的地，是飞机还是高铁还是火车，真的重要吗？如果非要去统一什么，我希望是“语言”或者“领域语言”，因为，我们的沟通，因为存在太多的翻译而逐渐失真、甚至被曲解，我们一般把这样的沟通称之为扯皮，就像土味情话虽然美妙动听，但它携带了大量无用的信息。所以，即使冒着成为“钢铁直男”的危险，我依然想成为一个表达清晰的人。有人说，姜子牙就不能和原始天尊好好商量一下吗？非要自断天梯逼得鸿钧老祖出手吗？人类啊，归根到底，只愿意相信自己相信的，只愿意看见自己看见的，这种意念在成年后往往更加强烈，有多少遗憾就是得不到有效沟通造成的呢？九尾狐自觉被原始天尊欺骗、过河拆桥，而原始天尊认为“非我族类，其心必异”，都是选择性地相信了自己愿意去相信的东西。有人说，姜子牙有强迫症，为什么会任由师尊披头散发？因为不是每个人都能像约翰·纳什那样，在最亲密的人面前直抒胸臆，人类就是这么奇怪，和陌生人玩什么真心话大冒险，在亲人面前反而含蓄、羞怯起来，可能是因为某种特殊的磁力限制了声道发声吧，科学与玄学往往就是这么切换自如。</p>
<p>思绪就像一个无底黑洞，姜子牙与朱一旦，两个八竿子不十竿子都打不着的人，就这么神奇地在我脑海里，完成了一次对话。如果思维存在奇点，将会坍陷于何处，苏格拉有没有底不重要，马老师们谁说得对同样不重要，甚至你看我这满纸荒唐言依然不重要，它仅仅表明我此时此刻在思考，我是一个活生生的人，所谓“我思故我在”，无非给枯燥的人生多一点无用的点缀罢了，你说朱一旦都不枯燥了，我们却还停留在这里，你说，还有比这个更枯燥的事情吗？申公豹形神俱灭，从头开始修行，居然连基因都发生了突变，大概，在这世间，没有什么可以永恒。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/posts/hsts-problem-solving-experience.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/hsts-problem-solving-experience.html" itemprop="url">记一次因 HSTS 导致跨域问题的经历</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-17T04:56:49+00:00">
                2020-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>Access to XMLHttpRequest at ‘<a target="_blank" rel="noopener" href="http://a.com/api">http://a.com/api</a>‘ from origin ‘<a target="_blank" rel="noopener" href="http://b.com/">http://b.com</a>‘ has been blocked by CORS policy: Response to preflight request doesn’t pass access control check: Redirect is not allowed for a preflight request.</p>
</blockquote>
<p>生产上多次出现上面这个奇怪的跨域问题，但神奇的是强刷新后或者使用无痕模式打开就正常了。<br />到底是哪里出了问题呢？本文将一探究竟。<br /></p>
<blockquote>
<p>本文首发于知乎：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/245511588">https://zhuanlan.zhihu.com/p/245511588</a></p>
</blockquote>
<p><a name="T7LWX"></a></p>
<h2 id="先说结论"><a href="#先说结论" class="headerlink" title="先说结论"></a>先说结论</h2><p>排查后发现，出现这个报错的原因是：<strong>之前使用过 HTTPS 访问页面，所以也请求了 HTTPS 协议的 API，然后 API 的域名被记录在 <code>HSTS</code> 列表中，之后使用 HTTP 访问页面，而 API 请求却被重定向到 HTTPS，而因为预检请求(OPTIONS)不能被重定向，所以导致出现 CORS 错误。</strong><br /><br><br />关于 CORS 更详细的介绍可以点击查看：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">HTTP 访问控制（CORS）</a><br /><br><br />总的来说原因在于前后端 HTTP 和 HTTPS 混用导致的，正常的情况下如果统一为 HTTP 或者 HTTPS 则不会出现这个问题。<br /><br><br />所以如果要开启 <code>HSTS</code> ，请确保前后端都开启，否则就会出现与本文一样的错误。<br /><br><br />那么前端页面要开启 HSTS 的话，需要做哪些操作呢？需要在 web 服务器添加响应头 ，以 Nginx 为例：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span> always;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />如果是其他 web 服务器，可以到参考<a target="_blank" rel="noopener" href="https://www.techbrown.com/configure-hsts-apache-nginx-iis-lighttpd-web-servers/">这里</a>。<br /><br><br />这里还要注意：<br /></p>
<ol>
<li>即便关掉 HSTS 也需要等到 max-age 过期才会从 HSTS 列表清除，所以除非让用户手动清除，否则这段时间内还是会被重定向到 HTTPS。</li>
<li>如果加了 includeSubDomains ，该网站的所有子域名都会被重定向到 HTTPS ，那会有什么影响呢？假设生产环境为 <a target="_blank" rel="noopener" href="http://a.com/">http://a.com</a>，而测试环境为 <a target="_blank" rel="noopener" href="http://test.a.com/">http://test.a.com</a>，当访问 <a target="_blank" rel="noopener" href="http://a.com/">http://a.com</a> 后，即便在测试环境没有 HTTPS 的情况下也会被重定向</li>
</ol>
<p><br />好了，说完结论，那下面来讲讲我是如何使用 Chrome 自带的网络记录工具定位到此问题的。<br /></p>
<p><a name="n8wDb"></a></p>
<h2 id="是缓存的问题？"><a href="#是缓存的问题？" class="headerlink" title="是缓存的问题？"></a>是缓存的问题？</h2><p>既然强刷新或者使用无痕模式是正常的，那么就很有可能是因为缓存导致，对比会出现跨域和正常的请求头，发现两者有很大不同：<br /><br><br />这是正常的 👇<br /></p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_1.png">这是出现跨域的 👇<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_2.png"><br />可以看出下面这个会出现跨域的请求少了很多内容，而猜测会不会是因为缺少 CORS 相关的部分请求头，所以导致跨域呢？<br /><br><br /><del>根据关键词「跨域 无痕模式」在搜索引擎找到这篇《</del><a target="_blank" rel="noopener" href="https://blog.techbridge.cc/2018/08/18/cors-issue/"><del>原來 CORS 沒有我想像中的簡單</del></a><del>》，其中说到是因为浏览器缓存的问题，使用 <code>crossorigin=&quot;anonymous&quot;</code> 让每次发出的请求带上 origin header， 但是这个属性只适用于 <code>&lt;img&gt;</code> 、 <code>&lt;script&gt;</code> 等，于是我去寻找在 axios 请求库对应的属性</del>，然并卵。<br /><br><br />那么有没有可能问题根本不是出在前端发送请求上呢？<br /></p>
<p><a name="8lHSO"></a></p>
<h2 id="使用-Chrome-排查网络问题"><a href="#使用-Chrome-排查网络问题" class="headerlink" title="使用 Chrome 排查网络问题"></a>使用 Chrome 排查网络问题</h2><p>既然这样，那就来看看浏览器发送请求的过程中到底发生了什么，于是我通过 chrome:&#x2F;&#x2F;net-export 记录会发生跨域的页面请求日志：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_3.png"><br />导出日志文件后，发现了一个很奇怪的点：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_4.png"><br />在上图可以看到，明明请求 HTTP 协议的 API，但是因为 <code>HSTS</code> ，将请求重定向到了 HTTPS 协议下。<br /><br><br />简单来说一下 <code>HSTS</code> 是什么：</p>
<blockquote>
<p>HTTP Strict Transport Security（通常简称为 HSTS）是一个安全功能，它告诉浏览器只能通过 HTTPS 访问当前资源，而不是 HTTP —— <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Security/HTTP_Strict_Transport_Security">MDN</a></p>
</blockquote>
<p><br />就是说如果浏览器发现该网站开启了 <code>HSTS</code> ，则会自动把所有请求重定向到 HTTPS 下。<br /><br><br />为了验证是不是因为这个原因，在无痕模式下也进行了一次记录，发现该日志下找不到 <code>HSTS</code> 的身影：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_5.png"><br />随后我又通过 Chrome 的 <code>HSTS</code> 设置页面进一步验证了两者的不同，打开 <a href="">chrome:&#x2F;&#x2F;net-internals&#x2F;#hsts</a> 查询发送跨域的请求域名：<br /><br><br />出现跨域的浏览器窗口 👇<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_6.png"><br />正常请求的浏览器窗口（无痕模式）👇<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/image_7.png"><br /></p>
<p><a name="CDmgs"></a></p>
<h2 id="都是-HSTS-惹的祸"><a href="#都是-HSTS-惹的祸" class="headerlink" title="都是 HSTS 惹的祸"></a>都是 HSTS 惹的祸</h2><p>没想到，竟然是因为 <code>HSTS</code> ，那为什么一个会有 <code>HSTS</code> 而另一个却没有呢？这时候我留意到出现跨域的页面使用的是 HTTP 访问，但其实是支持 HTTPS 的，所以我猜想会不会是：<strong>之前使用过 HTTPS 访问页面，所以也请求了 HTTPS 的 API，然后 API 的域名被记录在 <code>HSTS</code> 列表中，之后使用 HTTP 访问页面，而 API 请求却被重定向到 HTTPS，所以导致跨域？</strong><br /><br><br />为了验证上面的猜想，特地开了一个新的无痕模式，按照上面所说的步骤操作，完美复现跨域错误！<br /><br><br /><strong>更重要的是我在原本出现跨域的页面改为 HTTPS 访问，也正常请求了。</strong><br /></p>
<p><a name="7Nc9R"></a></p>
<h2 id="为什么会出现这种情况？"><a href="#为什么会出现这种情况？" class="headerlink" title="为什么会出现这种情况？"></a>为什么会出现这种情况？</h2><p>为什么请求 API 会被自动重定向到 HTTPS，而请求页面却不会呢？<br /><br><br />原来 <code>HSTS</code> 是根据响应头有没有 <code>strict-transport-security</code> 字段决定是否加入 <code>HSTS</code> 列表的，<strong>经排查发现前端页面的响应头是没有这个字段的，但 API 响应头却有</strong>。<br /><br><br />页面响应头：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20201017132900.png"><br><br />API 响应头：<br /><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20201017132926.png"><br><a name="3pm3v"></a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如果出现奇怪的网络请求问题，可以尝试使用 Chrome 自带的网络请求分析工具，说不定会有收获。<br /></p>
<p><a name="MB4GK"></a></p>
<h2 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h2><ul>
<li><a target="_blank" rel="noopener" href="https://support.google.com/chrome/a/answer/6271171?hl=zh-Hans">排查 Chrome 网络问题</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">HTTP 访问控制（CORS）</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Security/HTTP_Strict_Transport_Security">HTTP Strict Transport Security</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/6866942131777306631">浏览器跨域问题与服务器中的 CORS</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%9130%E5%B9%B4%E5%8F%98%E8%BF%81%E5%8F%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%9130%E5%B9%B4%E5%8F%98%E8%BF%81%E5%8F%B2/" itemprop="url">前端开发30年变迁史</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-16T13:53:49+00:00">
                2020-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <blockquote>
<p>缅怀司徒正美大神，愿天堂没有996！</p>
</blockquote>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%9130%E5%B9%B4%E5%8F%98%E8%BF%81%E5%8F%B2/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020-10-12-antifragile-book-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020-10-12-antifragile-book-summary/" itemprop="url">从不确定性中获益 - 读《反脆弱》</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-12T04:13:24+00:00">
                2020-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>最近读完了《反脆弱》一书，这是《黑天鹅》的作者塔勒布的又一本畅销书。</p>
<p>全书的内容比较啰嗦，核心讲的就是两个方面：<br>1、什么是反脆弱性<br>2、如何应对不确定性，并从中获得收益</p>
<h2 id="什么是反脆弱性"><a href="#什么是反脆弱性" class="headerlink" title="什么是反脆弱性"></a>什么是反脆弱性</h2><p>首先我们应该看到世界是不确定的，人们试图预测很多事情，但是最终发现，对世界产生巨大影响的事情，人们基本上都预测失败了（比如今年的新冠疫情）。这种不确定性一方面是由于世界本身是很难预测的，另一方面是极端事情发生的可能性并不低。</p>
<p>尼采说：“杀不死我的，只会让我更坚强”。作者的反脆弱性就是指这种现象。如果面对压力，有一些事物反而呈现出更好的自己，这类事物就是反脆弱的。</p>
<p>书中举了很多案例，我觉得最容易理解的案例就是：如果把体力消耗看成一种压力：</p>
<ul>
<li>如果我们面对高强度体力消耗，累死了，我们就是脆弱的。</li>
<li>如果我们面对高强度体力消耗，没累死，我们就是强韧的。</li>
<li>如果我们面对高强度体力消耗，变得更强壮了，我们就是反脆弱的。</li>
</ul>
<p>我还看到一个读者的比喻：</p>
<ul>
<li>一阵微风就可以吹灭蜡烛，蜡烛是脆弱的；</li>
<li>一阵风吹不灭所有的蜡烛，蜡烛就是强韧的；</li>
<li>一阵风反而助长了蜡烛的火焰，蜡烛就是反脆弱。</li>
</ul>
<p>书中还举了很多组织的反脆弱案例，比如国家或者社区的某一个个体的悲剧，使得整个群体关注到一些危险，从而使得整个群体变得更加安全和健康。</p>
<h2 id="如何应对不确定性"><a href="#如何应对不确定性" class="headerlink" title="如何应对不确定性"></a>如何应对不确定性</h2><p>作者推荐通过加强自己的反脆弱性来应对不确定性。我印象中的包括：</p>
<p>1、杠铃策略。把 90% 的投入到安全领域，把 10% 投入到损失很小，但是可以提高自己的反脆弱性的事情上。例如买保险，灾难可能使得你获得更多；例如培养自己的第二技能，万一失业还可以另谋生计。</p>
<p>又例如在股票市场上，买入股票的同时又买入看跌期权，这样万一股票大跌，你可以从看跌期权的对冲中锁定自己的损失。股票的期权权利金叫做 premium，这个单词本身就有保险的意思。</p>
<p>2、主动理性试错。做成功率虽然低，但是低风险高收益的事情。你要考虑的事情只有两件，一是万一失败是否致命，二是万一成功收益是否不成比例的多，如果同时符合这两点，这类事情就是多多益善，二者缺其一的事，则尽量少做，按照这样的做事策略，反脆弱性就会提高。</p>
<p>例如：加入一家早期的创业公司，就是符合这种策略的。因为加入一家创业公司收入和技能锻炼并不少，但是潜在的收益可能很高。</p>
<p>3、通过备份，即使一个备份丢失，你仍有别的备份可供使用。计算机系统上，我们就通常用线上从库 + Binary Log + 离线备份来实在数据的冗余备份。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>人们常说，不要把鸡蛋放在一个篮子里面，这其实就是一种避免风险的办法。《反脆弱》用更系统的方式介绍了生活中各种有趣的案例，教我们通过杠铃策略、主动理性试错、备份等方式来应对不确定性。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/74/">74</a><a class="extend next" rel="next" href="/page/21/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1464</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">910</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5358884258"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
