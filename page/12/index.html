<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="codeva-HZoIBm8yNp" />
<meta name="bytedance-verification-code" content="xa6iZeY+/XCOJvarHaDY" />








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Liunx Python Rust Goalng DevOPS" />










<meta name="description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:type" content="website">
<meta property="og:title" content="逐流小站">
<meta property="og:url" content="https://blog.feedscoin.com/page/12/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="个人随想，瞎子的世界. Linux Python Rust React Nextjs are my love.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="Liunx Python Rust Goalng DevOPS">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/page/12/"/>





  <title>逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/post/how-object-keys-work.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/how-object-keys-work.html" itemprop="url">一行 Object.keys() 引发的血案</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-12-05T16:00:00+00:00">
                2021-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="故事背景"><a href="#故事背景" class="headerlink" title="故事背景"></a>故事背景</h2><p>有一天上线后大佬在群里反馈了一个问题，他刚发的动态在生成分享卡片的时候，卡片底部的小程序码丢失了，然而其他小伙伴都表示在自己手机上运行正常。事实上大佬也说除了这条动态以外，其它都是正常的。</p>
<p>说明这个 BUG 需要特定的动态卡片 + 特定的设备才能复现，所幸坐我对面的小姐姐手机与大佬是同款，也能复现 BUG，避免了作为社恐的我要去找大佬借手机测试的尴尬。</p>
<p>先交代一下项目背景，这是一个微信小程序项目，其中生成分享卡片功能用到的是一个叫 <a target="_blank" rel="noopener" href="https://github.com/wg-front/wxml2canvas">wxml2canvas</a> 的库，然而该库目前看上去已经「年久失修」，上面所说的 BUG 就是因为这个库，本文主要对其进行「鞭尸」之余，顺便分享一下排查该 BUG 的过程、以及如何从 ECMAScript 规范中找到关于 <code>Object.keys()</code> 返回顺序的规范定义，最后介绍一下在 V8 引擎中是如何处理对象属性的。</p>
<p>希望大家在阅读本文后，不会再因为搞不懂  <code>Object.keys()</code> 输出的顺序而犯错导致产生莫名其妙的 BUG。</p>
<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><blockquote>
<p>浪费读者的时间是可耻的。———— 鲁迅</p>
</blockquote>
<p>本文很长，如果你不想阅读整篇文章，可以阅读这段摘要；如果你打算阅读整篇文章，那么你完全可以跳过本段。</p>
<p>如果阅读摘要时未能帮助你理解，可以跳转到对应章节进行详细阅读。</p>
<p>摘要：</p>
<ol>
<li>这个 BUG 是如何产生的？</li>
</ol>
<ul>
<li><code>wxml2canvas</code> 在绘制的时候，会根据一个叫做 <code>sorted</code> 的对象对它的 keys 进行遍历，该对象的 key 为节点的 top 值，value 为节点元素；问题就是出在这里，该库作者误以为 <code>Object.keys()</code> 总是会按照实际创建属性的顺序返回，<strong>然而当 key 为正整数的时候</strong>，返回顺序就不符合原本的预期了，会出现了绘制顺序错乱，从而导致这个 BUG 的产生。</li>
<li>源码：<a target="_blank" rel="noopener" href="https://github.com/wg-front/wxml2canvas/blob/master/src/index.js#L1146">src&#x2F;index.js#L1146</a> 和 <a target="_blank" rel="noopener" href="https://github.com/wg-front/wxml2canvas/blob/master/src/index.js#L829">src&#x2F;index.js#L829</a></li>
</ul>
<ol start="2">
<li>如何解决这个 BUG</li>
</ol>
<ul>
<li>由于对象的 key 是一个数字，那么 key 有可能会是整数，也有可能是浮点数。但是预期行为是希望  <code>Object.keys()</code> 按照属性实际创建的顺序返回，那只要将所有 key 都强制转换为浮点数就好了。</li>
</ul>
<ol start="3">
<li><code>Object.keys()</code> 是按照什么顺序返回值的？</li>
</ol>
<ul>
<li><code>Object.keys()</code> 返回顺序与遍历对象属性时的顺序一样，调用的是 <code>[[OwnPropertyKeys]]()</code> 内部方法。</li>
<li>根据 <a target="_blank" rel="noopener" href="https://262.ecma-international.org/6.0/#sec-ordinary-object-internal-methods-and-internal-slots-ownpropertykeys">ECMAScript 规范</a>，在输出 keys 时会<strong>先将所有 key 为数组索引类型（正整数）从小到大的顺序排序，然后将所有字符串类型（包括负数、浮点数）的 key 按照实际创建的顺序来排序</strong>。</li>
</ul>
<ol start="4">
<li>V8 内部是如何处理对象属性的？</li>
</ol>
<ul>
<li>V8 在存储对象属性时，为了提高访问效率，会分为<strong>常规属性(properties)</strong> 和 <strong>排序属性(elements)</strong><ul>
<li><strong>排序属性(elements)</strong> ，就是数组索引类型的属性（也就是正整数类型）。</li>
<li><strong>常规属性(properties)</strong> ，就是字符串类型的属性（也包括负数、浮点数）。</li>
<li>以上两种属性都会存放在线性结构中，称为<strong>快属性</strong>。</li>
<li>然而这样每次查询都有一个间接层，会影响效率，所以 V8 引入<strong>对象内属性(in-object-properties)</strong>  。</li>
</ul>
</li>
<li>V8 会为每一个对象关联一个隐藏类，用于记录该对象的形状，相同形状的对象会共用同一个隐藏类。<ul>
<li>当对象添加、删除属性的时候，会创建一个新的对应的<strong>隐藏类</strong>，并重新关联。</li>
</ul>
</li>
<li><strong>对象内属性</strong>会将部分<strong>常规属性</strong>直接放在对象第一层，所以它访问效率是最高的。<ul>
<li>当<strong>常规属性</strong>的数量<strong>少于对象初始化时的属性数量</strong>时，<strong>常规属性</strong>会直接作为<strong>对象内属性</strong>存放。</li>
</ul>
</li>
<li>虽然<strong>快属性</strong>访问速度快，但是从线性结构中添加或删除时执行效率会非常低，因此如果属性特别多、或出现添加和删除属性时，就会将<strong>常规属性</strong>从线性存储改为字典存储，这就是<strong>慢属性</strong>。</li>
</ul>
<p>可以看一下这两张图帮助理解：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/object-keys.jpeg"></p>
<p style="text-align:center;">V8 常规属性和排序属性</p>

<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/v8-object-keys.jpeg"></p>
<p style="text-align:center;">V8 对象内属性、快属性和慢属性</p>
<p style="text-align:center;"><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100048001">图片出处：《图解 Google V8》 —— 极客时间</a></p>

<h2 id="如何解决该-BUG"><a href="#如何解决该-BUG" class="headerlink" title="如何解决该 BUG"></a>如何解决该 BUG</h2><p>由于是特定的动态 + 特定的设备才能复现问题，可以很轻易地排除掉网络原因，通过在 <code>wxml2canvas</code> 输出绘制的节点列表，也能看到小程序码相关的节点。</p>
<p>既然 <code>wxml2canvas</code> 已经接收到小程序码的节点，却没有绘制出来，那么问题自然就出在 <code>wxml2canvas</code>  内部，不过已经见怪不怪了，在我加入项目以后就已经多次因为这操蛋的 <code>wxml2canvas</code> 出现各种问题而搞得头皮发麻，有机会一定要替换掉这个库，但由于已经有很多页面在依赖这个库，现在也只能硬着头皮上。</p>
<p>首先怀疑是小程序码节点的坐标位置不太对，通过对比，发现位置相差不大，排除该原因。</p>
<p>然后对比所有节点的绘制顺序，发现了一个不太寻常的点，在复现 BUG 的手机上，绘制小程序码节点的时机是比较靠前的，但由于它在卡片底部，所以在正常情况下，应该是比较靠后才对。</p>
<p>于是通过查看相关代码，果然发现了其中的玄机：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/WechatIMG100.jpeg"></p>
<p>在绘制的时候，通过遍历 <code>sorted</code> 对象，从上往下、从左到右依次绘制，但是通过对比两台手机的 <code>Object.keys()</code>，发现了它们的输出是不一样的，这时候我就明白怎么回事了。</p>
<p>先来说说这个 <code>sorted</code> 对象，它是一个 key 为节点 top 值，value 为所有相同 top 值（同一行）的元素数组。</p>
<p>下面是生成它的代码：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/Snipaste_2021-12-08_00-07-16.png"></p>
<p>问题就发生在前面所说的 <code>Object.keys()</code> 这里，我们先来看个 🌰：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sorted = &#123;&#125;</span><br><span class="line"></span><br><span class="line">sorted[<span class="number">300</span>] = &#123;&#125;</span><br><span class="line">sorted[<span class="number">200</span>] = &#123;&#125;</span><br><span class="line">sorted[<span class="number">100</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(sorted)) <span class="comment">// 输出什么呢？</span></span><br></pre></td></tr></table></figure>

<p>相信大部分同学都知道答案是：[‘100’, ‘200’, ‘300’]。</p>
<p>如果在有浮点数的情况呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sorted = &#123;&#125;</span><br><span class="line"></span><br><span class="line">sorted[<span class="number">300</span>] = &#123;&#125;</span><br><span class="line">sorted[<span class="number">100</span>] = &#123;&#125;</span><br><span class="line">sorted[<span class="number">200</span>] = &#123;&#125;</span><br><span class="line">sorted[<span class="number">50.5</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(sorted)) <span class="comment">// 这次又输出什么呢？</span></span><br></pre></td></tr></table></figure>

<p>会不会有同学以为答案是：[‘50.5’, ‘100’, ‘200’, ‘300’] 呢？</p>
<p>但正确的答案应该是：[‘100’, ‘200’, ‘300’,’50.5’]。</p>
<p>所以我合理地猜测 <code>wxml2canvas</code> 的作者就是犯了这样的错误，他可能以为 <code>Object.keys</code>  会根据 key 从小到大的顺序返回，因此满足从上往下绘制的逻辑。但是他却没有考虑浮点数的情况，所以当某个节点 top 值为整数的时候，会比其他 top 值为浮点数的节点更早地绘制，导致绘制后面的节点时覆盖了前面的节点。</p>
<p>于是，当我把代码改成这样后，分享卡片的小程序码就正常绘制出来了：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  Object</span><br><span class="line">  .keys(sorted)</span><br><span class="line"><span class="addition">+ .sort((a, b)=&gt; a - b)</span></span><br><span class="line">  .forEach((top, topIndex) =&gt; &#123;</span><br><span class="line">    //  do something</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>OK，搞定收工。</p>
<p><strong>测试小姐姐</strong>：慢着！影响到其它地方了。</p>
<p>我一看，果然。于是再次经过对比，发现原来大部分情况下，top 值都会是浮点数，而本次出 BUG 的卡片小程序码只是非常凑巧地为整数，导致绘制顺序不对。</p>
<p>我才发现 <code>wxml2canvas</code> 原本的逻辑是想根据 <code>sorted</code> 创建的顺序来绘制，但是没有考虑 key 为整数的情况。</p>
<p>所以，最后这样修改解决问题：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">_sortListByTop (list = []) &#123;</span><br><span class="line">    let sorted = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    // 粗略地认为2px相差的元素在同一行</span><br><span class="line">    list.forEach((item, index) =&gt; &#123;</span><br><span class="line"><span class="deletion">-       let top = item.top;</span></span><br><span class="line"><span class="addition">+       let top = item.top.toFixed(6); // 强制添加小数点，将整数转为浮点数</span></span><br><span class="line">        if (!sorted[top]) &#123;</span><br><span class="line">            if (sorted[top - 2]) &#123;</span><br><span class="line">                top = top - 2;</span><br><span class="line">            &#125;else if (sorted[top - 1]) &#123;</span><br><span class="line">                top = top - 1;</span><br><span class="line">            &#125; else if (sorted[top + 1]) &#123;</span><br><span class="line">                top = top + 1;</span><br><span class="line">            &#125; else if (sorted[top + 2]) &#123;</span><br><span class="line">                top = top + 2;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                sorted[top] = [];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sorted[top].push(item);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return sorted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很显然，是因为 <code>wxml2canvas</code> 作者对 <code>Object.keys()</code> 返回顺序的机制不了解，才导致出现这样的 BUG。</p>
<p>不知道是否也有同学犯过同样的错误，为避免再次出现这样的情况，非常有必要深入、全面地介绍一下 <code>Object.keys()</code> 的执行机制。 </p>
<p>所以接下来就跟随我一探究竟吧。</p>
<h2 id="深入理解-Object-keys"><a href="#深入理解-Object-keys" class="headerlink" title="深入理解 Object.keys()"></a>深入理解 Object.keys()</h2><p>可能会有同学说： <code>Object.keys()</code> 又不是什么新出的 API， Google 一下不就行了，何必大费周章写一篇文章来介绍呢？</p>
<p>的确通过搜索引擎可以很快就能知道 <code>Object.keys()</code> 的返回顺序是怎样的，但是很多都只流于表面，甚至我还见过这样片面的回答：数字排前面，字符串排后面。</p>
<p>所以这次我想试着追本溯源，通过第一手资料来获取信息，轻易相信口口相传得来的信息，都极有可能是片面的、甚至是错误的。</p>
<p>PS：其实不光技术，我们在对待其它不了解的事物都应保持同样的态度。 </p>
<p>我们先来看看在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">MDN</a> 上关于 <code>Object.keys()</code> 的描述：</p>
<blockquote>
<p><code>Object.keys()</code> 方法会返回一个由一个给定对象的自身可枚举属性组成的数组，数组中属性名的排列顺序和正常循环遍历该对象时返回的顺序一致 。</p>
</blockquote>
<p>emmm… 并没有直接告诉我们输出顺序是什么，不过我们可以看看上面的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/keys#polyfill">Polyfill</a> 是怎么写的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title class_">Object</span>.<span class="property">keys</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="property">keys</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hasOwnProperty = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>,</span><br><span class="line">        hasDontEnumBug = !(&#123;<span class="attr">toString</span>: <span class="literal">null</span>&#125;).<span class="title function_">propertyIsEnumerable</span>(<span class="string">&#x27;toString&#x27;</span>),</span><br><span class="line">        dontEnums = [</span><br><span class="line">          <span class="string">&#x27;toString&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;toLocaleString&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;valueOf&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;hasOwnProperty&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;isPrototypeOf&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;propertyIsEnumerable&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;constructor&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        dontEnumsLength = dontEnums.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> obj !== <span class="string">&#x27;function&#x27;</span> || obj === <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Object.keys called on non-object&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> result = [];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasOwnProperty.<span class="title function_">call</span>(obj, prop)) result.<span class="title function_">push</span>(prop);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (hasDontEnumBug) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; dontEnumsLength; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (hasOwnProperty.<span class="title function_">call</span>(obj, dontEnums[i])) result.<span class="title function_">push</span>(dontEnums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>其实就是利用 <code>for...in</code> 来进行遍历，接下来我们可以再看看关于 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...in">for…in</a> 的文档，然而里面也没有告诉我们顺序是怎样的。</p>
<p>既然 MDN 上没有，那我们可以直接看 ECMAScript 规范，通常 MDN 上都会附上关于这个 API 的规范链接，我们直接点开最新（Living Standard）的那个，下面是关于 Object.keys 的<a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-object.keys">规范定义</a>：</p>
<blockquote>
<p>When the keys function is called with argument <em>O</em>, the following steps are taken:</p>
<ol>
<li>Let <em>obj</em> be ? <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-toobject">ToObject</a>(<em>O</em>).</li>
<li>Let <em>nameList</em> be ? <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-enumerableownpropertynames">EnumerableOwnPropertyNames</a>(<em>obj</em>, key).</li>
<li>Return <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a>(<em>nameList</em>).</li>
</ol>
</blockquote>
<p>对象属性列表是通过 <code> EnumerableOwnPropertyNames</code> 获取的，这是它的<a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-enumerableownpropertynames">规范定义</a>：</p>
<blockquote>
<p>The abstract operation EnumerableOwnPropertyNames takes arguments O (an Object) and kind (key, value, or key+value). It performs the following steps when called:</p>
<ol>
<li><p>Let ownKeys be ? O.<a href="">[OwnPropertyKeys]</a>.</p>
</li>
<li><p>Let properties be a new empty List.</p>
</li>
<li><p>For each element key of ownKeys, do<br> a. If Type(key) is String, then</p>
<ol>
<li>Let desc be ? O.<a href="key">[GetOwnProperty]</a>.</li>
<li>If desc is not undefined and desc.[[Enumerable]] is true, then<br> a. If kind is key, append key to properties.<br> b. Else,<ol>
<li>Let value be ? Get(O, key).</li>
<li>If kind is value, append value to properties.</li>
<li>Else<br> i. Assert: kind is key+value.<br> ii. Let entry be ! CreateArrayFromList(« key, value »).<br> iii. Append entry to properties.</li>
</ol>
</li>
</ol>
</li>
<li><p>Return properties.</p>
</li>
</ol>
</blockquote>
<p><strong>敲黑板！</strong> 这里有个细节，请同学们多留意，后面会考。</p>
<p>我们接着探索，<code>OwnPropertyKeys</code> 最终返回的 <code>OrdinaryOwnPropertyKeys</code>：</p>
<blockquote>
<p>The [[OwnPropertyKeys]] internal method of an ordinary object O takes no arguments. It performs the following steps when called:</p>
<ol>
<li>Return ! <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-ordinaryownpropertykeys">OrdinaryOwnPropertyKeys(O)</a>.</li>
</ol>
</blockquote>
<p>重头戏来了，关于 keys 如何排序就在 <code>OrdinaryOwnPropertyKeys</code> 的<a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-ordinaryownpropertykeys">定义</a>中：</p>
<blockquote>
<p>The abstract operation OrdinaryOwnPropertyKeys takes argument O (an Object). It performs the following steps when called:</p>
<ol>
<li>Let keys be a new empty List.</li>
<li>For each own property key P of O such that P is an array index, in ascending numeric index order, do<br> a. Add P as the last element of keys.</li>
<li>For each own property key P of O such that Type(P) is String and P is not an array index, in ascending chronological order of property creation, do<br> a. Add P as the last element of keys.</li>
<li>For each own property key P of O such that Type(P) is Symbol, in ascending chronological order of property creation, do<br> a. Add P as the last element of keys.</li>
<li>Return keys.</li>
</ol>
</blockquote>
<p>到这里，我们已经知道我们想要的答案，这里总结一下：</p>
<ol>
<li>创建一个空的列表用于存放 keys</li>
<li>将所有<strong>合法的数组索引</strong>按升序的顺序存入</li>
<li>将所有<strong>字符串类型索引</strong>按属性创建时间以升序的顺序存入</li>
<li>将所有 <strong><code>Symbol</code> 类型索引</strong>按属性创建时间以升序的顺序存入</li>
<li>返回 keys</li>
</ol>
<p>这里顺便也纠正一个普遍的误区：有些回答说将所有属性为数字类型的 key 从小到大排序，其实不然，还必须要符合<strong>「合法的数组索引」</strong>，也即只有<strong>正整数</strong>才行，负数或者浮点数，一律当做字符串处理。</p>
<p>PS：严格来说对象属性没有数字类型的，无论是数字还是字符串，都会被当做字符串来处理。</p>
<p>我们结合上面的规范，来思考一下下面这段代码会输出什么：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> testObj = &#123;&#125;</span><br><span class="line"></span><br><span class="line">testObj[-<span class="number">1</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="number">1</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="number">1.1</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="string">&#x27;2&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="string">&#x27;c&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="string">&#x27;b&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="title class_">Symbol</span>(<span class="number">1</span>)] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="title class_">Symbol</span>(<span class="string">&#x27;a&#x27;</span>)] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="title class_">Symbol</span>(<span class="string">&#x27;b&#x27;</span>)] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">testObj[<span class="string">&#x27;d&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(testObj))</span><br></pre></td></tr></table></figure>

<p>请认真思考后，在这里核对你的答案是否正确：</p>
<details>
  <summary>查看结果</summary>
  
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span>&#x27;<span class="number">1</span>&#x27;<span class="punctuation">,</span> &#x27;<span class="number">2</span>&#x27;<span class="punctuation">,</span> &#x27;<span class="number">-1</span>&#x27;<span class="punctuation">,</span> &#x27;<span class="number">1.1</span>&#x27;<span class="punctuation">,</span> &#x27;c&#x27;<span class="punctuation">,</span> &#x27;b&#x27;<span class="punctuation">,</span> &#x27;a&#x27;<span class="punctuation">,</span> &#x27;d&#x27;<span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>  是否与你想象的一致？你可能会奇怪为什么没有 <code>Symbol</code> 类型。</p>
<p>  还记得前面敲黑板让同学们留意的地方吗，因为在 <code>EnumerableOwnPropertyNames</code> 的规范中规定了返回值只应包含字符串属性（上面说了数字其实也是字符串）。</p>
<p>  所以 Symbol 属性是不会被返回的，可以看 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">MDN</a> 上关于 <code>Object.getOwnPropertyNames()</code> 的描述。</p>
<p>  如果要返回 Symbol 属性可以用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols()</a>。</p>
</details>



<p>看完 ECMAScript 的规范定义，相信你不会再搞错 <code>Object.keys()</code> 的输出顺序了。但是你好奇 V8 是如何处理对象属性的吗，下一节我们就来讲讲。</p>
<h2 id="V8-是如何处理对象属性的"><a href="#V8-是如何处理对象属性的" class="headerlink" title="V8 是如何处理对象属性的"></a>V8 是如何处理对象属性的</h2><p>在 V8 的官方博客上有一篇文章<a target="_blank" rel="noopener" href="https://v8.dev/blog/fast-properties">《Fast properties in V8》</a>（<a target="_blank" rel="noopener" href="https://blog.crimx.com/2018/11/25/v8-fast-properties/">中译版</a>），非常详细地向我们解释了 V8 内部如何处理 JavaScript 的对象属性，强烈推荐阅读。</p>
<p>另外再推荐一下极客时间上的课程《<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100048001">图解 Google V8</a>》（毕竟本文借用了里面的图片，怎么好意思不推荐）。</p>
<p>本节内容主要参考这两个地方，下面我们来总结一下。</p>
<p>首先，V8 为了提高对象属性的访问效率，将属性分为两种类型：</p>
<ul>
<li><p><strong>排序属性(elements)</strong> ，就是符合数组索引类型的属性（也就是正整数）。</p>
</li>
<li><p><strong>常规属性(properties)</strong> ，就是字符串类型的属性（也包括负数、浮点数）。</p>
</li>
</ul>
<p>所有的<strong>排序属性</strong>都会存放在一个线性结构中，线性结构的特点就是支持通过索引随机访问，所以能加快访问速度，对于存放在线性结构的属性都称为<strong>快属性</strong>。</p>
<p><strong>常规属性</strong>也会存放在另一个线性结构中，可以看下面这张图帮助理解：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/object-keys.jpeg" alt="img"></p>
<p style="text-align:center;">V8 排序属性和常规属性</p>

<p>但是<strong>常规属性</strong>还需要做一些额外的处理，这里我们要先介绍一下什么是<strong>隐藏类</strong>。</p>
<p>由于 JavaScript 在运行时是可以修改对象属性的，所以在查询的时候会比较慢，可以看回上面那张图，每次访问一个属性的时候都需要经过多一层的访问，而像 C++ 这类静态语言在声明对象之前需要定义这个对象的结构（形状），经过编译后每个对象的形状都是固定的，所以在访问的时候由于知道了属性的偏移量，自然就会比较快。</p>
<p>V8 采用的思路就是将这种机制应用在 JavaScript 对象中，所以引入了<strong>隐藏类</strong>的机制，你可以简单的理解<strong>隐藏类</strong>就是描述这个对象的形状、包括每个属性对应的位置，这样查询的时候就会快很多。</p>
<p>关于<strong>隐藏类</strong>还有几点要补充：</p>
<ol>
<li>对象的第一个字段指向它的<strong>隐藏类</strong>。</li>
<li>如果两个对象的形状是完全相同的，会共用同一个<strong>隐藏类</strong>。</li>
<li>当对象添加、删除属性的时候，会创建一个新的对应的<strong>隐藏类</strong>，并重新指向它。</li>
<li>V8 有一个转换树的机制来创建隐藏类，不过本文不赘述，有兴趣可以看<a target="_blank" rel="noopener" href="https://v8.dev/blog/fast-properties#hiddenclasses-and-descriptorarrays">这里</a>。</li>
</ol>
<p>解释完隐藏类，我们再回头来讲讲<strong>常规属性</strong>，通过上面那张图我们很容易发现一个问题，那就是每次访问一个属性的时候，都需要经过一个间接层才能访问，这无疑降低了访问效率，为了解决这个问题，V8 又引入了一个叫做<strong>对象内属性</strong>，顾名思义，它会将某些属性直接存放在对象的第一层里，它的访问是最快的，如下图所示：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/%E4%B8%8B%E8%BD%BD.jpeg"></p>
<p style="text-align:center;">V8 对象内属性</p>

<p>但要注意，<strong>对象内属性</strong>只存放<strong>常规属性</strong>，排序属性依旧不变。而且需要常规属性的数量<strong>小于</strong>某个数量的时候才会直接存放<strong>对象内属性</strong>，那这个数量是多少呢？</p>
<p>答案是取决于<strong>对象初始化时的大小</strong>。</p>
<p>PS：有些文章说是少于 10 个属性时才会存放对象内属性，<strong>别被误导了</strong>。</p>
<p>除了<strong>对象内属性</strong>、<strong>快属性</strong>以外，还有一个<strong>慢属性</strong>。</p>
<p>为什么会有<strong>慢属性</strong>呢？<strong>快属性</strong>虽然访问很快，但是如果要从对象中添加或删除大量属性，则可能会产生大量时间和内存开销来维护<strong>隐藏类</strong>，所以在<strong>属性过多或者反复添加、删除属性时</strong>会将<strong>常规属性</strong>的存储方式从线性结构变成字典，也就是降级到<strong>慢属性</strong>，而由于<strong>慢属性</strong>的信息不会再存放在<strong>隐藏类</strong>中，所以它的访问会比<strong>快属性</strong>要慢，但是可以高效地添加和删除属性。可以通过下图帮助理解：</p>
<p><img src="https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/v8-object-keys.jpeg" alt="img"></p>
<p style="text-align:center;">V8 慢属性</p>

<p>写到这里，我觉得自己对 V8 的快属性、慢属性这些知识已经非常了解，简直要牛逼到上天了。</p>
<p>但当我看到这段代码的时候：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toFastProperties</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="comment">/*jshint -W027*/</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    f.<span class="property"><span class="keyword">prototype</span></span> = obj;</span><br><span class="line">    <span class="title function_">ASSERT</span>(<span class="string">&quot;%HasFastProperties&quot;</span>, <span class="literal">true</span>, obj);</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">    <span class="built_in">eval</span>(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我的心情是这样的：</p>
<img src="https://ozinparis.com/wp-content/uploads/2016/04/jon-snow-know-nothing-e1461048094110-1.jpg" style="text-align: left; margin-left: 0;" />

<p>关于这段代码是如何能让 V8 使用对象<strong>快属性</strong>的可以看这篇文章：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25069272">开启 V8 对象属性的“fast”模式</a>。</p>
<p>另外也可以看一下这段代码：<a target="_blank" rel="noopener" href="https://github.com/sindresorhus/to-fast-properties/blob/main/index.js">to-fast-properties&#x2F;index.js</a>。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>当在开发时遇到一个简单的错误，通常可以很快地利用搜索引擎解决问题，但如果只是面向 Google 编程，可能在技术上很难会有进步，所以我们不光要能解决问题，还要理解这个产生问题的背后的原因到底是什么，也就是知其然更知其所以然。</p>
<p>真的非常建议每个 JavaScript 开发者都应该去了解一些关于 V8 或其它 JavaScript 引擎的知识，无论你是通过什么途径（真的没有打广告），这样能保证我们在编写 JavaScript 代码时出现问题可以更加地得心应手。</p>
<p>最后，本文篇幅有限，部分细节难免会有遗漏，非常建议有兴趣深入了解的同学可以延伸阅读下面的列表。</p>
<p>感谢阅读。</p>
<h2 id="延伸阅读"><a href="#延伸阅读" class="headerlink" title="延伸阅读"></a>延伸阅读</h2><ul>
<li><a target="_blank" rel="noopener" href="https://v8.dev/blog/fast-properties">Fast properties in V8</a><ul>
<li><a target="_blank" rel="noopener" href="https://blog.crimx.com/2018/11/25/v8-fast-properties/">中译版</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100048001">《图解 Google V8》 —— 极客时间</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.dashlane.com/how-is-data-stored-in-v8-js-engine-memory/">How is data stored in V8 JS engine memory?</a></li>
<li><a target="_blank" rel="noopener" href="https://z3rog.tech/blog/2020/fast-properties.html">V8 中的快慢属性与快慢数组</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25069272">开启 V8 对象属性的“fast”模式</a></li>
<li><a target="_blank" rel="noopener" href="https://262.ecma-international.org/6.0/">ECMAScript® 2015 Language Specification</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5525795/does-javascript-guarantee-object-property-order">Does JavaScript guarantee object property order? —— stackoverflow</a></li>
</ul>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-12-4-notion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-12-4-notion/" itemprop="url">将网页内容保存到 Notion 的两个浏览器插件</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-12-04T12:46:00+00:00">
                2021-12-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>文&#x2F;彭宏豪，本文首发于我的公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/bdtVoL6dh4Vtru4eE1Tfxg">效率工具指南</a>」      </p>
<p>Hello 各位好。   </p>
<p>之前一篇文章介绍过一款<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649918192&idx=1&sn=d2e4083599d625b419abf62e97af9dee&chksm=83a88eddb4df07cb914cd71bad11816bb2fe02b393e7e01dbc0a93d32bd823e0691613a84e1a&token=2008602560&lang=zh_CN#rd">剪藏工具 Cubox</a>，可以很方便地保存公众号文章或网页内容，但这款工具有个不足的地方：收藏超过 200 篇内容，就需要开通会员。   </p>
<p>除了充钱，Cubox 还有一个不太令我满意的地方，它与我正在使用的 Notion 是两个独立的软件，收藏与记录的东西不能放在同个软件，搜索东西比较麻烦。   </p>
<p>基于此，我找到了 2 个可以将网页内容保存到 Notion 的工具，让收藏的内容也能汇总到 Notion，方便后续的检索。   </p>
<h2 id="Notion-Pro-Clipper"><a href="#Notion-Pro-Clipper" class="headerlink" title="Notion Pro Clipper"></a>Notion Pro Clipper</h2><p>Notion Pro Clipper，是一个第三方的 Notion 剪藏插件，比 Notion 官方的剪藏插件好用太多。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/12/04/16386117880556.jpg"></p>
<p>插件支持 Chrome 和火狐浏览器，安装插件并授权账号后，点击右上角的插件按钮，弹出的面板如下。</p>
<p>它支持 4 种剪藏方式：网页链接、整个页面、选中的区域以及截图，其中截图还细分为 3 种——区域截图、可视区域和整个页面。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/12/04/16386188357978.jpg"></p>
<p>将内容保存到 Notion 后，最好在 Notion 中预览一下剪藏后的内容，因为可能会出现部分图片丢失的情况。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/12/04/16386200557700.jpg"></p>
<p>这里着重说一下，使用插件保存公众号文章，如果想将原文保存到 Notion，需要选择 <strong>Section</strong>。</p>
<p>如果你选 Full page，它还是会和 Notion 官方的剪藏插件一样，把文章链接而非原文保存到 Notion，后续公众号原文被删除，即便保存了链接也是徒劳。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/12/04/16386195621906.jpg"></p>
<p>Notion Pro Clipper 官网：<br><em><a target="_blank" rel="noopener" href="https://notionproclipper.com/">https://notionproclipper.com/</a></em></p>
<h2 id="简悦"><a href="#简悦" class="headerlink" title="简悦"></a>简悦</h2><p>除了前面的插件，这里还有另外一个可供选择的插件——<strong>简悦</strong>。  </p>
<p>安装插件后，回到想剪藏到 Notion 的页面，右击鼠标，选择「简悦 &gt;&gt; 阅读模式」。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/12/04/16386203296574.jpg"></p>
<p>进入阅读模式后，点击右下方的「…」按钮，切换到「动作」面板，往下滑动面板，可以看到：</p>
<p>简悦支持将网页内容保存到多个平台或软件，这里我们选择「保存到 Notion」即可。</p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/12/04/16386204414841.jpg"></p>
<p>不更改简悦默认设置的情况下，它会将网页内容保存到 Notion 左侧栏最上方的页面。   </p>
<p>如果你想更改保存的位置，可以打开简悦的设置页面，切换到「服务」选项卡，找到刚刚授权的 Notion，将默认页面更改为其他 Notion 页面。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/12/04/16386208499081.jpg"></p>
<p>简悦官网：<br><em><a target="_blank" rel="noopener" href="http://ksria.com/simpread/">http://ksria.com/simpread/</a></em>   </p>
<p>相比前面介绍的 Notion Pro Clipper，简悦插件的功能更为强大。 </p>
<p>简悦插件还支持将 Notion 中存放的内容导出为 Markdown 文件，解决 Notion 自带导出功能图片丢失的问题，详细操作可参考之前发布的一篇文章：   </p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649912854&idx=1&sn=79f16a62d1543a9739b61b92e34effc1&chksm=83a8723bb4dffb2d221e856614b778b102e354c6ca0aa24d691656703ef52f89442ab357517a&token=2008602560&lang=zh_CN#rd">Notion客户端不好看？手把手教你把它变好看。</a>    </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">       </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021/61-%E7%88%B1%E5%BE%88%E7%BE%8E%E5%91%B3%E6%9C%89%E7%82%B9%E6%84%8F%E6%80%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/61-%E7%88%B1%E5%BE%88%E7%BE%8E%E5%91%B3%E6%9C%89%E7%82%B9%E6%84%8F%E6%80%9D/" itemprop="url">《爱很美味》有点意思</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-12-02T15:00:00+00:00">
                2021-12-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%A7%82%E7%82%B9/" itemprop="url" rel="index">
                    <span itemprop="name">观点</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p><img src="https://cos.pinlyu.com/posts/2021/61-aihenmeiwei.webp#550x"></p>
<p>上周开播的鹅厂网剧《爱很美味》没有流量明星带来的粉黑大战，也少了平台给予的宣发支持，加上剧名一看之下会以为是俗套的甜宠剧，导致播放量目前来看并不如人意。不过短短一周时间，在没什么特别的营销情况下，在豆瓣上的评分从8.1上升到了8.3。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2021/61-%E7%88%B1%E5%BE%88%E7%BE%8E%E5%91%B3%E6%9C%89%E7%82%B9%E6%84%8F%E6%80%9D/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%9B%E6%9E%97%E6%8E%A2%E9%99%A9%E7%B3%BB%E5%88%97%E4%B9%8B-Redis-%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%9B%E6%9E%97%E6%8E%A2%E9%99%A9%E7%B3%BB%E5%88%97%E4%B9%8B-Redis-%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/" itemprop="url">分布式丛林探险系列之 Redis 集群模式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-12-01T01:58:59+00:00">
                2021-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>时间终于来到了十二月，据说，<a target="_blank" rel="noopener" href="https://movie.douban.com/subject/34801038/">《黑客帝国 4：矩阵重生》</a> 将于本月在北美上映，正如同它的片名一样，黑客帝国系列在沉寂了十八年后，终于等来了一次矩阵重生的机会，不可不谓“有生之年”、“爷青回”。提及黑客帝国系列，这是一部公认的、具有划时代意义的科幻电影，除了精彩绝伦的打斗特效，最为影迷所津津乐道的，当属对于人和机器的关系这种颇具哲学意味的问题的探讨。在第二部中，The One 的部分代码被融合到了 Smith 身上，而这使得 Smith 发生变异，成为了可以自我复制的病毒。于是，我们在这里看到了 Neo 和 100 个 Smith 打斗的桥段，类似的桥段还有第三部里的雨中决斗。这些桥段或多或少地影响到了后来的电影，譬如，星爷的 <a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1291543/">《功夫》</a> 里，阿星与斧头帮、火云邪神打斗的片段；吴京的第一部电影 <a target="_blank" rel="noopener" href="https://movie.douban.com/subject/3082452/">《狼牙》</a> 里，阿布雨夜大战黑衣人的片段等等。虽然，病毒的自我复制和分布式系统中的复制，是两个完全不同的概念，可当我们试图将电影和现实联系起来的时候，我们还是会不免会心一笑，因为 100 个 Smith ，大概就相当于一个 Smith 的集群；而吞噬了先知能力的 Smith ，大概就相当于这个集群中的 Leader。我们注意到，强如超人般的 Neo，一样架不住越来越多的 Smith ，最后不得不飞走，所谓：“双拳难敌四手”，这足以说明集群的重要性。好了，既然这里聊到了集群，那么我们这次来聊聊 Redis 中的集群模式。</p>
<h1 id="Redis-集群概述"><a href="#Redis-集群概述" class="headerlink" title="Redis 集群概述"></a>Redis 集群概述</h1><p>通过上一篇<a href="/posts/1748863652/">文章</a>，我们了解到，主从复制的作用主要体现在数据冗余、故障恢复、负载均衡等方面。可很多时候，我们讲分布式，并不是说简单的复制就好啦！相信大家都听说过，水平扩展和垂直扩展这两个概念，特别是数据库的水平扩展，它天然地和分片(Sharding)联系在一起，这意味是我们希望在不同地数据库&#x2F;表里存储不同地数据。此前，博主曾在 <a target="_blank" rel="noopener" href="https://blog.yuanpei.me/posts/2151871792/">《浅议 EF Core 分库分表及多租户架构的实现》</a> 一文里介绍过数据库的分库&#x2F;表，作为类比，我们可以归纳出 Redis 集群模式的第一个特点，即：<strong>它本质上是一种服务器 Sharding 技术</strong>。因为纯粹的主从复制意味着，每台 Redis 服务器都存储相同的数据，显然这造成了资源的浪费，而让每台 Redis 服务器存储不同的数据，这就是 Redis 的集群模式。如下图所示，Redis 集群模式呈现出的一种网状结构，完全不同于主从复制间的单向流动：</p>
<p><img src="/Redis-Clusters-theory.drawio.png" alt="Redis 集群模式示意图"></p>
<p>从图中可以看出，6 台服务器组成了一个网状结构，任意两台服务器间都可以相互通信。也许，大家会好奇一个问题，为什么这里博主就画了 6 台服务器？其实，这一切都是有迹可循的，因为 Redis 官方规定：一个集群中至少需要有 3 个主服务器(Master)。所以，一个 Redis 集群至少需要 6 台服务器。如果从这个角度来审视集群的定义的话，你可以认为 Redis 集群就是由多个主从复制一起对外提供服务。此时，集群中的节点都通过 TCP 连接和一个被称为 Cluster Bus 的二进制协议来建立通信，这里的 Cluster Bus 你可以将其理解为 <a target="_blank" rel="noopener" href="https://kafka.apache.org/">Kafka</a> 或者 <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/">RabbitMQ</a> 这样的支持“发布-订阅”(Pub-Sub)机制的东西，换句话说，集群中的每个节点都可以通过 Cluster Bus 与集群中的其它节点连接起来。节点们使用一种叫做 <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/gossip.html">Gossip</a> 的消息协议，据说，这是一种从瘟疫和社交网站上获得灵感消息传播方式。“六度分割”理论告诉我们，<strong>最多通过 6 个人你就能认识任何一个陌生人</strong>，同样地，最多通过 6 个节点你就可以把消息传递给任何一个节点。</p>
<p><img src="/Redis-Clusters-1.drawio.png" alt="Redis 集群模式与主从模式的联系"></p>
<p>目前，使用 Gossip 这一协议的项目有 Redis Cluster、<a target="_blank" rel="noopener" href="https://www.consul.io/">Consul</a>、<a target="_blank" rel="noopener" href="https://cassandra.apache.org/_/index.html">Apache Cassandra</a> 等等, 关于这个协议以及“六度分割”理论更进一步的细节，大家可以通过搜索引擎来获取，对我们而言，我们只需要知道，Redis 集群需要借助这个协议来实现诸如发现新节点、发送 <code>PING</code> 包、发送集群消息这些功能，因为每个节点除了存储自身的数据以外，还需要记录集群的状态，需要知道哪些节点不可用，需要合适的时机推选出主节点。我们在主从复制这一篇文章中提到过故障恢复，这个概念在这里同样适用，如图所示，S1 是 M1 的从节点，它本身并不是为了扩展请求的并发量而存在的，它需要在主节点宕机的情况下能被提拔为主节点，所以，它主要起一个数据备份的作用。因此，Redis 集群中的读和写，实际上都是在M1、M2 和 M3 上进行的。那么，我们不妨来想这样一个问题，如果 M1 和 S1 都宕机了，此时 Redis 集群还能不能正常工作呢？答案是否定的，因为此时显然不满足最少 3 个主节点的要求。</p>
<h2 id="一致性哈希算法"><a href="#一致性哈希算法" class="headerlink" title="一致性哈希算法"></a>一致性哈希算法</h2><p>OK，我们知道，在面对数据库的水平拆分问题时，一个最为关键的问题是路由，换句话说，我怎么样可以找到到对应的库或者表。常见的思路有范围、哈希和配置等等，而在 Redis 的集群模式下，我们同样会面临这个问题，更一般地，任何需要负载均衡的场景都需要考虑这个问题，譬如，我们对多台服务器的 IP 地址求余，然后按照余数来进行路由，抑或者是按照不同的权重进行随机等等，这看起来像回到了熟悉的负载均衡算法，对吗？事实上，一般的负载均衡算法都会选择哈希算法，而哈希算法本质上就是一种散列函数，它可以把任意长度的输入转化为确定的、固定长度的输出，以最常见的求余为例，它具体是怎么工作的呢？我们来一起看下面的图：</p>
<p><img src="/Redis-Clusters-Hash.drawio.png" alt="经典哈希算法"></p>
<p>可以注意到，首先，我们需要对 Key 计算出一个 hash 值，你可以理解为编程语言里的<code>GetHashCode()</code>方法，主要目的是将字符串类型的 Key 转化为整数型方便计算。接下来，按照主节点的数量来进行求余运算(统称为<strong>散列运算</strong>)，例如，这里我们有 3 台主节点服务器，故而在上面的图示中 n 应该等于 3，而这就是经典的哈希算法啦！那么，Redis 的集群有没有采用这个算法呢？答案还是否定的，因为这个方案里最大的变数就是 n。具体来讲，如果你想要扩容，那么 n 会变大，此时 Key 与服务器间的映射关系会被打破，即使不扩容，一旦某台服务器宕机，Key 与服务器间的映射关系还是会被打破，如果出现散列“碰撞”，无疑会让问题变得更复杂。</p>
<p><img src="/Redis-Clusters-Hash-Conflict.drawio.png" alt="经典哈希算法“碰撞”问题"></p>
<p>可以注意到，当从对 3 取模变成对 2 取模以后，必然会出现两个 1，这就是所谓的散列“碰撞”。所以，对于经典的哈希算法而言，它无法抵消因为 n 的变化而带来的重新 hash 的问题。为了解决这个问题，业界普遍使用的是一致性哈希算法，相比经典的哈希算法，最大的变化在于它将 n 的取值固定下来，即按 <code>2^32</code> 取模，此时，结果会落在 0 到 <code>2^32 - 1</code> 这个区间内，一旦我们将这个区间抽象为一个圆环，利用 CRC16 算法计算出来的值就会落在圆环上的某个地方：</p>
<p><img src="/Redis-Clusters-Hash-Advance.drawio.png" alt="改良后的哈希一致性算法"></p>
<p>如图所示，假设我们有 A、B、C 三个 Redis 节点，它们均按照顺时针方向排列在整个圆环上，当我们对每一个 Redis 节点进行 <code>hash()</code> 运算以后按 <code>2^32</code> 取模，此时，这个值依然会落在 0 到 <code>2^32 - 1</code> 这个区间内，以此类推，理论上对于任意一台服务器 X，我们总能找到对应的一个值，当该值介于区间<code>(m, n)</code>中，表示它分配在节点 n 上，你可以认为，每个服务器节点，它负责的并不是哈希环上的一个点，而是一个范围。基于这种特性，当某一台 Redis 服务器宕机时，对应的这个区间会变大，相当于流量从这个节点转移到了它的下一个节点，这意味着我们只需要移动一部分数据。同理，如果要增加节点，只需要把移动该节点到它上一个节点间的数据。由此可见，它对原来数据的影响非常小，而这就是一致性哈希算法。</p>
<h2 id="Redis-哈希槽"><a href="#Redis-哈希槽" class="headerlink" title="Redis 哈希槽"></a>Redis 哈希槽</h2><p>截止到现在，我们知道了，一致性哈希算法相对经典哈希算法的优势，可这个算法真的没有问题吗？我们应该会想到，节点在哈希环上的分布是不均匀的，这意味着，每个节点上对应的 Key 的数量各不相同，更进一步，我们可以说，每台 Redis 上存储的数据量不同，这样，原本期待着负载均衡的我们，此刻被光速地打脸。因此，在实际应用中，为了让哈希环分布更均匀一点，会设置所谓的“虚拟节点”。不过，就算你考虑到了这种地步，Redis 还是没有采用这种哈希一致性的方案，你说这是不是有点气人？事实上，它采用的是一种被称为哈希槽的方案：</p>
<p><img src="/Redis-Clusters-Hash-Slots.drawio.png" alt="Redis 哈希槽示意图"></p>
<p>如图所示，Redis 集群中总共有 16384 个槽位，它是怎么算出来的呢？因为 CRC16 算法产生的 hash 值有 16 个 bit，因此，它可以产生 <code>2^16</code> 即 65536 个值，理论上我们完全可以分配 65536 个槽位，不过考虑到网络带宽、节点数目，作者觉得 16384 个槽位完全够用了，前提是你集群内的节点不超过 1000 个！是不是听起来觉得非常离谱？可有些时候，工程上的事情，还真不能按科学一板一眼的来，不然，你又怎么会见到各种各样的“敏捷开发”、”项目管理”呢？</p>
<p><img src="/Redis-Clusters-Hash-Slots-Assign.png" alt="Redis 哈希槽槽位分配"></p>
<p>OK，对于 Redis 中的每一个 Key，它经过计算以后会落到某个具体的槽位内，至于槽位会路由到哪个机器上，这完全取决于每台 Redis 服务器的配置，硬盘大就多分一点，硬盘小就少分一点，“能者多劳”，听起来就很科学，对吧！所以，从这个角度来看，相比哈希环，哈希槽可以更加灵活地控制槽位的分布。可世间万物，无一不是双刃剑，你选择了自由，那么需要操心的事情就变多了，至少 Redis 集群不会帮你转移和分配槽位；你选择了秩序，一切井井有条，那么你内心又会期盼自由。“小而美”，想要面面俱到；“大而全”，想要细致入微，难怪刺客组织要和圣殿骑士间的斗争永无止息啊，哈哈……因此，Redis 集群的高可用，实际上非常依赖主从节点的主从复制和故障切换，我承认，我点题了，你发现了吗？</p>
<h1 id="Redis-集群实战"><a href="#Redis-集群实战" class="headerlink" title="Redis 集群实战"></a>Redis 集群实战</h1><p>好了，和上一篇一样，我们先礼后兵，等所有的理论知识都讲完了，再来着眼实际的过程，因为在博主看来，这是一个互相印证的过程，写流水账、记下每一步的操作步骤，这固然可以让你快速上手，但你真的只愿意到此为止吗？博主以前学过 CAD，近来又开始学习 <a target="_blank" rel="noopener" href="https://www.blender.org/">Blender</a>，一个深刻的感受就是，这些软件都需要大量的重复练习，甚至于形成肌肉记忆。可是我们学习知识的过程，是一个反复提炼、内化的过程，我们并不是为了成为某种“熟练工”，我发现有很多朋友，特别喜欢问某软件&#x2F;工具怎么安装&#x2F;配置类似的问题，虽然说这是技术人员日常生活里的一部分，但我觉得这不应该成为你特别关注的问题，所以，如果你发现我越来越不像是在写教程，恭喜你，发现了我的改变，谢谢你啊！回到正题，我们还是准备一个最小的集群，即“<strong>三主三从</strong>”的一个集群，依然使用 <code>docker-compose</code> 进行服务编排。首先，准备下面的目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Clusters</span><br><span class="line">|-- docker-compose.yaml</span><br><span class="line">|-- redis-1</span><br><span class="line">|   |-- redis.conf</span><br><span class="line">|-- redis-2</span><br><span class="line">|   |-- redis.conf</span><br><span class="line">|-- redis-3</span><br><span class="line">|   |-- redis.conf</span><br><span class="line">|-- redis-4</span><br><span class="line">|   |-- redis.conf</span><br><span class="line">|-- redis-5</span><br><span class="line">|   |-- redis.conf</span><br><span class="line">|-- redis-6</span><br><span class="line">|   |-- redis.conf</span><br></pre></td></tr></table></figure>

<p>此时，针对集群模式的 Redis 配置文件，相比主从复制模式要精简许多，以其中一台服务器<code>7001</code>为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 端口号</span><br><span class="line">port 7001</span><br><span class="line"># 启用集群</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes_7001.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p>照葫芦画瓢，我们准备好剩下的<code>7002</code>、<code>7003</code>、<code>7004</code>、<code>7005</code>、<code>7006</code> 这 5台服务器即可。接下来，我们准备服务编排文件<code>docker-compose.yaml</code>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-1</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-1/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-2/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-3</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-3/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis4:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-4</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-4/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis5:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-5</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-5/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis6:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-6</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-6/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>接下来，我们运行 <code>docker-compose up</code>命令，就可以看到 6 台 Redis 服务器都运行起来，此时，我们需要选择任意一台 Redis 服务器对应的容器内，执行下列命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create </span><br><span class="line">  127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 \</span><br><span class="line">  127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 \</span><br><span class="line">  --cluster-replicas 1</span><br></pre></td></tr></table></figure>
<p>该命令表示创建一个由 6 台服务器组成的集群，其中，<code>--cluster-replicas</code> 参数表示每个主节点分配一个从节点。此时此刻，当我们按下回车后，就可以看到下面的画面：</p>
<p><img src="/Redis-Clusters-Docker-01.png" alt="通过 redis-cli 创建 Redis 集群"></p>
<p>可以注意到，当前集群有 3 台主服务器节点：<code>7001</code>、<code>7002</code> 和 <code>7003</code>，有 3 台从服务器节点：<code>7004</code>、<code>7005</code> 和 <code>7006</code>，这符合我们一开始设想的“<strong>三主三从</strong>”，Redis 内部会为每个节点分配一个唯一的 Id，这个 Id 会和每个节点的 IP 地址、端口号一起保存下来。当我们没有显式地分配每台服务器对应多少个槽位时，它会按照主节点的数量平均地分割。在这里我们只有 3 台主节点服务器，无法被 16384 整除，所以，<code>7002</code> 这个服务器会多分配一个槽位。显然，Redis 需要我们来确定这个集群划分，此时，我们输入<code>yes</code>即可，这样我们就完成了 Redis 集群的搭建。接下来，我们通过 <code>redis-cli</code> 写入信息来看看集群实际的运行效果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入 Redis 容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it df5cae3c6004 sh</span><br><span class="line"><span class="comment"># 连接 7001 服务器</span></span><br><span class="line">redis-cli -p 7001 -c</span><br><span class="line"><span class="comment"># 写入一个 key</span></span><br><span class="line">127.0.0.1:7001&gt; <span class="built_in">set</span> name yuanpei</span><br></pre></td></tr></table></figure>
<p>我们会发现一个现象，就是 Redis 会告诉你这里有一次重定向，如图所示，它从 <code>7001</code> 重定向到了 <code>7002</code>，这是因为按照 CRC16 算法计算出的结果，<code>name</code> 这个键应该被分配到 <code>7002</code> 上存储：</p>
<p><img src="/Redis-Clusters-Docker-03.png" alt="通过 redis-cli 向 Redis 集群写入值"></p>
<p>同理，在我们已经知道 <code>name</code> 这个键存储在 <code>7002</code>上的情况下，我们依然可以从集群中的其它节点上读取到这个值：</p>
<p><img src="/Redis-Clusters-Docker-02.png" alt="通过 redis-cli 向 Redis 集群读出值"></p>
<p>可以注意到，集群依然可以自动地从 <code>7004</code> 重定向到 <code>7002</code>，这表明，我们可以从集群中的任何一个节点上查询数据，并且每个节点上都存储着不同的数据，这可不就是数据分片吗？这恰恰印证了我一开始的观点，即：<strong>Redis 的集群模式，本质上是一种服务器 Sharding 技术</strong>。果然，博主诚不欺人也，哈哈！</p>
<p><img src="/Redis-Clusters-Vote.drawio.png" alt="Redis 集群投票示意图"></p>
<p>到目前为止，我们已经搭建出了一个基本的 Redis 集群，你可能会问，如果集群中某个节点发生宕机该怎么办呢？此时，我们要注意区分，这是主观宕机还是客观宕机。什么是主观宕机呢？就是某个节点认为你挂了；什么是客观宕机呢？就是集群内超过半数的节点认为你挂了。事实上，只有客观宕机会触发故障转移，而所谓的故障转移，其实就是从故障节点的从节点中挑选一个出来继续提供服务，此时，需要有超过半数以上的主节点给这个从节点投票，这样，Redis 集群就会让它当选为新的主节点，谁能想到，在以绝对理性著称的技术世界里，居然会有如此民主而科学的做法呢？可少数服从多数，真的就是对的吗？</p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>坦白讲，这篇文章写起来非常费劲，因为它里面关联的知识点非常密集，从经典哈希算法到一致性哈希算法，再到 Redis 集群里的哈希槽，这是一个循序渐进的认知过程，我们由此认识到，Redis 的集群模式，本质上是由多个主从复制模式组成的服务器分片技术，它通过哈希槽来管理集群内的节点和数据，而节点间则是通过 TCP 协议互相通信，这使得我们可以从任意节点上查询数据，因为 Redis 集群会帮助我们实现连接的重定向。与此同时，Redis 集群内通过投票来实现故障转移，其触发机制是超过半数的节点认为该节点宕机，即客观宕机，此时，就需要从该节点的从节点中筛选一个继续提供服务，当然，这个筛选还是投票决定的，谁能说这不是一种现实世界的投影呢？好了，以上就是这篇博客的全部内容啦，关于 Gossip 协议等更细节的东西，留到以后有机会再写吧…..！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-11-30-office/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-11-30-office/" itemprop="url">入职新公司 1 个月感悟</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-30T12:30:00+00:00">
                2021-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>文&#x2F;彭宏豪，本文首发于我的公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/26zULZQ__6cOjSFUKGO-2Q">效率工具指南</a>」      </p>
<p>从上次写那篇离开广州的文章《<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/pxSLC58oz6sRxw3_jmDUZw">离开待了 7 年的广州，百感交集</a>》，到今天入职新公司有一个月多 3 天了，这个时间包含了周末，真正上班的时间只有 25 天。   </p>
<p>对比之前的工作，说几个体会：      </p>
<ul>
<li><p>真·弹性上下班，早打开早下班，不像网上的「面试黑话」说的——弹性打卡，其实是无限加班的代名词     </p>
</li>
<li><p>周末终于迎来了久违的双休        </p>
</li>
<li><p>每天下午 4 点到 4 点半，有半个小时的休息时间，这段休息时间，在公司有个另外的名字——<strong>放风</strong>，可以用来吃零食（零食是公司提供的，而不是用惩罚同事上班迟到扣的钱买的）、站起来放松一下或者出去楼下走走      </p>
</li>
<li><p>公司虽然是互联网公司，但节奏还不算特别快     </p>
</li>
<li><p>会议上会听到一些刚开始听不懂的词汇，称作公司内部的「黑话」也合适，如体外收费、禁精华、黑标签         </p>
</li>
<li><p>老板很平和（不确定用这个词准不准确），很接地气，会带饭到公司，会在中午饭点和同事一起吃饭，边吃饭边聊天    </p>
</li>
<li><p>对老板的唯一反差是，他在网络上用语音回复别人的问题时，语速比较慢，但第一次开会听他说话的时候，又觉得他说话很快</p>
</li>
</ul>
<p>25 天下来，推进的工作比较少，有点惭愧，这几天早上的站会有点发愁，同事或者老板每天都听到我汇报一样的事情——修改 XXX 文章，会不会觉得我在摸鱼了？    </p>
<p>现在的工作是负责一个项目，和之前每天按部就班写文章的模式不太一样：    </p>
<ul>
<li><p>完成一篇文章的时间比较短，1-3 天的工期，且文章之间基本独立，不会相互影响   </p>
</li>
<li><p>不考虑每周一的选题会，和同事讨论选题的事情，多数文章可以一个人自己完成         </p>
</li>
<li><p>项目是一个具有延续性、需要不断推进的工作，做之前可能需要先拟定框架或列好时间轴，确定项目在关键节点的进度   </p>
</li>
<li><p>项目的推进，需要多位同事协作，包含直属领导、同部门同事、跨部门同事（如设计师）、支持部门同事（征求其他部门同事对文章的建议或看法）</p>
</li>
</ul>
<p>还有一个体会是，如果对接下来要做的事情不是很清晰，可以用一个文档或者表格把它们写下来，而不是心里总惦记着这件事。     </p>
<p>记忆不太靠谱，不写下来，容易丢三落四、考虑不周。    </p>
<p>下图是同事建议我写的项目进度表，比较简陋，把要做和可能会做的事情写下来，对照着表格，更新事项进度，补充相关的文档链接。    </p>
<p>项目相关的文档多了之后，放在一张表格里，找起来也比较方便。                </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/30/16382809561384.jpg"></p>
<p>以上，就是本次想和你分享的内容。               </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-11-27-notionupdate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-11-27-notionupdate/" itemprop="url">笔记软件 Notion 最近又增加了什么新功能？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-27T12:30:00+00:00">
                2021-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>文&#x2F;彭宏豪，本文首发于我的公众号「<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/jlbZG8EQuQqxQUjoFw3jfw">效率工具指南</a>」     </p>
<p>Hello 各位晚上好。  </p>
<p>很久没写笔记软件 Notion 相关的内容了，这次的这篇文章，简单介绍一下 Notion 最近更新的两个功能。   </p>
<h2 id="简单表格"><a href="#简单表格" class="headerlink" title="简单表格"></a>简单表格</h2><p>Notion 之前最具特色的一个功能为 database，翻译为「数据库」，这个功能是 Notion 的一大亮点，但对于第一次接触的人来说，还是有点学习成本的。   </p>
<p>不太了解 database 的设计理念，用起来也会觉得云里雾里，外表看上去像 Excel 的表格，但使用起来又不完全是。  </p>
<p>如果让我向别人清晰地解释 database 的概念，我也无法做到。      </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/27/16380176144008.jpg"></p>
<p>可能是考虑到有些人不需要用到看起来比较复杂的 database，Notion 最近增加了一个更接近于 Excel 表格的功能——<strong>简单表格</strong>。  </p>
<p>输入 &#x2F;table 就能呼出插入简单表格的命令，Table 右侧带有一个 NEW 的标识，提示这是 Notion 的新特性。  </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/27/16380181929904.jpg"></p>
<p>插入的简单表格默认为 2 行 * 2 列，将鼠标移动到表格的右侧、底部或者是右上角，可以分别添加列、行、同时添加行和列。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/27/16380185352522.jpg"></p>
<p>如果简单表格不能满足你的需求，还可以通过整个表格的菜单，选择「Turn into database」，将简单表格转换为 database。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/27/16380186768632.jpg"></p>
<p>同样地，你也可以将之前创建的 database 直接转换为简单表格，两种数据表可以互相转换。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/27/16380188834704.jpg"></p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>除了简单表格，最近在使用 database 的过程中，还发现 database 增加了一个新功能——<strong>分组</strong>。   </p>
<p>点击 Group，下面会弹出一个设置分组标准(Group by)的面板，可选择的分组标准，其实就是 database 中的属性(property)，例如下面从 flomo 创建的 database，可以使用<strong>创建时间、链接、名称&#x2F;内容、标签</strong>来进行分组。  </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/27/16380189954479.jpg"></p>
<p>我使用其中的<strong>标签</strong>进行分组，它就会<strong>通过标签聚合展示相关的内容</strong>，效果如下图所示。</p>
<p>点击标签左侧的 ▼ 按钮，可以折叠暂时不需要查看的内容，为屏幕内其他内容腾出空间。    </p>
<p>使用分组功能切换到不同的视图模式，操作起来非常方便，这也是 database 有别于 Excel 的地方——达到同样的效果，Excel 可能还要用到数据透视表呢。。。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/27/16380171825400.jpg"></p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">               </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021/macos-vm-on-m1-mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/macos-vm-on-m1-mac/" itemprop="url">在 M1 Mac 上运行 macOS 虚拟机</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-26T10:30:00+00:00">
                2021-11-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>Apple M1 芯片问世一年有余，时至今日，在 M1 Mac 上运行 Windows、Linux 虚拟机的方法都已经比较成熟了。然而 macOS 本身的虚拟化却并非如此：直到 Monterey 发布，于 M1 Mac 上运行 macOS 虚拟机才成为可能。</p>
<p>最近有几个小实验需要在 macOS 虚拟机上跑，本来以为去 Parallels Desktop 上开一个就完事了，搜了一下才发现，其实事情没那么简单……实际配置过程中也是踩了几个坑，所以顺带记录一下。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2021/macos-vm-on-m1-mac/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E5%86%99%E5%9C%A8%E5%86%AC%E9%98%B3%E5%8D%87%E8%B5%B7%E4%BB%A5%E5%89%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E5%86%99%E5%9C%A8%E5%86%AC%E9%98%B3%E5%8D%87%E8%B5%B7%E4%BB%A5%E5%89%8D/" itemprop="url">写在冬阳升起以前</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-26T00:48:41+00:00">
                2021-11-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p><img src="/%E5%86%AC%E9%98%B3.jpg" alt="某个冬天的清晨"></p>
<p>突然间想要写点什么，或许是我终于发觉，一个人内心的疲惫感，是会像水里泛起的涟漪一样，一圈圈地向远方散开去，直至在某个时刻产生了共振，这种感觉就仿佛是，冬天的清晨，于雾气中升起的太阳，虽然无法令你感受到炽热，可依然会令你感到刺目甚至眩晕，圣人有云，“劳心者治人，劳力者治于人”，而这种劳心又劳力的状态，属实是一个普通打工人，经常要去面对的一件事情，因此，我想要说的，本质上是一种薛定谔的状态，它代表着温暖，代表着光明，可以给你生存所需要的一切，可于此同时，它又代表着炽热，代表着煎熬，可以毫无顾忌地灼伤你裸露的心。</p>
<p>就像一下子击中内心似的，我渐渐意识到，这个世界上的工作，本质上只有两种，一种是问题本身特别难，需要更多的心智上的投入，譬如数学、计算机图形学、物理碰撞等等，一个有意思的事情是，国产单机游戏《古剑奇谭3》和《仙剑奇侠传7》，男主的剑都是直接“浮空”地背在人物身上的，甚至都没有剑鞘，而《巫师3》据说光是一个拔剑&#x2F;收剑就借助了相当多的技术手段，这其中最大的问题在于穿模，尤其是国产游戏都喜欢给武器加各种发光特效，很多时候为了避免穿模的尴尬，不得不在刀&#x2F;剑入鞘以后隐藏刀&#x2F;剑刃这部分的模型，所以，这一类问题有时候属于“看起来简单，实现起来复杂”，联想到曾经有产品经理和程序员因为需求而大打出手的新闻，你就不难理解，人们对于难易程度的认知差异，其实是非常大的，原因就在于，人们无法确定这到底属于那一类问题，有人关注整体，就有人关注局部，就像人的眼睛，视锥体永远有一个范围，这无疑让人类永远只能看到一部分，这似乎会成为某种宿命，本身就很难的问题，大概就是无论从整体还是局部来看，难度都没有变化的问题。此前，有同事要计算客户的分层活跃度，我虽然知道这是一个关乎数学期望的问题，可因为我早就忘记了怎么去算概率密度函数，所以，这个问题我只知道方向而无从下手，换句话说，本身就很难的问题，并不会因为场景的转换而发生变化。</p>
<p>而相对地，第二种是问题本身不难，但因为流程、方案、组织等因素而变得复杂，不幸的是，我们在生活和工作中遇到的都是这种情况。我们总安慰自己说，买菜做饭用不到高等数学，其实，从某个角度来看，是因为作为普通人的你我，完全没有机会接触到这种“难题”。当然，我并不否认，这种因为复杂度提升而带来的挑战性。联想到最近网上报道的甘肃大爷花132万改造房子的新闻，我终于意识到，工程上的问题是无所谓科学与否的，因为无论装修工艺如何演进，技术与艺术的鸿沟始终存在。软件行业更是类似，不论我们使用多么先进的技术或是框架，多年来羁绊不前的其实是需求分析。我始终不明白，人可以靠着感觉去做一件事情，就好像设计师陶磊可以用傲慢和偏见去替老人做出选择一样，而我们这个行业可以在需求没落实的情况下仓促开发。如果说这两者间有什么本质上的不同，大概摸不着的软件和代码可以永无止境地修改吧！那么，当大爷的红砖毛坯房墙体开始反碱的时候，这是肉眼看得见的崩塌，可代码世界里的崩塌，又有谁会在乎呢？我们又太多太多的难度，完全是自己构建出来的，也许，这样能让大家看起来都在忙碌吧……</p>
<p>熟悉我的人，都知道我是一个怕麻烦的人，这种惰性，一旦体现在工作上，就表现为对繁琐、重复的厌倦，厌倦含糊不清的规则，厌倦似是而非的表达。每次工作上别人找我问问题，我更希望，对方可以用一句话说清楚他的疑虑，而不是每次都挥手示意我“过来”，我以为这是某种表达能力的欠缺，可很多时候，尤其是研发工作中的来来回回，这种沟通更像是一种“剧本杀”，每个人都利用手中的信息来拼凑出一个故事，然后互相从对方的故事中寻找破绽。这种感觉有时候会让我觉得麻烦，是不是隐隐约约有什么东西再让事情变得复杂起来，虽然我确信，熵增定律一定会让事物的复杂度变高，可假如这一切可以避免呢？我们都听过一个词——内耗，譬如，最典型的想太多、自我否定等等，一个人精神层面的自我内耗会让整个人都变得焦灼起来，而这种问题，如果反映到一个团队或者组织中，大概就是将错就错，“磨刀不误砍柴工”，可如果所有人都宁愿拿着一把生锈的刀去砍柴呢？有的人能忍受这样一把生锈的刀，有的人一定要用瑞士军刀才有生产力，而这就是分歧。</p>
<p>我一直觉得，我是那个站在技术与人文十字路口的那个人，甚至我能将这种东西完美融合在一起，毕竟，对于一个19岁前写诗的程序员来说，本质上都属于输入&#x2F;输出的一个过程。可多年以后，我渐渐发现，我是一个重视实用性超过艺术性的人，也许，是技术给了我这种实用主义思维，当我发现我通过 Blender 建模无法调出甜甜圈的颜色的时候，我隐隐约约地从材质编辑器中找到了一点当年写 Shader 时的感觉，我终于理解了当初关于 CSS 不正交的说法，那就是，当一件事情有多种方式可以做到的时候，对于普通人而言，困难已不再是实现这件事情，而是做出选择，装修这项工程是这样，日常的研发工作还是这样，甚至人生都是这样，我们从来到这个世界的那一天起，无数种世界观、人生观、价值观开始交织和缠绕，我们清楚地知道人生的结局是什么，以至于这个真相都不在重要，毕竟，我们每天经历的事情，一直都在教你做出选择，以及不断合理化这个选择，人们常说，选择比努力更重要，那么，聪明的你，你说，哪一件事情更难？</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021/ghcr-io-with-github-actions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/ghcr-io-with-github-actions/" itemprop="url">GitHub 全家桶：Actions 自动构建多架构 Docker 镜像并上传至 Packages (ghcr.io)</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-24T10:30:00+00:00">
                2021-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>前段时间把 GitHub 的用户名修改成了 <a target="_blank" rel="noopener" href="https://github.com/prinsss">@prinsss</a>，准备把其他地方的账号也修改一下的时候，却发现 Docker Hub 的 username 不能改，只能<a target="_blank" rel="noopener" href="https://hub.docker.com/support/doc/how-do-i-change-my-docker-username">砍掉重练</a>（npm 也是）。</p>
<p>想想反正我 Docker Hub 上也没上传什么东西，不如就用 GitHub 自家的 Container registry 来托管镜像吧！</p>
<p>这里有个小插曲：其实我挺早之前就想要改名了，但当时在忙秋招，考虑到改名后可能会有一些后续要处理（擦屁股），所以只是创建了一个 organization 把名字占住，等有时间了再正式改名。然而后来我把组织删了，想要修改 GitHub 账户的用户名时，却提示 <code>prinsss</code> 这个名称 unavailable（我确定它是没被占用的，因为我还能再用这个名字创建组织），不知道是不是触发了内部的什么保留机制。</p>
<p>最后还是发工单找客服解决了，而且等了一个多星期才回复，也是挺无语的。原来的 <code>printempw</code> 这个名字我也保留了，所以 <a target="_blank" rel="noopener" href="https://printempw.github.io/">printempw.github.io</a> 这个域名还是可以访问的，目前是<a target="_blank" rel="noopener" href="https://github.com/prinsss/prinsss.github.io/blob/source/_config.yml#L148">两边同步更新</a>，后续再慢慢迁移。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2021/ghcr-io-with-github-actions/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-11-19-lusun/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-11-19-lusun/" itemprop="url">这款免费好用的录屏软件「芦笋」，第一次用就爱上了。</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-19T15:30:00+00:00">
                2021-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>Hello 各位好。</p>
<p>之前推荐过不少工具，其中有一个经常被问到的问题，「电脑上有什么好用的录屏软件」。  </p>
<p>换做是以前，我都会推荐 OBS，因为它真的非常强大，既可以录屏，也可以直播，还能给录制的视频添加各种特效，但唯一的缺点是，使用起来有点麻烦，刚开始可能需要跟着图文或视频学习操作，不太适合不喜欢折腾软件的朋友。 </p>
<p>而且，如果我们想把录制的视频文件分享给朋友，要么是上传到视频网站，要么是上传到网盘，操作起来都不是非常方便。</p>
<p>如果你对录屏、以及后续的录屏文件分享存在着需求，那么可以试试我最近刚发现的一款软件——<strong>芦笋</strong>。   </p>
<p>下图是芦笋的首页，它有 3 种录制模式：</p>
<ul>
<li>人像+屏幕   </li>
<li>仅人像  </li>
<li>仅屏幕</li>
</ul>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/19/16373318932087.jpg"></p>
<p>打开软件，默认使用的是「人像+屏幕」的录制模式，桌面左下角会有一个如下图的圆形人像窗口，显示电脑摄像头捕获的人脸。  </p>
<p>圆形窗口下方有两个小圆点和一个放大的按钮，分别可以调整圆形窗口的大小和形状。点击放大按钮，圆形窗口会变成矩形。</p>
<p>此外，在录屏的过程中，可以随意拖拽改变圆形窗口的位置，非常灵活，避免圆形窗口遮挡到你想点击的区域。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/19/16373321838308.jpg"></p>
<p>在开始录制之前，点击下方的「录制设置」，可以设置捕获人像和录制音频的设备。  </p>
<p>需要注意的是，如果你想同时录制电脑发出的声音和周围的环境音，在 Mac 电脑上需要选择「聚集设备」。     </p>
<p>如果你的 Mac 电脑没有聚集设备这一选项，可以参考我之前写过的一篇文章，在电脑上安装 Soundflower：《<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649902497&idx=1&sn=27540fffc649aaac6e3a216d600931be&chksm=83a8498cb4dfc09a3dc8bcb40bd0a2c3ed5e1a92a00944f472dc9090f092d741c07853711bfe&token=1263943466&lang=zh_CN&scene=21#wechat_redirect">iPhone 投屏录制无声音？这个免费工具来帮你｜Mac 使用指南</a>》          </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/19/16373329251824.jpg"></p>
<p>结束录制时，它会在浏览器中打开一个网页，显示我们刚录制的视频内容，即录制的视频文件不会存放在电脑本地，而是会存放在云端的账户中。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/19/16373335357405.jpg"></p>
<p>如果你想下载录制的视频，那也没有问题，点击右上角的「更多」，选择「下载」，就可以将视频文件下载到本地。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/19/16373336642686.jpg"></p>
<p>芦笋录制的文件，之所以会放到云端，可能还是考虑到我们后续会<strong>分享视频文件</strong>的需求。</p>
<p>点击右上角绿色的「分享」按钮，在弹出的菜单中，可以看到快捷分享视频的选项。</p>
<p>我们可以使用链接或二维码的方式，将录制的文件分享给别人，而且支持他人对视频进行评论。这个设计，有点像是这些年非常流行的各类「在线文档」产品，区别在于这里的文档被替换成了我们录制的视频内容，多人可以就一个视频内容进行讨论或点评。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/19/16373338796140.jpg"></p>
<p>将视频链接分享给他人时，他人可以在观看的同时进行评论，评论时会附带视频的<strong>时间戳</strong>，方便观看评论的人快速定位到视频对应的画面，这有点像是我们已经非常熟悉的「弹幕」，而且还支持在评论的下方进行回复，就某个点或者话题作进一步的讨论。</p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/19/16373346166656.jpg"></p>
<p>体验下来，个人觉得芦苇还是<strong>少了一些基础的「视频编辑」能力</strong>，例如可以让用户对录制得到的视频进行裁剪，去除不必要的片段；或是可以对视频添加贴图或是马赛克，去除一些比较敏感的个人信息，可能会更好，期待这款产品后续能带来更多有意思的特性。</p>
<p>芦笋目前支持 Windows 和 macOS 系统，从官网看到移动端的产品正在开发中，有录屏和文件分享需求的朋友，可以前去官网下载体验。    </p>
<p>芦笋下载地址：<br><em><a target="_blank" rel="noopener" href="https://lusun.com/download?utm_source=preview">https://lusun.com/download?utm_source=preview</a></em>     </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">               </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%9B%E6%9E%97%E6%8E%A2%E9%99%A9%E7%B3%BB%E5%88%97%E4%B9%8B-Redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%9B%E6%9E%97%E6%8E%A2%E9%99%A9%E7%B3%BB%E5%88%97%E4%B9%8B-Redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F/" itemprop="url">分布式丛林探险系列之 Redis 主从复制模式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-16T03:48:41+00:00">
                2021-11-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>如果说，单体架构系统是坐在家里悠闲地喝着下午茶，那么，毫无疑问，分布式系统将会是一场永远充满惊喜的丛林冒险。从踏上这条旅程的那一刻起，此间种种都被打上分布式的烙印，譬如分布式锁、分布式事务、分布式存储、分布式配置等等，这些词汇拆开来看，“似曾相识燕归来”，每一个我都认识，而一旦放到分布式的场景中，一切就突然变得陌生起来，从过去的经典三层架构、到时下流行的微服务、再到更为前沿的服务网格，一路跌跌撞撞地走过来，大概只有眼花缭乱和目不暇接了。前段时间在做 <a target="_blank" rel="noopener" href="https://github.com/qinyuanpei/FakeRpc">FakeRpc</a>，这是一个基于 ASP.NET Core 的轻量级 RPC 框架，其间接触了 <a target="_blank" rel="noopener" href="http://zookeeper.apache.org/">ZooKeeper</a>、<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/">Nacos</a>，后来工作中又接触到了 <a target="_blank" rel="noopener" href="http://kafka.apache.org/">Kafka</a>、<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/azure/architecture/reference-architectures/saga/saga">Saga</a>，虽然这些都是不同领域里的分布式解决方案，但是我隐隐觉得它们之间有某种内在的联系，就像所有的分布式系统都存在选举 Leader 的协调算法一样。于是，“喜新厌旧”的双子座，决定新开一个专栏，既然分布式系统是一场永远充满惊喜的丛林冒险，那么，这个专栏就叫做 「分布式丛林冒险系列」好了。一切该从哪里开始呢？我想，还是从 Redis 开始，今天这篇文章，我们来聊一聊 Redis 里的主从复制。</p>
<h1 id="主从复制概述"><a href="#主从复制概述" class="headerlink" title="主从复制概述"></a>主从复制概述</h1><p>从某种意义上来讲，主从复制并不是一个新的概念，因为此前博主介绍过数据库里的主从复制，在 <a target="_blank" rel="noopener" href="https://blog.yuanpei.me/posts/1333693167/">利用 MySQL 的 Binlog 实现数据同步与订阅(上)：基础篇</a> 这篇文章中，博主和大家分享过利用数据库 Binlog 实现数据同步的方案，而 Binlog 正是实现数据库主从复制的重要机制之一，甚至在更多的时候，我们更喜欢换一种说法，即 读写分离。和数据库类似，Redis 中的主从复制，其实，就是指将一台 Redis 服务器中的数据，复制到其它 Redis 服务器。其中，前者被称为主节点(Master)，后者被称为从节点(Slave)，通常情况下，每一台 Redis 服务器都是主节点，一个主节点可以有多个从节点，而一个从节点只能有一个主节点，并且数据只能从主节点单向流向从节点，如下图所示：</p>
<p><img src="/Redis-Replication.png" alt="Redis 主从复制示意图"></p>
<p>虽然 Redis 在缓存上的应用做到了家喻户晓的地步，可这并不代表我们能真正得用好 Redis，譬如，博主的上一家公司，基本上没有用到 Redis 的高可用，最多就是一主一从这样的搭配。所以，当时公司里很多人都知道哨兵、集群这些概念，而真正搭过环境的人则是寥寥无几，这正是博主要写这个系列的原因之一。那么，从实用性的角度来看，Redis 的主从复制有哪些实际的作用呢？个人认为，主要有以下几点：</p>
<ul>
<li>数据冗余：主从复制相当于实现了数据的热备份，是除了数据持久化以外的一种数据冗余方案。</li>
<li>故障恢复：主从复制相当于一种灾备措施，当主节点主线故障的时候，可以暂时由从节点来提供服务。</li>
<li>负载均衡：主从复制搭配读写分离，可以分担主节点的负载压力，在“读多于写”的场景中，可以显著提高并发量。</li>
<li>高可用：主从复制是高可用的基础，无论是集群模式还是哨兵模式，都建立在主从复制的基础上。</li>
</ul>
<p>相信大家都听过 CAP 定理，这是分布式系统中的重要理论之一，其基本思想是，一致性(<strong>Consistence</strong>)、可用性(<strong>Availability</strong>) 和 分区容忍性(<strong>Partition Tolerance</strong>)，最多只能同时实现两点，而无法做到三者兼顾，如下图所示：</p>
<p><img src="/CAP-Theory.png" alt="CAP 理论"></p>
<p>事实上，对分布式系统的设计而言，本质上就是“<strong>鱼和熊掌不可兼得</strong>”，关键看你想要做出一个怎么样的选择。例如，同样是注册中心，ZooKeeper、etcd 以及 Consul 都选择了 CP，而 Euraka 则选择了 AP。对于 Redis 而言，单机版的 Redis 可以看作是 CP，因为它牺牲了 A，即可用性。而集群化的 Redis，则可以看作是 AP，通过自动分片和数据冗余，来换取可用性。这其实印证了我们一开始的观点，为什么我们需要 Redis 的主从复制、集群、哨兵这些东西呢？本质上还是为了提高 Redis 的可用性。可能有朋友会问，难道一致性在 Redis 里就不重要了吗？我想，这要从 Redis 主从复制的原理说起。</p>
<h1 id="主从复制原理"><a href="#主从复制原理" class="headerlink" title="主从复制原理"></a>主从复制原理</h1><p>首先，我们要明确一点，Redis 里的主从复制是异步的，这样就回到了一个老生常谈的话题，即：实时一致性 和 最终一致性，显然，在 AP 的场景下，最终一致性这种“弱一致性”实现起来要更容易一点，因为实时一致性这种“强一致性”的方案，意味着所有人都要在这个时间点停下来，等实现一致性以后再继续进行下面的工作。我们甚至都不用钻研那些高深莫测的分布式理论，单单从日常生活的角度来切入，你一定会觉得这样子做事情效率低到爆炸，所以，追求实时一致性并不是说不可取，而是感觉这样有一点得不偿失，难道你要为了一致性而牺牲可用性吗？博主曾经接触过一个基于 <a target="_blank" rel="noopener" href="http://ignite.apache.org/">Ignite</a> 构建的缓存组件，对方声称数据的一致性比可用性更重要。所以，作为一个被很多项目依赖的基础设施，虽然隔三差五地出各种问题，可大家竟然能一直容忍下去，可能这就是爱吧。直到后来引进 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/azure/architecture/reference-architectures/saga/saga">Saga</a> 做分布式事务，我意识到这是通过柔性事务来实现最终一致性，而如此前后矛盾的做法，只能成为此刻用来调侃的谈资，其实人更是如此，世间的一切你都可以去追逐，可你终将会失去它，这大概是人生的最终一致性。</p>
<p>好了，言归正传，事实上，Redis 的主从复制可以分为连接建立、数据同步、命令传播三个阶段，下面我们来分别讲解各个部分的相关细节。</p>
<h2 id="连接建立阶段"><a href="#连接建立阶段" class="headerlink" title="连接建立阶段"></a>连接建立阶段</h2><p>连接建立阶段，主要目的是主从双方建立 Socket 连接，此时，双方都需要知道对方的 IP 地址和端口号，其基本交互流程如下图所示：</p>
<p><img src="/Redis-Replication-Phase-1.drawio.png" alt="Redis 主从复制：连接建立阶段"></p>
<p>可以注意到，在连接建立阶段，首先，由从节点发出指令<code>slaveof &lt;IP&gt; &lt;Port&gt;</code>，这里的 IP 地址和端口号都是指主节点的 IP 地址和端口号。事实上，该指令还可以有下面两种形式，即：</p>
<ul>
<li>服务器启动参数：在<code>redis-server</code>命令后附加参数，即 <code>redis-server -slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li>
<li>服务器配置文件：在 <code>redis.conf</code> 文件中配置主节点信息，即 <code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li>
</ul>
<p>接下来，一旦主节点收到了该指令，就会对从节点做出响应，此时，从节点就可以获得主节点的 IP 地址和端口号，在 <code>redis-cli</code> 环境下，我们可以通过 <code>info Replication</code> 来验证这个观点。如图所示，是某个 Redis 从节点中存储的主节点信息：</p>
<p><img src="/Redis-Replication-Info-Slave.png" alt="Redis 从节点中存储的主节点信息"></p>
<p>此时，从节点和主节点会打一场“乒乓球”，从节点会定期发送<code>PING</code>指令，此时，如果主节点返回了<code>PONG</code>指令，则表示连接到主节点的 Socket 可用，你可以将其理解为一种健康检查或者心跳机制，目的是确定主节点还“活”着，否则，作为客户端的从节点就会断开 Socket 连接并尝试重连。如果主节点要求提供密码，那么从节点还需要发送以下指令：<code>auth password</code>，这个时候主节点会对从节点提供的身份信息进行验证，一旦验证通过，从节点就会开始监听主节点的端口，与此同时，主节点会保存从节点的 IP 地址和端口号。同样地，我们可以在主节点中通过 <code>info Replication</code> 来验证这个观点：</p>
<p><img src="/Redis-Replication-Info-Master.png" alt="Redis 主节点中存储的从节点信息"></p>
<p>至此，主从双方的互相“试探”结束，双方正式建立连接，是为连接建立阶段。</p>
<h2 id="数据同步阶段"><a href="#数据同步阶段" class="headerlink" title="数据同步阶段"></a>数据同步阶段</h2><p>如果我们把建立连接看作是两个人“握手”，也许，你的脑海中此刻会浮现出诺基亚的经典开机画面，毫无疑问，下面两个人的“会话”才是真正的重头戏。于是，我们来到了数据同步阶段，这一阶段的主要目的是，完成从节点的数据初始化。在连接建立阶段，从节点是主节点的客户端；而到了这一阶段以及命令传播阶段，双方互为彼此的客户端，因为，此时主节点需要主动向从节点发送命令。按照主从节点的状态不同，可以分为：<strong>全量复制</strong> 和 <strong>部分复制</strong>。</p>
<p>如果你接触过 Kafka，应该会有这样一种认知，即 Kafka 里面维护着一个始终追加的日志文件，而每一条消息则是这个日志文件中的一部分，Kafka 利用偏移量来定位某一条消息。在 Redis 的主从复制中，存在着类似的概念，它被称为：复制偏移量，事实上，参与复制的主从节点都会自身的复制偏移量，其中，主节点在处理完写入命令后，会将该命令的对应字节长度累加和记录，该信息可以在主节点的 <code>info Replication</code> 中的 <code>master_repl_offset</code> 字段上找到，我们还是用前面的图做例子来说明：</p>
<p><img src="/Redis-Replication-Info-Offset.png" alt="Redis 主节点中存储的复制偏移量信息"></p>
<p>实际上，在数据同步阶段，主节点内部会维护一个固定长度的、先进先出(<strong>FIFO</strong>)的队列作为复制积压缓冲区，其默认大小为 1 MB，主节点在响应写命令的时候，不但会把命令发送给从节点，还会写入到复制缓冲区，如下图所示：</p>
<p><img src="/Redis-Replication-Buffer-Offset.png" alt="Redis 复制缓冲区 和 复制偏移量累积"></p>
<p>这个复制缓存区的作用是保留主节点最近执行的写命令，因为它是一个先进先出的队列，所以，时间较早或者偏移量较大的命令会在一段时间后被挤出缓冲区，这样，我们就有了更进一步的结论，即：<strong>当主从节点 offset 的差距过大超过缓冲区长度时，将无法执行部分复制，只能执行全量复制</strong>。所以，选择全量复制还是部分复制，还是要有实际的使用场景来决定。主从配置第一次启用的时候，因为从库没有对应的复制偏移量，所以，第一次复制一定是全量复制，对于全量复制而言，其基本流程如下图所示：</p>
<p><img src="/Redis-Replication-Full.png" alt="Redis 主从复制：全量复制"></p>
<p>而对于部分复制而言，其得以实施的前提是，<strong>复制偏移量之后的数据依然存在于复制缓冲区</strong>，那么，如何判断复制偏移量在不在复制缓冲区里呢？在 Redis 中主要是通过 <code>PSYNC</code> 命令来实现，请注意，在 Redis 2.8 之前的版本中，只有 <code>SYNC</code> 命令，而 <code>PSYNC</code>则是 Redis 2.8 版本之后推出的替代命令，它提供了 <strong>完整重同步</strong> 和  <strong>部分重同步</strong> 的功能，主要解决了老版本中断线以后重新复制带来的低效率问题。这里，我们以 <code>PSYNC</code> 命令为例来进行说明。事实上，无论主从节点，都会被分配一个唯一的 runid，所以，对于部分复制而言，实际上是从节点告诉主节点，它的 runid 和 offset，然后由主节点来判断这个 offset 是否在它的复制缓冲区里，如下图所示：</p>
<p><img src="/Redis-Replication-Phase-2-PSYNC.png" alt="Redis 主从复制：部分复制"></p>
<p>因为复制缓冲区中持久化了写入命令，所以此时我们只需要从复制缓冲区中找到对应区间的数据，发给从节点即可，在这种情况下，主节点不需要生成 RDB 快照，所以，部分复制的效率会比全量复制要高很多。以上就是 Redis 数据同步阶段的基本流程，其实在这这个过程中，我们还有很多问题没有说到，譬如 <strong>Redis 的两种持久化方案 RDB 和 AOF 应该如何去选择，全量复制过程中主要的性能损耗点，以及 从节点如何利用 RDB 快照更新数据</strong>等等，考虑到篇幅，这些话题等以后有机会了再专门来说吧！</p>
<h2 id="命令传播阶段"><a href="#命令传播阶段" class="headerlink" title="命令传播阶段"></a>命令传播阶段</h2><p>前面提到过，主节点内部会维护一个复制缓冲区，其主要作用是持久化最近执行的写命令，可是你把命令都放到这个复制缓冲区里了，那些从节点又怎么知道这个具体动作呢？实际上，这一工作是由命令传播程序来完成的，所以，命令传播阶段实际上就是指主节点在写入复制缓冲区以后，通知从节点的这个过程。下面是一个简单的示意图：</p>
<p><img src="/Redis-Replication-Phase-3.png" alt="Redis 主从复制：命令传播阶段"></p>
<p>我承认，这些偏理论的内容，不单单看起来挺费劲，我写起来更费劲，所以，我只能尽可能地去画这些流程图，这样能更好地帮助大家理解这些内容。其实，有很多的东西，你对它的理解，是一种潜移默化、层层递进的过程，就像这里的复制缓冲区，你压根说不上来，到底是 Kafka 帮助你理解了 Redis，还是 Redis 帮助你理解了 Kafka。<strong>有时候，我挺不理解人类变幻莫测的情感，那东西对我来说有时像一门玄学，显然，科学对我而言会更容易一点，那么，我不妨选择去相信科学、相信唯物主义</strong>。也许，屏幕前的你，会不置可否地批评我说“光说不练假把式”，好了，下面我们来看一个全量复制的简单实例。</p>
<h1 id="主从复制实战"><a href="#主从复制实战" class="headerlink" title="主从复制实战"></a>主从复制实战</h1><p>这里，我们按照“<strong>一主两从</strong>”的方案来实施 Redis 的主从复制，前面提到过，我们有三种方式来配置主从复制。在这里，博主是使用第三种方式来进行配置的，如下图所示，准备三个文件夹及一个 <code>docker-compose.yaml</code>文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MasterSlave</span><br><span class="line">|-- docker-compose.yaml</span><br><span class="line">|-- redis-1</span><br><span class="line">|   |-- redis.conf</span><br><span class="line">|-- redis-2</span><br><span class="line">|   |-- redis.conf</span><br><span class="line">|-- redis-3</span><br><span class="line">|   |-- redis.conf</span><br></pre></td></tr></table></figure>
<p>其中，<code>redis-1</code>为主节点，对应端口号为：7001；<code>redis-2</code> 和 <code>redis-3</code>为从节点，对应端口号分别为：7002 和 7003。首先，主节点的配置项定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">port 7001</span><br><span class="line">timeout 5000</span><br><span class="line"># 900 秒内 1 个更改</span><br><span class="line">save 900 1</span><br><span class="line"># 300 秒内 10 个更改</span><br><span class="line">save 300 10</span><br><span class="line"># 60 秒内 10000 个更改</span><br><span class="line">save 60 10000</span><br><span class="line">rdbcompression yes</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir /data</span><br><span class="line"># 开启 AOF 模式</span><br><span class="line">appendonly yes</span><br><span class="line"># 每秒一次 fsync</span><br><span class="line">appendfsync everysec</span><br><span class="line">requirepass 12345678</span><br></pre></td></tr></table></figure>
<p>接下来，对于<code>redis-2</code> 和 <code>redis-3</code> 这两个从节点而言，主要多了 <code>slaveof</code> 和 <code>masterauth</code> 这两行配置，这是因为我们在主节点中配置了密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">port 7002</span><br><span class="line">timeout 5000</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">rdbcompression yes</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir /data</span><br><span class="line">appendonly yes</span><br><span class="line">appendfsync everysec</span><br><span class="line">requirepass 12345678</span><br><span class="line"></span><br><span class="line">slaveof 127.0.0.1 7001</span><br><span class="line">masterauth 12345678</span><br></pre></td></tr></table></figure>

<p>同理，可以对 <code>redis-3</code> 进行配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">port 7003</span><br><span class="line">timeout 5000</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">rdbcompression yes</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir /data</span><br><span class="line">appendonly yes</span><br><span class="line">appendfsync everysec</span><br><span class="line">requirepass 12345678</span><br><span class="line"></span><br><span class="line">slaveof 127.0.0.1 7001</span><br><span class="line">masterauth 12345678</span><br></pre></td></tr></table></figure>

<p>以上配置文件，均可以在 <a target="_blank" rel="noopener" href="https://github.com/Regularly-Archive/2021/tree/master/src/RedisClusters/MasterSlave">Github</a> 获取。接下来，我们会使用 Docker-Compose 进行服务编排：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-master</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-1/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave-1</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-2/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave-2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis-3/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>此时，当我们执行<code>docker-compose up</code>命令，如下图所示，它就会自动建立主从关系，这意味着我们在主节点写入的值，均可以通过从节点来进行读取：</p>
<p><img src="/Redis-Replication-Docker-Compose.png" alt="通过 Docker-Compose 建立主从关系"></p>
<p>为了印证我们的想法，下面我们通过 Redis 的命令行工具<code>redis-cli</code> 来向主节点写入值，为此我们需要进入到容器内部并执行相应的命令。</p>
<p><img src="/Redis-Replication-Docker-Compose-List.png" alt="一主两从及对应的容器 ID "></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入主 Redis 容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 8574d93eeaf4 sh</span><br><span class="line"><span class="comment"># 通过 redis-cli 连接 master</span></span><br><span class="line">redis-cli -p 7001 -c</span><br><span class="line"><span class="comment"># 身份认证</span></span><br><span class="line">127.0.0.1:7001&gt; auth 12345678</span><br><span class="line"><span class="comment"># 写入一个 key：name</span></span><br><span class="line">127.0.0.1:7001&gt; <span class="built_in">set</span> name yuanpei</span><br></pre></td></tr></table></figure>

<p>同样地，我们进入从节点，从 <code>7002</code> 和 <code>7003</code> 中任选一个即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入从 Redis 容器</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it 0b19237b7e58 sh</span><br><span class="line"><span class="comment"># 通过 redis-cli 连接从节点</span></span><br><span class="line">redis-cli -p 7002 -c</span><br><span class="line"><span class="comment"># 身份认证</span></span><br><span class="line">127.0.0.1:7002&gt; auth 12345678</span><br><span class="line"><span class="comment"># 读取一个 key：name</span></span><br><span class="line">127.0.0.1:7002&gt; get name</span><br></pre></td></tr></table></figure>

<p>可以注意到，我们从 <code>7002</code> 中读取出了 <code>7001</code> 中写入的值，这表明我们搭建的 Redis 主从复制起作用了，这样，如果主节点某一天遭遇不幸，这个时候从节点可以临时提供服务，而这恰好印证了我们一开始的观点，为什么需要主从复制呢？我们肉眼可见的效果就是数据冗余和故障恢复，而负载均衡和高可用更多的是一种战略上的考量，它完全取决于你所处的高度。截至到此刻，Redis 的主从复制，你学会了吗？</p>
<p><img src="/Redis-Replication-Docker-Compose-Sync.png" alt="Redis 主从复制效果展示"></p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p> 本文是 #分布式丛林探险系列# 的第一篇文章，主要分享了 Redis 主从复制模式的相关内容。首先，主从复制可以为 Redis 带来数据冗余、故障恢复、负载均衡以及高可用等方面的收益，单机版的 Redis 是一个符合 CP 的系统，而集群化的 Redis 则是一个符合 AP 的系统，其一致性正是由这篇文章中描述的复制来保证。根据主从节点状态的不同，Redis 中的主从复制，可以分为 <strong>全量复制</strong> 和 <strong>部分复制</strong> 两种，全量复制是主节点生成一个快照然后发送给从节点，而部分复制则是从复制缓冲区中筛选出命令然后发给从节点，在此基础上，我们用 Docker-Compose 构建了一个“<strong>一主两从</strong>”的主从复制方案。这个世界上没有 100% 完美的方案，Redis 的主从复制在实际使用中可能会遇到，诸如延迟与不一致、数据过期、故障切换等等的问题，特别是故障切换，虽然从节点可以在主节点挂了的时候临时顶上去，但这依赖于研发人员去切换项目中使用的连接字符串，如果希望更好的实现主从切换，可能还是需要大家去做进一步的工作，常言道，“实践出真知”，这篇文章充其量只能作为一个引子，更深入的话题、玩法，需要大家在实践中不断总结。好了，以上就是这篇文章的全部内容啦，如果大家对文章中的内容和观点有什么意见或者建议，欢迎大家在评论区留言，谢谢大家！</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-11-2-apps/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-11-2-apps/" itemprop="url">从一而终，难</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-02T14:30:00+00:00">
                2021-11-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>这两天和同事沟通，除了工作上的事情，还说到了一些工作中正在使用或曾经用过的工具，例如幕布、石墨文档。    </p>
<h2 id="幕布"><a href="#幕布" class="headerlink" title="幕布"></a>幕布</h2><p>我跟同事说到，幕布的创始人离开字节去做新的产品了，听说幕布之后会关停。  </p>
<p>同事感慨到，用得好好的工具，怎么突然间说停就停呢。   </p>
<p>我：幕布之前不是可以免费薅到很多年的会员吗？    </p>
<p>同事：也是，但幕布变成今天这样，也是他们团队把好牌给打烂了。我最开始充了幕布会员，但后来看到很多人可以免费薅会员，觉得他们团队采用的这个策略，深深地伤害了我这个付费用户。           </p>
<h2 id="石墨文档"><a href="#石墨文档" class="headerlink" title="石墨文档"></a>石墨文档</h2><p>我：石墨文档现在分享给他人的文档，需要其中一方开通会员之后，才可以一起协作编辑。     </p>
<p>同事：石墨文档变成这样了？   </p>
<p>我：你以前也有用过石墨吧？    </p>
<p>同事：有用过，我以前很喜欢石墨的，但后来觉得石墨变得很「鸡贼」，右下角会多出一些小广告。   </p>
<p>我：嗯，我在手机上打开别人分享的石墨链接的时候，也看到了广告。    </p>
<p>对于石墨文档需要付费后才能参与协作的这个变化，我在社交平台上稍微吐槽了一下，石墨文档的前技术总监 @子骅 看到我的动态后回复说，「主要还是政策方面的原因」，具体是啥原因，我也不清楚。    </p>
<p>为了能和同事一起编辑同一份石墨文档，我开通了 3 个月的高级会员，总价为 24 元。     </p>
<h2 id="Notability"><a href="#Notability" class="headerlink" title="Notability"></a>Notability</h2><p>今天 App 届的大新闻，应该当属：笔记应用 Notability 由买断制转向了订阅制。  </p>
<p>之前 Notability 的价格为 60 元，一次性购买下载之后无需再付费，而新版的 Notability 决定采用现在非常流行的「订阅制」，可免费下载，但需要按年付费。       </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/02/16358636528959.jpg"></p>
<p>这个消息一出，相信许多人都会在社交平台上吐槽官方的这种行为，有些人还说，Notability 的这个操作，让自己更加坚定了选择同类应用 GoodNotes 的决心。    </p>
<h2 id="谜底时钟"><a href="#谜底时钟" class="headerlink" title="谜底时钟"></a>谜底时钟</h2><p>谜底时钟，是我之前推荐过好几次的一款时钟应用，它的出现，让我觉得，好的时钟应用应该就是这个样子的，时钟颜值在线，动画讲究（设备插上电的时候还有小彩蛋），而且不同的时钟还配上了不同的声音。  </p>
<p>下图是其中的一个「霓虹灯」样式的时钟，在不同的时间段打开这个时钟，它上面的文字和图片也是不同的：         </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/02/img0664.JPEG" alt="IMG_0664"></p>
<p>原先这款应用也是买断制，我当初买的时候是 18 元，现在的价格是 25 元，接下来会更改为「订阅制 + 买断制」并存的收费机制，但买断制的价格会更高，有需要的朋友，可以前去购买。       </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/11/02/16358647345674.jpg"></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>列举这些应用的变化，并不是说想控诉什么，也没有要指责谁，只能说无论这些 App 的开发者或团队下一步选择做什么，都是他们的自由。    </p>
<p>做出某个选择，就意味着选择了某一部分用户，放弃了另外一些对变化感到不满意的用户，选择的同时也是在做取舍。     </p>
<p>有些人买个大几千的钱，眼都不眨一下的，反而是买个小物件的东西，却很在意价格，说来也奇怪。     </p>
<p>只能说，从一而终，难。         </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">             </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E9%80%9A%E8%BF%87%20Python%20%E9%A2%84%E6%B5%8B%202021%20%E5%B9%B4%E5%8F%8C%E5%8D%81%E4%B8%80%E4%BA%A4%E6%98%93%E9%A2%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E9%80%9A%E8%BF%87%20Python%20%E9%A2%84%E6%B5%8B%202021%20%E5%B9%B4%E5%8F%8C%E5%8D%81%E4%B8%80%E4%BA%A4%E6%98%93%E9%A2%9D/" itemprop="url">通过 Python 预测 2021 年双十一交易额</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-26T08:10:47+00:00">
                2021-10-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" itemprop="url" rel="index">
                    <span itemprop="name">数据分析</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>突然间，十月以某种始料未及的方式结束了，也许是因为今年雨水变多的缘故，总觉得这个秋天过去得平平无奇，仿佛只有观音禅寺的满地银杏叶儿，真正地宣布着秋天的到来，直到看见朋友在朋友圈里借景抒怀，『 霜叶红于二月花 』，秋天终于没能迁就我的一厢情愿，我确信她真的来了。当然，秋天不单单会带来这些诗情画意的东西，更多的时候我们听到的是双十一、双十二，这些曾经由光棍节而催生出的营销活动，在过去的十多年间渐渐成为了一种文化现象，虽然我们的法定节日永远都只有那么几天，可这并不妨碍我们自己创造出无数的节日，从那一刻开始，每个节日都可以和购物产生联系，这种社会氛围让我们有了某种仪式感，比如，零点时为了抢购商品恨不得戳破屏幕。再比如，在复杂的满减、红包、优惠券算法中复习数学知识。可当时间节点来到 1202 年，你是否依然对剁手这件事情乐此不疲呢，在新一轮剁手行动开始前，让我们来试试通过 Python 预测一下今年的交易额，因为在这场狂欢过后，没有人会关心你买了什么，而那个朴实无华的数字，看起来总比真实的人类要生动得多。</p>
<h1 id="思路说明"><a href="#思路说明" class="headerlink" title="思路说明"></a>思路说明</h1><p>其实，我一直觉得这个东西，完全不需要特意写一篇文章，因为用毕导的话说，这个东西我们在小学二年级就学过。相信只要我说出 <a target="_blank" rel="noopener" href="https://ws.wiki.gaogevip.com/wiki/%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95">最小二乘法</a> 和 <a target="_blank" rel="noopener" href="https://zh.wikipedia.ryancray.com/zh-hans/%E7%B7%9A%E6%80%A7%E5%9B%9E%E6%AD%B8">线性回归</a> 这样两个关键词，各位就知道我在说什么了！博主从网上收集了从 2009 年至今历年双十一的交易额数据，如果我们将其绘制在二维坐标系内，就会得到一张散点图，而我们要做的事情，就是找到一条曲线或者方程，来对这些散点进行拟合，一旦我们确定了这样一条曲线或者方程，我们就可以预测某一年双十一的交易额。如图所示，是 2009 年至今历年双十一的交易额数据，在 Excel 中我们可以非常容易地得到对应的散点图：</p>
<p><img src="https://i.loli.net/2021/10/27/mf3h4oXLiswzPOq.png" alt="在 Excel 中绘制散点图"></p>
<p>如果有朋友做过化学或者生物实验，对接下来的事情应该不会感到陌生，通常我们会在这类图表中添加趋势线，由此得到一个公式，实际上这就是一个回归或者说拟合的过程，因为 Excel 内置了线性、指数型、对数型等多种曲线模型，所以，我们可以非常容易地切换到不同的曲线，而评估一个方程好坏与否的指标为 $R^2$，该值越接近 1 表示拟合效果越好，如图是博主在 Excel 中得到的一条拟合方程：</p>
<p><img src="https://i.loli.net/2021/10/27/D5xHLIfrJsZNi1B.png" alt="在 Excel 中添加趋势线"></p>
<p>那么，在 Python 中我们如何实现类似的效果呢？答案是 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/">scikit-learn</a>，这是 Python 中一个常用的机器学习算法库，主要覆盖了以下功能：<strong>分类</strong>、<strong>回归</strong>、<strong>聚类</strong>、<strong>数据降维</strong>、<strong>模型选择</strong> 和 <strong>数据预处理</strong>，我们这里主要利用了回归这部分的 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/394.html">LinearRegression</a> 类，顾名思义，它就是我们通常说的线性回归。事实上，这个线性并不是单指一元一次方程，因为我们还可以使用二次或者三次多项式，因为上面的 Excel 图表早已告诉我们，一元一次方程误差太大。</p>
<h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><p>OK，具体是如何实现的呢？首先，我们从 CSV 文件中加载数据，这个非常简单，利用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/">Pandas</a> 库中的 read_csv() 方法即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">&#x27;./历年双十一交易额.csv&#x27;</span>, index_col = <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>接下来，我们使用下面的方法来获取 年份 和 交易额 这两列数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">year = np.array(df.index.tolist())</span><br><span class="line">sales = np.array(df.Sales.tolist())</span><br></pre></td></tr></table></figure>
<p>此时，我们可以非常容易地用 <a target="_blank" rel="noopener" href="https://matplotlib.org/">matplotlib</a> 库绘制出对应的图表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plt.scatter(year, sales, marker=<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;年份&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;交易额(亿)&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;历年双十一交易额变化趋势&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/10/27/wD2b8lhjmIsETeP.png" alt="通过 matplotlib 绘制散点图"></p>
<p>接下来，我们来看看如何对这组数据做线性回归，以一元一次方程为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">X = (year - <span class="number">2008</span>).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">X = np.concatenate([X], axis= -<span class="number">1</span>)</span><br><span class="line">Y = sales</span><br><span class="line">lr = LinearRegression()</span><br><span class="line">lr.fit(X, Y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;方程系数：&#x27;</span>, lr.coef_)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;方程截距：&#x27;</span>,lr.intercept_)</span><br></pre></td></tr></table></figure>

<p>这里，首先我们需要把 2009 到 2020 这个范围内的年份转化为更方便计算的 1、2、3 …，所以，每一个数都减去了 2008，这样我们就得到了横坐标 <code>X</code> 以及 纵坐标 <code>Y</code>。接下来，我们只需要将其传入 <code>fit()</code> 方法即可。有时候，你可能会看到下面这样的代码，即用于划分 <strong>训练集</strong> 和 <strong>测试集</strong> 的的代码片段：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size=<span class="number">0.3</span>, random_state=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>考虑到我们这里的样本数据本来就不多，毕竟，这股消费主义的风潮在中国刚刚流行了十二年，所以，我们要珍惜这份福报，就不划分 <strong>训练集</strong> 和 <strong>测试集</strong> 了(逃。此时，我们会得到两个重要的参数，即方程系数 <code>lr.coef_</code> 和 方程截取 <code>lr.intercept_</code>，而一旦有了这两个参数，我们就能确定一个线性方程，即传说中的 $y&#x3D;ax+b$ :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x: lr.coef_[<span class="number">0</span>] * x + lr.intercept_</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;2021年交易额预测：&#x27;</span>, f(<span class="number">13</span>))</span><br></pre></td></tr></table></figure>

<p>此时，f(13) 就是 2021 年双十一的交易额，显然，这是一个预测值，大概是 3592 亿，这属实是有点离谱啦，都没能超过 2020 年的 4982 亿，我们前面提到过 $R^2$，在 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/">scikit-learn</a> 中我们使用下面的方法来计算它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;R^2：&#x27;</span>, lr.score(X_test, Y_test))</span><br></pre></td></tr></table></figure>

<p>没错，<code>score()</code> 函数需要这样一组测试数据，我们利用前面划分 <strong>训练集</strong> 和 <strong>测试集</strong> 的方法就可以得到它。我们发现，这个值大概是 0.73，这要不离谱都说不过去，这一点我们从图上就可以看出来：</p>
<p><img src="https://i.loli.net/2021/10/27/UerVa9mZ5NSPwTC.png" alt="历年双十一交易额变化趋势预测：一次方程"></p>
<p>这样显然不行啊，那怎么办呢？遥想古人利用“割圆术”无限逼近圆形进而计算出圆周率的这种执着，我们是不是可以通过提高“次数”来解决欠拟合的问题呢？换句话说，我们来试试一元二次方程，此时，我们只需要调整下横坐标 <code>X</code> 的构造过程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = (year - <span class="number">2008</span>).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">X = np.concatenate([X**<span class="number">2</span>, X], axis= -<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>简单来说，如果你需要构造一个 N 次多项式，那么，只需要由高到底依次写出来即可，所以，你可以想象得到，对于三次多项式，我们可以这样构造：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = (year - <span class="number">2008</span>).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">X = np.concatenate([X**<span class="number">3</span>, X**<span class="number">2</span>, X], axis= -<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>对于二次多项式，我们可以得到下面的结果，其 $R^2$ 为 0.92，预测 2021 年双十一交易额为 5218 亿：</p>
<p><img src="https://i.loli.net/2021/10/27/1RF3LtQr4pTidb6.png" alt="历年双十一交易额变化趋势预测：二次方程"></p>
<p>同理，对于三次多项式，我们可以得到下面的结果，其 $R^2$ 为 0.96，预测 2021 年双十一交易额为 6213 亿：</p>
<p><img src="https://i.loli.net/2021/10/27/DlHcQUIXf1pORob.png" alt="历年双十一交易额变化趋势预测：三次方程"></p>
<p>整体上看，三次方程的拟合效果更好一点，达到了 0.96，但这个和大学时候做实验追求的 0.99 相比，多少有一点尴尬，屏幕前的你，是否想到了更好的曲线模型呢，我们常常说某某行业取得了指数级的增长，难道说指数模型更适合这个问题？关于这一点博主没能去亲自验证，因为看起来在 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/">scikit-learn</a> 中没有指数型函数的计算模型，可当博主在 Excel 中添加了指数型的趋势线以后，发现结果有点出人意料，因为它的 $R^2$ 只有 0.8314，而按这个方程计算出的交易额则约为2万多亿，好家伙，这都赶上恒大目前拖欠的债务了，想想就觉得离谱，指数型函数对应的曲线如下：</p>
<p><img src="https://i.loli.net/2021/10/27/ZBN5RgXiqUDLym3.png" alt="历年双十一交易额变化趋势预测：指数函数"></p>
<p>此时此刻，坐在屏幕前的你，更倾向于选择那种计算模型呢，个人觉得三次方程更好一点，因为它的 $R^2$ 是目前最好的，当然，<a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/">scikit-learn</a> 还有类似可解释的方差分数、最大误差、平均绝对误差、均方误差、均方误差对数等等不同的指标，大家可以参考 <a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/view/93.html#3.3.4%20%E5%9B%9E%E5%BD%92%E6%8C%87%E6%A0%87">官方文档</a> 来做更进一步的探索，一切都只有等到下个月双十一过后方能揭晓，就让我们拭目以待！本文中使用的源代码，已更新至 <a target="_blank" rel="noopener" href="https://hub.fastgit.org/Regularly-Archive/2021/tree/master/src/11.11">Github</a> 供大家参考，如果大家对博客中的内容有什么意见或者建议，欢迎大家在评论区积极留言，谢谢大家！</p>
<h1 id="本文小结"><a href="#本文小结" class="headerlink" title="本文小结"></a>本文小结</h1><p>恍惚中惊觉，十月份就这样结束了，这意味是 2021 年只剩下 60 多天。上了年纪的人总不免开始怀念，那些偷偷从树叶间隙里溜走的时光，去年的这个时候我在做些什么呢？大概刚刚追完「半泽直树」第二部吧！在疫情愈发常态化的日子里，人对于未来总有种难以言说的失控感，某君有言道，『不知道明天和意外哪一个先来』，虽然机器学习可以通过“训练”过去达到“预测”未来的目的，可人生并没有哪一个方程可以完美拟合，虽然这个世界早已为你规划好一条叫做“随大流”的路，一个人的过去、当下就像无数个离散的点，这些点构成了我们人生的轨迹，某种我们通常称之为回忆的东西，可这些点是否会向着预期的方向延伸，也许，永远没有人会知道答案，这个世界上有相当多的数字，譬如自然对数、圆周率、黄金分割比等等，都是前辈先哲从自然世界中寻找到的，可对于我们的人生而言，并没有这样明显的答案，所以，每次做数据分析的时候，我都有种奇怪的感觉，因为我不明白这些数字背后，到底和我们本身有着什么样的关联，可这个世界偶尔会感应到你的失落，当你听着「明年今日」，而心里想的是去年今日，我想，这一页可以翻过去，这篇文章可以结尾，这样就可以了吧…</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-10-21-apps/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-10-21-apps/" itemprop="url">近期值得关注的 App</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-21T05:30:00+00:00">
                2021-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>Hello 各位下午好。    </p>
<p>今天的这篇文章，想和大家分享一些我最近看到的一些新应用、或者好玩的东西，希望能对你有帮助。    </p>
<h2 id="阿里云盘"><a href="#阿里云盘" class="headerlink" title="阿里云盘"></a>阿里云盘</h2><p>阿里云盘在近期上线了 iPad 版本，在 iOS 移动端的更新说明中，它也提到了「iPad 版上线」，如此一来，阿里云盘可以说是可以在绝大多数设备上运行了。</p>
<p>根据官网的说法，后续可能还会上线小程序的版本，敬请期待。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/16347862403041.jpg"></p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/img0690.JPEG" alt="IMG_0690"></p>
<h2 id="星空问答"><a href="#星空问答" class="headerlink" title="星空问答"></a>星空问答</h2><p>星空问答，是知识星球 App 推出的一个<strong>问答小程序</strong>，你可免费向他人提出问题，也可以分享自己的「问答主页」，让别人来向你提出问题。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/img0691.PNG" alt="IMG_0691"></p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/img0693.PNG" alt="IMG_0693"></p>
<p>这个问答小程序，让我想起以前朋友圈不少人都在用的一个匿名提问产品 Tape，将你的提问链接发布到朋友圈，别人可以向你匿名提问，回答了之后就会向所有人公开展示，他人可以围观吃瓜。  </p>
<p>匿名提问的好处在于，一方面可以减轻提问者的压力，另一方面是可以问一些比较私密的问题，比如说你对某个人有意思，但又不知道他有没有对象，这个场景下就很适合用匿名提问。  </p>
<p>而知识星球推出的星空问答，暂时不支持匿名提问，可能是匿名提问的产品在微信生态下有被下架的风险，而且目前这款产品刚上线不久，满足主要需求即可，不需要弄得太复杂。      </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/img0694.JPEG" alt="IMG_0694"></p>
<h2 id="微信读书"><a href="#微信读书" class="headerlink" title="微信读书"></a>微信读书</h2><p>微信读书近期上线了一个「勋章体系」，会根据你在 App 内的行为——阅读天数、阅读时长、发布的想法数量、收到的点赞数量、读完的书籍数量，授予相应的虚拟勋章，如下图所示：   </p>
<p>发现现在挺多产品都会做这种虚拟勋章的功能，比如 QQ、知乎、得到、Keep，还有苹果手表的健身 App。      </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/albumtemp1633999256.PNG" alt="album_temp_1633999256"></p>
<h2 id="更改外接显示器屏幕亮度"><a href="#更改外接显示器屏幕亮度" class="headerlink" title="更改外接显示器屏幕亮度"></a>更改外接显示器屏幕亮度</h2><p>这里推荐一个 Mac 上用来<strong>更改外接显示器屏幕亮度</strong>的软件——<strong>MonitorControl</strong>，软件支持 M1 和原先 Intel 芯片的 Mac 电脑，因此在使用的时候不用担心兼容性的问题。       </p>
<p>MonitorControl 下载地址：<br><em><a target="_blank" rel="noopener" href="https://github.com/MonitorControl/MonitorControl/releases/tag/v4.0.0-rc1">https://github.com/MonitorControl/MonitorControl/releases/tag/v4.0.0-rc1</a></em>      </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/16347922773620.jpg"></p>
<h2 id="实时显示-Twitter-关注增长数据"><a href="#实时显示-Twitter-关注增长数据" class="headerlink" title="实时显示 Twitter 关注增长数据"></a>实时显示 Twitter 关注增长数据</h2><p>这个网站包含了多款与 Twitter 相关的工具，例如在 Twitter 头像显示关注数增长进度、在个人主页顶部的 Banner 图显示最近关注你的人、可视化呈现关注你的人或者你正在关注的人等等。</p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/16347938826165.jpg"></p>
<p>以第一个工具「在 Twitter 头像显示关注数增长进度」为例，事先设置一个你想达到的关注数目标，通过计算目标与现有关注数量的差异，会在圆形的 Twitter 头像边缘增加一个<strong>环形的进度条</strong>，实时显示现有关注数和目标的百分比。      </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/21/16347938242649.jpg"></p>
<p>BlackMagic 官网：<br><em><a target="_blank" rel="noopener" href="https://blackmagic.so/">https://blackmagic.so/</a></em>        </p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>除了前面提到的应用，如果你也发现了一些<strong>好玩、有趣</strong>或者<strong>实用</strong>的工具，欢迎在下方的评论区留言，感谢。    </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">             </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/%E4%BB%8E%E3%80%8C%E5%A4%B1%E6%8E%A7%E7%8E%A9%E5%AE%B6%E3%80%8D%E4%B8%AD%E5%BE%97%E5%88%B0%E7%9A%84%E5%90%AF%E7%A4%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/%E4%BB%8E%E3%80%8C%E5%A4%B1%E6%8E%A7%E7%8E%A9%E5%AE%B6%E3%80%8D%E4%B8%AD%E5%BE%97%E5%88%B0%E7%9A%84%E5%90%AF%E7%A4%BA/" itemprop="url">从「失控玩家」中得到的启示</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-18T12:42:47+00:00">
                2021-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F/" itemprop="url" rel="index">
                    <span itemprop="name">生活感悟</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>也许，在某一个不寻常的清晨，突然从睡梦中惊醒的你，开始重新审视周围的一切，这个习以为常的世界，是否是真实的呢？而这种疑问，「黑客帝国」里的 Neo 有过，「西部世界」里的 Dolores 有过，甚至，连庄周梦蝶这个故事，都在探讨同一个哲学命题，即：人应该如何认识真实。从某种意义上来讲，游戏世界是现实世界的一种映射，这种对人类文明进行解构，并尝试进行重新演绎的做法，其本身就有种浓厚的哲学意味，正如古希腊人刻在阿波罗神殿里的那句名言，『人啊，认识你自己』。关于真实，这是人从诞生那一刻起，就在不断思考着的终究问题：我是谁？我从哪里来？要到哪里去？</p>
<p>「失控玩家」的切入点，源于一名自我意识觉醒的 NPC——盖，他每天过着一成不变的生活：起床、喝咖啡、到银行上班、等待劫匪上门、和黑人保安趴在地上配合演出……事实上，这可以视为早期的 AI —— 有限状态机，我想，接触过游戏开发的朋友们，看到这里都不免要会心一笑啦！可惜，这是一部以 NPC 作为主角的电影，在电影的设定中，盖是一个具备深度学习能力的 AI，当他偶然从玩家手中夺过墨镜以后，终于从玩家视角看见不一样的世界。和「头号玩家」中被游戏入侵真实生活的设定不同，「失控玩家」更像是游戏版的「楚门的世界」，如果用一句话来概括，『海的尽头是天空，天空的尽头是荧幕』，在某个时刻，当你发现周围的一切变得不再真实，甚至身边的所有人都是演员，而更为讽刺的是，你的人生其实是一场被现场直播着的真人秀，而这便是「楚门」所面对着的世界。暂且不论这种设定，是否隐隐约约预言了当下流行的真人秀节目。当不经意间发现生活在不断重复的时候，你是否会愿意男主盖一样跳出这个循环呢？从我们出生的那一刻起，姓名、身份、知识、道德、文化…等等，无一不是我们的「出厂设定」，更不必说上学、工作、结婚、生子这种类似 RPG 游戏里打怪升级的任务系统。</p>
<p>导演小策有一期<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1vy4y187rR?spm_id_from=333.999.0.0">视频</a>，大意是说，我们这个世界，其实是高维度文明设计出的一个游戏，这个游戏制定了非常精细的规则，与此同时，它具备高度的自由性，这一切的一切，都让我们误以为我们可以自己来做决定。其实，这些高维度文明，早已设定好了基本的规则，他们唯一想做的事情，就是看我们能不能通过进化发现自己只是一个戏中人。正如电影中的美女咖啡师，难道她真的喜欢做「两份奶一份糖」的咖啡吗？还是冥冥中有某种接近命运的东西让她成为了这样一个咖啡师？也许，这样的理论是细思极恐的，可笛卡尔同样说过，『我思故我在』。既然，我们都解释不了，我们为何会在这里，我们又如何能相信，周围的一切就一定是真实的呢？如果说，盖因为爱情的鼓舞而快速升级进化，这多少沾点喜剧的色彩，那么，接下来，当整个世界即将不复存在的时候，整个故事就变成了彻头彻尾的悲剧，因为在那一刻，无论你等级有多高，装备有多好，全部都失去了意义，一如人死灯灭，名与利，转瞬化为烟云，假如真有高维度文明存在，对方的维度只比你多0.0000001，连一粒尘埃的质量都达不到，你拼命想要抓住、想要证明的人生，可能就只是一场游戏，一个实验，就像最近大火的韩国电视剧「鱿鱼游戏」，穷人的放手一搏，富人的博君一笑，荒诞而又真实。可以说，终其一生，我们都在追求意义和仪式感，可人生恰恰是没有意义的，就像盖每天都重复着同一句话醒来，在永无止境的循环中，意义始终逃不出这个作用域，你可以定义它，但你终将失去它。</p>
<p>而这种感觉，在我玩「风之旅人」这款游戏时更为强烈，在广袤无垠的沙漠中，当我开始漫无目的地行走的时候，我突然意识到，有可以称之为起点的地方，便一定会有可以称之为终点的地方，我会在某个时刻消逝，而这个世界则不会结束，就好像这个世界从来没有过我一样。其实，在「风之旅人」这个游戏中，陈星汉老师通过壁画的形式，隐晦地讲述了白袍人文明从诞生到被黄沙掩埋的整个故事。主角拼尽全力穿过雪地，如同预言一般死在圣山脚下，然后化成一道光变成玩家一开始身着红袍的样子。你不能不说这是一种轮回，故事还是那个故事，红袍人还是红袍人，而你注定再难变回你自己。不管是游戏还是人生，我们都会碰见不止一个同伴，而它们永远只能陪伴我们走完一段旅程，接下来的人生还是需要自己去完成。所以，这是一种难以言说的感觉，虽然听起来像是某种虚无主义的观点，可其实你仔细一想，如果上帝真的会掷骰子，女娲真的会造人，这个世界本身又何尝不能是一款游戏，一个人从出生的那一刻起，就开始扮演各种角色，这是一个角色扮演游戏；从小到大，从分数到薪资再到地位，这是一个跑酷竞技游戏……而游戏规则永远掌握在少数人手中，而这个时代，成功或者是优秀的标准，早已令人高不可攀，甚至没有人会想到，证明你是一个真实的人要比想象中还要难。在人工智能的加持下，游戏里的 NPC 有了独立的意识，可如果你无法分辨出什么是真实，你就无法证明这个世界是真实存在的。正因为如此，「模仿游戏」中的警官，只有不无遗憾地对图灵说，I can’t judge you.</p>
<p>回到电影本身的话，我想，它更能激发骨灰级电影爱好者发掘彩蛋的兴趣。因为，这部电影里的梗简直多得像一部百科全书。从主角盖的冒险经历来看，你能找到「楚门的世界」、「西部世界」、「黑客帝国」等多部电影的影子，而如果从『自由城』的氛围来看，你会发现这无非就是一个升级、高配版本的「侠盗猎车手」游戏，甚至于盖在对抗 Dude 这个游戏中的 Boss 的时候，更是接连使用美队盾牌、绿巨人、光剑这种颇具代表性的意象。当然，你还可以从研发人员的视角来调侃这部电影，无论是盖背后无与伦比的人工智能算法，还是尚未完成设计就仓促上线的 Dude，抑或者是模型岛屿下面的天空盒，即使你并不确定，游戏公司老板选择用斧头来砸游戏服务器，其中是否有致敬「闪灵」的嫌疑？这个世界的神奇之处在于，无论你试图用文学、戏剧、游戏、电影中的哪一种方式来进行描摹，你都能得到一个令你自己确信的故事，唯独在确定自身的真实性上不止一次地迟疑过。对于普通人而言，我们真的有那么多的选择吗？是我们在玩一款游戏，还是躲在游戏背后的人在愚弄我们？当讨论一个群体的时候，个体的独特性就会被忽略，可或许我们本就没有什么不同，完全是 AGCT 四种碱基的排列组合让我们相信自己与众不同，在这款被称为「人生」的游戏里，99.9999999 的玩家注定要成为 NPC，人人都笑工具人，可在这款游戏里，谁又不是工具人呢？人们步履不停、反反复复地跌入生老病死的无限循环，为了只在这次循环中被定义和声明的作用域而奔波一生，这是否可以算作某种献祭？</p>
<p>如果这个世界是假的，你应该如何面对？对于这个问题，我想，我没有答案，因为它就像我一直都看不清、抓不着的未来一样，无论我有没有机会去做出这个选择，它始终就像写好的结局一样被放在哪里，而我步履蹒跚的每一个当下，从某种意义上来讲，它或许只是我走向未来的一个工具，就像「风之旅人」里漫无边际的沙漠一样，你追着风的足迹前往某个叫做远方的地点，没有人知道远方的远方到底是什么。可你生命中遇见的每一个闪光点是何其的珍贵，即使它只在这一次循环内存在，即使它终会在你走向某座雪山的时候失去，而这正是生命的意义所在，不妨去假设这个世界是一款虚拟的游戏，你我都是这个游戏里最普通不过的 NPC，我们来到这个世界的唯一目的，也许是为了在这个宇宙中传递某种讯息，正如屏幕前的你，曾经无意间捕获到这点微弱的信号。罗曼罗兰曾经说过，『世上只有一种英雄主义，就是在认清生活真相之后依然热爱生活』，而这款游戏的目的，或许正是要我们在窥破这个世界的真实面目的时候，依然能够勇敢地面对人类孤独的永恒本质，依然能够用热爱和虔诚去面对由别人定义的意义，依然能够让生命中的每个当下都变得不舍和难忘，无论快乐还是悲伤，我们总不愿意永远活在别人的期待里，成为一个被信息茧房和消费主义麻醉的人，而这，正是我想要的冒险。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-10-17-obs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-10-17-obs/" itemprop="url">边录屏边看音乐歌词，录屏软件 OBS 的这个用法真的绝了。</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-17T15:00:00+00:00">
                2021-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>Hello 各位晚上好，我是安哥。   </p>
<p>今天来给大家介绍录屏软件 OBS 的一个用法，实现如下图的效果，一边录屏，一边看当前正在播放的音乐《机场雷雨》的歌词。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344745003758.jpg"></p>
<p>OBS 是一个开源免费的软件，支持 Windows、macOS 和 Linux 系统的电脑，可从官网下载。</p>
<p>如果你无法打开 OBS 的官网，也可以点击下方的公众号卡片，在后台回复「<strong>OBS</strong>」，获取我下载好的 Windows 和 macOS 系统的安装包。   </p>
<p>下面就来说说实现上面那种效果的方法：   </p>
<p>点击「来源」窗口左下角的加号，添加我们想捕获的窗口或区域，这里选择「<strong>窗口采集</strong>」。        </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344748911019.jpg"></p>
<p>选择窗口采集，它会显示电脑电脑当前运行的所有软件，这里请确保你的电脑运行了任意一个音乐软件，比如我这里用到的「<strong>网易云音乐</strong>」，即窗口采集捕获的是整个音乐软件。   </p>
<p>接着右击「窗口采集」，选择「<strong>滤镜</strong>」，给我们捕获的音乐窗口添加一些效果。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344751491162.jpg"></p>
<p>在滤镜中，我们想要实现两种效果，一个是抠去网易云音乐歌词默认的背景，将其更换我们喜欢的其他颜色；一个是去掉网易云歌词页面左侧旋转的专辑封面等元素，只保留右侧的歌词。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344753519077.jpg"></p>
<p>OBS 实现抠图，需要用到内置的「<strong>色值</strong>」滤镜，点击滤镜左下角的加号，选择「色值」。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344756952568.jpg"></p>
<p>添加色值滤镜后，右侧面板需要对相关的参数进行调整，首先我们需要选取想抠去的颜色，点击「选择颜色」，在打开的窗口中，选择左下角的「Pick Screen Color」，用拾色器选择网易云歌词背景的颜色。   </p>
<p>不过需要注意的是，如果你使用的 macOS 版的 OBS，它的拾色器是不支持跨软件拾取颜色的，因此无法直接吸取网易云歌词背景的颜色，此时你可以先用截图软件，例如 Snipaste 或者 iShot 吸取网易云歌词背景的颜色，再将色值粘贴到 OBS 中。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344761765661.jpg"></p>
<p>选择要抠去的背景色之后，还需要稍微调整一下下面的参数——<strong>相似度、平滑</strong>和<strong>对比度</strong>，参数的调整没有固定的数值，需要结合实际情况进行调整。</p>
<p>如下图，调整参数之后，原本的歌词页面视觉发生了变化，最大的变化在于，它<strong>保留了高亮显示的歌词</strong>，而已经播放或者还未播放的歌词，就快看不清了。  </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344764723735.jpg"></p>
<p>经过这番调节之后，暂时关闭滤镜面板，回到 OBS 的录屏窗口，你应该就可以看到一个抠去背景、呈现为<strong>透明背景</strong>的歌词界面。    </p>
<p>原本的歌词背景是变透明了，但它带来了一个新的问题，白色的歌词与电脑壁纸的对比度不够明显、或是白色歌词与一些软件内部的白色文字重叠在一起，会导致歌词无法看清。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344767652435.jpg"></p>
<p>为解决这个问题，我们可以在透明背景的歌词下方<strong>放一个色块</strong>，将色块的颜色设置为高对比、而且是我们喜欢的颜色。   </p>
<p>再次点击「来源」左下角的加号，选择「<strong>色源</strong>」。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344771336375.jpg"></p>
<p>右击色源，选择「属性」，在打开的窗口，点击「<strong>选择颜色</strong>」，从中挑选一个你喜欢的颜色，作为透明歌词的背景色。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344772311011.jpg"></p>
<p>这里还需要注意的是，OBS 的「来源」面板中创建的窗口或元素，是存在着<strong>层级关系</strong>的，默认最后创建的「色源」会排在最上层，会挡住我们在最开始创建的「窗口采集」，因此需要调整一下两者的位置，将代表歌词的「窗口采集」拖拽放到作为背景的「色源」上方。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344773208314.jpg"></p>
<p>说完了抠去歌词背景的步骤，下面再来说一下，如何裁剪歌词页面不想要的部分。  </p>
<p>同样右击「窗口采集」，选择「<strong>滤镜</strong>」。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344751491162.jpg"></p>
<p>点击左下角的加号，选择「<strong>裁剪&#x2F;填充</strong>」。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344777245416.jpg"></p>
<p>调整裁剪&#x2F;填充滤镜右侧的四个参数，调整的时候，可以在上方的窗口实现预览到裁剪之后的效果。   </p>
<p>因为是裁到歌词页面左侧的内容，因此「左」参数的数值需要调得比较大。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/17/16344777837484.jpg"></p>
<p>值得一提的是，要想在录屏或直播的时候，让捕获的歌词随着音乐的播放<strong>自动滚动</strong>，播放音乐的软件不能最小化到后台运行，而要一直保持在前台运行。          </p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">              </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-10-16-zxsq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-10-16-zxsq/" itemprop="url">创建知识星球社群 500 天，我有这 3 点心得。</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-16T15:00:00+00:00">
                2021-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>Hello 各位晚上好。      </p>
<p>去年我写过一篇文章《<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMjY0NTY5OA==&mid=2649882126&idx=1&sn=763e1f64a72ad57915e8c532e50126a2&chksm=83abfa23b4dc7335e0be802f04cbce653f6c60dc0fc45b5c778dc89552e652e79c6227c44b32&token=215341684&lang=zh_CN#rd">你的另一个朋友圈「效率工具指北」</a>》，介绍了我创建的一个免费的知识星球「效率工具指北」，现在已更名为与公众号同名的「效率工具指南」。     </p>
<p>从去年 5 月份创建到今天，这个免费的社群已存在 510 天，在这一年多的时间里，这个星球累计发布了 1233 条动态，大部分动态都是我发布的，少部分是社群内的群友发布的内容，比如他们的运动打卡、对产品的吐槽、或是推荐自己开发的一个产品等等。       </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/16/16343892328689.jpg"></p>
<p>加入这个星球的总用户数为 907 人，不过就像公众号一样，过度关注「关注数」这个数据是没有意义的，因为<strong>关注数并不等同于阅读数</strong>，这中间存在着打开率（打开比例）的问题。     </p>
<p>我统计了一下最近 1 个月所有动态的平均阅读量——133，打开率为 14.7%，我觉得还是能接受的。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/16/16343900248560.jpg"></p>
<p>除了上面的数据，这里还要夸一下知识星球提供的一个功能「<strong>二维码分析</strong>」，在移动端生成加入知识星球的二维码时，可以为二维码添加「备注」，之后将二维码放到不同的渠道，就可以了解从不同渠道加入的用户数量。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/16/16343906154404.jpg"></p>
<p>简单说完了数据的问题，接下来我想说一下，运营这个免费星球的一些心得，以及我最近想到的一些东西：   </p>
<h2 id="运营知识星球的一些心得"><a href="#运营知识星球的一些心得" class="headerlink" title="运营知识星球的一些心得"></a>运营知识星球的一些心得</h2><ul>
<li>免费的知识星球是廉价的，<strong>人们不会珍惜免费得来的东西</strong>，毕竟有些付费的东西都看不过来了，哪还有时间分配给免费的东西？                   </li>
<li>如何让星球内的用户活跃起来，有在星球内发布动态的动力，是一个大问题。有些星球使用物质激励的方式，比如现金奖励、星球内流通的虚拟奖励；有些星球采用「知行合一」的方式去影响用户，比如知识星球「辉哥奇谭读者群」的星主 @辉哥 将自己的运动打卡、碎片化想法、每日语音、每周语音发布到星球内，鼓励加入的读者可以采取类似的行为，加入这个星球最大的感受是——这里面不少读者都很活跃，整个星球每日 100+ 动态是家常便饭。     </li>
<li>知识星球不少用户可能都是这种状态：一开始兴冲冲加入知识星球了，但隔了两三天之后，可能就把加入星球这件事忘光了。原因一方面可能是初次使用知识星球没有下载移动端的 App，不像是放在手机桌面的 App，网页版的产品在大脑中停留的时间太短；另一方面是<strong>没有养成使用知识星球的习惯</strong>，习惯的养成可能涉及多方面的因素：你之前消费的内容形式的偏好（更喜欢看文章，还是更喜欢看视频）、你对自己喜欢的内容创作者发布新内容的期待程度等等。</li>
</ul>
<p>关于使用习惯这一点，有位加入星球的用户是这么看的：  </p>
<blockquote>
<p>越难的事越能过滤人。     </p>
</blockquote>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/16/16343936437865.jpg"></p>
<p>他说的这个观点，有一点点哲学的意思😂但说实话，多数时候打开知识星球 App 之前，我给打开知识星球这个行为设定的预期是：   </p>
<blockquote>
<p>我希望每次打开星球，都能获得一些有价值的东西，而不仅仅是纯粹的图一乐，或者单纯地消磨时间。   </p>
</blockquote>
<h2 id="flomo-和知识星球"><a href="#flomo-和知识星球" class="headerlink" title="flomo 和知识星球"></a>flomo 和知识星球</h2><p>之前看到 flomo 的创始人 @少楠 老师说过一句话，没找到原话，大意是：对于许多知识工作者而言，当他们离职的时候，随身带走的东西可能就是他们日积月累下来称之「经验」的东西，这些东西可能是存在于你的脑子，也可能是外化为你的笔记本上的笔记，或者是存放在你 flomo 里面的东西。    </p>
<p>单纯从<strong>沉淀内容</strong>的用途出发，我觉得 flomo 和知识星球这两款产品有相通之处，唯一的区别在于：   </p>
<ul>
<li>flomo 更侧重个人的私密记录      </li>
<li>知识星球可以是一个人的私密记录（平台存在着内容审核的环节），也可以是一对多的内容分享        </li>
<li>flomo 支持批量导出内容，知识星球暂不支持批量导出</li>
</ul>
<h2 id="社群的一个理想状态"><a href="#社群的一个理想状态" class="headerlink" title="社群的一个理想状态"></a>社群的一个理想状态</h2><p>它能自发运行，不需要社群的管理者刻意引导群内的用户发言，用户会自发、主动地贡献内容。       </p>
<h2 id="去哪里寻找创作者？"><a href="#去哪里寻找创作者？" class="headerlink" title="去哪里寻找创作者？"></a>去哪里寻找创作者？</h2><p>根据创作者本身的 level 或者说咖位，创作者可以分为：   </p>
<ul>
<li>头部创作者</li>
<li>腰部创作者</li>
<li>尾部创作者（臀部创作者）</li>
</ul>
<p>还有根据创作的内容，按不同的领域进行细分：   </p>
<ul>
<li>健身</li>
<li>美食  </li>
<li>科技   </li>
<li>互联网</li>
<li>产品</li>
<li>个人成长   </li>
<li>读书  </li>
<li>职场   </li>
<li>技能学习</li>
</ul>
<p>根据内容的创作形式，将创作者分为：           </p>
<ul>
<li>图文内容创作者：知识星球目前大多的创作者应该都属于这一类           </li>
<li>播客创作者：播客节目「疯投圈」的两位主理人在知识星球上创建了一个买断制的知识星球              </li>
<li>视频创作者：B 站不少 Up 主都有建立交流群的需求，很多都使用 QQ 群</li>
</ul>
<h2 id="推荐一期播客节目"><a href="#推荐一期播客节目" class="headerlink" title="推荐一期播客节目"></a>推荐一期播客节目</h2><p>最后，给大家推荐一期我刚刚听完的播客节目《<a target="_blank" rel="noopener" href="https://www.xiaoyuzhoufm.com/episode/615afe285a518e53b88049ec">寻觅意义：做一些渺小而伟大的事情</a>》，来自前面提到的 flomo 创始人 @少楠 老师最新的一期播客，给你或许有些浮躁的内心降降火：      </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/16/16343952861090.jpg"></p>
<h2 id="欢迎关注"><a href="#欢迎关注" class="headerlink" title="欢迎关注"></a>欢迎关注</h2><p>以上，就是本次想和你分享的内容，希望能够对你有一点帮助。     </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/05/28/gong-zhong-hao-wei-bu-er-wei-ma-dailogo.png" alt="公众号：效率工具指南">              </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-10-16-using-dropbox-as-git-remote-rep/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-10-16-using-dropbox-as-git-remote-rep/" itemprop="url">把 DropBox 当作私有化 Git 仓库</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-16T14:15:58+00:00">
                2021-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <h2 id="一、序"><a href="#一、序" class="headerlink" title="一、序"></a>一、序</h2><p>我最近有一些随手的小项目，不便于公开到 GitHub 上面，但是又想有一个简单的私有化仓库。</p>
<p>于是我想到了 DropBox。</p>
<p>但是，我们不能简单地把项目放到 DropBox 目录中，因为这样会使得每次简单的保存都会发起文件同步，编译的时候的一些临时文件改动也会造成 DropBox 同步，这样会把电脑 CPU 占用搞得很高。</p>
<p>我们要的只是一个远程仓库。</p>
<p>于是我想到了 <code>Git init --bare</code> 指令，测试了一下，效果还可以，给大家分享一下。</p>
<h2 id="二、方法"><a href="#二、方法" class="headerlink" title="二、方法"></a>二、方法</h2><p>1、我们还是正常地在本地非 DropBox 目录用 Git 来管理工程，我们假设这个本地的工程已经建好了。</p>
<p>2、同步地，我们在 DropBox 目录下，新建一个对应的同步目录，在目录下，使用 <code>git init --bare</code> 进行初始化（如下图）。该指令只会创建一个空的 Git 仓库，同时没有工作区和缓存区。</p>
<img src="/images/dropbox-1.png" class="">

<p>3、在代码工程的 Git 仓库，使用 <code>git remote add</code> 指令，将刚刚创建的仓库指定成名为 <code>origin</code> 的远程仓库（如下图）。</p>
<img src="/images/dropbox-2.png" class="">

<p>4、最后执行 <code>git push origin master</code> 将代码同步到 DropBox。</p>
<p>5、看了一眼 DropBox 状态，它很快就将代码同步到了云端。</p>
<img src="/images/dropbox-3.png" class="">

<p>6、当我们要在另一台电脑上下载这个工程时，只需要这样：<code>git clone &lt;DropBox仓库目录&gt; &lt;本地目录&gt;</code> 即可（如下图）。</p>
<img src="/images/dropbox-4.png" class="">

<p>以上。</p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021/eslint-prettier-commitlint/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/eslint-prettier-commitlint/" itemprop="url">使用 ESLint + Prettier + Commitlint 规范代码风格与提交流程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-13T21:37:49+00:00">
                2021-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
          <p>最近因为课程需要开了几个多人协作的新项目，感觉有必要在团队中强制一下代码规范，免得提交上来的东西对 leader 血压不好。前后端都是 TypeScript 的，所以就用流行的 ESLint + Prettier 组合拳（配合 <a target="_blank" rel="noopener" href="https://standardjs.com/">Standard</a> 规范），EditorConfig 同步编辑器配置，再加上 commitlint 规范提交信息，最后用 Git Hooks 实现自动化检查。</p>
<p>配置虽然不难，但还是有点繁琐的，所以记录一下，如果忘了下次可以翻回来看。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2021/eslint-prettier-commitlint/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2021-10-9-appfeatures/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021-10-9-appfeatures/" itemprop="url">这些App隐藏的小细节，天天在用都不一定知道。</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-09T15:25:00+00:00">
                2021-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      
        
        
          
            <p>Hello 各位晚上好。  </p>
<p>今天发一点我之前陆陆续续发现或者从别处看来的 App 细节&#x2F;功能，<strong>发掘 App 中的设计细节，这个过程有点像是在寻宝</strong>，不少时候会让人有意外之喜，这也是我在闲暇时间的一点小癖好，希望下方分享的一些东西，你也会喜欢。   </p>
<h2 id="滴答清单"><a href="#滴答清单" class="headerlink" title="滴答清单"></a>滴答清单</h2><p>这是我今天看到一个 Telegram 群的消息才知道的功能，得亏我去年一直在安利滴答清单，却一直没有发现这个细节：     </p>
<p>在添加任务的输入框中，直接粘贴 url 链接、并按下 Enter 键，滴答清单会<strong>解析 url 得到链接的标题</strong>，省去了复制链接之后，可能还要粘贴内容标题的操作。   </p>
<p>当然，如果你添加的任务中包含了<strong>非 url 链接的文本内容</strong>，那么 url 链接就不会自动解析出标题了。  </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/16337881931614.jpg"></p>
<h2 id="Day-One"><a href="#Day-One" class="headerlink" title="Day One"></a>Day One</h2><p>Day One，是苹果生态下一款优秀的日记应用，支持 iOS 和 macOS 系统。  </p>
<p>这款 App 在今年 8 月份的时候，增加了一个和 Notion 非常相似的功能，在空白位置输入<strong>斜杆 &#x2F;</strong> ，可以<strong>呼出命令列表</strong>。  </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/16337885185371.jpg"></p>
<p>呼出的命令列表如下，可以快速插入当前的时间、日期、待办事项复选框、分割线、不同字号大小的标题，第一时间看到这个，觉得很 Notion。   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/16337889365853.jpg"></p>
<h2 id="智行火车票服务号"><a href="#智行火车票服务号" class="headerlink" title="智行火车票服务号"></a>智行火车票服务号</h2><p>智行火车票，是一个购买高铁票的第三方应用。如果你通过这个 App 买票，并且绑定了微信账号，它会通过服务号向你发送 3 次消息提醒：     </p>
<ul>
<li>服务号发车前 2 小时提醒   </li>
<li>服务号发车前 30 分钟提醒   </li>
<li>服务号列车即将到站提醒</li>
</ul>
<p>对比官方的 12306，还是得说一句，有些事情啊，民营公司确实做得更好，想得更到位。    </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/img0535-2.JPG" alt="IMG_0535 2"></p>
<h2 id="Twitter-搜索命令"><a href="#Twitter-搜索命令" class="headerlink" title="Twitter 搜索命令"></a>Twitter 搜索命令</h2><p>微博自带了搜索自己或他人发布过的微博动态的功能，但作为微博祖师爷的 Twitter 却没有这个功能。</p>
<p>如果我们想在 Twitter 上实现类似微博搜索的效果，需要使用下面的命令：</p>
<p><strong>关键词(from:推特 ID)</strong></p>
<p>注意：这里的括号是英文输入法下的括号。       </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/16337895174003.jpg"></p>
<h2 id="微信读书无限卡帮你省了多少钱"><a href="#微信读书无限卡帮你省了多少钱" class="headerlink" title="微信读书无限卡帮你省了多少钱"></a>微信读书无限卡帮你省了多少钱</h2><p>如果你有用过微信读书或者正在使用微信读书，可能会对它的「无限阅读卡」印象深刻。  </p>
<p>为了让用户能够对无限卡带来的价值有更直观、具体的感受，无限卡页面给出了累计节省的金额，用一个具体的数字，让虚拟、摸不着的会员服务变得可感知。  </p>
<p>声明：下面的图片来自网络，不是我自己的截图。      </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/9c8af769f207e26c8786f7e7eeec9ed9.jpeg" alt="9c8af769f207e26c8786f7e7eeec9ed9"></p>
<p>除了微信读书的无限阅读卡，京东 Plus 会员也有类似的设计：   </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/img0538.jpg" alt="IMG_0538"></p>
<h2 id="即刻-App-圈子"><a href="#即刻-App-圈子" class="headerlink" title="即刻 App 圈子"></a>即刻 App 圈子</h2><p>除了 Twitter，即刻最近也成了我每天都会刷的一个应用，这里说一个我最近才发现的东西：  </p>
<p>和豆瓣上的<strong>小组</strong>类似，即刻也划分出了各式各样的<strong>圈子</strong>，譬如下图的「追剧小组」，在追剧小组的顶部，它还列出了与追剧相关的子圈子——美剧、日剧、番剧等，用了即刻挺长时间，头一回在即刻见到这种<strong>圈子套娃</strong>的设计。  </p>
<p><img src="https://article-picbed-1302715071.cos.ap-guangzhou.myqcloud.com/2021/10/09/img0520.jpg" alt="IMG_0520"></p>
<p>以上，就是本次想和你分享的内容。   </p>
<p>如果对你也有帮助的话，别忘了点击下方的<strong>点赞、在看</strong>和<strong>分享</strong>按钮，<strong>你的小小支持，是我持续更新的最大动力</strong>，我们下次再见。         </p>

          
        
      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/74/">74</a><a class="extend next" rel="next" href="/page/13/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1464</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">910</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5358884258"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
