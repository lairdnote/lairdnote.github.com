<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="codeva-HZoIBm8yNp" />
<meta name="bytedance-verification-code" content="xa6iZeY+/XCOJvarHaDY" />








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="工具,系统设计," />










<meta name="description" content="我的 博客 停服已经有几个月了，主要原因是使用的 Google Cloud 免费服务器已经到期了，而整个博客系统的迁移成本很大，因此迟迟没有开启服务。">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Docker轻松部署Hexo博客系统">
<meta property="og:url" content="https://blog.feedscoin.com/2020/12/hexo-to-docker/index.html">
<meta property="og:site_name" content="逐流小站">
<meta property="og:description" content="我的 博客 停服已经有几个月了，主要原因是使用的 Google Cloud 免费服务器已经到期了，而整个博客系统的迁移成本很大，因此迟迟没有开启服务。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.fanhaobai.com/2020/12/hexo-to-docker/704035c6-348e-439b-9048-d05a2a18ef1f.png">
<meta property="article:published_time" content="2020-12-27T06:00:00.000Z">
<meta property="article:modified_time" content="2024-01-15T07:29:51.000Z">
<meta property="article:author" content="Laird Lau">
<meta property="article:tag" content="工具">
<meta property="article:tag" content="系统设计">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.fanhaobai.com/2020/12/hexo-to-docker/704035c6-348e-439b-9048-d05a2a18ef1f.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.feedscoin.com/2020/12/hexo-to-docker/"/>





  <title>使用Docker轻松部署Hexo博客系统 | 逐流小站</title>
  





<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MW47YH6RH0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MW47YH6RH0');
</script>





<meta name="generator" content="Hexo 7.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">逐流小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">想回到那个能随便跳槽的年代</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.feedscoin.com/2020/12/hexo-to-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逐流小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">使用Docker轻松部署Hexo博客系统</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-27T06:00:00+00:00">
                2020-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">系统设计</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5167312561"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
      

      

        <p>我的 <a target="_blank" rel="noopener" href="https://www.fanhaobai.com/">博客</a> 停服已经有几个月了，主要原因是使用的 <a target="_blank" rel="noopener" href="https://cloud.google.com/free/">Google Cloud</a> 免费服务器已经到期了，而整个博客系统的迁移成本很大，因此迟迟没有开启服务。</p>
<p><img src="//www.fanhaobai.com/2020/12/hexo-to-docker/704035c6-348e-439b-9048-d05a2a18ef1f.png" alt="预览图"><span id="more"></span></p>
<p>这周末，终于有时间来彻底解决博客迁移问题了。通过改造 Hexo 博客系统，使其支持 Docker 部署，彻底摆脱了运行环境依赖，以后再更换云服务器厂商时，就可以做到快速平滑迁移了。</p>
<p>我的博客做过定制化改造，使用的是 <a target="_blank" rel="noopener" href="https://github.com/fan-haobai/hexo-theme-yilia">hexo-theme-yilia</a> 作为主题，评论使用的是 <a target="_blank" rel="noopener" href="https://github.com/fan-haobai/disqus-php-api">disqus-php-api</a>，支持 HTTPS 协议，因此本次改造主要涉及这些。</p>
<h2 id="Docker-环境"><a href="#Docker-环境" class="headerlink" title="Docker 环境"></a>Docker 环境</h2><h3 id="云服务器"><a href="#云服务器" class="headerlink" title="云服务器"></a>云服务器</h3><p>由于没有了 Google Cloud 的免费使用资格，只能在国内挑选较便宜的腾讯云云服务器厂商，购买了一台低配云服务器。</p>
<p>这台服务器的操作系统是 <a href="">CentOS</a>，我们选用 <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/install/">Docker Compose</a> 作为容器编排工具。</p>
<h3 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.删除旧的Docker版本</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.添加Docker源</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.安装Docker</span></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line">sudo yum install docker-ce-20.10.1 docker-ce-cli-20.10.1 containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.启动Docker</span></span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.查看Docker版本</span></span><br><span class="line">docker -v</span><br><span class="line">Docker version 20.10.1, build 831ebea</span><br></pre></td></tr></table></figure>

<h3 id="安装-Docker-Compose"><a href="#安装-Docker-Compose" class="headerlink" title="安装 Docker Compose"></a>安装 Docker Compose</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.获取docker-compose脚本</span></span><br><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.增加可执行权限</span></span><br><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line">sudo <span class="built_in">ln</span> -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.查看版本</span></span><br><span class="line">docker-compose --version</span><br><span class="line">docker-compose version 1.27.4, build 40524192</span><br></pre></td></tr></table></figure>

<h2 id="项目改造"><a href="#项目改造" class="headerlink" title="项目改造"></a>项目改造</h2><h3 id="调整目录结构"><a href="#调整目录结构" class="headerlink" title="调整目录结构"></a>调整目录结构</h3><p>之前的目录结构较为单一，需调整项目目录结构。调整后的目录结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">├── _config.yml           <span class="comment"># Hexo配置文件</span></span><br><span class="line">├── disqus                <span class="comment"># Disqus评论</span></span><br><span class="line">├── themes                <span class="comment"># Hexo主题</span></span><br><span class="line">│   └── yilia             <span class="comment"># hexo-theme-yilia主题</span></span><br><span class="line">├── <span class="built_in">source</span>                <span class="comment"># 文章.md文件</span></span><br><span class="line">├── public                <span class="comment"># Hexo发布后的静态资源文件</span></span><br><span class="line">├── dockerfiles           <span class="comment"># Dockerfile文件</span></span><br><span class="line">│   ├── nginx</span><br><span class="line">│   ├── nodejs</span><br><span class="line">│   └── php</span><br><span class="line">├── docker-compose.yml    <span class="comment"># 容器编排配置</span></span><br><span class="line">├── docker.env            <span class="comment"># Docker环境变量文件</span></span><br><span class="line">├── docker.example.env    <span class="comment"># Docker环境变量示例文件</span></span><br><span class="line">├── network-override.yml  <span class="comment"># 容器编排配置（特殊网络）</span></span><br><span class="line">└── package.json          <span class="comment"># Hexo依赖包</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>disqus</code> 和 <code>yilia</code> 目录分别对应 <a target="_blank" rel="noopener" href="https://github.com/fan-haobai/disqus-php-api">disqus-php-api</a> 和 <a target="_blank" rel="noopener" href="https://github.com/fan-haobai/hexo-theme-yilia">hexo-theme-yilia</a> 这 2 个子项目，并采用 <code>submodule</code> 模式管理这些源代码。</p>
<blockquote>
<p>在 <code>submodule</code> 模式下，<code>clone</code> 和 <code>pull</code> 命令会有一些变化，分别为 <code>git clone --recursive https://github.com/fan-haobai/blog.git</code><br>和 <code>git pull &amp;&amp; git submodule foreach git pull origin master</code>。</p>
</blockquote>
<h3 id="编排容器"><a href="#编排容器" class="headerlink" title="编排容器"></a>编排容器</h3><p>本博客系统，主要依赖 <code>NodeJS</code>、<code>PHP</code>、<code>Nginx</code> 环境，因此分别构建 3 个容器。</p>
<h3 id="配置-docker-compose-yml"><a href="#配置-docker-compose-yml" class="headerlink" title="配置 docker-compose.yml"></a>配置 docker-compose.yml</h3><p>Docker Compose 会根据 <code>docker-compose.yml</code> 配置文件，来自动编排容器。配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    restart: always</span><br><span class="line">    build: ./dockerfiles/nginx</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      - <span class="string">&quot;443:443&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      <span class="comment"># 博客源代码</span></span><br><span class="line">      - <span class="string">&quot;/var/www/blog:/var/www/blog&quot;</span></span><br><span class="line">      <span class="comment"># HTTPS证书</span></span><br><span class="line">      - <span class="string">&quot;/var/www/ssl/certs:/var/www/ssl/certs&quot;</span></span><br><span class="line">      <span class="comment"># Nginx配置</span></span><br><span class="line">      - <span class="string">&quot;<span class="variable">$PWD</span>/dockerfiles/nginx/conf.d:/etc/nginx/conf.d&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: /bin/bash /start.sh</span><br><span class="line">    env_file:</span><br><span class="line">      - docker.env</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - <span class="string">&quot;raw.githubusercontent.com:199.232.96.133&quot;</span></span><br><span class="line">    container_name: <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  nodejs:</span><br><span class="line">    build: ./dockerfiles/nodejs</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;4000:4000&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;/var/www/blog:/var/www/blog&quot;</span></span><br><span class="line">    container_name: <span class="string">&quot;nodejs&quot;</span></span><br><span class="line">  php:</span><br><span class="line">    restart: always</span><br><span class="line">    build: ./dockerfiles/php</span><br><span class="line">    expose:</span><br><span class="line">      - <span class="string">&quot;9000&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;/var/www/blog:/var/www/blog&quot;</span></span><br><span class="line">    container_name: <span class="string">&quot;php&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>services</code> 下为需要编排的 <code>nodejs</code>、<code>php</code>、<code>nginx</code> 容器服务。每个容器服务都可以灵活配置，常见的配置参数如下：</p>
<ul>
<li>restart：容器退出时，是否重启</li>
<li>build：构建容器 Dockerfile 文件所在的目录</li>
<li>ports：映射端口</li>
<li>volumes：挂载目录</li>
<li>command：容器启动后执行的命令</li>
<li>env_file：环境变量文件</li>
<li>extra_hosts：域名IP映射</li>
<li>container_name：容器名称</li>
</ul>
<blockquote>
<p>Docker Compose 支持多配置文件，且为覆盖关系。因此将 <code>ssl-override.yml</code> 作为获取 HTTPS 证书时启动容器的配置文件。</p>
</blockquote>
<h3 id="配置-docker-env"><a href="#配置-docker-env" class="headerlink" title="配置 docker.env"></a>配置 docker.env</h3><p>环境变量统一配置在 <code>docker.env</code> 文件中，并增加示例环境文件 <code>docker.example.env</code>。环境变量目前较少，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是否启用HTTPS证书</span></span><br><span class="line">ENABLE_SSL=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持HTTPS协议的域名</span></span><br><span class="line">SSL_DOMAINS=fanhaobai.com,www.fanhaobai.com</span><br></pre></td></tr></table></figure>

<h3 id="构建-Dockerfile"><a href="#构建-Dockerfile" class="headerlink" title="构建 Dockerfile"></a>构建 Dockerfile</h3><p>Dockerfile 文件统一放在 <code>dockerfiles</code> 目录下，并分别建立 <code>nodejs</code>、<code>php</code>、<code>nginx</code> 文件夹。</p>
<h4 id="NodeJS"><a href="#NodeJS" class="headerlink" title="NodeJS"></a>NodeJS</h4><p>该容器下需要安装 <code>git</code>、<code>npm</code>。Dockerfile 文件如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROM node:12-alpine</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone \</span><br><span class="line">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;https://mirrors.ustc.edu.cn/alpine/v3.9/main/&quot;</span> &gt; /etc/apk/repositories  \</span><br><span class="line">    &amp;&amp; npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org \</span><br><span class="line">    &amp;&amp; apk add --no-cache git \</span><br><span class="line">    &amp;&amp; npm install hexo-cli -g</span><br><span class="line"></span><br><span class="line">ADD *.sh /</span><br><span class="line">RUN <span class="built_in">chmod</span> 777 /*.sh</span><br><span class="line"></span><br><span class="line">EXPOSE 4000</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;/start.sh&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>其中，<code>start.sh</code> 为容器的启动脚本，主要作用为生成静态资源文件。内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /var/www/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新代码</span></span><br><span class="line">git pull &amp;&amp; git submodule foreach git pull origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成静态资源</span></span><br><span class="line">npm install --force</span><br><span class="line"><span class="comment"># hexo clean</span></span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><p>该容器基于官方的基础镜像，安装一些必要的扩展。Dockerfile 文件如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">FROM php:7.3.7-fpm-alpine3.9</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&#x27;https://mirrors.aliyun.com/alpine/v3.9/main/&#x27;</span> &gt; /etc/apk/repositories &amp;&amp; \</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;https://mirrors.aliyun.com/alpine/v3.9/community/&#x27;</span> &gt;&gt; /etc/apk/repositories</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装扩展</span></span><br><span class="line">RUN apk add --no-cache <span class="variable">$PHPIZE_DEPS</span> \</span><br><span class="line">    &amp;&amp; apk add --no-cache libstdc++ libzip-dev vim\</span><br><span class="line">    &amp;&amp; apk update \</span><br><span class="line">    &amp;&amp; apk del <span class="variable">$PHPIZE_DEPS</span></span><br><span class="line">RUN apk add --no-cache freetype libpng libjpeg-turbo freetype-dev libpng-dev libjpeg-turbo-dev \</span><br><span class="line">    &amp;&amp; apk update \</span><br><span class="line">    &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ --with-png-dir=/usr/include/ \</span><br><span class="line">    &amp;&amp; docker-php-ext-install -j$(<span class="built_in">nproc</span>) gd \</span><br><span class="line">    &amp;&amp; docker-php-ext-install -j$(<span class="built_in">nproc</span>) opcache \</span><br><span class="line">    &amp;&amp; docker-php-ext-install -j$(<span class="built_in">nproc</span>) bcmath</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件</span></span><br><span class="line">RUN <span class="built_in">mv</span> <span class="string">&quot;<span class="variable">$PHP_INI_DIR</span>/php.ini-production&quot;</span> <span class="string">&quot;<span class="variable">$PHP_INI_DIR</span>/php.ini&quot;</span></span><br><span class="line">ADD conf.d/* <span class="variable">$PHP_INI_DIR</span>/conf.d/</span><br></pre></td></tr></table></figure>

<p>其中，<code>conf.d</code> 下为 <code>php</code> 的配置文件。</p>
<h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><ul>
<li>Dockerfile 文件</li>
</ul>
<p>该容器基于官方的基础镜像，并安装 <code>cron</code>、<code>wget</code>、<code>python</code>。Dockerfile 文件如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装cron等</span></span><br><span class="line">RUN sed -i s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list \</span><br><span class="line">    &amp;&amp; apt-get update &amp;&amp; apt-get install -y cron wget python</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动脚本和配置</span></span><br><span class="line">ADD *.sh /</span><br><span class="line">ADD nginx.conf /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS证书生成脚本</span></span><br><span class="line">ADD ssl/* /var/www/ssl/</span><br><span class="line">RUN <span class="built_in">chmod</span> +x /var/www/ssl/*.sh</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">chmod</span> 777 -R /var/log/nginx</span><br></pre></td></tr></table></figure>

<p>其中，<code>conf.d</code> 下为 <code>nginx</code> 的配置文件，<code>ssl</code> 下为 HTTPS 证书的生成脚本。</p>
<ul>
<li>HTTPS 证书生成脚本</li>
</ul>
<p><code>ssl</code> 下的 <code>init_ssl.sh</code> 为首次获取 HTTPS 证书脚本，<code>refresh_cert.sh</code> 为更新 HTTPS 证书脚本。</p>
<p>其中，<code>init_ssl.sh</code> 脚本内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Stoping nginx ...&quot;</span></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Starting nginx ...&quot;</span></span><br><span class="line">docker-compose -f docker-compose.yml -f ssl-override.yml up --force-recreate --build -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否启动完成</span></span><br><span class="line"><span class="keyword">until</span> [ <span class="string">&quot;`docker inspect -f &#123;&#123;.State.Running&#125;&#125; nginx`&quot;</span>==<span class="string">&quot;true&quot;</span> ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;### Wait nginx docker start ...&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 0.1;</span><br><span class="line"><span class="keyword">done</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成HTTPS证书</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Gen nginx ssl ...&quot;</span></span><br><span class="line">docker <span class="built_in">exec</span> nginx /bin/bash /var/www/ssl/refresh_cert.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启nginx</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Restart nginx ...&quot;</span></span><br><span class="line">docker <span class="built_in">exec</span> nginx nginx -s reload</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ssl-override.yml</code> 会覆盖 <code>docker-compose.yml</code> 中的环境变量，因此会将环境变量 <code>ENABLE_SSL</code> 设置为 <code>false</code>，并将 <code>php</code> 解析到 <code>127.0.0.1</code>，以确保 <code>nginx</code> 容器在首次能成功启动。 </p>
</blockquote>
<p>而 <code>refresh_cert.sh</code> 脚本内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span>=<span class="string">&#x27;/var/www/ssl&#x27;</span></span><br><span class="line">certs_dir=<span class="string">&quot;<span class="variable">$dir</span>/certs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$certs_dir</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$certs_dir</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$SSL_DOMAINS</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;### Domains is empty&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Starting ssl ...&quot;</span></span><br><span class="line"></span><br><span class="line">openssl genrsa 4096 &gt; account.key</span><br><span class="line">openssl genrsa 4096 &gt; domain.key</span><br><span class="line"></span><br><span class="line">domains=`<span class="built_in">echo</span> <span class="string">&quot;DNS:<span class="variable">$SSL_DOMAINS</span>&quot;</span> | sed <span class="string">&#x27;s/,/&amp;DNS:/g&#x27;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Gen domain key, domains: <span class="variable">$domains</span> ...&quot;</span></span><br><span class="line">openssl req -new -sha256 -key domain.key -subj <span class="string">&quot;/&quot;</span> -reqexts SAN -config \</span><br><span class="line">    &lt;(<span class="built_in">cat</span> /etc/ssl/openssl.cnf &lt;(<span class="built_in">printf</span> <span class="string">&quot;[SAN]\nsubjectAltName=<span class="variable">$domains</span>&quot;</span>)) &gt; domain.csr</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Download acme_tiny script ...&quot;</span></span><br><span class="line">wget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py -O acme_tiny.py</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### Gen chained cert ...&quot;</span></span><br><span class="line">python acme_tiny.py --account-key account.key --csr domain.csr --acme-dir <span class="variable">$dir</span>/challenges/ &gt; signed.crt || <span class="built_in">exit</span></span><br><span class="line">openssl dhparam -out dhparams.pem 2048</span><br><span class="line">wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem &gt; intermediate.pem</span><br><span class="line"><span class="built_in">cat</span> signed.crt intermediate.pem &gt; chained.pem</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;### End ssl ...&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>SSL_DOMAINS</code> 为环境变量文件 <code>docker.env</code> 中配置需要支持 HTTPS 的域名。</p>
<ul>
<li>容器启动脚本</li>
</ul>
<p>在该容器启动后，会执行 <code>start.sh</code> 脚本。其内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span>=<span class="string">&quot;/var/www/ssl&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$dir</span>/challenges&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否启用HTTPS</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ENABLE_SSL</span>&quot;</span> = <span class="string">&quot;false&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改nginx配置, 不启用HTTPS</span></span><br><span class="line">    sed -i <span class="string">&#x27;/https/d&#x27;</span> /etc/nginx/nginx.conf</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每2个月更新一次, 并重启nginx容器</span></span><br><span class="line">    ssl_cron=<span class="string">&quot;0 0 1 */2 * <span class="variable">$dir</span>/refresh_cert.sh &amp;&amp; nginx -s reload 2&gt;&gt; /var/log/acme_tiny.log&quot;</span></span><br><span class="line">    crontab -l | &#123; <span class="built_in">cat</span>; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ssl_cron</span>&quot;</span>; &#125; | crontab -</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 前台启动</span></span><br><span class="line">nginx -g <span class="string">&quot;daemon off;&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中需要注意，当不启用 HTTPS 协议时，需要将 Nginx 配置修改为不启用 HTTPS；而启用时，会添加每 2 个月重新生成证书的定时任务。<code>nginx</code> 也需要改为前台启动模式，否则容器会因没有前台程序而自动退出。</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>前面的一切都准备就绪后，部署就异常简单了，后续再迁移时，也只需要简单做部署这一步就好了。</p>
<ul>
<li>配置环境变量</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> docker.example.env docker.env</span><br></pre></td></tr></table></figure>

<ul>
<li>获取HTTPS证书</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash dockerfiles/nginx/ssl/init_ssl.sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果无需支持HTTPS协议，则跳过此步骤，并将环境变量 <code>ENABLE_SSL</code> 修改为 <code>false</code>。</p>
</blockquote>
<ul>
<li>启动所有容器</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up --force-recreate --build -d</span><br></pre></td></tr></table></figure>

<p>如果一切顺利，那么运行 <code>docker ps -a</code> 命令就能看到已成功启动的容器，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED      STATUS      PORTS                    NAMES</span><br><span class="line">b0307bac08d7   blog_nodejs   <span class="string">&quot;sh /start.sh&quot;</span>           2 days ago   Up 2 days   0.0.0.0:4000-&gt;4000/tcp   nodejs</span><br><span class="line">e8ef7a1e9271   blog_nginx    <span class="string">&quot;/docker-entrypoint.…&quot;</span>   2 days ago   Up 2 days   0.0.0.0:80-&gt;80/tcp       nginx</span><br><span class="line">af7baad788c5   blog_php      <span class="string">&quot;docker-php-entrypoi…&quot;</span>   2 days ago   Up 2 days   9000/tcp                 php</span><br></pre></td></tr></table></figure>

<p>通过 <a target="_blank" rel="noopener" href="https://www.fanhaobai.com/">www.fanhaobai.com</a> 域名也可以直接访问到本站了。</p>
<blockquote>
<p>使用 <a target="_blank" rel="noopener" href="https://github.com/sigoden/webhook">webhook-cli</a> 工具可以支持代码自动部署，详细见 <a target="_blank" rel="noopener" href="https://www.fanhaobai.com/2018/03/hexo-deploy.html">我的博客发布上线方案 — Hexo</a>。</p>
</blockquote>
<p><strong>更新 <a href="#">»</a></strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/fan-haobai/disqus-php-api">disqus-php-api</a> 已替换为开源的 <a target="_blank" rel="noopener" href="https://github.com/SukkaW/DisqusJS">DisqusJS</a>，无需再单独部署。</li>
<li>博客源码 <a target="_blank" rel="noopener" href="https://github.com/howborn/blog">howborn&#x2F;blog</a>。</li>
</ul>

      
    </div>
    
    
    

    


    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag"># 工具</a>
          
            <a href="/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" rel="tag"># 系统设计</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020-12-26-how-to-apply-international-bank-card/" rel="next" title="如何申请境外银行卡">
                <i class="fa fa-chevron-left"></i> 如何申请境外银行卡
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/%E6%B8%A9%E6%95%85%E8%80%8C%E7%9F%A5%E6%96%B0%EF%BC%8C%E7%94%B1ADO.NET%E4%B8%8EDapper%E6%89%80%E8%81%94%E6%83%B3%E5%88%B0%E7%9A%84/" rel="prev" title="温故而知新，由 ADO.NET 与 Dapper 所联想到的">
                温故而知新，由 ADO.NET 与 Dapper 所联想到的 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">1460</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">895</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-4522670236044605"
     data-ad-slot="5358884258"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E7%8E%AF%E5%A2%83"><span class="nav-number">1.</span> <span class="nav-text">Docker 环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.1.</span> <span class="nav-text">云服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Docker"><span class="nav-number">1.2.</span> <span class="nav-text">安装 Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Docker-Compose"><span class="nav-number">1.3.</span> <span class="nav-text">安装 Docker Compose</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E6%94%B9%E9%80%A0"><span class="nav-number">2.</span> <span class="nav-text">项目改造</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">调整目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E6%8E%92%E5%AE%B9%E5%99%A8"><span class="nav-number">2.2.</span> <span class="nav-text">编排容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-docker-compose-yml"><span class="nav-number">2.3.</span> <span class="nav-text">配置 docker-compose.yml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-docker-env"><span class="nav-number">2.4.</span> <span class="nav-text">配置 docker.env</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-Dockerfile"><span class="nav-number">2.5.</span> <span class="nav-text">构建 Dockerfile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#NodeJS"><span class="nav-number">2.5.1.</span> <span class="nav-text">NodeJS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PHP"><span class="nav-number">2.5.2.</span> <span class="nav-text">PHP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Nginx"><span class="nav-number">2.5.3.</span> <span class="nav-text">Nginx</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-number">3.</span> <span class="nav-text">部署</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Laird Lau</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
